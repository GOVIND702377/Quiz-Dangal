import{as as C,f as E,r as n,j as e,h as b,M as P,a4 as T,ah as U}from"./react-vendor-c284acb6.js";import{u as B,a as L,s as y,B as N}from"./index-e74e2d11.js";import{m as c}from"./motion-b88ded6b.js";import"./vendor-3e030596.js";import"./supabase-97550265.js";const $=()=>{var u;const{id:o}=C(),v=E(),{toast:m}=B(),{user:x}=L(),[a,w]=n.useState(null),[k,z]=n.useState([]),[r,_]=n.useState(null),[R,S]=n.useState(!0);n.useEffect(()=>{A()},[o]);const A=async()=>{try{const{data:t}=await y.from("quizzes").select("*").eq("id",o).single();w(t);const{data:s}=await y.from("quiz_participants").select(`
          *,
          profiles (
            full_name,
            username,
            avatar_url
          )
        `).eq("quiz_id",o).eq("status","completed").order("score",{ascending:!1});z(s||[]);const i=s==null?void 0:s.find(l=>l.user_id===x.id);if(i){const l=s.findIndex(d=>d.user_id===x.id)+1;_({...i,rank:l})}}catch(t){console.error("Error fetching results:",t)}finally{S(!1)}};return R?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-indigo-600"})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(c.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Quiz Results"}),e.jsx("p",{className:"text-gray-600",children:a==null?void 0:a.title})]}),e.jsxs("div",{className:"flex justify-center gap-3 mb-8",children:[e.jsx(N,{variant:"outline",onClick:()=>v("/my-quizzes"),children:"Back to My Quizzes"}),e.jsx(N,{onClick:async()=>{var t;try{const s=window.location.href;(t=navigator.clipboard)!=null&&t.writeText?(await navigator.clipboard.writeText(s),m({title:"Link copied",description:"Result link copied to clipboard"})):window.prompt("Copy result link:",s)}catch(s){m({title:"Copy failed",description:s.message,variant:"destructive"})}},children:"Share Result"})]}),r&&e.jsx(c.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg mb-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:r.rank===1?e.jsx(b,{className:"h-16 w-16 text-yellow-500"}):r.rank===2?e.jsx(P,{className:"h-16 w-16 text-gray-400"}):r.rank===3?e.jsx(T,{className:"h-16 w-16 text-orange-500"}):e.jsx(U,{className:"h-16 w-16 text-blue-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Your Result"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-3xl font-bold text-indigo-600",children:["#",r.rank]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Rank"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:r.score}),e.jsx("p",{className:"text-sm text-gray-600",children:"Score"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:["â‚¹",r.rank<=3&&((u=a==null?void 0:a.prizes)==null?void 0:u[r.rank-1])||0]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Prize"})]})]})]})}),e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Prize Distribution"}),Array.isArray(a==null?void 0:a.prizes)&&a.prizes.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:a.prizes.map((t,s)=>e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50 flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-gray-700",children:s===0?"1st":s===1?"2nd":s===2?"3rd":`#${s+1}`}),e.jsxs("div",{className:"text-indigo-600 font-bold",children:["â‚¹",t]})]},s))}):e.jsx("div",{className:"text-sm text-gray-500",children:"No prize data available"})]}),e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-6 flex items-center",children:[e.jsx(b,{className:"mr-2 text-yellow-500"}),"Leaderboard"]}),e.jsx("div",{className:"space-y-4",children:k.map((t,s)=>{var i,l,d,h,f,g,p,j;return e.jsxs(c.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.1},className:`flex items-center justify-between p-4 rounded-lg ${t.user_id===x.id?"bg-indigo-100 border-2 border-indigo-300":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold",children:s+1}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center text-gray-600 font-bold",children:(i=t.profiles)!=null&&i.avatar_url?e.jsx("img",{src:t.profiles.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):e.jsx("span",{children:(((l=t.profiles)==null?void 0:l.full_name)||((d=t.profiles)==null?void 0:d.username)||"U").charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:((h=t.profiles)==null?void 0:h.username)||((f=t.profiles)==null?void 0:f.full_name)||"Anonymous"}),((g=t.profiles)==null?void 0:g.full_name)&&((p=t.profiles)==null?void 0:p.username)&&e.jsx("p",{className:"text-xs text-gray-600",children:t.profiles.full_name})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold text-green-600",children:t.score}),e.jsx("p",{className:"text-xs text-gray-600",children:"Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:["â‚¹",s<3&&((j=a==null?void 0:a.prizes)==null?void 0:j[s])||0]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Prize"})]}),s<3&&e.jsx("div",{className:"text-2xl",children:s===0?"ðŸ¥‡":s===1?"ðŸ¥ˆ":"ðŸ¥‰"})]})]},t.id)})})]})]})})};export{$ as default};
