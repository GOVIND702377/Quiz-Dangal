import{u as q,a as N,s as v,j as s,S}from"./index-aebac8b0.js";import{r}from"./react-8a702e3e.js";import{a as _}from"./router-bcacfb8d.js";import{b as C,B as E,T as L,c as k}from"./icons-b32a7949.js";import{m as I}from"./motion-511bde03.js";import"./supabase-4c1332f7.js";const T=[{title:"Opinion",slug:"opinion",icon:C},{title:"G.K Knowledge",slug:"gk",icon:E},{title:"Sports",slug:"sports",icon:L},{title:"Movies",slug:"movies",icon:k}],J=({tile:n,quizzes:f,onJoin:l,index:g,joiningId:u})=>{const a=f.find(d=>(d.category||"").toLowerCase()===n.slug.toLowerCase()),o=u&&a&&u===a.id,h=n.icon,m=["neon-orange","neon-purple","neon-teal","neon-pink"];return s.jsx(I.button,{type:"button",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},transition:{duration:.25,delay:g*.06},onClick:()=>{!a||o||l(a)},className:`neon-card ${m[g%m.length]} group aspect-square w-full rounded-xl focus:outline-none will-change-transform transform-gpu ${!a||o?"opacity-70 cursor-not-allowed":""}`,style:{borderRadius:"0.75rem"},"aria-disabled":!a||o,"aria-label":`${n.title} - ${a?o?"Joining…":"Play":"Coming soon"}`,children:s.jsx("div",{className:"neon-card-content select-none flex items-center justify-center",children:s.jsxs("div",{className:"w-full flex flex-col items-center justify-center gap-2",children:[s.jsx(h,{className:"w-8 h-8 text-white drop-shadow"}),s.jsx("h3",{className:"text-base font-extrabold leading-tight text-white text-shadow-sm text-center",children:n.title}),s.jsx("span",{className:"play-pill",children:o?"JOINING…":a?"PLAY":"SOON"})]})})})},Q=()=>{const{toast:n}=q(),f=_(),{user:l,userProfile:g,refreshUserProfile:u}=N(),[a,o]=r.useState([]),[h,m]=r.useState(!0),[d,w]=r.useState({open:!1,day:0,coins:0}),x=r.useRef(!1),[j,z]=r.useState(null),y=r.useCallback(async()=>{try{const{data:t,error:e}=await v.from("quizzes").select("*").order("start_time",{ascending:!0});if(e)throw e;o(t||[])}catch(t){console.error(t),n({title:"Error",description:"Could not fetch quizzes.",variant:"destructive"}),o([])}finally{m(!1)}},[n]);r.useEffect(()=>{y();const t=setInterval(y,3e4);return()=>clearInterval(t)},[y]),r.useEffect(()=>{if(!l||x.current)return;const e=setTimeout(async()=>{x.current=!0;try{const{data:i,error:c}=await v.rpc("handle_daily_login",{user_uuid:l.id});if(c)return console.error(c);i&&i.is_new_login&&(await u(l),w({open:!0,day:i.streak_day,coins:i.coins_earned}))}finally{x.current=!1}},1200);return()=>clearTimeout(e)},[l,u]);const b=async t=>{if(!(!t||j===t.id)){if(!l){n({title:"Login required",description:"Please sign in to join the quiz.",variant:"destructive"}),f("/login");return}z(t.id);try{const{data:e,error:i}=await v.rpc("join_quiz",{p_quiz_id:t.id});if(i)throw i;if(e&&e!=="Joined Successfully")throw new Error(e);n({title:"Joined!",description:"Redirecting you to the quiz."}),f(`/quiz/${t.id}`)}catch(e){const i=String((e==null?void 0:e.message)||"").toLowerCase();let c=(e==null?void 0:e.message)||"Could not join quiz.",p="Error";i.includes("not authenticated")?(p="Login required",c="Please sign in to join the quiz."):i.includes("insufficient balance")?(p="Insufficient balance",c="You do not have enough coins to join this quiz."):i.includes("quiz not active")&&(p="Quiz not active",c="This quiz is not active right now."),n({title:p,description:c,variant:"destructive"})}finally{z(null)}}};return s.jsxs("div",{className:"h-full relative overflow-hidden",children:[s.jsx("div",{className:"relative z-10 h-full flex items-center justify-center px-4 mt-1 sm:mt-2",children:s.jsx("div",{className:"w-full max-w-[420px]",children:s.jsx("div",{className:"grid grid-cols-2 gap-3",children:h?Array.from({length:4}).map((t,e)=>s.jsx("div",{className:"aspect-square w-full rounded-xl bg-slate-800/60 border border-slate-700/60 animate-pulse"},e)):T.map((t,e)=>s.jsx(J,{tile:t,quizzes:a,onJoin:b,index:e,joiningId:j},t.slug))})})}),s.jsx(S,{open:d.open,day:d.day,coins:d.coins,onClose:()=>w(t=>({...t,open:!1}))})]})};export{Q as default};
