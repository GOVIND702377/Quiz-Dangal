import{u as b,a as N,s as z,j as s,S as _}from"./index-30cc22b4.js";import{r as c}from"./react-8a702e3e.js";import{a as q}from"./router-bcacfb8d.js";import{b as S,B as C,T as J,c as L}from"./icons-5fedd17b.js";import{m as I}from"./motion-511bde03.js";import"./supabase-4c1332f7.js";const E=[{title:"Opinion",slug:"opinion",icon:S},{title:"G.K Knowledge",slug:"gk",icon:C},{title:"Sports",slug:"sports",icon:J},{title:"Movies",slug:"movies",icon:L}],k=({tile:i,quizzes:u,onJoin:y,index:h,joiningId:v,onOpenList:w,navigateTo:m})=>{const o=u.filter(n=>(n.category||"").toLowerCase()===i.slug.toLowerCase()).filter(n=>n.status==="upcoming"||n.status==="active").sort((n,f)=>new Date(n.start_time||n.end_time||0)-new Date(f.start_time||f.end_time||0))[0],r=v&&o&&v===o.id,x=i.icon,d=["neon-orange","neon-purple","neon-teal","neon-pink"],p=r?"JOINING…":o?o.status==="active"?"PLAY":"JOIN":"SOON";return s.jsx(I.button,{type:"button",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},transition:{duration:.25,delay:h*.06},onClick:()=>m(i.slug),className:`neon-card ${d[h%d.length]} group aspect-square w-full rounded-xl focus:outline-none will-change-transform transform-gpu ${!o||r?"opacity-70 cursor-not-allowed":""}`,style:{borderRadius:"0.75rem"},"aria-disabled":!o||r,"aria-label":`${i.title} - ${o?r?"Joining…":o.status==="active"?"Play":"Join":"Coming soon"}`,children:s.jsx("div",{className:"neon-card-content select-none flex items-center justify-center",children:s.jsxs("div",{className:"w-full flex flex-col items-center justify-center gap-2",children:[s.jsx(x,{className:"w-8 h-8 text-white drop-shadow"}),s.jsx("h3",{className:"text-base font-extrabold leading-tight text-white text-shadow-sm text-center",children:i.title}),s.jsx("span",{className:"play-pill",children:p})]})})})},Q=()=>{const{toast:i}=b(),u=q(),{user:y,userProfile:h,refreshUserProfile:v}=N(),[w,m]=c.useState([]),[j,o]=c.useState(!0),[r,x]=c.useState({open:!1,day:0,coins:0});c.useRef(!1);const[d,p]=c.useState(null),n=c.useCallback(async()=>{try{const{data:e,error:t}=await z.from("quizzes").select("id,title,category,start_time,end_time,status,prize_pool,prizes").order("start_time",{ascending:!0});if(t)throw t;m(e||[])}catch(e){console.error(e),i({title:"Error",description:"Could not fetch quizzes.",variant:"destructive"}),m([])}finally{o(!1)}},[i]);c.useEffect(()=>{n();const e=setInterval(n,6e4);return()=>clearInterval(e)},[n]);const f=async e=>{if(!(!e||d===e.id)){if(!y){i({title:"Login required",description:"Please sign in to join the quiz.",variant:"destructive"}),u("/login");return}p(e.id);try{const t=e.status==="upcoming"?"pre_join_quiz":"join_quiz",{data:a,error:l}=await z.rpc(t,{p_quiz_id:e.id});if(l)throw l;if(e.status==="upcoming")i({title:"Pre-joined!",description:"We will remind you 1 minute before start."});else{if(a&&a!=="Joined Successfully")throw new Error(a);i({title:"Joined!",description:"Redirecting you to the quiz."}),u(`/quiz/${e.id}`)}}catch(t){const a=String((t==null?void 0:t.message)||"").toLowerCase();let l=(t==null?void 0:t.message)||"Could not join quiz.",g="Error";a.includes("not authenticated")?(g="Login required",l="Please sign in to join the quiz."):a.includes("insufficient balance")?(g="Insufficient balance",l="You do not have enough coins to join this quiz."):a.includes("quiz not active")&&(g="Quiz not active",l="This quiz is not active right now."),i({title:g,description:l,variant:"destructive"})}finally{p(null)}}};return s.jsxs("div",{className:"h-full relative overflow-hidden",children:[s.jsx("div",{className:"relative z-10 h-full flex items-center justify-center px-4 mt-1 sm:mt-2",children:s.jsx("div",{className:"w-full max-w-[420px]",children:s.jsx("div",{className:"grid grid-cols-2 gap-3",children:j?Array.from({length:4}).map((e,t)=>s.jsx("div",{className:"aspect-square w-full rounded-xl bg-slate-800/60 border border-slate-700/60 animate-pulse"},t)):E.map((e,t)=>s.jsx(k,{tile:e,quizzes:w,onJoin:f,index:t,joiningId:d,navigateTo:a=>u(`/category/${a}`)},e.slug))})})}),s.jsx(_,{open:r.open,day:r.day,coins:r.coins,onClose:()=>x(e=>({...e,open:!1}))})]})};export{Q as default};
