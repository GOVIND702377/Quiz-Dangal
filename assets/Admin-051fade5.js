import{j as e,c as ee,a as te,u as W,s as d,B as g,L as p,I as c}from"./index-0a1e05c4.js";import{a as se,r as l}from"./react-8a702e3e.js";import{d as ie}from"./router-bcacfb8d.js";import{m as K}from"./motion-511bde03.js";import{J,L as R,K as ae,N as re,O as B,Q as ne}from"./icons-b32a7949.js";import"./supabase-4c1332f7.js";const V=se.forwardRef(({className:o,...a},z)=>e.jsx("textarea",{ref:z,className:ee("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",o),...a}));V.displayName="Textarea";function le(){const{toast:o}=W(),[a,z]=l.useState(""),[T,b]=l.useState(""),[D,I]=l.useState("announcement"),[h,S]=l.useState(""),[C,L]=l.useState(""),[k,v]=l.useState(!1),[i,m]=l.useState([]),[x,Q]=l.useState(!0),[A,F]=l.useState(""),[E,U]=l.useState(""),[r,N]=l.useState(!1),w=async()=>{Q(!0);const{data:n,error:y}=await d.from("notifications").select("*").order("created_at",{ascending:!1}).limit(20);y?o({title:"Load failed",description:y.message,variant:"destructive"}):m(n||[]),Q(!1)};l.useEffect(()=>{w()},[]);const q=async n=>{if(n.preventDefault(),!A.trim()||!E.trim()){o({title:"Title/Message required",variant:"destructive"});return}N(!0);try{const{error:y}=await d.functions.invoke("send-notifications",{body:{title:A.trim(),message:E.trim()}});if(y)throw y;o({title:"Push sent",description:"Notifications queued to subscribers."}),F(""),U("")}catch(y){o({title:"Push failed",description:y.message||"Try again later",variant:"destructive"})}finally{N(!1)}},$=async n=>{if(n.preventDefault(),!a.trim()||!T.trim()){o({title:"Title/Message required",variant:"destructive"});return}v(!0);try{const y={p_title:a.trim(),p_message:T.trim(),p_type:D,p_quiz_id:h||null,p_scheduled_at:C?new Date(C).toISOString():null},{error:M}=await d.rpc("create_notification",y);if(M)throw M;o({title:"Notification queued",description:"It will be delivered per schedule."}),z(""),b(""),S(""),L(""),I("announcement"),await w()}catch(y){o({title:"Send failed",description:y.message,variant:"destructive"})}finally{v(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent flex items-center",children:[e.jsx(ne,{className:"mr-2"})," Admin: Notifications"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Announcements aur quiz notifications yahan se bhejein"})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Send Push Notification"}),e.jsxs("form",{onSubmit:q,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"pushTitle",children:"Push Notification Title *"}),e.jsx(c,{id:"pushTitle",value:A,onChange:n=>F(n.target.value),placeholder:"e.g., New Quiz Alert!",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"pushMessage",children:"Push Notification Message *"}),e.jsx(V,{id:"pushMessage",value:E,onChange:n=>U(n.target.value),placeholder:"Don't miss out on today's quiz!",required:!0})]}),e.jsx(g,{type:"submit",disabled:r,className:"bg-purple-600 hover:bg-purple-700",children:r?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Push..."]}):"Send Push Notification"})]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:$,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"ntitle",children:"Title *"}),e.jsx(c,{id:"ntitle",value:a,onChange:n=>z(n.target.value),placeholder:"e.g., Quiz Starting Soon",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"ntype",children:"Type *"}),e.jsxs("select",{id:"ntype",value:D,onChange:n=>I(n.target.value),className:"w-full border rounded-md px-3 py-2",children:[e.jsx("option",{value:"announcement",children:"Announcement"}),e.jsx("option",{value:"quiz_start",children:"Quiz Start"}),e.jsx("option",{value:"quiz_end",children:"Quiz End"}),e.jsx("option",{value:"quiz_result",children:"Quiz Result"})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"nmsg",children:"Message *"}),e.jsx(V,{id:"nmsg",value:T,onChange:n=>b(n.target.value),placeholder:"Write your message...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"nquiz",children:"Quiz ID (optional)"}),e.jsx(c,{id:"nquiz",value:h,onChange:n=>S(n.target.value),placeholder:"UUID of quiz"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"nsched",children:"Schedule (optional)"}),e.jsx(c,{id:"nsched",type:"datetime-local",value:C,onChange:n=>L(n.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"submit",disabled:k,className:"bg-indigo-600 hover:bg-indigo-700",children:k?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):"Send Notification"}),e.jsx(g,{type:"button",variant:"outline",onClick:w,children:"Refresh"})]})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Recent"}),x?e.jsxs("div",{className:"py-8 text-center text-gray-600",children:[e.jsx(R,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):i.length===0?e.jsx("div",{className:"py-8 text-center text-gray-600",children:"No notifications"}):e.jsx("div",{className:"space-y-2",children:i.map(n=>e.jsx("div",{className:"p-3 rounded-xl bg-white/70 border border-gray-200/50 flex items-center justify-between text-sm",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800",children:[n.title," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",n.type,")"]})]}),e.jsx("div",{className:"text-gray-600",children:n.message}),e.jsxs("div",{className:"text-gray-500 text-xs",children:["Quiz: ",n.quiz_id||"—"," • Scheduled: ",n.scheduled_at?new Date(n.scheduled_at).toLocaleString():"now"," • Created: ",new Date(n.created_at).toLocaleString()]})]})},n.id))})]})]})}function pe(){const{userProfile:o}=te(),{toast:a}=W(),[z,T]=ie(),b=z.get("tab")||"overview",D=t=>{const s=new URLSearchParams(z);s.set("tab",t),T(s,{replace:!1})};if((o==null?void 0:o.role)!=="admin")return e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Aapke paas admin adhikaar nahi hain."})]});const[I,h]=l.useState([]),[S,C]=l.useState(!0),[L,k]=l.useState(!1),[v,i]=l.useState(null),[m,x]=l.useState(!1),[Q,A]=l.useState([]),[F,E]=l.useState(null),U=["opinion","gk","movies","sports"],[r,N]=l.useState({title:"",prizes:["","",""],start_time:"",end_time:"",result_time:"",category:""});l.useEffect(()=>{b==="overview"&&w()},[b]);const w=async()=>{try{const{data:t,error:s}=await d.from("quizzes").select("*").order("start_time",{ascending:!1});if(s)throw s;h(t||[])}catch(t){a({title:"Error",description:"Failed to fetch quizzes.",variant:"destructive"})}finally{C(!1)}},q=async t=>{try{const{data:s,error:u}=await d.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",t);if(u)throw u;A(s||[])}catch(s){a({title:"Error",description:"Failed to fetch questions.",variant:"destructive"})}},$=async()=>{if(!v)return;const t=window.prompt("Question text daalein");if(!t||!t.trim())return;const{error:s}=await d.from("questions").insert({quiz_id:v.id,question_text:t.trim()});if(s)return a({title:"Add failed",description:s.message,variant:"destructive"});await q(v.id)},n=async(t,s)=>{const u=(s||"").trim();if(!u)return a({title:"Question khaali nahi ho sakta",variant:"destructive"});const{error:_}=await d.from("questions").update({question_text:u}).eq("id",t);if(_)return a({title:"Update failed",description:_.message,variant:"destructive"});await q(v.id)},y=async t=>{if(!confirm("Is question aur iske options ko delete karein?"))return;const{error:s}=await d.from("questions").delete().eq("id",t);if(s)return a({title:"Delete failed",description:s.message,variant:"destructive"});await q(v.id)},M=async t=>{const s=window.prompt("Option text daalein");if(!s||!s.trim())return;const{error:u}=await d.from("options").insert({question_id:t,option_text:s.trim()});if(u)return a({title:"Add failed",description:u.message,variant:"destructive"});await q(v.id)},G=async(t,s)=>{const u=(s||"").trim();if(!u)return a({title:"Option khaali nahi ho sakta",variant:"destructive"});const{error:_}=await d.from("options").update({option_text:u}).eq("id",t);if(_)return a({title:"Update failed",description:_.message,variant:"destructive"});await q(v.id)},H=async t=>{if(!confirm("Is option ko delete karein?"))return;const{error:s}=await d.from("options").delete().eq("id",t);if(s)return a({title:"Delete failed",description:s.message,variant:"destructive"});await q(v.id)},X=async t=>{t.preventDefault();try{const s=r.prizes.filter(P=>P).map(P=>parseInt(P)),u=s.reduce((P,f)=>P+f,0),{data:_,error:O}=await d.from("quizzes").insert([{title:r.title,entry_fee:parseFloat(r.entry_fee),prize_pool:u,prizes:s,start_time:r.start_time,end_time:r.end_time,result_time:r.result_time,status:"upcoming",category:r.category||null}]).select("id").single();if(O)throw O;a({title:"Success",description:"Quiz create ho gaya."}),k(!1),N({title:"",entry_fee:"",prizes:["","",""],start_time:"",end_time:"",result_time:"",category:""}),w()}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}},Y=async t=>{if(confirm("Kya aap is quiz ko delete karna chahte hain?"))try{const{error:s}=await d.from("quizzes").delete().eq("id",t);if(s)throw s;a({title:"Success",description:"Quiz delete ho gaya."}),w()}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}},Z=async t=>{try{E(t);const{error:s}=await d.rpc("admin_recompute_quiz_results",{p_quiz_id:t});if(s)throw s;a({title:"Results recomputed",description:"Leaderboard update ho gaya."})}catch(s){a({title:"Recompute failed",description:s.message,variant:"destructive"})}finally{E(null)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Quiz Dangal Admin"}),e.jsx("p",{className:"text-gray-600",children:"Admin dashboard"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-6",children:[{key:"overview",title:"Overview"},{key:"notifications",title:"Notifications"},{key:"redemptions",title:"Redemptions"}].map(t=>e.jsx("button",{onClick:()=>D(t.key),className:`px-3 py-2 rounded-lg border text-sm transition-colors ${t.key===b?"bg-indigo-600 text-white border-indigo-600":"bg-white border-gray-200 hover:bg-gray-50"}`,children:t.title},t.key))}),b==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs(g,{onClick:()=>k(!0),className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Create New Quiz"]})}),L&&e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-1",children:"Create New Quiz"}),e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Category (Section)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:U.map(t=>e.jsx("button",{type:"button",onClick:()=>N({...r,category:t}),className:`px-3 py-1 rounded-full border text-sm capitalize ${r.category===t?"bg-indigo-600 text-white border-indigo-600":"bg-white border-gray-200 hover:bg-gray-50"}`,children:t},t))}),!r.category&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Please choose a category"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(p,{htmlFor:"title",children:"Quiz Title"}),e.jsx(c,{id:"title",value:r.title,onChange:t=>N({...r,title:t.target.value}),placeholder:"Daily Opinion Quiz - Evening",required:!0})]})}),e.jsxs("div",{children:[e.jsx(p,{children:"Prize Distribution (₹)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(c,{placeholder:"1st Prize (251)",value:r.prizes[0],onChange:t=>{const s=[...r.prizes];s[0]=t.target.value,N({...r,prizes:s})}}),e.jsx(c,{placeholder:"2nd Prize (151)",value:r.prizes[1],onChange:t=>{const s=[...r.prizes];s[1]=t.target.value,N({...r,prizes:s})}}),e.jsx(c,{placeholder:"3rd Prize (51)",value:r.prizes[2],onChange:t=>{const s=[...r.prizes];s[2]=t.target.value,N({...r,prizes:s})}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"start_time",children:"Start Time"}),e.jsx(c,{id:"start_time",type:"datetime-local",value:r.start_time,onChange:t=>N({...r,start_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"end_time",children:"End Time"}),e.jsx(c,{id:"end_time",type:"datetime-local",value:r.end_time,onChange:t=>N({...r,end_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"result_time",children:"Result Time"}),e.jsx(c,{id:"result_time",type:"datetime-local",value:r.result_time,onChange:t=>N({...r,result_time:t.target.value}),required:!0})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(g,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create Quiz"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>k(!1),children:"Cancel"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"All Quizzes"}),S?e.jsxs("div",{className:"py-8 text-center text-gray-600",children:[e.jsx(R,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading quizzes..."]}):I.map((t,s)=>{var u,_,O,P;return e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["Category: ",t.category||"—"]}),e.jsxs("span",{children:["Prize Pool: ₹",t.prize_pool]}),e.jsxs("span",{children:["Prizes: ₹",(u=t.prizes)==null?void 0:u.join(", ₹")]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.status==="upcoming"?"bg-blue-100 text-blue-800":t.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.status})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[e.jsxs("span",{children:["Start: ",new Date(t.start_time).toLocaleString()]}),e.jsxs("span",{className:"ml-4",children:["End: ",new Date(t.end_time).toLocaleString()]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-5 gap-2",children:[e.jsxs("select",{className:"border rounded-md px-2 py-2 capitalize",value:t.category||"",onChange:async f=>{const{error:j}=await d.from("quizzes").update({category:f.target.value}).eq("id",t.id);j?a({title:"Update failed",description:j.message,variant:"destructive"}):w()},children:[e.jsx("option",{value:"",children:"Select category"}),U.map(f=>e.jsx("option",{value:f,children:f},f))]}),e.jsx(c,{type:"datetime-local",value:((_=t.start_time)==null?void 0:_.slice(0,16))||"",onChange:async f=>{const{error:j}=await d.from("quizzes").update({start_time:f.target.value}).eq("id",t.id);j?a({title:"Update failed",description:j.message,variant:"destructive"}):w()}}),e.jsx(c,{type:"datetime-local",value:((O=t.end_time)==null?void 0:O.slice(0,16))||"",onChange:async f=>{const{error:j}=await d.from("quizzes").update({end_time:f.target.value}).eq("id",t.id);j?a({title:"Update failed",description:j.message,variant:"destructive"}):w()}}),e.jsx(c,{type:"datetime-local",value:((P=t.result_time)==null?void 0:P.slice(0,16))||"",onChange:async f=>{const{error:j}=await d.from("quizzes").update({result_time:f.target.value}).eq("id",t.id);j?a({title:"Update failed",description:j.message,variant:"destructive"}):w()}}),e.jsxs("select",{className:"border rounded-md px-2 py-2",value:t.status,onChange:async f=>{const{error:j}=await d.from("quizzes").update({status:f.target.value}).eq("id",t.id);j?a({title:"Update failed",description:j.message,variant:"destructive"}):w()},children:[e.jsx("option",{value:"upcoming",children:"upcoming"}),e.jsx("option",{value:"active",children:"active"}),e.jsx("option",{value:"finished",children:"finished"})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Z(t.id),disabled:F===t.id,className:"text-indigo-600 hover:text-indigo-700",children:F===t.id?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-1 animate-spin"}),"Recomputing"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Recompute"]})}),e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>{i(t),q(t.id),x(!0)},className:"text-blue-600 hover:text-blue-700",children:[e.jsx(re,{className:"h-4 w-4"}),"Questions"]}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Y(t.id),className:"text-red-600 hover:text-red-700",children:e.jsx(B,{className:"h-4 w-4"})})]})]})},t.id)})]}),m&&v&&e.jsxs("div",{className:"mt-6 bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Questions for: ",v.title]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:$,className:"bg-indigo-600 hover:bg-indigo-700",size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Add Question"]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>x(!1),children:"Close"})]})]}),Q.length===0?e.jsx("div",{className:"py-6 text-center text-gray-600",children:"No questions yet"}):e.jsx("div",{className:"space-y-4",children:Q.map(t=>e.jsxs("div",{className:"p-3 rounded-xl bg-white/70 border border-gray-200/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{defaultValue:t.question_text,onBlur:s=>n(t.id,s.target.value),className:"flex-1"}),e.jsx(g,{variant:"outline",size:"sm",className:"text-red-600 border-red-300",onClick:()=>y(t.id),children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 pl-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Options"}),e.jsxs("div",{className:"space-y-2",children:[(t.options||[]).map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{defaultValue:s.option_text,onBlur:u=>G(s.id,u.target.value),className:"flex-1"}),e.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-700",children:[e.jsx("input",{type:"checkbox",defaultChecked:!!s.is_correct,onChange:async u=>{const{error:_}=await d.from("options").update({is_correct:u.target.checked}).eq("id",s.id);_&&a({title:"Update failed",description:_.message,variant:"destructive"})}}),"Correct"]}),e.jsx(g,{variant:"outline",size:"sm",className:"text-red-600 border-red-300",onClick:()=>H(s.id),children:e.jsx(B,{className:"w-4 h-4"})})]},s.id)),e.jsxs(g,{onClick:()=>M(t.id),size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Add Option"]})]})]})]},t.id))})]})]}),b==="notifications"&&e.jsx(le,{}),b==="redemptions"&&e.jsx(de,{})]})}function de(){const{toast:o}=W(),[a,z]=l.useState([]),[T,b]=l.useState(!0),[D,I]=l.useState(!1),[h,S]=l.useState({title:"",coins_required:"",description:"",image_url:""}),C=async()=>{b(!0);const{data:i,error:m}=await d.from("reward_catalog").select("*").order("created_at",{ascending:!1});m?(o({title:"Load failed",description:m.message,variant:"destructive"}),z([])):z(i||[]),b(!1)};l.useEffect(()=>{C()},[]);const L=async i=>{var A,F;i.preventDefault();const m=h.title.trim(),x=parseInt(h.coins_required,10);if(!m||isNaN(x)||x<0){o({title:"Invalid input",description:"Title required and coins must be a non-negative number",variant:"destructive"});return}I(!0);const{error:Q}=await d.from("reward_catalog").insert({title:m,coins_required:x,description:((A=h.description)==null?void 0:A.trim())||null,image_url:((F=h.image_url)==null?void 0:F.trim())||null,is_active:!0});Q?o({title:"Add failed",description:Q.message,variant:"destructive"}):(o({title:"Added",description:"Catalog item created"}),S({title:"",coins_required:"",description:"",image_url:""}),C()),I(!1)},k=async(i,m)=>{const{error:x}=await d.from("reward_catalog").update(m).eq("id",i);x?o({title:"Update failed",description:x.message,variant:"destructive"}):C()},v=async i=>{if(!confirm("Delete this item?"))return;const{error:m}=await d.from("reward_catalog").delete().eq("id",i);m?o({title:"Delete failed",description:m.message,variant:"destructive"}):(o({title:"Deleted"}),C())};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Admin: Redemptions Catalog"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Items jinko users coins se redeem kar sakte hain"})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:L,className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"rc_title",children:"Title *"}),e.jsx(c,{id:"rc_title",value:h.title,onChange:i=>S({...h,title:i.target.value}),placeholder:"e.g., ₹100 Paytm",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"rc_coins",children:"Coins *"}),e.jsx(c,{id:"rc_coins",type:"number",min:"0",value:h.coins_required,onChange:i=>S({...h,coins_required:i.target.value}),placeholder:"e.g., 1000",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"rc_img",children:"Image URL (optional)"}),e.jsx(c,{id:"rc_img",value:h.image_url,onChange:i=>S({...h,image_url:i.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(p,{htmlFor:"rc_desc",children:"Description (optional)"}),e.jsx(V,{id:"rc_desc",value:h.description,onChange:i=>S({...h,description:i.target.value}),placeholder:"Short details"})]}),e.jsx("div",{children:e.jsx(g,{type:"submit",disabled:D,className:"bg-green-600 hover:bg-green-700",children:D?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):"Add Item"})})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Catalog Items"}),T?e.jsxs("div",{className:"py-8 text-center text-gray-600",children:[e.jsx(R,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):a.length===0?e.jsx("div",{className:"py-8 text-center text-gray-600",children:"No items"}):e.jsx("div",{className:"space-y-2",children:a.map(i=>e.jsxs("div",{className:"p-3 rounded-xl bg-white/70 border border-gray-200/50 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{defaultValue:i.title,onBlur:m=>{const x=m.target.value.trim();x&&x!==i.title&&k(i.id,{title:x})},className:"flex-1"}),e.jsx(c,{type:"number",min:"0",defaultValue:i.coins_required,onBlur:m=>{const x=parseInt(m.target.value,10);!isNaN(x)&&x!==i.coins_required&&k(i.id,{coins_required:x})},className:"w-32"})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1 truncate",children:i.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs text-gray-700 flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",defaultChecked:!!i.is_active,onChange:m=>k(i.id,{is_active:m.target.checked})})," Active"]}),e.jsx(g,{size:"sm",variant:"outline",className:"text-red-600 border-red-300",onClick:()=>v(i.id),children:e.jsx(B,{className:"w-4 h-4"})})]})]},i.id))})]})]})}export{pe as default};
