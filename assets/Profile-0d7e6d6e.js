import{a as K,s as h,j as e,B as X,P as Z}from"./index-d8c98b97.js";import{r as l}from"./react-8a702e3e.js";import{L as E}from"./router-f2cf3f51.js";import{S as ee}from"./SEO-4581ed8b.js";import{L as se,n as te,a as ae,S as re,C as ne,g as le,T as ie,d as oe,o as P,m as ce,I as de,p as xe,q as me,r as ue,f as he}from"./icons-52d1b41a.js";import"./supabase-4c1332f7.js";import"./motion-f69b6c08.js";function we(){var k,z,R,U;const{signOut:M}=K(),[A,p]=l.useState(!0),[x,I]=l.useState(null),[s,b]=l.useState(null),[j,m]=l.useState(""),[N,w]=l.useState(!1),[$,y]=l.useState(!1),[S,D]=l.useState(!1),[f,T]=l.useState(0),[L,O]=l.useState({nextLevel:1,nextReq:50,have:0,remaining:50,currReq:0}),u=l.useMemo(()=>[0,50,200,450,800,1250,1800,2450,3200,4050,5e3,6050,7200,8450,9800,11250,12800,14450,16200,18050,2e4,22050,24200,26450,28800,31250,33800,36450,39200,42050,45e3,48050,51200,54450,57800,61250,64800,68450,72200,76050,8e4,84050,88200,92450,96800,101250,105800,110450,115200,120050,125e3,130050,135200,140450,145800,151250,156800,162450,168200,174050,18e4,186050,192200,198450,204800,211250,217800,224450,231200,238050,245e3,252050,259200,266450,273800,281250,288800,296450,304200,312050,32e4,328050,336200,344450,352800,361250,369800,378450,387200,396050,405e3,414050,423200,432450,441800,451250,460800,470450,480200,490050,5e5],[]),C=l.useCallback(t=>{const n=Number(t||0);let a=0;for(let r=1;r<u.length&&n>=u[r];r++)a=r;return a},[u]),q=l.useCallback((t,n)=>{const a=Number(t||0),r=Math.max(0,Number(n||0)),i=100,o=Math.min(i,r+1),c=u[r]||0,d=u[o]||u[i],J=Math.max(0,(d||0)-a);return{nextLevel:o,nextReq:d,have:a,remaining:J,currReq:c}},[u]),g=l.useRef(null),v=l.useCallback(async()=>{p(!0);try{const{data:{session:t}}=await h.auth.getSession(),n=(t==null?void 0:t.user)||null;if(I(n),n){const{data:a,error:r}=await h.from("profiles").select("*").eq("id",n.id).single();if(r)throw r;b(a);const i=Number((a==null?void 0:a.total_coins)||0),o=C(i);if(T(o),O(q(i,o)),a!=null&&a.avatar_url)if(a.avatar_url.includes("://"))m(a.avatar_url);else{const{data:c,error:d}=await h.storage.from("avatars").createSignedUrl(a.avatar_url,3600);d?(console.warn("Avatar signed URL creation failed:",d),m("")):m((c==null?void 0:c.signedUrl)||"")}else m("")}else b(null),m("")}catch(t){b(null),m("")}finally{p(!1)}},[C,q]);l.useEffect(()=>{v()},[v]);const Q=async()=>{await M()},F=()=>{var t;return(t=g.current)==null?void 0:t.click()},W=async t=>{var a;const n=(a=t.target.files)==null?void 0:a[0];if(!(!n||!x)){w(!0);try{const r=`${x.id}/${Date.now()}-${n.name}`,{error:i}=await h.storage.from("avatars").upload(r,n,{upsert:!0});if(i)throw i;const{error:o}=await h.from("profiles").update({avatar_url:r}).eq("id",x.id);if(o)throw o;const{data:c,error:d}=await h.storage.from("avatars").createSignedUrl(r,60*60);d||m((c==null?void 0:c.signedUrl)||""),await v(),alert("Avatar updated")}catch(r){alert(`Avatar change failed: ${(r==null?void 0:r.message)||"Try again later"}`)}finally{w(!1),g.current&&(g.current.value="")}}},Y=t=>{const n=Number(t||0);return n>=80?"ring-[#8b5cf6]":n>=50?"ring-[#f59e0b]":n>=20?"ring-[#9ca3af]":"ring-[#cd7f32]"},_=(t,n)=>{const a=Number(t||0);if(Math.max(0,Number(n||0))>=100)return 100;const{nextReq:i,currReq:o}=L;if(!i||i<=o)return 0;const c=i-o,d=Math.max(0,Math.min(c,a-o));return Math.round(d/c*100)};if(A)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(se,{className:"w-8 h-8 animate-spin text-indigo-300"})});if(!x)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-800/40 text-indigo-300 flex items-center justify-center mb-3 border border-indigo-700/60",children:e.jsx(te,{className:"w-6 h-6"})}),e.jsxs("p",{className:"text-lg text-slate-200",children:["You are not logged in or session expired.",e.jsx("br",{}),"Please ",e.jsx(E,{to:"/login",className:"text-indigo-300 underline",children:"login"})," to view your profile."]})]});const B=[{label:"About Us",href:"/about-us",icon:de},{label:"Contact Us",href:"/contact-us",icon:xe},{label:"Terms & Conditions",href:"/terms-conditions",icon:me},{label:"Privacy Policy",href:"/privacy-policy",icon:ue},{label:"Refer & Earn",href:"/refer",icon:he}],H=Number((k=s==null?void 0:s.played_quizzes)!=null?k:0),V=Number((z=s==null?void 0:s.quiz_won)!=null?z:0),G=Number((R=s==null?void 0:s.referral_count)!=null?R:0);return e.jsxs("div",{className:"relative overflow-x-hidden",children:[e.jsx(ee,{title:"Your Quiz Dangal Profile",description:"View and manage your Quiz Dangal profile details, quiz preferences, and account settings.",canonical:"https://quizdangal.com/profile",robots:"noindex, nofollow"}),e.jsxs("div",{className:"mx-auto w-full px-3 sm:px-4 pt-3 pb-24 max-w-3xl space-y-3 overflow-x-hidden",children:[e.jsxs("div",{className:"qd-card relative overflow-hidden rounded-3xl p-4 shadow-2xl",children:[e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute -top-20 -right-20 h-56 w-56 rounded-full bg-gradient-to-tr from-indigo-500/20 via-fuchsia-400/15 to-transparent blur-3xl"}),e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute -bottom-24 -left-24 h-56 w-56 rounded-full bg-gradient-to-tr from-purple-500/15 via-pink-500/10 to-transparent blur-3xl"}),e.jsxs("div",{className:"flex flex-col gap-3 relative",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center -ml-2",children:[e.jsxs("div",{className:"relative w-[5.5rem] h-[5.5rem]",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-indigo-400/20 via-fuchsia-400/20 to-transparent blur-[3px] animate-spin",style:{animationDuration:"9s"}}),e.jsx("div",{className:`relative w-[5.5rem] h-[5.5rem] rounded-full overflow-hidden flex items-center justify-center text-slate-100 font-bold ring-2 ring-offset-2 ring-offset-slate-900 ${Y(f)} bg-gradient-to-br from-slate-800 to-slate-700 shadow-md`,children:j?e.jsx("img",{src:j,alt:s!=null&&s.full_name||s!=null&&s.username?`${s.full_name||s.username} avatar`:"User avatar",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:((s==null?void 0:s.full_name)||(x==null?void 0:x.email)||"U").charAt(0).toUpperCase()})})}),e.jsx("button",{onClick:F,disabled:N,className:"absolute -bottom-2 -right-2 p-2 rounded-xl bg-slate-900/80 border border-slate-700/60 shadow-sm text-slate-200 hover:bg-slate-800 transition disabled:opacity-60",title:N?"Uploadingâ€¦":"Change avatar",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("input",{ref:g,type:"file",accept:"image/*",className:"hidden",onChange:W})]}),e.jsxs("div",{className:"mt-1.5 text-center max-w-[12rem] sm:max-w-none mx-auto",children:[e.jsx("div",{className:"text-[11px] text-slate-400",children:"Email"}),e.jsx("div",{className:"text-sm font-medium text-slate-100 truncate",children:(s==null?void 0:s.email)||x.email})]})]}),e.jsxs("div",{className:"min-w-0 -mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[e.jsx(re,{className:"w-4 h-4 text-indigo-300"}),e.jsx("span",{children:"Welcome back"})]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate",children:s!=null&&s.username?`@${s.username}`:"Username not set"}),e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-2 text-xs",children:e.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-amber-900/20 text-amber-200 border border-amber-500/20",children:[e.jsx(ne,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:[Number((U=s==null?void 0:s.wallet_balance)!=null?U:0).toLocaleString()," Coins"]})]})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mt-1.5 inline-flex items-center gap-2 relative",children:[e.jsxs("button",{type:"button",onClick:()=>D(t=>!t),className:"px-2 py-0.5 rounded-full text-[11px] chip-accent-b focus:outline-none focus:ring-2 focus:ring-indigo-500/40",title:"Show next level info","aria-expanded":S,children:["Level ",f]}),S&&e.jsxs("div",{className:"absolute z-20 top-full left-0 mt-2 w-56 rounded-xl border border-slate-700/60 bg-slate-900/95 text-slate-100 shadow-xl p-3",children:[e.jsx("div",{className:"text-xs font-semibold mb-1",children:"Next Level Info"}),e.jsxs("div",{className:"text-[11px] text-slate-300 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Required"}),e.jsxs("span",{children:[Number(L.nextReq).toLocaleString()," coins"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"You have"}),e.jsxs("span",{children:[Number((s==null?void 0:s.total_coins)||0).toLocaleString()," coins"]})]})]})]})]}),e.jsxs("div",{className:"mt-1.5 relative h-2.5 bg-slate-800/70 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10"}),e.jsx("div",{className:"relative h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-fuchsia-500 shadow-[0_0_12px_rgba(99,102,241,0.35)]",style:{width:`${_(s==null?void 0:s.total_coins,f)}%`}}),e.jsxs("span",{className:"absolute right-1 top-1/2 -translate-y-1/2 text-[10px] text-slate-300",children:[_(s==null?void 0:s.total_coins,f),"%"]})]}),e.jsx("div",{className:"mt-1 text-[11px] text-slate-400",children:"to next level"})]}),e.jsx("div",{className:"pt-2 mt-1 w-full border-t border-gray-100",children:e.jsx(X,{onClick:()=>y(!0),size:"sm",variant:"brand",className:"rounded-xl",children:"Edit Profile"})})]})]}),e.jsx("div",{className:"qd-card rounded-3xl p-4 shadow-xl",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-indigo-900/30 border border-indigo-600/30",children:[e.jsx("span",{className:"w-10 h-10 rounded-xl bg-indigo-800/50 flex items-center justify-center text-indigo-200 shadow-inner",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-indigo-200/80",children:"Quizzes Played"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:H.toLocaleString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-emerald-900/25 border border-emerald-600/30",children:[e.jsx("span",{className:"w-10 h-10 rounded-xl bg-emerald-800/40 flex items-center justify-center text-emerald-200 shadow-inner",children:e.jsx(ie,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-emerald-200/80",children:"Quizzes Won"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:V.toLocaleString()})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-cyan-900/25 border border-cyan-600/30",children:[e.jsx("span",{className:"w-10 h-10 rounded-xl bg-cyan-800/40 flex items-center justify-center text-cyan-200 shadow-inner",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-cyan-200/80",children:"Friends Referred"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:G.toLocaleString()})]})]})]})}),e.jsx("div",{className:"qd-card rounded-3xl p-3 shadow-xl",children:e.jsx("div",{className:"flex flex-col gap-3",children:B.map((t,n)=>{const a=["chip-accent-d","chip-accent-a","chip-accent-b","chip-accent-c"][n%4],r=e.jsxs("div",{className:"group w-full flex items-center justify-between px-3.5 py-2.5 rounded-2xl border border-indigo-700/60 bg-indigo-900/40 hover:bg-indigo-900/60 transition shadow-sm hover:shadow-lg text-sm text-slate-100 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`w-9 h-9 rounded-xl ${a} group-hover:scale-[1.03] transition`,children:e.jsx(t.icon,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-semibold tracking-wide",children:t.label})]}),e.jsx(P,{className:"w-4 h-4 text-slate-500 group-hover:text-slate-300 transition"})]});return t.href?e.jsx(E,{to:t.href,tabIndex:0,className:"focus:outline-none focus:ring-2 focus:ring-indigo-500/40 rounded-2xl",children:r},n):e.jsx("button",{onClick:t.onClick,className:"text-left w-full focus:outline-none focus:ring-2 focus:ring-indigo-500/40 rounded-2xl",children:r},n)})})}),e.jsx("div",{className:"qd-card rounded-3xl p-3 shadow-xl",children:e.jsx("button",{onClick:Q,className:"w-full text-left focus:outline-none focus:ring-2 focus:ring-red-500/30 rounded-2xl",children:e.jsxs("div",{className:"group w-full flex items-center justify-between px-3.5 py-2.5 rounded-2xl border border-rose-700/40 bg-rose-900/10 hover:bg-rose-900/20 transition shadow-sm hover:shadow-md text-sm text-rose-300 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-9 h-9 rounded-xl bg-rose-900/30 text-rose-300 flex items-center justify-center shadow-sm border border-rose-700/40 group-hover:scale-[1.03] transition",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-semibold tracking-wide",children:"Logout"})]}),e.jsx(P,{className:"w-4 h-4 text-rose-400/70 group-hover:text-rose-300 transition"})]})})}),e.jsx(Z,{isOpen:$,onClose:()=>{y(!1),v()},isFirstTime:!1})]})]})}export{we as default};
