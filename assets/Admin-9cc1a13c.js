import{j as e,c as ee,a as te,u as W,s as l,B as g,L as p,I as c}from"./index-ec0de953.js";import{a as se,r as d}from"./react-8a702e3e.js";import{d as ie}from"./router-bcacfb8d.js";import{m as K}from"./motion-511bde03.js";import{J,L as R,K as re,N as ae,O as B,Q as ne}from"./icons-b32a7949.js";import"./supabase-4c1332f7.js";const V=se.forwardRef(({className:o,...r},z)=>e.jsx("textarea",{ref:z,className:ee("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",o),...r}));V.displayName="Textarea";function de(){const{toast:o}=W(),[r,z]=d.useState(""),[T,y]=d.useState(""),[D,I]=d.useState("announcement"),[h,S]=d.useState(""),[C,L]=d.useState(""),[k,f]=d.useState(!1),[i,u]=d.useState([]),[x,Q]=d.useState(!0),[A,F]=d.useState(""),[E,U]=d.useState(""),[a,N]=d.useState(!1),w=async()=>{Q(!0);const{data:n,error:b}=await l.from("notifications").select("*").order("created_at",{ascending:!1}).limit(20);b?o({title:"Load failed",description:b.message,variant:"destructive"}):u(n||[]),Q(!1)};d.useEffect(()=>{w()},[]);const q=async n=>{if(n.preventDefault(),!A.trim()||!E.trim()){o({title:"Title/Message required",variant:"destructive"});return}N(!0);try{const{error:b}=await l.functions.invoke("send-notifications",{body:{title:A.trim(),message:E.trim()}});if(b)throw b;o({title:"Push sent",description:"Notifications queued to subscribers."}),F(""),U("")}catch(b){o({title:"Push failed",description:b.message||"Try again later",variant:"destructive"})}finally{N(!1)}},$=async n=>{if(n.preventDefault(),!r.trim()||!T.trim()){o({title:"Title/Message required",variant:"destructive"});return}f(!0);try{const b={p_title:r.trim(),p_message:T.trim(),p_type:D,p_quiz_id:h||null,p_scheduled_at:C?new Date(C).toISOString():null},{error:M}=await l.rpc("create_notification",b);if(M)throw M;o({title:"Notification queued",description:"It will be delivered per schedule."}),z(""),y(""),S(""),L(""),I("announcement"),await w()}catch(b){o({title:"Send failed",description:b.message,variant:"destructive"})}finally{f(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent flex items-center",children:[e.jsx(ne,{className:"mr-2"})," Admin: Notifications"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Announcements aur quiz notifications yahan se bhejein"})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Send Push Notification"}),e.jsxs("form",{onSubmit:q,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"pushTitle",children:"Push Notification Title *"}),e.jsx(c,{id:"pushTitle",value:A,onChange:n=>F(n.target.value),placeholder:"e.g., New Quiz Alert!",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"pushMessage",children:"Push Notification Message *"}),e.jsx(V,{id:"pushMessage",value:E,onChange:n=>U(n.target.value),placeholder:"Don't miss out on today's quiz!",required:!0})]}),e.jsx(g,{type:"submit",disabled:a,className:"bg-purple-600 hover:bg-purple-700",children:a?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Push..."]}):"Send Push Notification"})]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:$,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"ntitle",children:"Title *"}),e.jsx(c,{id:"ntitle",value:r,onChange:n=>z(n.target.value),placeholder:"e.g., Quiz Starting Soon",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"ntype",children:"Type *"}),e.jsxs("select",{id:"ntype",value:D,onChange:n=>I(n.target.value),className:"w-full border rounded-md px-3 py-2",children:[e.jsx("option",{value:"announcement",children:"Announcement"}),e.jsx("option",{value:"quiz_start",children:"Quiz Start"}),e.jsx("option",{value:"quiz_end",children:"Quiz End"}),e.jsx("option",{value:"quiz_result",children:"Quiz Result"})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"nmsg",children:"Message *"}),e.jsx(V,{id:"nmsg",value:T,onChange:n=>y(n.target.value),placeholder:"Write your message...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"nquiz",children:"Quiz ID (optional)"}),e.jsx(c,{id:"nquiz",value:h,onChange:n=>S(n.target.value),placeholder:"UUID of quiz"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"nsched",children:"Schedule (optional)"}),e.jsx(c,{id:"nsched",type:"datetime-local",value:C,onChange:n=>L(n.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"submit",disabled:k,className:"bg-indigo-600 hover:bg-indigo-700",children:k?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):"Send Notification"}),e.jsx(g,{type:"button",variant:"outline",onClick:w,children:"Refresh"})]})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Recent"}),x?e.jsxs("div",{className:"py-8 text-center text-gray-600",children:[e.jsx(R,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):i.length===0?e.jsx("div",{className:"py-8 text-center text-gray-600",children:"No notifications"}):e.jsx("div",{className:"space-y-2",children:i.map(n=>e.jsx("div",{className:"p-3 rounded-xl bg-white/70 border border-gray-200/50 flex items-center justify-between text-sm",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800",children:[n.title," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",n.type,")"]})]}),e.jsx("div",{className:"text-gray-600",children:n.message}),e.jsxs("div",{className:"text-gray-500 text-xs",children:["Quiz: ",n.quiz_id||"—"," • Scheduled: ",n.scheduled_at?new Date(n.scheduled_at).toLocaleString():"now"," • Created: ",new Date(n.created_at).toLocaleString()]})]})},n.id))})]})]})}function pe(){const{userProfile:o}=te(),{toast:r}=W(),[z,T]=ie(),y=z.get("tab")||"overview",D=t=>{const s=new URLSearchParams(z);s.set("tab",t),T(s,{replace:!1})};if((o==null?void 0:o.role)!=="admin")return e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Aapke paas admin adhikaar nahi hain."})]});const[I,h]=d.useState([]),[S,C]=d.useState(!0),[L,k]=d.useState(!1),[f,i]=d.useState(null),[u,x]=d.useState(!1),[Q,A]=d.useState([]),[F,E]=d.useState(null),U=["opinion","gk","movies","sports"],[a,N]=d.useState({title:"",prizes:["","",""],start_time:"",end_time:"",result_time:"",category:""});d.useEffect(()=>{y==="overview"&&w()},[y]);const w=async()=>{try{const{data:t,error:s}=await l.from("quizzes").select("*").order("start_time",{ascending:!1});if(s)throw s;h(t||[])}catch(t){r({title:"Error",description:"Failed to fetch quizzes.",variant:"destructive"})}finally{C(!1)}},q=async t=>{try{const{data:s,error:m}=await l.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",t);if(m)throw m;A(s||[])}catch(s){r({title:"Error",description:"Failed to fetch questions.",variant:"destructive"})}},$=async()=>{if(!f)return;const t=window.prompt("Question text daalein");if(!t||!t.trim())return;const{error:s}=await l.from("questions").insert({quiz_id:f.id,question_text:t.trim()});if(s)return r({title:"Add failed",description:s.message,variant:"destructive"});await q(f.id)},n=async(t,s)=>{const m=(s||"").trim();if(!m)return r({title:"Question khaali nahi ho sakta",variant:"destructive"});const{error:_}=await l.from("questions").update({question_text:m}).eq("id",t);if(_)return r({title:"Update failed",description:_.message,variant:"destructive"});await q(f.id)},b=async t=>{if(!confirm("Is question aur iske options ko delete karein?"))return;const{error:s}=await l.from("questions").delete().eq("id",t);if(s)return r({title:"Delete failed",description:s.message,variant:"destructive"});await q(f.id)},M=async t=>{const s=window.prompt("Option text daalein");if(!s||!s.trim())return;const{error:m}=await l.from("options").insert({question_id:t,option_text:s.trim()});if(m)return r({title:"Add failed",description:m.message,variant:"destructive"});await q(f.id)},G=async(t,s)=>{const m=(s||"").trim();if(!m)return r({title:"Option khaali nahi ho sakta",variant:"destructive"});const{error:_}=await l.from("options").update({option_text:m}).eq("id",t);if(_)return r({title:"Update failed",description:_.message,variant:"destructive"});await q(f.id)},H=async t=>{if(!confirm("Is option ko delete karein?"))return;const{error:s}=await l.from("options").delete().eq("id",t);if(s)return r({title:"Delete failed",description:s.message,variant:"destructive"});await q(f.id)},X=async t=>{t.preventDefault();try{const s=a.prizes.filter(P=>P).map(P=>parseInt(P)),m=s.reduce((P,v)=>P+v,0),{data:_,error:O}=await l.from("quizzes").insert([{title:a.title,entry_fee:parseFloat(a.entry_fee),prize_pool:m,prizes:s,start_time:a.start_time,end_time:a.end_time,result_time:a.result_time,status:"upcoming",category:a.category||null}]).select("id").single();if(O)throw O;r({title:"Success",description:"Quiz create ho gaya."}),k(!1),N({title:"",entry_fee:"",prizes:["","",""],start_time:"",end_time:"",result_time:"",category:""}),w()}catch(s){r({title:"Error",description:s.message,variant:"destructive"})}},Y=async t=>{if(confirm("Kya aap is quiz ko delete karna chahte hain?"))try{const{error:s}=await l.from("quizzes").delete().eq("id",t);if(s)throw s;r({title:"Success",description:"Quiz delete ho gaya."}),w()}catch(s){r({title:"Error",description:s.message,variant:"destructive"})}},Z=async t=>{try{E(t);const{error:s}=await l.rpc("admin_recompute_quiz_results",{p_quiz_id:t});if(s)throw s;r({title:"Results recomputed",description:"Leaderboard update ho gaya."})}catch(s){r({title:"Recompute failed",description:s.message,variant:"destructive"})}finally{E(null)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl text-foreground",children:[e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Quiz Dangal Admin"}),e.jsx("p",{className:"text-muted-foreground",children:"Admin dashboard"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-6",children:[{key:"overview",title:"Overview"},{key:"notifications",title:"Notifications"},{key:"redemptions",title:"Redemptions"}].map(t=>e.jsx("button",{onClick:()=>D(t.key),className:`px-3 py-2 rounded-lg border text-sm transition-colors ${t.key===y?"bg-primary text-primary-foreground border-transparent shadow":"bg-muted text-muted-foreground border-border hover:text-foreground"} `,children:t.title},t.key))}),y==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs(g,{onClick:()=>k(!0),className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Create New Quiz"]})}),L&&e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-1",children:"Create New Quiz"}),e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Category (Section)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:U.map(t=>e.jsx("button",{type:"button",onClick:()=>N({...a,category:t}),className:`px-3 py-1 rounded-full border text-sm capitalize ${a.category===t?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border hover:text-foreground"}`,children:t},t))}),!a.category&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:"Please choose a category"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(p,{htmlFor:"title",children:"Quiz Title"}),e.jsx(c,{id:"title",value:a.title,onChange:t=>N({...a,title:t.target.value}),placeholder:"Daily Opinion Quiz - Evening",required:!0})]})}),e.jsxs("div",{children:[e.jsx(p,{children:"Prize Distribution (₹)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(c,{placeholder:"1st Prize (251)",value:a.prizes[0],onChange:t=>{const s=[...a.prizes];s[0]=t.target.value,N({...a,prizes:s})}}),e.jsx(c,{placeholder:"2nd Prize (151)",value:a.prizes[1],onChange:t=>{const s=[...a.prizes];s[1]=t.target.value,N({...a,prizes:s})}}),e.jsx(c,{placeholder:"3rd Prize (51)",value:a.prizes[2],onChange:t=>{const s=[...a.prizes];s[2]=t.target.value,N({...a,prizes:s})}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"start_time",children:"Start Time"}),e.jsx(c,{id:"start_time",type:"datetime-local",value:a.start_time,onChange:t=>N({...a,start_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"end_time",children:"End Time"}),e.jsx(c,{id:"end_time",type:"datetime-local",value:a.end_time,onChange:t=>N({...a,end_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"result_time",children:"Result Time"}),e.jsx(c,{id:"result_time",type:"datetime-local",value:a.result_time,onChange:t=>N({...a,result_time:t.target.value}),required:!0})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(g,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create Quiz"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>k(!1),children:"Cancel"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"All Quizzes"}),S?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(R,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading quizzes..."]}):I.map((t,s)=>{var m,_,O,P;return e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Category: ",t.category||"—"]}),e.jsxs("span",{children:["Prize Pool: ₹",t.prize_pool]}),e.jsxs("span",{children:["Prizes: ₹",(m=t.prizes)==null?void 0:m.join(", ₹")]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.status==="upcoming"?"bg-blue-600/10 text-blue-700 dark:text-blue-300":t.status==="active"?"bg-green-600/10 text-green-700 dark:text-green-300":"bg-muted text-foreground/80"}`,children:t.status})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Start: ",new Date(t.start_time).toLocaleString()]}),e.jsxs("span",{className:"ml-4",children:["End: ",new Date(t.end_time).toLocaleString()]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-5 gap-2",children:[e.jsxs("select",{className:"border border-border bg-background text-foreground rounded-md px-2 py-2 capitalize",value:t.category||"",onChange:async v=>{const{error:j}=await l.from("quizzes").update({category:v.target.value}).eq("id",t.id);j?r({title:"Update failed",description:j.message,variant:"destructive"}):w()},children:[e.jsx("option",{value:"",children:"Select category"}),U.map(v=>e.jsx("option",{value:v,children:v},v))]}),e.jsx(c,{type:"datetime-local",value:((_=t.start_time)==null?void 0:_.slice(0,16))||"",onChange:async v=>{const{error:j}=await l.from("quizzes").update({start_time:v.target.value}).eq("id",t.id);j?r({title:"Update failed",description:j.message,variant:"destructive"}):w()}}),e.jsx(c,{type:"datetime-local",value:((O=t.end_time)==null?void 0:O.slice(0,16))||"",onChange:async v=>{const{error:j}=await l.from("quizzes").update({end_time:v.target.value}).eq("id",t.id);j?r({title:"Update failed",description:j.message,variant:"destructive"}):w()}}),e.jsx(c,{type:"datetime-local",value:((P=t.result_time)==null?void 0:P.slice(0,16))||"",onChange:async v=>{const{error:j}=await l.from("quizzes").update({result_time:v.target.value}).eq("id",t.id);j?r({title:"Update failed",description:j.message,variant:"destructive"}):w()}}),e.jsxs("select",{className:"border border-border bg-background text-foreground rounded-md px-2 py-2",value:t.status,onChange:async v=>{const{error:j}=await l.from("quizzes").update({status:v.target.value}).eq("id",t.id);j?r({title:"Update failed",description:j.message,variant:"destructive"}):w()},children:[e.jsx("option",{value:"upcoming",children:"upcoming"}),e.jsx("option",{value:"active",children:"active"}),e.jsx("option",{value:"finished",children:"finished"})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Z(t.id),disabled:F===t.id,className:"text-indigo-600 hover:text-indigo-700",children:F===t.id?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-1 animate-spin"}),"Recomputing"]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Recompute"]})}),e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>{i(t),q(t.id),x(!0)},className:"text-blue-600 hover:text-blue-700",children:[e.jsx(ae,{className:"h-4 w-4"}),"Questions"]}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Y(t.id),className:"text-red-600 hover:text-red-700",children:e.jsx(B,{className:"h-4 w-4"})})]})]})},t.id)})]}),u&&f&&e.jsxs("div",{className:"mt-6 bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["Questions for: ",f.title]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:$,className:"bg-indigo-600 hover:bg-indigo-700",size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Add Question"]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>x(!1),children:"Close"})]})]}),Q.length===0?e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:"No questions yet"}):e.jsx("div",{className:"space-y-4",children:Q.map(t=>e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{defaultValue:t.question_text,onBlur:s=>n(t.id,s.target.value),className:"flex-1"}),e.jsx(g,{variant:"outline",size:"sm",className:"text-red-600 border-red-300",onClick:()=>b(t.id),children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 pl-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Options"}),e.jsxs("div",{className:"space-y-2",children:[(t.options||[]).map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{defaultValue:s.option_text,onBlur:m=>G(s.id,m.target.value),className:"flex-1"}),e.jsxs("label",{className:"flex items-center gap-1 text-xs text-foreground/80",children:[e.jsx("input",{type:"checkbox",defaultChecked:!!s.is_correct,onChange:async m=>{const{error:_}=await l.from("options").update({is_correct:m.target.checked}).eq("id",s.id);_&&r({title:"Update failed",description:_.message,variant:"destructive"})}}),"Correct"]}),e.jsx(g,{variant:"outline",size:"sm",className:"text-red-600 border-red-300",onClick:()=>H(s.id),children:e.jsx(B,{className:"w-4 h-4"})})]},s.id)),e.jsxs(g,{onClick:()=>M(t.id),size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Add Option"]})]})]})]},t.id))})]})]}),y==="notifications"&&e.jsx(de,{}),y==="redemptions"&&e.jsx(le,{})]})}function le(){const{toast:o}=W(),[r,z]=d.useState([]),[T,y]=d.useState(!0),[D,I]=d.useState(!1),[h,S]=d.useState({title:"",coins_required:"",description:"",image_url:""}),C=async()=>{y(!0);const{data:i,error:u}=await l.from("reward_catalog").select("*").order("created_at",{ascending:!1});u?(o({title:"Load failed",description:u.message,variant:"destructive"}),z([])):z(i||[]),y(!1)};d.useEffect(()=>{C()},[]);const L=async i=>{var A,F;i.preventDefault();const u=h.title.trim(),x=parseInt(h.coins_required,10);if(!u||isNaN(x)||x<0){o({title:"Invalid input",description:"Title required and coins must be a non-negative number",variant:"destructive"});return}I(!0);const{error:Q}=await l.from("reward_catalog").insert({title:u,coins_required:x,description:((A=h.description)==null?void 0:A.trim())||null,image_url:((F=h.image_url)==null?void 0:F.trim())||null,is_active:!0});Q?o({title:"Add failed",description:Q.message,variant:"destructive"}):(o({title:"Added",description:"Catalog item created"}),S({title:"",coins_required:"",description:"",image_url:""}),C()),I(!1)},k=async(i,u)=>{const{error:x}=await l.from("reward_catalog").update(u).eq("id",i);x?o({title:"Update failed",description:x.message,variant:"destructive"}):C()},f=async i=>{if(!confirm("Delete this item?"))return;const{error:u}=await l.from("reward_catalog").delete().eq("id",i);u?o({title:"Delete failed",description:u.message,variant:"destructive"}):(o({title:"Deleted"}),C())};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Admin: Redemptions Catalog"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Items jinko users coins se redeem kar sakte hain"})]}),e.jsx("div",{className:"bg-card text-card-foreground border border-border rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:L,className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"rc_title",children:"Title *"}),e.jsx(c,{id:"rc_title",value:h.title,onChange:i=>S({...h,title:i.target.value}),placeholder:"e.g., ₹100 Paytm",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"rc_coins",children:"Coins *"}),e.jsx(c,{id:"rc_coins",type:"number",min:"0",value:h.coins_required,onChange:i=>S({...h,coins_required:i.target.value}),placeholder:"e.g., 1000",required:!0})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"rc_img",children:"Image URL (optional)"}),e.jsx(c,{id:"rc_img",value:h.image_url,onChange:i=>S({...h,image_url:i.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(p,{htmlFor:"rc_desc",children:"Description (optional)"}),e.jsx(V,{id:"rc_desc",value:h.description,onChange:i=>S({...h,description:i.target.value}),placeholder:"Short details"})]}),e.jsx("div",{children:e.jsx(g,{type:"submit",disabled:D,className:"bg-green-600 hover:bg-green-700",children:D?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):"Add Item"})})]})}),e.jsxs("div",{className:"bg-card text-card-foreground border border-border rounded-2xl p-4 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Catalog Items"}),T?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(R,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):r.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No items"}):e.jsx("div",{className:"space-y-2",children:r.map(i=>e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{defaultValue:i.title,onBlur:u=>{const x=u.target.value.trim();x&&x!==i.title&&k(i.id,{title:x})},className:"flex-1"}),e.jsx(c,{type:"number",min:"0",defaultValue:i.coins_required,onBlur:u=>{const x=parseInt(u.target.value,10);!isNaN(x)&&x!==i.coins_required&&k(i.id,{coins_required:x})},className:"w-32"})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1 truncate",children:i.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs text-foreground/80 flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",defaultChecked:!!i.is_active,onChange:u=>k(i.id,{is_active:u.target.checked})})," Active"]}),e.jsx(g,{size:"sm",variant:"outline",className:"text-red-600 border-red-300",onClick:()=>f(i.id),children:e.jsx(B,{className:"w-4 h-4"})})]})]},i.id))})]})]})}export{pe as default};
