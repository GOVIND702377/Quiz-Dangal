import{l as B,a as M,b as O,u as U,r as s,s as u,j as e,L as w,m as l,B as C,T as H,n as J}from"./index-d3eb7f4e.js";import{C as E}from"./check-circle-d442b788.js";import{C as Q}from"./clock-d8a55c36.js";import{U as V}from"./users-efad5444.js";const Z=()=>{var _;const{id:m}=B(),d=M(),{user:f}=O(),{toast:i}=U(),[n,k]=s.useState(null),[c,T]=s.useState([]),[x,L]=s.useState(0),[p,A]=s.useState({}),[r,j]=s.useState("loading"),[v,D]=s.useState(0),[h,N]=s.useState(!1),[F,P]=s.useState(0),z=s.useCallback(async()=>{try{const{data:t,error:o}=await u.from("quiz_participants").select("*").eq("user_id",f.id).eq("quiz_id",m).single();if(o||!t){i({title:"Not Joined",description:"You have not joined this quiz.",variant:"destructive"}),d("/");return}if(t.status==="completed"){j("completed");return}const{data:a,error:b}=await u.from("quizzes").select("*").eq("id",m).single();if(b||!a){i({title:"Error",description:"Quiz not found.",variant:"destructive"}),d("/");return}k(a);const{data:y,error:I}=await u.from("questions").select(`
          id,
          question_text,
          options (
            id,
            option_text
          )
        `).eq("quiz_id",m).order("id");if(I||!y||y.length===0){i({title:"Error",description:"Could not load questions.",variant:"destructive"}),d("/");return}T(y);const{count:R}=await u.from("quiz_participants").select("*",{count:"exact",head:!0}).eq("quiz_id",m).eq("status","joined");P(R||0)}catch(t){console.error("Error fetching quiz data:",t),i({title:"Error",description:"Failed to load quiz.",variant:"destructive"}),d("/")}},[m,f.id,d,i]);s.useEffect(()=>{z()},[z]),s.useEffect(()=>{if(!n||r==="loading"||r==="completed")return;const t=setInterval(()=>{new Date(n.start_time),new Date(n.end_time),j("active"),D(600)},1e3);return()=>clearInterval(t)},[n,r]),s.useEffect(()=>{r==="finished"&&Object.keys(p).length>0&&!h&&q()},[r]);const Y=async(t,o)=>{try{const{error:a}=await u.from("user_answers").upsert({user_id:f.id,question_id:t,selected_option_id:o});if(a)throw a;A(b=>({...b,[t]:o})),x<c.length-1&&setTimeout(()=>{L(b=>b+1)},500),i({title:"Answer Saved",description:"Your answer has been recorded."})}catch(a){console.error("Error saving answer:",a),i({title:"Error",description:"Failed to save answer. Please try again.",variant:"destructive"})}},q=async()=>{if(!h){N(!0);try{const{error:t}=await u.from("quiz_participants").update({status:"completed"}).eq("user_id",f.id).eq("quiz_id",m);if(t)throw t;i({title:"Quiz Completed!",description:"Your answers have been submitted. Results will be announced soon!"}),j("completed"),setTimeout(()=>{d("/my-quizzes")},3e3)}catch(t){console.error("Error submitting quiz:",t),i({title:"Submission Failed",description:"Could not submit your answers. Please try again.",variant:"destructive"})}finally{N(!1)}}},S=t=>{const o=Math.floor(t/60),a=t%60;return`${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};if(r==="loading"||!n)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-16 w-16 animate-spin text-indigo-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading quiz..."})]})});if(r==="completed")return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-8 shadow-xl text-center max-w-md",children:[e.jsx(E,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Quiz Completed!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You have already submitted your answers for this quiz."}),e.jsx(C,{onClick:()=>d("/my-quizzes"),className:"w-full",children:"View My Quizzes"})]})});if(r==="waiting")return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-8 shadow-xl text-center max-w-md",children:[e.jsx(Q,{className:"h-16 w-16 text-indigo-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:n.title}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Quiz starts in:"}),e.jsx("div",{className:"text-4xl font-bold text-indigo-600 mb-4",children:S(v)}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),F," joined"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"â‚¹",n.prize_pool," prize pool"]})]})]})});if(r==="finished")return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-8 shadow-xl text-center max-w-md",children:[e.jsx(Q,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Quiz Ended"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The quiz has ended. Results will be announced soon!"}),h&&e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(w,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Submitting your answers..."})]})]})});if(c.length===0)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-600",children:"No questions available for this quiz."})})});const g=c[x],$=(x+1)/c.length*100;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs(l.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-800",children:n.title}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Question ",x+1," of ",c.length]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:S(v)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Time Left"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-4",children:e.jsx(l.div,{className:"bg-gradient-to-r from-indigo-500 to-purple-600 h-2 rounded-full",style:{width:`${$}%`},transition:{duration:.5}})})]}),e.jsx(J,{mode:"wait",children:e.jsxs(l.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-center text-gray-800 mb-8",children:g.question_text}),e.jsx("div",{className:"space-y-4",children:(_=g.options)==null?void 0:_.map((t,o)=>e.jsxs(l.button,{onClick:()=>Y(g.id,t.id),whileHover:{scale:1.02},whileTap:{scale:.98},className:`w-full p-4 rounded-xl text-left font-medium transition-all duration-200 shadow-md border-2 ${p[g.id]===t.id?"bg-gradient-to-r from-green-400 to-emerald-500 text-white border-green-600":"bg-white hover:bg-indigo-50 border-gray-200 text-gray-700"}`,children:[e.jsxs("span",{className:"font-bold mr-3 text-indigo-600",children:[String.fromCharCode(65+o),"."]}),t.option_text]},t.id))}),x===c.length-1&&Object.keys(p).length===c.length&&e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-8",children:e.jsx(C,{onClick:q,disabled:h,className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-4 text-lg",children:h?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-6 w-6 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-6 w-6"}),"Submit Quiz"]})})})]},g.id)})]})})};export{Z as default};
