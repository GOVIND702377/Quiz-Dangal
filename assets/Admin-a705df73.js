import{j as e,o as Re,u as ee,a as Ie,s as d,H as ue,h as Pe,B as f,A as he,m as K,L as S,I as P,q as W}from"./index-ab473ad1.js";import{a as N,r as E}from"./react-63c462fe.js";import{d as qe,L as Le}from"./router-10fed1f4.js";import{L as $,Y as ae,Z as Te,m as De,u as Qe,_ as Me,$ as $e}from"./icons-590232b1.js";import"./supabase-07ebd5d8.js";const ie=N.forwardRef(({className:l,...g},z)=>e.jsx("textarea",{ref:z,className:Re("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",l),...g}));ie.displayName="Textarea";const fe=[{value:"opinion",label:"Opinion"},{value:"gk",label:"General Knowledge"},{value:"sports",label:"Sports"},{value:"movies",label:"Movies"}],ge=l=>{var g;return((g=fe.find(z=>z.value===l))==null?void 0:g.label)||l},J=()=>({text:"",options:["","",""],correctIndex:0});function Z(l,g,{fallback:z=0}={}){return g==null&&(g=z),l==="coins"?`${g} coins`:l==="others"?`${g}`:`₹${g}`}function Fe(l,{allowZeroCorrect:g=!1}={}){var C,L;const z=String(l||"").trim().split(/\n\s*\n+/),k=[],q=[],j=[];let b=0;for(const w of z){const R=w.split(/\r?\n/).map(c=>c.trim()).filter(Boolean);if(!R.length)continue;b+=1;const I=R[0].replace(/^Q\d*\.?\s*/i,"").replace(/^Question\s*[:-]\s*/i,""),v=[];let A="";for(let c=1;c<R.length;c++){const h=R[c];if(/^ans(wer)?\s*[:-]/i.test(h)){A=h;continue}const a=h.match(/^[-*•]?\s*\[(x|X| )\]\s*(.+)$/);if(a){v.push({option_text:a[2].trim(),is_correct:/x/i.test(a[1])});continue}const i=h.match(/^(?:[-*•]|[A-Da-d]\)|\d+\)|[A-Da-d][.:])\s*(.+)$/),r=i?i[1].trim():h.replace(/^[*]\s*/,"").trim();r&&v.push({option_text:r,is_correct:/^\*/.test(h)})}if(A){const c=A.split(/[:-]/).slice(1).join(":").trim(),h=(L=(C=c.match(/^[A-D]/i))==null?void 0:C[0])==null?void 0:L.toUpperCase(),a=h?{A:0,B:1,C:2,D:3}[h]:NaN,i=parseInt(c,10);if(!Number.isNaN(a)&&v[a])v.forEach((r,p)=>r.is_correct=p===a);else if(!Number.isNaN(i)&&v[i-1])v.forEach((r,p)=>r.is_correct=p===i-1);else{const r=c.toLowerCase(),p=v.findIndex(_=>_.option_text.toLowerCase()===r||_.option_text.toLowerCase().includes(r));p>=0&&v.forEach((_,M)=>_.is_correct=M===p)}}let o=v.filter(c=>c.option_text);if(o.length>4){const c=o.findIndex(h=>h.is_correct);if(c>=0){const h=o[c],a=o.filter((i,r)=>r!==c);o=[h,...a.slice(0,3)]}else o=o.slice(0,4);j.push(`Q${b}: Trimmed to 4 options.`)}if(!I){q.push(`Q${b}: Missing question text.`);continue}if(o.length<2){q.push(`Q${b}: Need at least 2 options.`);continue}if(g)o=o.map(c=>({...c,is_correct:!1}));else{const c=o.filter(h=>h.is_correct).length;if(c===0)o[0].is_correct=!0;else if(c>1){let h=!1;o=o.map(a=>a.is_correct&&!h?(h=!0,a):{...a,is_correct:!1})}}k.push({question_text:I,options:o})}return{items:k,errors:q,warnings:j}}function He(){var de;const{toast:l}=ee(),{userProfile:g,loading:z,user:k}=Ie(),[q,j]=qe(),b=q.get("tab")||"overview",C=s=>{q.set("tab",s),j(q,{replace:!0})},[L,w]=E.useState([]),[R,I]=E.useState(!1),[v,A]=E.useState(!1),[o,c]=E.useState({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),[h,a]=E.useState("form"),[i,r]=E.useState([J()]),[p,_]=E.useState(null),[M,F]=E.useState([]),[O,re]=E.useState(null),[ve,ye]=E.useState(!1),B=o.category==="opinion",je=E.useMemo(()=>{try{const s=String({}.VITE_ADMIN_EMAILS||"").trim();return s?new Set(s.split(/[\s,]+/).map(t=>t.trim().toLowerCase()).filter(Boolean)):new Set}catch(s){return new Set}},[]),be=String((g==null?void 0:g.role)||"").trim().toLowerCase(),ne=String((k==null?void 0:k.email)||"").trim().toLowerCase(),_e=String(((de=k==null?void 0:k.app_metadata)==null?void 0:de.role)||"").trim().toLowerCase(),T=be==="admin"||_e==="admin"||ne&&je.has(ne),X=E.useCallback(async()=>{if(!T){I(!1),w([]);return}if(I(!0),!d){w([]),I(!1);return}const{data:s,error:t}=await d.from("quizzes").select("id,title,category,prizes,prize_pool,prize_type,start_time,end_time").order("start_time",{ascending:!1});t?l({title:"Fetch failed",description:t.message,variant:"destructive"}):w(s||[]),I(!1)},[l,T]),we=E.useCallback(async s=>{if(!T){F([]);return}if(!d){F([]);return}const{data:t,error:x}=await d.from("questions").select("id,question_text,options(id,option_text,is_correct)").eq("quiz_id",s);x?l({title:"Questions failed",description:x.message,variant:"destructive"}):F(t||[])},[l,T]);E.useEffect(()=>{z||X()},[X,z]);const Ne=async s=>{s.preventDefault();try{if(!T){l({title:"Access denied",description:"Only admins can create quizzes.",variant:"destructive"});return}const t=[];o.category||t.push("Select category"),o.title.trim()||t.push("Title required"),(!o.start_time||!o.end_time)&&t.push("Start & End time required");const x=new Date(o.start_time);new Date(o.end_time)<=x&&t.push("End after start");const n=parseInt(o.prizes[0]||"",10);if((Number.isNaN(n)||n<=0)&&t.push("1st prize invalid"),t.length){l({title:"Fix form",description:t[0],variant:"destructive"});return}const u=i.map(Q=>{const Y=(Q.options||[]).map(te=>te.trim()).filter(Boolean).slice(0,4);if(!Q.text.trim()||Y.length<2)return null;const Ae=Math.min(Math.max(Q.correctIndex||0,0),Y.length-1);return{question_text:Q.text.trim(),options:Y.map((te,Ee)=>({option_text:te,is_correct:B?!1:Ee===Ae}))}}).filter(Boolean);if(!u.length){l({title:"Add questions",variant:"destructive"});return}const y=o.prizes.filter(Q=>Q).map(Q=>parseInt(Q,10)),D=y.reduce((Q,Y)=>Q+Y,0),G=o.prize_type==="money"&&D>0?"coins":o.prize_type,H={title:o.title.trim(),category:o.category,start_time:new Date(o.start_time).toISOString(),end_time:new Date(o.end_time).toISOString(),prizes:y,prize_pool:D,prize_type:G};if(!d)throw new Error("Supabase config missing");const{data:me,error:xe}=await d.from("quizzes").insert([H]).select().single();if(xe)throw xe;l({title:"Quiz created",description:me.title});const pe=await ke(me.id,u,"replace");pe.ok?l({title:"Questions added",description:`${u.length} questions`}):l({title:"Question insert fallback",description:pe.message||"Failed",variant:"destructive"}),A(!1),c({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),r([J()]),X()}catch(t){l({title:"Create failed",description:t.message,variant:"destructive"})}},ke=async(s,t,x="append")=>{var m;if(!T)return{ok:!1,message:"Admin access required"};if(!d)return{ok:!1,message:"No Supabase client"};try{const{data:n}=await d.auth.getSession(),u=(m=n==null?void 0:n.session)==null?void 0:m.access_token,y=await fetch("/functions/v1/admin-upsert-questions",{method:"POST",headers:{"Content-Type":"application/json",...u?{Authorization:`Bearer ${u}`}:{}},body:JSON.stringify({quizId:s,items:t,mode:x})});if(y.ok)return{ok:!0};if(y.status!==404){const D=await y.json().catch(()=>({}));throw new Error((D==null?void 0:D.error)||`HTTP ${y.status}`)}}catch(n){console.warn("Edge bulk insert failed, falling back to direct RPC path",n)}try{const{error:n}=await d.rpc("admin_bulk_upsert_questions",{p_quiz_id:s,p_payload:t,p_mode:x});if(!n)return{ok:!0};console.warn("admin_bulk_upsert_questions RPC returned error, using manual inserts",n==null?void 0:n.message)}catch(n){console.warn("admin_bulk_upsert_questions RPC threw, using manual inserts",n)}x==="replace"&&await d.from("questions").delete().eq("quiz_id",s);for(const n of t){const{data:u,error:y}=await d.from("questions").insert({quiz_id:s,question_text:n.question_text}).select("id").single();if(y)return{ok:!1,message:y.message};const D=n.options.map(H=>({question_id:u.id,option_text:H.option_text,is_correct:!!H.is_correct})),{error:G}=await d.from("options").insert(D);if(G)return{ok:!1,message:G.message}}return{ok:!0}},Ce=async s=>{if(!window.confirm("Delete this quiz?"))return;if(!T){l({title:"Access denied",description:"Only admins can delete quizzes.",variant:"destructive"});return}if(!d)return;const{error:t}=await d.from("quizzes").delete().eq("id",s);t?l({title:"Delete failed",description:t.message,variant:"destructive"}):(l({title:"Deleted"}),X())},Se=async s=>{if(!T){l({title:"Access denied",description:"Only admins can recompute results.",variant:"destructive"});return}if(d)try{re(s);const{error:t}=await d.rpc("admin_recompute_quiz_results",{p_quiz_id:s});if(t)throw t;try{await d.rpc("compute_results_if_due",{p_quiz_id:s})}catch(x){}l({title:"Recomputed"})}catch(t){l({title:"Recompute failed",description:t.message,variant:"destructive"})}finally{re(null)}},le=E.useMemo(()=>{const s=Date.now(),t=[],x=[];for(const m of L){const n=m.end_time?new Date(m.end_time).getTime():null;n!==null&&s>n?x.push(m):t.push(m)}return x.sort((m,n)=>{const u=m.end_time?new Date(m.end_time).getTime():0;return(n.end_time?new Date(n.end_time).getTime():0)-u}),{active:t,finished:x.slice(0,10)}},[L]),[se,V]=E.useState([]),[ce,oe]=E.useState(!1),U=E.useCallback(async()=>{if(!T){V([]);return}if(!d){V([]);return}oe(!0);try{const{data:s,error:t}=await d.from("redemptions").select("id,user_id,reward_value,reward_type,coins_required,payout_identifier,payout_channel,requested_at, profiles(username,full_name)").eq("status","pending").order("requested_at",{ascending:!1});if(t)throw t;V(s||[])}catch(s){V([])}finally{oe(!1)}},[T]),ze=E.useCallback(async s=>{if(T&&d){V(t=>t.filter(x=>x.id!==s));try{const{error:t}=await d.rpc("admin_approve_redemption",{p_redemption_id:s});if(t)throw t;l({title:"Approved",description:"Redemption approved."})}catch(t){l({title:"Approve failed",description:t.message,variant:"destructive"}),U()}}},[T,U,l]);return E.useEffect(()=>{U();const s=setInterval(U,3e4);return()=>clearInterval(s)},[U]),z?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx($,{className:"w-8 h-8 text-indigo-600 animate-spin"})}):T?e.jsxs("div",{className:"container mx-auto p-6 max-w-5xl bg-white text-gray-900 rounded-2xl shadow-sm",children:[e.jsxs(ue,{children:[e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{rel:"canonical",href:"https://quizdangal.com/admin/"})]}),e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Admin Dashboard"}),!Pe&&e.jsx("div",{className:"mb-6 text-sm text-amber-600",children:"Supabase env keys missing. Read-only UI only."}),e.jsx("div",{className:"flex gap-2 mb-6 flex-wrap",children:["overview","automation","rewards","approvals","notifications"].map(s=>e.jsx("button",{onClick:()=>C(s),className:`px-3 py-1.5 rounded border text-sm transition-colors ${s===b?"bg-indigo-600 text-white border-indigo-600":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"}`,children:s},s))}),b==="overview"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{children:e.jsxs(f,{onClick:()=>A(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"New Quiz"]})}),e.jsx(he,{children:v&&e.jsxs(K.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},className:"bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Create Quiz"}),e.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{className:"mb-1 block",children:"Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map(({value:s,label:t})=>e.jsx("button",{type:"button",onClick:()=>c(x=>({...x,category:s})),className:`px-3 py-1 rounded-full text-xs border ${o.category===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:t},s))})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Title"}),e.jsx(P,{value:o.title,onChange:s=>c(t=>({...t,title:s.target.value})),placeholder:"Daily Quiz",required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Prize Type"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["money","coins","others"].map(s=>e.jsx("button",{type:"button",onClick:()=>c(t=>({...t,prize_type:s})),className:`px-2 py-1 rounded text-xs border ${o.prize_type===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},s))})]})]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-2",children:o.prizes.map((s,t)=>e.jsx(P,{value:s,placeholder:`${t+1}${["st","nd","rd"][t]||"th"} Prize`,onChange:x=>c(m=>{const n=[...m.prizes];return n[t]=x.target.value,{...m,prizes:n}})},t))}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Start Time"}),e.jsx(P,{type:"datetime-local",value:o.start_time,onChange:s=>c(t=>({...t,start_time:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{children:"End Time"}),e.jsx(P,{type:"datetime-local",value:o.end_time,onChange:s=>c(t=>({...t,end_time:s.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Questions Mode"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["form","paste"].map(s=>e.jsx("button",{type:"button",onClick:()=>a(s),className:`px-3 py-1 rounded text-xs border ${h===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},s))})]}),h==="form"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-600",children:B?"Opinion: no correct option stored.":"Mark one correct option with radio."}),i.map((s,t)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 space-y-2 bg-white",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-6",children:["Q",t+1]}),e.jsx(P,{value:s.text,onChange:x=>r(m=>{const n=[...m];return n[t]={...n[t],text:x.target.value},n}),placeholder:"Question text",className:"flex-1"}),e.jsx(f,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-500",onClick:()=>r(x=>x.length===1?[J()]:x.filter((m,n)=>n!==t)),children:"Del"})]}),(s.options||[]).slice(0,4).map((x,m)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!B&&e.jsx("input",{type:"radio",name:`q-${t}`,checked:(s.correctIndex||0)===m,onChange:()=>r(n=>{const u=[...n];return u[t]={...u[t],correctIndex:m},u})}),e.jsx(P,{value:x,onChange:n=>r(u=>{const y=[...u],D=[...y[t].options];return D[m]=n.target.value,y[t]={...y[t],options:D},y}),placeholder:`Option ${m+1}`,className:"flex-1"}),(s.options||[]).length>2&&e.jsx(f,{type:"button",size:"sm",variant:"outline",className:"border-red-300 text-red-500",onClick:()=>r(n=>{const u=[...n],y=[...u[t].options];return y.splice(m,1),u[t]={...u[t],options:y},u}),children:"X"})]},m)),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(f,{type:"button",size:"sm",disabled:(s.options||[]).length>=4,onClick:()=>r(x=>{const m=[...x],n=[...m[t].options];return n.length<4&&n.push(""),m[t]={...m[t],options:n},m}),children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Option"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Max 4 options"})]})]},t)),e.jsxs(f,{type:"button",onClick:()=>r(s=>[...s,J()]),children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Question"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Paste Questions"}),e.jsx(ie,{className:"h-40",value:o.bulk,onChange:s=>c(t=>({...t,bulk:s.target.value})),placeholder:`Q1. Capital of India?
- [ ] Mumbai
- [x] Delhi
- [ ] Kolkata
- [ ] Jaipur

Q2. ...`}),(()=>{const{items:s,errors:t,warnings:x}=Fe(o.bulk,{allowZeroCorrect:B});return e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[s.length," parsed"]}),x[0]&&e.jsx("div",{className:"text-amber-500",children:x[0]}),t[0]&&e.jsx("div",{className:"text-red-500",children:t[0]}),e.jsx(f,{type:"button",size:"sm",disabled:!!t.length||!s.length,onClick:()=>{if(t.length||!s.length)return;const m=s.map(n=>({text:n.question_text,options:n.options.map(u=>u.option_text),correctIndex:B?0:n.options.findIndex(u=>u.is_correct)>=0?n.options.findIndex(u=>u.is_correct):0}));r(m.length?m:[J()]),a("form"),l({title:"Loaded",description:`${m.length} questions moved to form.`})},children:"Load into form"})]})})()]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancel"})]})]})]})}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2 mb-3",children:[e.jsx(Te,{className:"w-5 h-5"}),"All Quizzes"]}),R?e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading..."]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Active / Upcoming"}),e.jsx("div",{className:"space-y-4",children:le.active.map(s=>{const t=s.prize_type||"money",x=Z(t,s.prize_pool,{fallback:0}),m=Array.isArray(s.prizes)?s.prizes.map(n=>Z(t,n,{fallback:0})).join(", "):"";return e.jsxs(K.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[240px]",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",ge(s.category)||"—"]}),e.jsxs("span",{children:["Type: ",t]}),e.jsxs("span",{children:["Pool: ",x]}),e.jsxs("span",{children:["Prizes: ",m]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:["Start: ",s.start_time?W(s.start_time):"—"]}),e.jsxs("span",{className:"ml-4",children:["End: ",s.end_time?W(s.end_time):"—"]})]})]}),e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>Se(s.id),disabled:O===s.id,children:O===s.id?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"Recompute"]})}),e.jsxs(Le,{to:`/results/${s.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-gray-300 hover:bg-gray-100 text-indigo-600",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Results"]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{_(s),we(s.id),ye(!0)},className:"text-blue-400",children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),"Questions"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>Ce(s.id),className:"text-red-500",children:e.jsx($e,{className:"w-4 h-4"})})]})]}),e.jsx(he,{children:ve&&(p==null?void 0:p.id)===s.id&&e.jsxs(K.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 space-y-2",children:[e.jsxs("h5",{className:"font-medium flex items-center gap-2",children:["Questions for ",s.title]}),M.length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No questions."}),M.map((n,u)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 bg-white",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Q",u+1,": ",n.question_text]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:(n.options||[]).map(y=>e.jsxs("div",{className:`px-2 py-0.5 text-xs rounded-full ${y.is_correct?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:[y.option_text,y.is_correct&&e.jsx("span",{className:"ml-1",children:"✓"})]},y.id))})]},n.id))]})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Finished"}),e.jsx("div",{className:"space-y-4",children:le.finished.map(s=>{const t=s.prize_type||"money",x=Z(t,s.prize_pool,{fallback:0}),m=Array.isArray(s.prizes)?s.prizes.map(n=>Z(t,n,{fallback:0})).join(", "):"";return e.jsxs(K.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",ge(s.category)||"—"]}),e.jsxs("span",{children:["Type: ",t]}),e.jsxs("span",{children:["Pool: ",x]}),e.jsxs("span",{children:["Prizes: ",m]})]})]},s.id)})})]})]})]})]}),b==="approvals"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pending Redemptions"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Approve user reward payouts after verifying their UPI ID / phone number."}),ce&&e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading pending requests..."]}),!ce&&se.length===0&&e.jsx("div",{className:"py-6 text-center text-gray-500 border border-gray-200 rounded-xl bg-gray-50",children:"No pending redemptions."}),se.length>0&&e.jsx("div",{className:"space-y-4",children:se.map(s=>{var t;return e.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 bg-white shadow-sm flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-yellow-500 flex items-center justify-center text-white font-semibold shadow",children:e.jsx("span",{className:"text-sm",children:"₹"})}),(()=>{var u,y;const x=s.reward_value,m=x&&String(x).trim().length?x:`${s.reward_type||""}`.trim()||"Reward",n=((u=s.profiles)==null?void 0:u.username)||((y=s.profiles)==null?void 0:y.full_name)||"Anonymous";return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:m}),e.jsxs("div",{className:"text-[11px] text-gray-600",children:["@",n]})]})})()]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex flex-wrap gap-3",children:[e.jsxs("span",{children:["Type: ",s.reward_type||"—"]}),e.jsxs("span",{children:["Coins: ",(t=s.coins_required)!=null?t:0]}),e.jsxs("span",{children:["Requested: ",s.requested_at?W(s.requested_at):"—"]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Payout: ",s.payout_identifier?`${s.payout_identifier} (${s.payout_channel||"upi"})`:"—"]})]}),e.jsx("div",{className:"flex items-center gap-2 self-start md:self-center",children:e.jsx(f,{size:"sm",onClick:()=>ze(s.id),className:"bg-green-600 hover:bg-green-700 text-white",children:"Approve"})})]},s.id)})})]}),b==="notifications"&&e.jsx(Be,{}),b==="automation"&&e.jsx(Ve,{}),b==="rewards"&&e.jsx(Oe,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{children:[e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{rel:"canonical",href:"https://quizdangal.com/admin/"})]}),e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 max-w-md w-full text-center shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-500 mb-2",children:"Admin access required"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Supabase "}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:" table mein aapke record ka "}),e.jsx("strong",{children:"role"}),e.jsx("span",{children:" field admin hona chahiye."})]}),e.jsxs("ul",{className:"text-left text-sm text-gray-600 mt-4 space-y-2 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("span",{children:"Supabase dashboard"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"→"}),e.jsx("span",{children:"Table editor"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"→"}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:" me role update karein."})]}),e.jsx("li",{children:"Update ke baad login session refresh karein."}),e.jsxs("li",{children:["Dev bypass (",e.jsx("code",{children:"VITE_BYPASS_AUTH=1"}),") mein mock admin auto-enable hota hai."]})]})]})})]})}function Oe(){const{toast:l}=ee(),[g,z]=N.useState([]),[k,q]=N.useState(!1),[j,b]=N.useState(!1),[C,L]=N.useState({reward_type:"coins",reward_value:"",coins_required:"",is_active:!0}),[w,R]=N.useState(!1),[I,v]=N.useState(null),A=N.useCallback(async()=>{if(!d)return;q(!0);const{data:i,error:r}=await d.from("reward_catalog").select("id,reward_type,reward_value,coins_required,is_active").order("id",{ascending:!1}).limit(200);r?l({title:"Rewards load failed",description:r.message,variant:"destructive"}):z(i||[]),q(!1)},[l]);N.useEffect(()=>{A()},[A]);const o=()=>L({reward_type:"cash",reward_value:"",coins_required:"",is_active:!0}),c=async i=>{if(i.preventDefault(),!!d){R(!0);try{const r={reward_type:String(C.reward_type||"").trim()||"cash",reward_value:String(C.reward_value||"").trim(),coins_required:C.coins_required!==""&&C.coins_required!==null?parseInt(C.coins_required,10):null,is_active:!!C.is_active};if(!r.reward_value)throw new Error("Value required");if(r.coins_required===null||Number.isNaN(r.coins_required))throw new Error("Coins required");let p;if(I?p=await d.from("reward_catalog").update(r).eq("id",I).select().single():p=await d.from("reward_catalog").insert([r]).select().single(),p.error)throw p.error;l({title:I?"Reward updated":"Reward created"}),o(),b(!1),v(null),A()}catch(r){l({title:"Save failed",description:r.message,variant:"destructive"})}finally{R(!1)}}},h=async i=>{if(!d)return;const{error:r}=await d.from("reward_catalog").update({is_active:!i.is_active}).eq("id",i.id);r?l({title:"Toggle failed",description:r.message,variant:"destructive"}):(l({title:i.is_active?"Deactivated":"Activated"}),A())},a=i=>{var r;v(i.id),b(!0),L({reward_type:i.reward_type||"cash",reward_value:i.reward_value||"",coins_required:((r=i.coins_required)!=null?r:"").toString(),is_active:!!i.is_active})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Redemptions auto-approved hain. Neeche sirf Rewards Catalog manage karna hai."}),e.jsxs("div",{className:"pt-10 border-t border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Rewards Catalog"}),e.jsx(f,{size:"sm",onClick:()=>{b(i=>!i),j||(o(),v(null))},children:j?"Close":"New Reward"}),e.jsx(f,{size:"sm",variant:"outline",onClick:A,disabled:k,children:k?e.jsx($,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),j&&e.jsxs("form",{onSubmit:c,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Type"}),e.jsx("div",{className:"flex gap-2 flex-wrap mt-1",children:["cash","voucher"].map(i=>e.jsx("button",{type:"button",onClick:()=>L(r=>({...r,reward_type:i})),className:`px-2 py-1 rounded text-xs border ${C.reward_type===i?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:i==="cash"?"💵 Cash (UPI/Phone)":"🎟️ Voucher (WhatsApp)"},i))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:C.reward_type==="cash"?"User will provide UPI ID or Phone number":"User will provide WhatsApp number"})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Value"}),e.jsx(P,{value:C.reward_value,onChange:i=>L(r=>({...r,reward_value:i.target.value})),placeholder:"e.g. 100 / AMAZON100 / ₹100"})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Coins Required"}),e.jsx(P,{type:"number",value:C.coins_required,onChange:i=>L(r=>({...r,coins_required:i.target.value})),placeholder:"coins needed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_active",type:"checkbox",checked:!!C.is_active,onChange:i=>L(r=>({...r,is_active:i.target.checked}))}),e.jsx("label",{htmlFor:"is_active",className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"Saving"]}):I?"Update":"Create"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>{o(),v(null)},children:I?"Cancel Edit":"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Value"}),e.jsx("th",{className:"p-2 text-left",children:"Coins Required"}),e.jsx("th",{className:"p-2 text-left",children:"Active"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[g.map(i=>{var r;return e.jsxs("tr",{className:"border-t border-gray-200 hover:bg-gray-100",children:[e.jsx("td",{className:"p-2 capitalize",children:i.reward_type}),e.jsx("td",{className:"p-2 max-w-[260px] truncate",title:i.reward_value,children:i.reward_value}),e.jsx("td",{className:"p-2",children:(r=i.coins_required)!=null?r:"—"}),e.jsx("td",{className:"p-2",children:i.is_active?e.jsx("span",{className:"text-green-500",children:"Yes"}):e.jsx("span",{className:"text-gray-500",children:"No"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>a(i),children:"Edit"}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>h(i),children:i.is_active?"Deactivate":"Activate"})]})})]},i.id)}),!g.length&&!k&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 text-center text-gray-500",children:"No rewards."})}),k&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading rewards..."]})})]})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Catalog: inactive rewards are hidden from users."})]})]})}function Be(){const{toast:l}=ee(),[g,z]=N.useState(""),[k,q]=N.useState(""),[j,b]=N.useState("all"),[C,L]=N.useState(!1),[w,R]=N.useState([]),[I,v]=N.useState(!1),A=N.useCallback(async()=>{if(!d)return;v(!0);const{data:c,error:h}=await d.from("notifications").select("id,title,message,type,segment,created_at").order("created_at",{ascending:!1}).limit(100);h?l({title:"Fetch failed",description:h.message,variant:"destructive"}):R(c||[]),v(!1)},[l]);N.useEffect(()=>{A()},[A]);const o=async c=>{var h;if(c.preventDefault(),!g.trim()||!k.trim()){l({title:"Missing fields",variant:"destructive"});return}if(!d){l({title:"No backend client",variant:"destructive"});return}L(!0);try{const a={title:g.trim(),message:k.trim(),segment:j},{data:i}=await d.auth.getSession(),r=(h=i==null?void 0:i.session)==null?void 0:h.access_token,{data:p,error:_}=await d.functions.invoke("send-notifications",{body:a,headers:r?{Authorization:`Bearer ${r}`}:void 0});if(_)throw new Error(_.message||_.error||"Failed to send notification");const M=typeof p=="object"&&(p!=null&&p.message)?p.message:g.trim();l({title:"Sent",description:M}),z(""),q(""),A()}catch(a){l({title:"Send failed",description:a.message,variant:"destructive"})}finally{L(!1)}};return e.jsxs("div",{className:"space-y-8 max-w-3xl",children:[e.jsxs("form",{onSubmit:o,className:"space-y-4 bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Send Notification"}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"notification-title",children:"Title"}),e.jsx(P,{id:"notification-title",name:"notificationTitle",value:g,onChange:c=>z(c.target.value),maxLength:80,placeholder:"Short title"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 80 chars • ",g.length,"/80"]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"notification-message",children:"Message"}),e.jsx(ie,{id:"notification-message",name:"notificationMessage",value:k,onChange:c=>q(c.target.value),className:"h-28",maxLength:280,placeholder:"Body shown in push notification"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 280 chars • ",k.length,"/280"]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Segment"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["all"].map(c=>e.jsx("button",{type:"button",onClick:()=>b(c),className:`px-3 py-1 rounded text-xs border ${j===c?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:c},c))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"Sending"]}):"Send"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>{z(""),q("")},children:"Reset"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Recent Notifications"}),e.jsx(f,{size:"sm",variant:"outline",onClick:A,disabled:I,children:I?e.jsx($,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),e.jsxs("div",{className:"space-y-3",children:[w.map(c=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:c.title}),e.jsx("div",{className:"text-xs text-gray-600 whitespace-pre-wrap max-w-xl break-words",children:c.message})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:W(c.created_at)})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Segment: ",c.segment||"—",c.type?` • ${c.type}`:""]})]},c.id)),!w.length&&!I&&e.jsx("div",{className:"text-xs text-gray-500",children:"No notifications yet."})]})]})]})}function Ve(){const{toast:l}=ee(),[g,z]=N.useState(!1),[k,q]=N.useState(!1),[j,b]=N.useState({is_enabled:!0,cadence_min:10,live_window_min:7,start_offset_sec:15,cleanup_days:3,categories:["opinion","gk","sports","movies"],alert_emails:["quizdangalofficial@gmail.com"]}),[C,L]=N.useState([]),[w,R]=N.useState({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),I=async()=>{if(d)try{const{error:a}=await d.from("ai_providers").update({quota_exhausted:!1,last_error:null}).eq("enabled",!0);if(a)throw a;l({title:"Quota flags reset",description:"Enabled providers can be retried now."}),v()}catch(a){l({title:"Reset failed",description:a.message,variant:"destructive"})}},v=N.useCallback(async()=>{var a,i,r,p;if(d){z(!0);try{const[{data:_,error:M},{data:F,error:O}]=await Promise.all([d.from("ai_settings").select("*").eq("id",1).maybeSingle(),d.from("ai_providers").select("*").order("enabled",{ascending:!1}).order("priority",{ascending:!0}).order("id",{ascending:!0})]);if(M)throw M;if(O)throw O;_&&b({is_enabled:!!_.is_enabled,cadence_min:(a=_.cadence_min)!=null?a:10,live_window_min:(i=_.live_window_min)!=null?i:7,start_offset_sec:(r=_.start_offset_sec)!=null?r:15,cleanup_days:(p=_.cleanup_days)!=null?p:3,categories:Array.isArray(_.categories)?_.categories:["opinion","gk","sports","movies"],alert_emails:Array.isArray(_.alert_emails)?_.alert_emails:["quizdangalofficial@gmail.com"]}),L(F||[])}catch(_){l({title:"Load failed",description:_.message,variant:"destructive"})}finally{z(!1)}}},[l]);N.useEffect(()=>{v()},[v]);const A=async a=>{var i,r;if((i=a==null?void 0:a.preventDefault)==null||i.call(a),!!d){q(!0);try{const p={id:1,is_enabled:!!j.is_enabled,cadence_min:Number(j.cadence_min||10),live_window_min:Number(j.live_window_min||7),start_offset_sec:Number((r=j.start_offset_sec)!=null?r:15),categories:j.categories,cleanup_days:Number(j.cleanup_days||3),alert_emails:j.alert_emails},{error:_}=await d.from("ai_settings").upsert(p,{onConflict:"id"});if(_)throw _;l({title:"Settings saved"})}catch(p){l({title:"Save failed",description:p.message,variant:"destructive"})}finally{q(!1)}}},o=async a=>{if(!d)return;const{error:i}=await d.from("ai_providers").update({enabled:!a.enabled}).eq("id",a.id);i?l({title:"Toggle failed",description:i.message,variant:"destructive"}):(l({title:a.enabled?"Disabled":"Enabled"}),v())},c=async a=>{var i;if((i=a==null?void 0:a.preventDefault)==null||i.call(a),!!d)try{const r={name:String(w.name||"").trim(),api_key_enc:String(w.api_key_enc||"").trim()||null,priority:Number(w.priority||1),enabled:!!w.enabled};if(!r.name)throw new Error("Provider name required");let p;if(w.id?p=await d.from("ai_providers").update(r).eq("id",w.id).select().single():p=await d.from("ai_providers").insert([r]).select().single(),p.error)throw p.error;l({title:w.id?"Provider updated":"Provider added"}),R({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),v()}catch(r){l({title:"Save failed",description:r.message,variant:"destructive"})}},h=a=>R({id:a.id,name:a.name||"",api_key_enc:a.api_key_enc||"",priority:a.priority||1,enabled:!!a.enabled});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"AI Automation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Auto-generate quizzes backend-only. Configure cadence (minutes) and live window (minutes). For 5-minute quizzes with 5-minute gaps, set cadence=10 and live window=5. Each quiz has 4 options per question."}),e.jsxs("form",{onSubmit:A,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_enabled",type:"checkbox",checked:!!j.is_enabled,onChange:a=>b(i=>({...i,is_enabled:a.target.checked}))}),e.jsx("label",{htmlFor:"is_enabled",className:"text-sm",children:"Enabled"})]}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Cadence (min)"}),e.jsx(P,{type:"number",min:1,max:60,value:j.cadence_min,onChange:a=>b(i=>({...i,cadence_min:a.target.valueAsNumber||10}))})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Live window (min)"}),e.jsx(P,{type:"number",min:5,max:180,value:j.live_window_min,onChange:a=>b(i=>({...i,live_window_min:a.target.valueAsNumber||7}))})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Start offset (sec)"}),e.jsx(P,{type:"number",min:0,max:120,value:j.start_offset_sec,onChange:a=>b(i=>{var r;return{...i,start_offset_sec:Math.max(0,(r=a.target.valueAsNumber)!=null?r:15)}})})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Cleanup days"}),e.jsx(P,{type:"number",min:1,max:30,value:j.cleanup_days,onChange:a=>b(i=>({...i,cleanup_days:a.target.valueAsNumber||3}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(S,{children:"Categories (comma)"}),e.jsx(P,{value:(j.categories||[]).join(", "),onChange:a=>b(i=>({...i,categories:a.target.value.split(",").map(r=>r.trim()).filter(Boolean)}))})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Alert emails (comma)"}),e.jsx(P,{value:(j.alert_emails||[]).join(", "),onChange:a=>b(i=>({...i,alert_emails:a.target.value.split(",").map(r=>r.trim()).filter(Boolean)}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:k,children:k?"Saving…":"Save Settings"}),e.jsx(f,{type:"button",variant:"outline",onClick:v,disabled:g,children:g?"Loading…":"Refresh"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h3",{className:"font-semibold",children:"Providers"}),e.jsx(f,{size:"sm",variant:"outline",onClick:v,disabled:g,children:g?"Loading…":"Refresh"}),e.jsx(f,{size:"sm",variant:"outline",onClick:I,children:"Reset quota flags"})]}),e.jsxs("form",{onSubmit:c,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsx("h4",{className:"font-medium",children:w.id?"Edit Provider":"Add Provider"}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(S,{children:"Name"}),e.jsx(P,{value:w.name,onChange:a=>R(i=>({...i,name:a.target.value})),placeholder:"e.g. openai"})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Priority"}),e.jsx(P,{type:"number",value:w.priority,onChange:a=>R(i=>({...i,priority:a.target.valueAsNumber||1}))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"prov_enabled",type:"checkbox",checked:!!w.enabled,onChange:a=>R(i=>({...i,enabled:a.target.checked}))}),e.jsx("label",{htmlFor:"prov_enabled",className:"text-sm",children:"Enabled"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(S,{children:"API Key (stored server-side)"}),e.jsx(P,{value:w.api_key_enc,onChange:a=>R(i=>({...i,api_key_enc:a.target.value})),placeholder:"sk-..."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",children:w.id?"Update":"Add"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>R({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),children:"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Name"}),e.jsx("th",{className:"p-2 text-left",children:"Priority"}),e.jsx("th",{className:"p-2 text-left",children:"Enabled"}),e.jsx("th",{className:"p-2 text-left",children:"Quota"}),e.jsx("th",{className:"p-2 text-left",children:"Last Error"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[C.map(a=>e.jsxs("tr",{className:"border-t border-gray-200",children:[e.jsx("td",{className:"p-2",children:a.name}),e.jsx("td",{className:"p-2",children:a.priority}),e.jsx("td",{className:"p-2",children:a.enabled?"Yes":"No"}),e.jsx("td",{className:"p-2",children:a.quota_exhausted?"Exhausted":"OK"}),e.jsx("td",{className:"p-2 max-w-[300px] truncate",title:a.last_error||"",children:a.last_error||"—"}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>h(a),children:"Edit"}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>o(a),children:a.enabled?"Disable":"Enable"})]})})]},a.id)),!C.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-center text-gray-500",children:"No providers"})})]})]})})]})]})}export{He as default};
