import{j as e,k as Ie,u as Z,a as Re,s as m,H as ue,h as Pe,B as g,A as he,m as G,L as C,I as q,o as K}from"./index-6acc884f.js";import{a as w,r as E}from"./react-63c462fe.js";import{d as qe,L as Le}from"./router-10fed1f4.js";import{L as $,Y as te,Z as Te,m as De,u as Qe,_ as Me,$ as $e}from"./icons-218c8792.js";import"./supabase-07ebd5d8.js";const ae=w.forwardRef(({className:l,...u},z)=>e.jsx("textarea",{ref:z,className:Ie("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",l),...u}));ae.displayName="Textarea";const fe=[{value:"opinion",label:"Opinion"},{value:"gk",label:"General Knowledge"},{value:"sports",label:"Sports"},{value:"movies",label:"Movies"}],ge=l=>{var u;return((u=fe.find(z=>z.value===l))==null?void 0:u.label)||l},U=()=>({text:"",options:["","",""],correctIndex:0});function H(l,u,{fallback:z=0}={}){return u==null&&(u=z),l==="coins"?`${u} coins`:l==="others"?`${u}`:`₹${u}`}function Fe(l,{allowZeroCorrect:u=!1}={}){var k,P;const z=String(l||"").trim().split(/\n\s*\n+/),N=[],R=[],j=[];let v=0;for(const y of z){const I=y.split(/\r?\n/).map(c=>c.trim()).filter(Boolean);if(!I.length)continue;v+=1;const b=I[0].replace(/^Q\d*\.?\s*/i,"").replace(/^Question\s*[:-]\s*/i,""),S=[];let A="";for(let c=1;c<I.length;c++){const a=I[c];if(/^ans(wer)?\s*[:-]/i.test(a)){A=a;continue}const o=a.match(/^[-*•]?\s*\[(x|X| )\]\s*(.+)$/);if(o){S.push({option_text:o[2].trim(),is_correct:/x/i.test(o[1])});continue}const r=a.match(/^(?:[-*•]|[A-Da-d]\)|\d+\)|[A-Da-d][.:])\s*(.+)$/),i=r?r[1].trim():a.replace(/^[*]\s*/,"").trim();i&&S.push({option_text:i,is_correct:/^\*/.test(a)})}if(A){const c=A.split(/[:-]/).slice(1).join(":").trim(),a=(P=(k=c.match(/^[A-D]/i))==null?void 0:k[0])==null?void 0:P.toUpperCase(),o=a?{A:0,B:1,C:2,D:3}[a]:NaN,r=parseInt(c,10);if(!Number.isNaN(o)&&S[o])S.forEach((i,_)=>i.is_correct=_===o);else if(!Number.isNaN(r)&&S[r-1])S.forEach((i,_)=>i.is_correct=_===r-1);else{const i=c.toLowerCase(),_=S.findIndex(T=>T.option_text.toLowerCase()===i||T.option_text.toLowerCase().includes(i));_>=0&&S.forEach((T,M)=>T.is_correct=M===_)}}let d=S.filter(c=>c.option_text);if(d.length>4){const c=d.findIndex(a=>a.is_correct);if(c>=0){const a=d[c],o=d.filter((r,i)=>i!==c);d=[a,...o.slice(0,3)]}else d=d.slice(0,4);j.push(`Q${v}: Trimmed to 4 options.`)}if(!b){R.push(`Q${v}: Missing question text.`);continue}if(d.length<2){R.push(`Q${v}: Need at least 2 options.`);continue}if(u)d=d.map(c=>({...c,is_correct:!1}));else{const c=d.filter(a=>a.is_correct).length;if(c===0)d[0].is_correct=!0;else if(c>1){let a=!1;d=d.map(o=>o.is_correct&&!a?(a=!0,o):{...o,is_correct:!1})}}N.push({question_text:b,options:d})}return{items:N,errors:R,warnings:j}}function He(){var de;const{toast:l}=Z(),{userProfile:u,loading:z,user:N}=Re(),[R,j]=qe(),v=R.get("tab")||"overview",k=s=>{R.set("tab",s),j(R,{replace:!0})},[P,y]=E.useState([]),[I,b]=E.useState(!1),[S,A]=E.useState(!1),[d,c]=E.useState({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),[a,o]=E.useState("form"),[r,i]=E.useState([U()]),[_,T]=E.useState(null),[M,W]=E.useState([]),[ie,re]=E.useState(null),[ve,ye]=E.useState(!1),F=d.category==="opinion",je=E.useMemo(()=>{try{const s=String({}.VITE_ADMIN_EMAILS||"").trim();return s?new Set(s.split(/[\s,]+/).map(t=>t.trim().toLowerCase()).filter(Boolean)):new Set}catch(s){return new Set}},[]),be=String((u==null?void 0:u.role)||"").trim().toLowerCase(),ne=String((N==null?void 0:N.email)||"").trim().toLowerCase(),_e=String(((de=N==null?void 0:N.app_metadata)==null?void 0:de.role)||"").trim().toLowerCase(),L=be==="admin"||_e==="admin"||ne&&je.has(ne),Y=E.useCallback(async()=>{if(!L){b(!1),y([]);return}if(b(!0),!m){y([]),b(!1);return}const{data:s,error:t}=await m.from("quizzes").select("id,title,category,prizes,prize_pool,prize_type,start_time,end_time").order("start_time",{ascending:!1});t?l({title:"Fetch failed",description:t.message,variant:"destructive"}):y(s||[]),b(!1)},[l,L]),we=E.useCallback(async s=>{if(!L){W([]);return}if(!m){W([]);return}const{data:t,error:x}=await m.from("questions").select("id,question_text,options(id,option_text,is_correct)").eq("quiz_id",s);x?l({title:"Questions failed",description:x.message,variant:"destructive"}):W(t||[])},[l,L]);E.useEffect(()=>{z||Y()},[Y,z]);const Ne=async s=>{s.preventDefault();try{if(!L){l({title:"Access denied",description:"Only admins can create quizzes.",variant:"destructive"});return}const t=[];d.category||t.push("Select category"),d.title.trim()||t.push("Title required"),(!d.start_time||!d.end_time)&&t.push("Start & End time required");const x=new Date(d.start_time);new Date(d.end_time)<=x&&t.push("End after start");const n=parseInt(d.prizes[0]||"",10);if((Number.isNaN(n)||n<=0)&&t.push("1st prize invalid"),t.length){l({title:"Fix form",description:t[0],variant:"destructive"});return}const h=r.map(Q=>{const V=(Q.options||[]).map(se=>se.trim()).filter(Boolean).slice(0,4);if(!Q.text.trim()||V.length<2)return null;const Ae=Math.min(Math.max(Q.correctIndex||0,0),V.length-1);return{question_text:Q.text.trim(),options:V.map((se,Ee)=>({option_text:se,is_correct:F?!1:Ee===Ae}))}}).filter(Boolean);if(!h.length){l({title:"Add questions",variant:"destructive"});return}const f=d.prizes.filter(Q=>Q).map(Q=>parseInt(Q,10)),D=f.reduce((Q,V)=>Q+V,0),J=d.prize_type==="money"&&D>0?"coins":d.prize_type,X={title:d.title.trim(),category:d.category,start_time:new Date(d.start_time).toISOString(),end_time:new Date(d.end_time).toISOString(),prizes:f,prize_pool:D,prize_type:J};if(!m)throw new Error("Supabase config missing");const{data:me,error:xe}=await m.from("quizzes").insert([X]).select().single();if(xe)throw xe;l({title:"Quiz created",description:me.title});const pe=await ke(me.id,h,"replace");pe.ok?l({title:"Questions added",description:`${h.length} questions`}):l({title:"Question insert fallback",description:pe.message||"Failed",variant:"destructive"}),A(!1),c({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),i([U()]),Y()}catch(t){l({title:"Create failed",description:t.message,variant:"destructive"})}},ke=async(s,t,x="append")=>{var p;if(!L)return{ok:!1,message:"Admin access required"};if(!m)return{ok:!1,message:"No Supabase client"};try{const{data:n}=await m.auth.getSession(),h=(p=n==null?void 0:n.session)==null?void 0:p.access_token,f=await fetch("/functions/v1/admin-upsert-questions",{method:"POST",headers:{"Content-Type":"application/json",...h?{Authorization:`Bearer ${h}`}:{}},body:JSON.stringify({quizId:s,items:t,mode:x})});if(f.ok)return{ok:!0};if(f.status!==404){const D=await f.json().catch(()=>({}));throw new Error((D==null?void 0:D.error)||`HTTP ${f.status}`)}}catch(n){console.warn("Edge bulk insert failed, falling back to direct RPC path",n)}try{const{error:n}=await m.rpc("admin_bulk_upsert_questions",{p_quiz_id:s,p_payload:t,p_mode:x});if(!n)return{ok:!0};console.warn("admin_bulk_upsert_questions RPC returned error, using manual inserts",n==null?void 0:n.message)}catch(n){console.warn("admin_bulk_upsert_questions RPC threw, using manual inserts",n)}x==="replace"&&await m.from("questions").delete().eq("quiz_id",s);for(const n of t){const{data:h,error:f}=await m.from("questions").insert({quiz_id:s,question_text:n.question_text}).select("id").single();if(f)return{ok:!1,message:f.message};const D=n.options.map(X=>({question_id:h.id,option_text:X.option_text,is_correct:!!X.is_correct})),{error:J}=await m.from("options").insert(D);if(J)return{ok:!1,message:J.message}}return{ok:!0}},Se=async s=>{if(!window.confirm("Delete this quiz?"))return;if(!L){l({title:"Access denied",description:"Only admins can delete quizzes.",variant:"destructive"});return}if(!m)return;const{error:t}=await m.from("quizzes").delete().eq("id",s);t?l({title:"Delete failed",description:t.message,variant:"destructive"}):(l({title:"Deleted"}),Y())},Ce=async s=>{if(!L){l({title:"Access denied",description:"Only admins can recompute results.",variant:"destructive"});return}if(m)try{re(s);const{error:t}=await m.rpc("admin_recompute_quiz_results",{p_quiz_id:s});if(t)throw t;try{await m.rpc("compute_results_if_due",{p_quiz_id:s})}catch(x){}l({title:"Recomputed"})}catch(t){l({title:"Recompute failed",description:t.message,variant:"destructive"})}finally{re(null)}},le=E.useMemo(()=>{const s=Date.now(),t=[],x=[];for(const p of P){const n=p.end_time?new Date(p.end_time).getTime():null;n!==null&&s>n?x.push(p):t.push(p)}return{active:t,finished:x}},[P]),[ee,O]=E.useState([]),[ce,oe]=E.useState(!1),B=E.useCallback(async()=>{if(!L){O([]);return}if(!m){O([]);return}oe(!0);try{const{data:s,error:t}=await m.from("redemptions").select("id,user_id,reward_value,reward_type,coins_required,payout_identifier,payout_channel,requested_at, profiles(username,full_name)").eq("status","pending").order("requested_at",{ascending:!1});if(t)throw t;O(s||[])}catch(s){O([])}finally{oe(!1)}},[L]),ze=E.useCallback(async s=>{if(L&&m){O(t=>t.filter(x=>x.id!==s));try{const{error:t}=await m.rpc("admin_approve_redemption",{p_redemption_id:s});if(t)throw t;l({title:"Approved",description:"Redemption approved."})}catch(t){l({title:"Approve failed",description:t.message,variant:"destructive"}),B()}}},[L,B,l]);return E.useEffect(()=>{B();const s=setInterval(B,3e4);return()=>clearInterval(s)},[B]),z?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx($,{className:"w-8 h-8 text-indigo-600 animate-spin"})}):L?e.jsxs("div",{className:"container mx-auto p-6 max-w-5xl bg-white text-gray-900 rounded-2xl shadow-sm",children:[e.jsxs(ue,{children:[e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{rel:"canonical",href:"https://quizdangal.com/admin"})]}),e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Admin Dashboard"}),!Pe&&e.jsx("div",{className:"mb-6 text-sm text-amber-600",children:"Supabase env keys missing. Read-only UI only."}),e.jsx("div",{className:"flex gap-2 mb-6 flex-wrap",children:["overview","automation","rewards","approvals","notifications"].map(s=>e.jsx("button",{onClick:()=>k(s),className:`px-3 py-1.5 rounded border text-sm transition-colors ${s===v?"bg-indigo-600 text-white border-indigo-600":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"}`,children:s},s))}),v==="overview"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{children:e.jsxs(g,{onClick:()=>A(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"New Quiz"]})}),e.jsx(he,{children:S&&e.jsxs(G.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},className:"bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Create Quiz"}),e.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{className:"mb-1 block",children:"Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map(({value:s,label:t})=>e.jsx("button",{type:"button",onClick:()=>c(x=>({...x,category:s})),className:`px-3 py-1 rounded-full text-xs border ${d.category===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:t},s))})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Title"}),e.jsx(q,{value:d.title,onChange:s=>c(t=>({...t,title:s.target.value})),placeholder:"Daily Quiz",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Prize Type"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["money","coins","others"].map(s=>e.jsx("button",{type:"button",onClick:()=>c(t=>({...t,prize_type:s})),className:`px-2 py-1 rounded text-xs border ${d.prize_type===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},s))})]})]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-2",children:d.prizes.map((s,t)=>e.jsx(q,{value:s,placeholder:`${t+1}${["st","nd","rd"][t]||"th"} Prize`,onChange:x=>c(p=>{const n=[...p.prizes];return n[t]=x.target.value,{...p,prizes:n}})},t))}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Start Time"}),e.jsx(q,{type:"datetime-local",value:d.start_time,onChange:s=>c(t=>({...t,start_time:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{children:"End Time"}),e.jsx(q,{type:"datetime-local",value:d.end_time,onChange:s=>c(t=>({...t,end_time:s.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Questions Mode"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["form","paste"].map(s=>e.jsx("button",{type:"button",onClick:()=>o(s),className:`px-3 py-1 rounded text-xs border ${a===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},s))})]}),a==="form"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-600",children:F?"Opinion: no correct option stored.":"Mark one correct option with radio."}),r.map((s,t)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 space-y-2 bg-white",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-6",children:["Q",t+1]}),e.jsx(q,{value:s.text,onChange:x=>i(p=>{const n=[...p];return n[t]={...n[t],text:x.target.value},n}),placeholder:"Question text",className:"flex-1"}),e.jsx(g,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-500",onClick:()=>i(x=>x.length===1?[U()]:x.filter((p,n)=>n!==t)),children:"Del"})]}),(s.options||[]).slice(0,4).map((x,p)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!F&&e.jsx("input",{type:"radio",name:`q-${t}`,checked:(s.correctIndex||0)===p,onChange:()=>i(n=>{const h=[...n];return h[t]={...h[t],correctIndex:p},h})}),e.jsx(q,{value:x,onChange:n=>i(h=>{const f=[...h],D=[...f[t].options];return D[p]=n.target.value,f[t]={...f[t],options:D},f}),placeholder:`Option ${p+1}`,className:"flex-1"}),(s.options||[]).length>2&&e.jsx(g,{type:"button",size:"sm",variant:"outline",className:"border-red-300 text-red-500",onClick:()=>i(n=>{const h=[...n],f=[...h[t].options];return f.splice(p,1),h[t]={...h[t],options:f},h}),children:"X"})]},p)),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(g,{type:"button",size:"sm",disabled:(s.options||[]).length>=4,onClick:()=>i(x=>{const p=[...x],n=[...p[t].options];return n.length<4&&n.push(""),p[t]={...p[t],options:n},p}),children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Option"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Max 4 options"})]})]},t)),e.jsxs(g,{type:"button",onClick:()=>i(s=>[...s,U()]),children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Question"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Paste Questions"}),e.jsx(ae,{className:"h-40",value:d.bulk,onChange:s=>c(t=>({...t,bulk:s.target.value})),placeholder:`Q1. Capital of India?
- [ ] Mumbai
- [x] Delhi
- [ ] Kolkata
- [ ] Jaipur

Q2. ...`}),(()=>{const{items:s,errors:t,warnings:x}=Fe(d.bulk,{allowZeroCorrect:F});return e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[s.length," parsed"]}),x[0]&&e.jsx("div",{className:"text-amber-500",children:x[0]}),t[0]&&e.jsx("div",{className:"text-red-500",children:t[0]}),e.jsx(g,{type:"button",size:"sm",disabled:!!t.length||!s.length,onClick:()=>{if(t.length||!s.length)return;const p=s.map(n=>({text:n.question_text,options:n.options.map(h=>h.option_text),correctIndex:F?0:n.options.findIndex(h=>h.is_correct)>=0?n.options.findIndex(h=>h.is_correct):0}));i(p.length?p:[U()]),o("form"),l({title:"Loaded",description:`${p.length} questions moved to form.`})},children:"Load into form"})]})})()]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(g,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancel"})]})]})]})}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2 mb-3",children:[e.jsx(Te,{className:"w-5 h-5"}),"All Quizzes"]}),I?e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading..."]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Active / Upcoming"}),e.jsx("div",{className:"space-y-4",children:le.active.map(s=>{const t=s.prize_type||"money",x=H(t,s.prize_pool,{fallback:0}),p=Array.isArray(s.prizes)?s.prizes.map(n=>H(t,n,{fallback:0})).join(", "):"";return e.jsxs(G.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[240px]",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",ge(s.category)||"—"]}),e.jsxs("span",{children:["Type: ",t]}),e.jsxs("span",{children:["Pool: ",x]}),e.jsxs("span",{children:["Prizes: ",p]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:["Start: ",s.start_time?K(s.start_time):"—"]}),e.jsxs("span",{className:"ml-4",children:["End: ",s.end_time?K(s.end_time):"—"]})]})]}),e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Ce(s.id),disabled:ie===s.id,children:ie===s.id?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"Recompute"]})}),e.jsxs(Le,{to:`/results/${s.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-gray-300 hover:bg-gray-100 text-indigo-600",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Results"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>{T(s),we(s.id),ye(!0)},className:"text-blue-400",children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),"Questions"]}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Se(s.id),className:"text-red-500",children:e.jsx($e,{className:"w-4 h-4"})})]})]}),e.jsx(he,{children:ve&&(_==null?void 0:_.id)===s.id&&e.jsxs(G.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 space-y-2",children:[e.jsxs("h5",{className:"font-medium flex items-center gap-2",children:["Questions for ",s.title]}),M.length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No questions."}),M.map((n,h)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 bg-white",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Q",h+1,": ",n.question_text]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:(n.options||[]).map(f=>e.jsxs("div",{className:`px-2 py-0.5 text-xs rounded-full ${f.is_correct?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:[f.option_text,f.is_correct&&e.jsx("span",{className:"ml-1",children:"✓"})]},f.id))})]},n.id))]})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Finished"}),e.jsx("div",{className:"space-y-4",children:le.finished.map(s=>{const t=s.prize_type||"money",x=H(t,s.prize_pool,{fallback:0}),p=Array.isArray(s.prizes)?s.prizes.map(n=>H(t,n,{fallback:0})).join(", "):"";return e.jsxs(G.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",ge(s.category)||"—"]}),e.jsxs("span",{children:["Type: ",t]}),e.jsxs("span",{children:["Pool: ",x]}),e.jsxs("span",{children:["Prizes: ",p]})]})]},s.id)})})]})]})]})]}),v==="approvals"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pending Redemptions"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Approve user reward payouts after verifying their UPI ID / phone number."}),ce&&e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading pending requests..."]}),!ce&&ee.length===0&&e.jsx("div",{className:"py-6 text-center text-gray-500 border border-gray-200 rounded-xl bg-gray-50",children:"No pending redemptions."}),ee.length>0&&e.jsx("div",{className:"space-y-4",children:ee.map(s=>{var t;return e.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 bg-white shadow-sm flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-yellow-500 flex items-center justify-center text-white font-semibold shadow",children:e.jsx("span",{className:"text-sm",children:"₹"})}),(()=>{var h,f;const x=s.reward_value,p=x&&String(x).trim().length?x:`${s.reward_type||""}`.trim()||"Reward",n=((h=s.profiles)==null?void 0:h.username)||((f=s.profiles)==null?void 0:f.full_name)||"Anonymous";return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:p}),e.jsxs("div",{className:"text-[11px] text-gray-600",children:["@",n]})]})})()]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex flex-wrap gap-3",children:[e.jsxs("span",{children:["Type: ",s.reward_type||"—"]}),e.jsxs("span",{children:["Coins: ",(t=s.coins_required)!=null?t:0]}),e.jsxs("span",{children:["Requested: ",s.requested_at?K(s.requested_at):"—"]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Payout: ",s.payout_identifier?`${s.payout_identifier} (${s.payout_channel||"upi"})`:"—"]})]}),e.jsx("div",{className:"flex items-center gap-2 self-start md:self-center",children:e.jsx(g,{size:"sm",onClick:()=>ze(s.id),className:"bg-green-600 hover:bg-green-700 text-white",children:"Approve"})})]},s.id)})})]}),v==="notifications"&&e.jsx(Be,{}),v==="automation"&&e.jsx(Ve,{}),v==="rewards"&&e.jsx(Oe,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{children:[e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{rel:"canonical",href:"https://quizdangal.com/admin"})]}),e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 max-w-md w-full text-center shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-500 mb-2",children:"Admin access required"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Supabase "}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:" table mein aapke record ka "}),e.jsx("strong",{children:"role"}),e.jsx("span",{children:" field admin hona chahiye."})]}),e.jsxs("ul",{className:"text-left text-sm text-gray-600 mt-4 space-y-2 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("span",{children:"Supabase dashboard"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"→"}),e.jsx("span",{children:"Table editor"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"→"}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:" me role update karein."})]}),e.jsx("li",{children:"Update ke baad login session refresh karein."}),e.jsxs("li",{children:["Dev bypass (",e.jsx("code",{children:"VITE_BYPASS_AUTH=1"}),") mein mock admin auto-enable hota hai."]})]})]})})]})}function Oe(){const{toast:l}=Z(),[u,z]=w.useState([]),[N,R]=w.useState(!1),[j,v]=w.useState(!1),[k,P]=w.useState({reward_type:"coins",reward_value:"",coins_required:"",is_active:!0}),[y,I]=w.useState(!1),[b,S]=w.useState(null),A=w.useCallback(async()=>{if(!m)return;R(!0);const{data:r,error:i}=await m.from("reward_catalog").select("id,reward_type,reward_value,coins_required,is_active").order("id",{ascending:!1}).limit(200);i?l({title:"Rewards load failed",description:i.message,variant:"destructive"}):z(r||[]),R(!1)},[l]);w.useEffect(()=>{A()},[A]);const d=()=>P({reward_type:"cash",reward_value:"",coins_required:"",is_active:!0}),c=async r=>{if(r.preventDefault(),!!m){I(!0);try{const i={reward_type:String(k.reward_type||"").trim()||"cash",reward_value:String(k.reward_value||"").trim(),coins_required:k.coins_required!==""&&k.coins_required!==null?parseInt(k.coins_required,10):null,is_active:!!k.is_active};if(!i.reward_value)throw new Error("Value required");if(i.coins_required===null||Number.isNaN(i.coins_required))throw new Error("Coins required");let _;if(b?_=await m.from("reward_catalog").update(i).eq("id",b).select().single():_=await m.from("reward_catalog").insert([i]).select().single(),_.error)throw _.error;l({title:b?"Reward updated":"Reward created"}),d(),v(!1),S(null),A()}catch(i){l({title:"Save failed",description:i.message,variant:"destructive"})}finally{I(!1)}}},a=async r=>{if(!m)return;const{error:i}=await m.from("reward_catalog").update({is_active:!r.is_active}).eq("id",r.id);i?l({title:"Toggle failed",description:i.message,variant:"destructive"}):(l({title:r.is_active?"Deactivated":"Activated"}),A())},o=r=>{var i;S(r.id),v(!0),P({reward_type:r.reward_type||"cash",reward_value:r.reward_value||"",coins_required:((i=r.coins_required)!=null?i:"").toString(),is_active:!!r.is_active})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Redemptions auto-approved hain. Neeche sirf Rewards Catalog manage karna hai."}),e.jsxs("div",{className:"pt-10 border-t border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Rewards Catalog"}),e.jsx(g,{size:"sm",onClick:()=>{v(r=>!r),j||(d(),S(null))},children:j?"Close":"New Reward"}),e.jsx(g,{size:"sm",variant:"outline",onClick:A,disabled:N,children:N?e.jsx($,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),j&&e.jsxs("form",{onSubmit:c,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Type"}),e.jsx("div",{className:"flex gap-2 flex-wrap mt-1",children:["cash","voucher"].map(r=>e.jsx("button",{type:"button",onClick:()=>P(i=>({...i,reward_type:r})),className:`px-2 py-1 rounded text-xs border ${k.reward_type===r?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:r==="cash"?"💵 Cash (UPI/Phone)":"🎟️ Voucher (WhatsApp)"},r))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:k.reward_type==="cash"?"User will provide UPI ID or Phone number":"User will provide WhatsApp number"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Value"}),e.jsx(q,{value:k.reward_value,onChange:r=>P(i=>({...i,reward_value:r.target.value})),placeholder:"e.g. 100 / AMAZON100 / ₹100"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Coins Required"}),e.jsx(q,{type:"number",value:k.coins_required,onChange:r=>P(i=>({...i,coins_required:r.target.value})),placeholder:"coins needed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_active",type:"checkbox",checked:!!k.is_active,onChange:r=>P(i=>({...i,is_active:r.target.checked}))}),e.jsx("label",{htmlFor:"is_active",className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"submit",disabled:y,children:y?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"Saving"]}):b?"Update":"Create"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>{d(),S(null)},children:b?"Cancel Edit":"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Value"}),e.jsx("th",{className:"p-2 text-left",children:"Coins Required"}),e.jsx("th",{className:"p-2 text-left",children:"Active"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[u.map(r=>{var i;return e.jsxs("tr",{className:"border-t border-gray-200 hover:bg-gray-100",children:[e.jsx("td",{className:"p-2 capitalize",children:r.reward_type}),e.jsx("td",{className:"p-2 max-w-[260px] truncate",title:r.reward_value,children:r.reward_value}),e.jsx("td",{className:"p-2",children:(i=r.coins_required)!=null?i:"—"}),e.jsx("td",{className:"p-2",children:r.is_active?e.jsx("span",{className:"text-green-500",children:"Yes"}):e.jsx("span",{className:"text-gray-500",children:"No"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>o(r),children:"Edit"}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>a(r),children:r.is_active?"Deactivate":"Activate"})]})})]},r.id)}),!u.length&&!N&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 text-center text-gray-500",children:"No rewards."})}),N&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading rewards..."]})})]})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Catalog: inactive rewards are hidden from users."})]})]})}function Be(){const{toast:l}=Z(),[u,z]=w.useState(""),[N,R]=w.useState(""),[j,v]=w.useState("all"),[k,P]=w.useState(!1),[y,I]=w.useState([]),[b,S]=w.useState(!1),A=w.useCallback(async()=>{if(!m)return;S(!0);const{data:c,error:a}=await m.from("notifications").select("id,title,message,type,segment,created_at").order("created_at",{ascending:!1}).limit(100);a?l({title:"Fetch failed",description:a.message,variant:"destructive"}):I(c||[]),S(!1)},[l]);w.useEffect(()=>{A()},[A]);const d=async c=>{var a;if(c.preventDefault(),!u.trim()||!N.trim()){l({title:"Missing fields",variant:"destructive"});return}if(!m){l({title:"No backend client",variant:"destructive"});return}P(!0);try{const o={title:u.trim(),message:N.trim(),segment:j},{data:r}=await m.auth.getSession(),i=(a=r==null?void 0:r.session)==null?void 0:a.access_token,{data:_,error:T}=await m.functions.invoke("send-notifications",{body:o,headers:i?{Authorization:`Bearer ${i}`}:void 0});if(T)throw new Error(T.message||T.error||"Failed to send notification");const M=typeof _=="object"&&(_!=null&&_.message)?_.message:u.trim();l({title:"Sent",description:M}),z(""),R(""),A()}catch(o){l({title:"Send failed",description:o.message,variant:"destructive"})}finally{P(!1)}};return e.jsxs("div",{className:"space-y-8 max-w-3xl",children:[e.jsxs("form",{onSubmit:d,className:"space-y-4 bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Send Notification"}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"notification-title",children:"Title"}),e.jsx(q,{id:"notification-title",name:"notificationTitle",value:u,onChange:c=>z(c.target.value),maxLength:80,placeholder:"Short title"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 80 chars • ",u.length,"/80"]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"notification-message",children:"Message"}),e.jsx(ae,{id:"notification-message",name:"notificationMessage",value:N,onChange:c=>R(c.target.value),className:"h-28",maxLength:280,placeholder:"Body shown in push notification"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 280 chars • ",N.length,"/280"]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Segment"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["all"].map(c=>e.jsx("button",{type:"button",onClick:()=>v(c),className:`px-3 py-1 rounded text-xs border ${j===c?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:c},c))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"submit",disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"Sending"]}):"Send"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>{z(""),R("")},children:"Reset"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Recent Notifications"}),e.jsx(g,{size:"sm",variant:"outline",onClick:A,disabled:b,children:b?e.jsx($,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),e.jsxs("div",{className:"space-y-3",children:[y.map(c=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:c.title}),e.jsx("div",{className:"text-xs text-gray-600 whitespace-pre-wrap max-w-xl break-words",children:c.message})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:K(c.created_at)})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Segment: ",c.segment||"—",c.type?` • ${c.type}`:""]})]},c.id)),!y.length&&!b&&e.jsx("div",{className:"text-xs text-gray-500",children:"No notifications yet."})]})]})]})}function Ve(){const{toast:l}=Z(),[u,z]=w.useState(!1),[N,R]=w.useState(!1),[j,v]=w.useState({is_enabled:!0,cadence_min:10,live_window_min:7,cleanup_days:3,categories:["opinion","gk","sports","movies"],alert_emails:["quizdangalofficial@gmail.com"]}),[k,P]=w.useState([]),[y,I]=w.useState({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),b=w.useCallback(async()=>{var a,o,r;if(m){z(!0);try{const[{data:i,error:_},{data:T,error:M}]=await Promise.all([m.from("ai_settings").select("*").eq("id",1).maybeSingle(),m.from("ai_providers").select("*").order("enabled",{ascending:!1}).order("priority",{ascending:!0}).order("id",{ascending:!0})]);if(_)throw _;if(M)throw M;i&&v({is_enabled:!!i.is_enabled,cadence_min:(a=i.cadence_min)!=null?a:10,live_window_min:(o=i.live_window_min)!=null?o:7,cleanup_days:(r=i.cleanup_days)!=null?r:3,categories:Array.isArray(i.categories)?i.categories:["opinion","gk","sports","movies"],alert_emails:Array.isArray(i.alert_emails)?i.alert_emails:["quizdangalofficial@gmail.com"]}),P(T||[])}catch(i){l({title:"Load failed",description:i.message,variant:"destructive"})}finally{z(!1)}}},[l]);w.useEffect(()=>{b()},[b]);const S=async a=>{var o;if((o=a==null?void 0:a.preventDefault)==null||o.call(a),!!m){R(!0);try{const r={id:1,is_enabled:!!j.is_enabled,cadence_min:Number(j.cadence_min||10),live_window_min:Number(j.live_window_min||7),categories:j.categories,cleanup_days:Number(j.cleanup_days||3),alert_emails:j.alert_emails},{error:i}=await m.from("ai_settings").upsert(r,{onConflict:"id"});if(i)throw i;l({title:"Settings saved"})}catch(r){l({title:"Save failed",description:r.message,variant:"destructive"})}finally{R(!1)}}},A=async a=>{if(!m)return;const{error:o}=await m.from("ai_providers").update({enabled:!a.enabled}).eq("id",a.id);o?l({title:"Toggle failed",description:o.message,variant:"destructive"}):(l({title:a.enabled?"Disabled":"Enabled"}),b())},d=async a=>{var o;if((o=a==null?void 0:a.preventDefault)==null||o.call(a),!!m)try{const r={name:String(y.name||"").trim(),api_key_enc:String(y.api_key_enc||"").trim()||null,priority:Number(y.priority||1),enabled:!!y.enabled};if(!r.name)throw new Error("Provider name required");let i;if(y.id?i=await m.from("ai_providers").update(r).eq("id",y.id).select().single():i=await m.from("ai_providers").insert([r]).select().single(),i.error)throw i.error;l({title:y.id?"Provider updated":"Provider added"}),I({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),b()}catch(r){l({title:"Save failed",description:r.message,variant:"destructive"})}},c=a=>I({id:a.id,name:a.name||"",api_key_enc:a.api_key_enc||"",priority:a.priority||1,enabled:!!a.enabled});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"AI Automation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Auto-generate quizzes backend-only. Configure cadence, categories, alert emails, and API providers with failover."}),e.jsxs("form",{onSubmit:S,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_enabled",type:"checkbox",checked:!!j.is_enabled,onChange:a=>v(o=>({...o,is_enabled:a.target.checked}))}),e.jsx("label",{htmlFor:"is_enabled",className:"text-sm",children:"Enabled"})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Cadence (min)"}),e.jsx(q,{type:"number",min:1,max:60,value:j.cadence_min,onChange:a=>v(o=>({...o,cadence_min:a.target.valueAsNumber||10}))})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Live window (min)"}),e.jsx(q,{type:"number",min:5,max:180,value:j.live_window_min,onChange:a=>v(o=>({...o,live_window_min:a.target.valueAsNumber||7}))})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Cleanup days"}),e.jsx(q,{type:"number",min:1,max:30,value:j.cleanup_days,onChange:a=>v(o=>({...o,cleanup_days:a.target.valueAsNumber||3}))})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Categories (comma)"}),e.jsx(q,{value:(j.categories||[]).join(", "),onChange:a=>v(o=>({...o,categories:a.target.value.split(",").map(r=>r.trim()).filter(Boolean)}))})]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Alert emails (comma)"}),e.jsx(q,{value:(j.alert_emails||[]).join(", "),onChange:a=>v(o=>({...o,alert_emails:a.target.value.split(",").map(r=>r.trim()).filter(Boolean)}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"submit",disabled:N,children:N?"Saving…":"Save Settings"}),e.jsx(g,{type:"button",variant:"outline",onClick:b,disabled:u,children:u?"Loading…":"Refresh"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h3",{className:"font-semibold",children:"Providers"}),e.jsx(g,{size:"sm",variant:"outline",onClick:b,disabled:u,children:u?"Loading…":"Refresh"})]}),e.jsxs("form",{onSubmit:d,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsx("h4",{className:"font-medium",children:y.id?"Edit Provider":"Add Provider"}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(C,{children:"Name"}),e.jsx(q,{value:y.name,onChange:a=>I(o=>({...o,name:a.target.value})),placeholder:"e.g. openai"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Priority"}),e.jsx(q,{type:"number",value:y.priority,onChange:a=>I(o=>({...o,priority:a.target.valueAsNumber||1}))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"prov_enabled",type:"checkbox",checked:!!y.enabled,onChange:a=>I(o=>({...o,enabled:a.target.checked}))}),e.jsx("label",{htmlFor:"prov_enabled",className:"text-sm",children:"Enabled"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(C,{children:"API Key (stored server-side)"}),e.jsx(q,{value:y.api_key_enc,onChange:a=>I(o=>({...o,api_key_enc:a.target.value})),placeholder:"sk-..."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"submit",children:y.id?"Update":"Add"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>I({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),children:"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Name"}),e.jsx("th",{className:"p-2 text-left",children:"Priority"}),e.jsx("th",{className:"p-2 text-left",children:"Enabled"}),e.jsx("th",{className:"p-2 text-left",children:"Quota"}),e.jsx("th",{className:"p-2 text-left",children:"Last Error"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[k.map(a=>e.jsxs("tr",{className:"border-t border-gray-200",children:[e.jsx("td",{className:"p-2",children:a.name}),e.jsx("td",{className:"p-2",children:a.priority}),e.jsx("td",{className:"p-2",children:a.enabled?"Yes":"No"}),e.jsx("td",{className:"p-2",children:a.quota_exhausted?"Exhausted":"OK"}),e.jsx("td",{className:"p-2 max-w-[300px] truncate",title:a.last_error||"",children:a.last_error||"—"}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>c(a),children:"Edit"}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>A(a),children:a.enabled?"Disable":"Enable"})]})})]},a.id)),!k.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-center text-gray-500",children:"No providers"})})]})]})})]})]})}export{He as default};
