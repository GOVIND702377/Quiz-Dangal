import{j as e,d as se,a as ie,u as J,s as o,B as p,L as g,I as h}from"./index-30cc22b4.js";import{a as re,r as d}from"./react-8a702e3e.js";import{d as ae}from"./router-bcacfb8d.js";import{m as K}from"./motion-511bde03.js";import{J as ne,h as W,G as de,K as $,N as Y,L as T,O as oe,Q as le,V as B,Y as ce}from"./icons-5fedd17b.js";import"./supabase-4c1332f7.js";const V=re.forwardRef(({className:l,...a},_)=>e.jsx("textarea",{ref:_,className:se("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",l),...a}));V.displayName="Textarea";function ue(){const{toast:l}=J(),[a,_]=d.useState(""),[P,N]=d.useState(""),[F,y]=d.useState("announcement"),[c,z]=d.useState(""),[S,L]=d.useState(""),[k,f]=d.useState(!1),[i,u]=d.useState([]),[m,A]=d.useState(!0),[D,I]=d.useState(""),[R,E]=d.useState(""),[n,w]=d.useState(!1),C=async()=>{A(!0);const{data:r,error:b}=await o.from("notifications").select("*").order("created_at",{ascending:!1}).limit(20);b?l({title:"Load failed",description:b.message,variant:"destructive"}):u(r||[]),A(!1)};d.useEffect(()=>{C()},[]);const q=async r=>{if(r.preventDefault(),!D.trim()||!R.trim()){l({title:"Title/Message required",variant:"destructive"});return}w(!0);try{const{error:b}=await o.functions.invoke("send-notifications",{body:{title:D.trim(),message:R.trim()}});if(b)throw b;l({title:"Push sent",description:"Notifications queued to subscribers."}),I(""),E("")}catch(b){l({title:"Push failed",description:b.message||"Try again later",variant:"destructive"})}finally{w(!1)}},G=async r=>{if(r.preventDefault(),!a.trim()||!P.trim()){l({title:"Title/Message required",variant:"destructive"});return}f(!0);try{const b={p_title:a.trim(),p_message:P.trim(),p_type:F,p_quiz_id:c||null,p_scheduled_at:S?new Date(S).toISOString():null},{error:M}=await o.rpc("create_notification",b);if(M)throw M;l({title:"Notification queued",description:"It will be delivered per schedule."}),_(""),N(""),z(""),L(""),y("announcement"),await C()}catch(b){l({title:"Send failed",description:b.message,variant:"destructive"})}finally{f(!1)}};return e.jsxs("div",{className:"space-y-4 text-foreground",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent flex items-center",children:[e.jsx(ce,{className:"mr-2"})," Admin: Notifications"]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Announcements aur quiz notifications yahan se bhejein"})]})}),e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-4 flex items-center",children:[e.jsx(W,{className:"w-5 h-5 mr-2"}),"Send Push Notification"]}),e.jsxs("form",{onSubmit:q,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"pushTitle",children:"Push Notification Title *"}),e.jsx(h,{id:"pushTitle",value:D,onChange:r=>I(r.target.value),placeholder:"e.g., New Quiz Alert!",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"pushMessage",children:"Push Notification Message *"}),e.jsx(V,{id:"pushMessage",value:R,onChange:r=>E(r.target.value),placeholder:"Don't miss out on today's quiz!",required:!0})]}),e.jsx(p,{type:"submit",disabled:n,className:"bg-purple-600 hover:bg-purple-700",children:n?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Push..."]}):"Send Push Notification"})]})]}),e.jsx("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:G,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"ntitle",children:"Title *"}),e.jsx(h,{id:"ntitle",value:a,onChange:r=>_(r.target.value),placeholder:"e.g., Quiz Starting Soon",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"ntype",children:"Type *"}),e.jsxs("select",{id:"ntype",value:F,onChange:r=>y(r.target.value),className:"w-full border border-border bg-background text-foreground rounded-md px-3 py-2",children:[e.jsx("option",{value:"announcement",children:"Announcement"}),e.jsx("option",{value:"quiz_start",children:"Quiz Start"}),e.jsx("option",{value:"quiz_end",children:"Quiz End"}),e.jsx("option",{value:"quiz_result",children:"Quiz Result"})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"nmsg",children:"Message *"}),e.jsx(V,{id:"nmsg",value:P,onChange:r=>N(r.target.value),placeholder:"Write your message...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"nquiz",children:"Quiz ID (optional)"}),e.jsx(h,{id:"nquiz",value:c,onChange:r=>z(r.target.value),placeholder:"UUID of quiz"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"nsched",children:"Schedule (optional)"}),e.jsx(h,{id:"nsched",type:"datetime-local",value:S,onChange:r=>L(r.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"submit",disabled:k,className:"bg-indigo-600 hover:bg-indigo-700",children:k?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):"Send Notification"}),e.jsx(p,{type:"button",variant:"outline",onClick:C,children:"Refresh"})]})]})}),e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg",children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Recent"]}),m?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(T,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):i.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No notifications"}):e.jsx("div",{className:"space-y-2",children:i.map(r=>e.jsx("div",{className:"p-3 rounded-xl bg-card/80 border border-border flex items-center justify-between text-sm",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-foreground",children:[r.title," ",e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",r.type,")"]})]}),e.jsx("div",{className:"text-foreground/80",children:r.message}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["Quiz: ",r.quiz_id||"—"," • Scheduled: ",r.scheduled_at?new Date(r.scheduled_at).toLocaleString():"now"," • Created: ",new Date(r.created_at).toLocaleString()]})]})},r.id))})]})]})}function je(){const{userProfile:l}=ie(),{toast:a}=J(),[_,P]=ae(),N=_.get("tab")||"overview",F=t=>{const s=new URLSearchParams(_);s.set("tab",t),P(s,{replace:!1})};if((l==null?void 0:l.role)!=="admin")return e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Aapke paas admin adhikaar nahi hain."})]});const[y,c]=d.useState([]),[z,S]=d.useState(!0),[L,k]=d.useState(!1),[f,i]=d.useState(null),[u,m]=d.useState(!1),[A,D]=d.useState([]),[I,R]=d.useState(null),E=["opinion","gk","movies","sports"],[n,w]=d.useState({title:"",prizes:["","",""],start_time:"",end_time:"",category:""});d.useEffect(()=>{N==="overview"&&C()},[N]);const C=async()=>{try{const{data:t,error:s}=await o.from("quizzes").select("*").order("start_time",{ascending:!1});if(s)throw s;c(t||[])}catch(t){a({title:"Error",description:"Failed to fetch quizzes.",variant:"destructive"})}finally{S(!1)}},q=async t=>{try{const{data:s,error:x}=await o.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",t);if(x)throw x;D(s||[])}catch(s){a({title:"Error",description:"Failed to fetch questions.",variant:"destructive"})}},G=async()=>{if(!f)return;const t=window.prompt("Question text daalein");if(!t||!t.trim())return;const{error:s}=await o.from("questions").insert({quiz_id:f.id,question_text:t.trim()});if(s)return a({title:"Add failed",description:s.message,variant:"destructive"});await q(f.id)},r=async(t,s)=>{const x=(s||"").trim();if(!x)return a({title:"Question khaali nahi ho sakta",variant:"destructive"});const{error:j}=await o.from("questions").update({question_text:x}).eq("id",t);if(j)return a({title:"Update failed",description:j.message,variant:"destructive"});await q(f.id)},b=async t=>{if(!confirm("Is question aur iske options ko delete karein?"))return;const{error:s}=await o.from("questions").delete().eq("id",t);if(s)return a({title:"Delete failed",description:s.message,variant:"destructive"});await q(f.id)},M=async t=>{const s=window.prompt("Option text daalein");if(!s||!s.trim())return;const{error:x}=await o.from("options").insert({question_id:t,option_text:s.trim()});if(x)return a({title:"Add failed",description:x.message,variant:"destructive"});await q(f.id)},H=async(t,s)=>{const x=(s||"").trim();if(!x)return a({title:"Option khaali nahi ho sakta",variant:"destructive"});const{error:j}=await o.from("options").update({option_text:x}).eq("id",t);if(j)return a({title:"Update failed",description:j.message,variant:"destructive"});await q(f.id)},X=async t=>{if(!confirm("Is option ko delete karein?"))return;const{error:s}=await o.from("options").delete().eq("id",t);if(s)return a({title:"Delete failed",description:s.message,variant:"destructive"});await q(f.id)},Z=async t=>{t.preventDefault();try{const s=n.prizes.filter(v=>v).map(v=>parseInt(v)),x=s.reduce((v,Q)=>v+Q,0),{data:j,error:O}=await o.from("quizzes").insert([{title:n.title,prize_pool:x,prizes:s,start_time:n.start_time?new Date(n.start_time).toISOString():null,end_time:n.end_time?new Date(n.end_time).toISOString():null,status:"upcoming",category:n.category||null}]).select("id, title, category, prizes, prize_pool, start_time, end_time").single();if(O)throw O;a({title:"Quiz created",description:"Ab questions add karein; users ko schedule ke hisaab se dikhega."}),k(!1),w({title:"",prizes:["","",""],start_time:"",end_time:"",category:""}),i(j),await q(j.id),m(!0),C()}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}},ee=async t=>{if(confirm("Kya aap is quiz ko delete karna chahte hain?"))try{const{error:s}=await o.from("quizzes").delete().eq("id",t);if(s)throw s;a({title:"Success",description:"Quiz delete ho gaya."}),C()}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}},te=async t=>{try{R(t);const{error:s}=await o.rpc("admin_recompute_quiz_results",{p_quiz_id:t});if(s)throw s;a({title:"Results recomputed",description:"Leaderboard update ho gaya."})}catch(s){a({title:"Recompute failed",description:s.message,variant:"destructive"})}finally{R(null)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl text-foreground",children:[e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Quiz Dangal Admin"}),e.jsx("p",{className:"text-muted-foreground",children:"Admin dashboard"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-6",children:[{key:"overview",title:"Overview",icon:e.jsx(ne,{className:"w-4 h-4"})},{key:"notifications",title:"Notifications",icon:e.jsx(W,{className:"w-4 h-4"})},{key:"redemptions",title:"Redemptions",icon:e.jsx(de,{className:"w-4 h-4"})}].map(t=>e.jsxs("button",{onClick:()=>F(t.key),className:`px-3 py-2 rounded-lg border text-sm transition-colors inline-flex items-center gap-2 ${t.key===N?"bg-primary text-primary-foreground border-transparent shadow":"bg-muted text-muted-foreground border-border hover:text-foreground"} `,children:[t.icon,t.title]},t.key))}),N==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs(p,{onClick:()=>k(!0),className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Create New Quiz"]})}),L&&e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-1",children:"Create New Quiz"}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Category (Section)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:E.map(t=>e.jsx("button",{type:"button",onClick:()=>w({...n,category:t}),className:`px-3 py-1 rounded-full border text-sm capitalize ${n.category===t?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border hover:text-foreground"}`,children:t},t))}),!n.category&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:"Please choose a category"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(g,{htmlFor:"title",children:"Quiz Title"}),e.jsx(h,{id:"title",value:n.title,onChange:t=>w({...n,title:t.target.value}),placeholder:"Daily Opinion Quiz - Evening",required:!0})]})}),e.jsxs("div",{children:[e.jsx(g,{children:"Prize Distribution (₹)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(h,{placeholder:"1st Prize (251)",value:n.prizes[0],onChange:t=>{const s=[...n.prizes];s[0]=t.target.value,w({...n,prizes:s})}}),e.jsx(h,{placeholder:"2nd Prize (151)",value:n.prizes[1],onChange:t=>{const s=[...n.prizes];s[1]=t.target.value,w({...n,prizes:s})}}),e.jsx(h,{placeholder:"3rd Prize (51)",value:n.prizes[2],onChange:t=>{const s=[...n.prizes];s[2]=t.target.value,w({...n,prizes:s})}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Start Time"}),e.jsx(h,{type:"datetime-local",value:n.start_time,onChange:t=>w({...n,start_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{children:"End Time"}),e.jsx(h,{type:"datetime-local",value:n.end_time,onChange:t=>w({...n,end_time:t.target.value}),required:!0})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(p,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create Quiz"}),e.jsx(p,{type:"button",variant:"outline",onClick:()=>k(!1),children:"Cancel"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground flex items-center",children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"All Quizzes"]}),z?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(T,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading quizzes..."]}):y.map((t,s)=>{var x,j,O;return e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Category: ",t.category||"—"]}),e.jsxs("span",{children:["Prize Pool: ₹",t.prize_pool]}),e.jsxs("span",{children:["Prizes: ₹",(x=t.prizes)==null?void 0:x.join(", ₹")]})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Start: ",t.start_time?new Date(t.start_time).toLocaleString():"—"]}),e.jsxs("span",{className:"ml-4",children:["End: ",t.end_time?new Date(t.end_time).toLocaleString():"—"]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("select",{className:"border border-border bg-background text-foreground rounded-md px-2 py-2 capitalize",value:t.category||"",onChange:async v=>{const{error:Q}=await o.from("quizzes").update({category:v.target.value}).eq("id",t.id);Q?a({title:"Update failed",description:Q.message,variant:"destructive"}):C()},children:[e.jsx("option",{value:"",children:"Select category"}),E.map(v=>e.jsx("option",{value:v,children:v},v))]}),e.jsx(h,{type:"datetime-local",value:((j=t.start_time)==null?void 0:j.slice(0,16))||"",onChange:async v=>{const Q=v.target.value;y[s].start_time=Q,c([...y]);const{error:U}=await o.from("quizzes").update({start_time:Q}).eq("id",t.id);U&&(a({title:"Update failed",description:U.message,variant:"destructive"}),C())}}),e.jsx(h,{type:"datetime-local",value:((O=t.end_time)==null?void 0:O.slice(0,16))||"",onChange:async v=>{const Q=v.target.value;y[s].end_time=Q,c([...y]);const{error:U}=await o.from("quizzes").update({end_time:Q}).eq("id",t.id);U&&(a({title:"Update failed",description:U.message,variant:"destructive"}),C())}})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>te(t.id),disabled:I===t.id,className:"text-indigo-600 hover:text-indigo-700",children:I===t.id?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-1 animate-spin"}),"Recomputing"]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Recompute"]})}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>{i(t),q(t.id),m(!0)},className:"text-blue-600 hover:text-blue-700",children:[e.jsx(le,{className:"h-4 w-4"}),"Questions"]}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>ee(t.id),className:"text-red-600 hover:text-red-700",children:e.jsx(B,{className:"h-4 w-4"})})]})]})},t.id)})]}),u&&f&&e.jsxs("div",{className:"mt-6 bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["Questions for: ",f.title]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:G,className:"bg-indigo-600 hover:bg-indigo-700",size:"sm",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Add Question"]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>m(!1),children:"Close"})]})]}),A.length===0?e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:"No questions yet"}):e.jsx("div",{className:"space-y-4",children:A.map(t=>e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{defaultValue:t.question_text,onBlur:s=>r(t.id,s.target.value),className:"flex-1"}),e.jsx(p,{variant:"outline",size:"sm",className:"text-red-600 border-red-300",onClick:()=>b(t.id),children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 pl-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Options"}),e.jsxs("div",{className:"space-y-2",children:[(t.options||[]).map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{defaultValue:s.option_text,onBlur:x=>H(s.id,x.target.value),className:"flex-1"}),e.jsxs("label",{className:"flex items-center gap-1 text-xs text-foreground/80",children:[e.jsx("input",{type:"checkbox",defaultChecked:!!s.is_correct,onChange:async x=>{const{error:j}=await o.from("options").update({is_correct:x.target.checked}).eq("id",s.id);j&&a({title:"Update failed",description:j.message,variant:"destructive"})}}),"Correct"]}),e.jsx(p,{variant:"outline",size:"sm",className:"text-red-600 border-red-300",onClick:()=>X(s.id),children:e.jsx(B,{className:"w-4 h-4"})})]},s.id)),e.jsxs(p,{onClick:()=>M(t.id),size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Add Option"]})]})]})]},t.id))})]})]}),N==="notifications"&&e.jsx(ue,{}),N==="redemptions"&&e.jsx(me,{})]})}function me(){const{toast:l}=J(),[a,_]=d.useState([]),[P,N]=d.useState(!0),[F,y]=d.useState(!1),[c,z]=d.useState({title:"",coins_required:"",description:"",image_url:""}),S=async()=>{N(!0);const{data:i,error:u}=await o.from("reward_catalog").select("*").order("coins_required",{ascending:!1});u?(l({title:"Load failed",description:u.message,variant:"destructive"}),_([])):_(i||[]),N(!1)};d.useEffect(()=>{S()},[]);const L=async i=>{var D,I;i.preventDefault();const u=c.title.trim(),m=parseInt(c.coins_required,10);if(!u||isNaN(m)||m<0){l({title:"Invalid input",description:"Title required and coins must be a non-negative number",variant:"destructive"});return}y(!0);const{error:A}=await o.from("reward_catalog").insert({title:u,coins_required:m,description:((D=c.description)==null?void 0:D.trim())||null,image_url:((I=c.image_url)==null?void 0:I.trim())||null,is_active:!0});A?l({title:"Add failed",description:A.message,variant:"destructive"}):(l({title:"Added",description:"Catalog item created"}),z({title:"",coins_required:"",description:"",image_url:""}),S()),y(!1)},k=async(i,u)=>{const{error:m}=await o.from("reward_catalog").update(u).eq("id",i);m?l({title:"Update failed",description:m.message,variant:"destructive"}):S()},f=async i=>{if(!confirm("Delete this item?"))return;const{error:u}=await o.from("reward_catalog").delete().eq("id",i);u?l({title:"Delete failed",description:u.message,variant:"destructive"}):(l({title:"Deleted"}),S())};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Admin: Redemptions Catalog"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Items jinko users coins se redeem kar sakte hain"})]}),e.jsx("div",{className:"bg-card text-card-foreground border border-border rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:L,className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"rc_title",children:"Title *"}),e.jsx(h,{id:"rc_title",value:c.title,onChange:i=>z({...c,title:i.target.value}),placeholder:"e.g., ₹100 Paytm",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"rc_coins",children:"Coins *"}),e.jsx(h,{id:"rc_coins",type:"number",min:"0",value:c.coins_required,onChange:i=>z({...c,coins_required:i.target.value}),placeholder:"e.g., 1000",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"rc_img",children:"Image URL (optional)"}),e.jsx(h,{id:"rc_img",value:c.image_url,onChange:i=>z({...c,image_url:i.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(g,{htmlFor:"rc_desc",children:"Description (optional)"}),e.jsx(V,{id:"rc_desc",value:c.description,onChange:i=>z({...c,description:i.target.value}),placeholder:"Short details"})]}),e.jsx("div",{children:e.jsx(p,{type:"submit",disabled:F,className:"bg-green-600 hover:bg-green-700",children:F?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):"Add Item"})})]})}),e.jsxs("div",{className:"bg-card text-card-foreground border border-border rounded-2xl p-4 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Catalog Items"}),P?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(T,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):a.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No items"}):e.jsx("div",{className:"space-y-2",children:a.map(i=>e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{defaultValue:i.title,onBlur:u=>{const m=u.target.value.trim();m&&m!==i.title&&k(i.id,{title:m})},className:"flex-1"}),e.jsx(h,{type:"number",min:"0",defaultValue:i.coins_required,onBlur:u=>{const m=parseInt(u.target.value,10);!isNaN(m)&&m!==i.coins_required&&k(i.id,{coins_required:m})},className:"w-32"})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1 truncate",children:i.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs text-foreground/80 flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",defaultChecked:!!i.is_active,onChange:u=>k(i.id,{is_active:u.target.checked})})," Active"]}),e.jsx(p,{size:"sm",variant:"outline",className:"text-red-600 border-red-300",onClick:()=>f(i.id),children:e.jsx(B,{className:"w-4 h-4"})})]})]},i.id))})]})]})}export{je as default};
