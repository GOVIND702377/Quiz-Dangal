import{u as K,a as R,s as b,j as t,f as W,b as M}from"./index-30cc22b4.js";import{r as l}from"./react-8a702e3e.js";import{c as Y,a as V}from"./router-bcacfb8d.js";import{m as H}from"./motion-511bde03.js";import{d as X,b as T,B as Z,F as q,c as ee}from"./icons-5fedd17b.js";import"./supabase-4c1332f7.js";function te(m){const o="px-2 py-0.5 rounded-full text-xs font-semibold";return m==="active"?o+" bg-green-600/15 text-green-400 border border-green-700/40":m==="upcoming"?o+" bg-blue-600/15 text-blue-300 border border-blue-700/40":o+" bg-slate-600/20 text-slate-300 border border-slate-700/40"}function se(m=""){const o=String(m||"").toLowerCase();return o.includes("opinion")?{title:"Opinion Quizzes",emoji:"ðŸ’¬",Icon:T,from:"from-indigo-600/30",to:"to-fuchsia-600/30",ring:"ring-fuchsia-500/30"}:o.includes("gk")?{title:"GK Quizzes",emoji:"ðŸ§ ",Icon:Z,from:"from-emerald-600/30",to:"to-teal-600/30",ring:"ring-emerald-500/30"}:o.includes("sport")?{title:"Sports Quizzes",emoji:"ðŸ”¥",Icon:q,from:"from-orange-600/30",to:"to-red-600/30",ring:"ring-orange-500/30"}:o.includes("movie")?{title:"Movie Quizzes",emoji:"ðŸŽ¬",Icon:ee,from:"from-violet-600/30",to:"to-indigo-600/30",ring:"ring-violet-500/30"}:{title:`${m} Quizzes`,emoji:"â­",Icon:T,from:"from-sky-600/30",to:"to-indigo-600/30",ring:"ring-sky-500/30"}}const ce=()=>{const{slug:m}=Y(),o=V(),{toast:x}=K(),{user:p}=R(),[c,$]=l.useState([]),[C,N]=l.useState(!0),[_,z]=l.useState(null),[O,k]=l.useState({});l.useState({});const[A,j]=l.useState({}),[ie,J]=l.useState(0),S=l.useCallback(async()=>{try{const{data:e,error:i}=await b.from("quizzes").select("id,title,category,start_time,end_time,status,prize_pool,prizes").eq("category",m).order("start_time",{ascending:!0});if(i)throw i;$(e||[])}catch(e){x({title:"Error",description:"Could not load quizzes.",variant:"destructive"})}finally{N(!1)}},[m,x]);l.useEffect(()=>{N(!0),S()},[S]),l.useEffect(()=>{const e=Date.now();if(!(c||[]).some(r=>{const n=r.start_time?new Date(r.start_time).getTime():0,s=r.end_time?new Date(r.end_time).getTime():0;return n&&e<n||n&&s&&e>=n&&e<s}))return;const a=setInterval(()=>J(r=>(r+1)%1e6),1e3);return()=>clearInterval(a)},[c]),l.useEffect(()=>{const e=async()=>{try{const i=(c||[]).map(s=>s.id);if(!i.length){k({});return}const{data:a,error:r}=await b.rpc("get_engagement_counts_many",{p_quiz_ids:i});if(r)throw r;const n={};for(const s of a||[]){const d=s.pre_joined||0,h=s.joined||0;n[s.quiz_id]=d+h}k(n)}catch(i){}};c&&c.length&&e()},[c]),l.useEffect(()=>{(async()=>{if(!p||!(c!=null&&c.length)){j({});return}try{const i=c.map(s=>s.id),{data:a,error:r}=await b.from("quiz_participants").select("quiz_id,status").eq("user_id",p.id).in("quiz_id",i);if(r)throw r;const n={};for(const s of a||[])n[s.quiz_id]=s.status==="pre_joined"?"pre":"joined";j(n)}catch(i){j({})}})()},[p,c]);const L=async e=>{if(!p){x({title:"Login required",description:"Please sign in to join the quiz.",variant:"destructive"}),o("/login");return}z(e.id);try{const i=Date.now(),a=e.start_time?new Date(e.start_time).getTime():0,r=e.end_time?new Date(e.end_time).getTime():0,n=a&&r&&i>=a&&i<r,s=a&&i<a,d=s?"pre_join_quiz":n?"join_quiz":"pre_join_quiz",{data:h,error:u}=await b.rpc(d,{p_quiz_id:e.id});if(u)throw u;s?x({title:"Pre-joined!",description:"We will remind you before start."}):(x({title:"Joined!",description:"Taking you to the quiz."}),o(`/quiz/${e.id}`))}catch(i){x({title:"Error",description:i.message||"Could not join quiz.",variant:"destructive"})}finally{z(null)}},[v,P]=l.useState("all"),D=c.filter(e=>{const i=Date.now(),a=e.start_time?new Date(e.start_time).getTime():0,r=e.end_time?new Date(e.end_time).getTime():0,n=a&&r&&i>=a&&i<r,s=a&&i<a;return v==="all"?n||s:v==="active"?n:s});return t.jsxs("div",{className:"container mx-auto px-4 py-3 text-foreground",children:[(()=>{const e=se(m);return e.Icon,t.jsxs("div",{className:`relative overflow-hidden rounded-2xl border border-white/10 bg-gradient-to-br ${e.from} ${e.to} mb-4`,children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(700px 180px at -10% -20%, rgba(255,255,255,0.07), transparent), radial-gradient(420px 100px at 110% 10%, rgba(255,255,255,0.05), transparent)"}}),t.jsx("div",{className:"px-4 py-4 sm:px-5 sm:py-5",children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"text-xl sm:text-2xl","aria-hidden":!0,children:e.emoji}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-lg sm:text-xl font-extrabold text-white tracking-tight drop-shadow-sm",children:e.title}),t.jsx("p",{className:"text-xs text-white/80",children:"Pick an upcoming or live quiz to jump in."})]})]}),t.jsx("div",{className:`inline-flex rounded-lg bg-slate-900/60 border border-slate-700/60 overflow-hidden shadow ${e.ring}`,children:["all","active","upcoming"].map(i=>t.jsx("button",{onClick:()=>P(i),className:`px-2.5 sm:px-3.5 py-1 text-[11px] font-semibold transition ${v===i?"bg-white/10 text-white":"text-slate-300 hover:bg-white/5"}`,children:i.toUpperCase()},i))})]})})]})})(),C?t.jsx("div",{className:"grid gap-3",children:Array.from({length:4}).map((e,i)=>t.jsx("div",{className:"h-24 rounded-xl bg-slate-800/60 border border-slate-700/60 animate-pulse"},i))}):D.length===0?t.jsx("div",{className:"text-center text-muted-foreground py-16",children:"No quizzes in this category yet."}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:D.map((e,i)=>{const a=Date.now(),r=e.start_time?new Date(e.start_time).getTime():null,n=e.end_time?new Date(e.end_time).getTime():null,s=r&&n&&a>=r&&a<n,d=r&&a<r,h=s||d;let u=_===e.id?"JOININGâ€¦":s?"PLAY":d?"JOIN":"SOON";const w=d&&r?Math.max(0,Math.floor((r-a)/1e3)):s&&n?Math.max(0,Math.floor((n-a)/1e3)):null,y=Array.isArray(e.prizes)?e.prizes:[],Q=y[0]||0,U=y[1]||0,B=y[2]||0,F=O[e.id]||0,g=A[e.id];let f=!h||_===e.id;d&&g==="pre"&&(u="PRE-JOINED",f=!0),s&&g==="joined"&&(u="PLAY");const I=r&&n?Math.max(1,n-r):null,E=s&&I?Math.min(100,Math.max(0,Math.round((a-r)/I*100))):null;return t.jsxs(H.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:i*.03},onClick:()=>o(`/quiz/${e.id}`),className:`relative overflow-hidden rounded-2xl border ${s?"border-emerald-700/50":"border-slate-800"} bg-gradient-to-br from-slate-950/90 via-slate-900/85 to-slate-900/60 shadow-xl cursor-pointer group hover:-translate-y-0.5 transition-transform`,role:"button",tabIndex:0,onKeyDown:G=>{G.key==="Enter"&&o(`/quiz/${e.id}`)},children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(1200px 300px at -10% -10%, rgba(99,102,241,0.06), transparent), radial-gradient(900px 200px at 110% 20%, rgba(16,185,129,0.05), transparent)"}}),s&&t.jsx("div",{className:"absolute -left-10 top-3 rotate-[-15deg]",children:t.jsx("span",{className:"bg-rose-600 text-white text-[10px] font-extrabold tracking-widest px-6 py-1 rounded shadow-lg ring-1 ring-rose-300/50",children:"LIVE"})}),d&&t.jsx("div",{className:"absolute -left-10 top-3 rotate-[-15deg]",children:t.jsx("span",{className:"bg-sky-600 text-white text-[10px] font-extrabold tracking-widest px-6 py-1 rounded shadow-lg ring-1 ring-sky-300/50",children:"SOON"})}),t.jsx("div",{className:"p-4 sm:p-5",children:t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("div",{className:"truncate font-semibold text-slate-100 text-base sm:text-lg",children:e.title}),t.jsx("span",{className:te(s?"active":d?"upcoming":"finished"),children:s?"active":d?"upcoming":"finished"}),g&&t.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-semibold border ${g==="pre"?"bg-indigo-500/15 text-indigo-300 border-indigo-700/40":"bg-emerald-500/15 text-emerald-300 border-emerald-700/40"}`,children:g==="pre"?"Pre-joined":"Joined"})]}),t.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs",children:[t.jsxs("span",{className:"px-2.5 py-1.5 rounded-lg bg-gradient-to-r from-amber-500/20 to-amber-400/10 text-amber-200 border border-amber-500/30 shadow-sm",children:["ðŸ¥‡ â‚¹",Q]}),t.jsxs("span",{className:"px-2.5 py-1.5 rounded-lg bg-gradient-to-r from-sky-500/20 to-sky-400/10 text-sky-200 border border-sky-500/30 shadow-sm",children:["ðŸ¥ˆ â‚¹",U]}),t.jsxs("span",{className:"px-2.5 py-1.5 rounded-lg bg-gradient-to-r from-violet-500/20 to-violet-400/10 text-violet-200 border border-violet-500/30 shadow-sm",children:["ðŸ¥‰ â‚¹",B]})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-[11px] text-slate-400",children:e.start_time?W(e.start_time):"â€”"}),t.jsxs("div",{className:"mt-1 grid grid-cols-1 sm:grid-cols-2 gap-2 text-[11px] text-slate-300",children:[t.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-md px-2 py-1",children:[t.jsx("span",{className:"uppercase text-[9px] text-slate-400",children:"Start"}),t.jsx("div",{children:e.start_time?M(e.start_time):"â€”"})]}),t.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-md px-2 py-1",children:[t.jsx("span",{className:"uppercase text-[9px] text-slate-400",children:"End"}),t.jsx("div",{children:e.end_time?M(e.end_time):"â€”"})]})]})]}),w!==null&&t.jsxs("div",{className:"mt-2 text-sm font-semibold text-indigo-300",children:[d?"Starts in":"Ends in"," ",Math.floor(w/60).toString().padStart(2,"0"),":",(w%60).toString().padStart(2,"0")]}),t.jsx("div",{className:"mt-1 flex items-center gap-4 text-xs text-slate-400",children:t.jsxs("span",{className:"inline-flex items-center",children:[t.jsx(X,{className:"w-3.5 h-3.5 mr-1"}),F," joined"]})}),E!==null&&t.jsx("div",{className:"mt-2 w-full bg-slate-800/50 border border-slate-700/70 rounded-full h-1 overflow-hidden",children:t.jsx("div",{className:"h-1 bg-emerald-500/80",style:{width:`${E}%`}})})]}),t.jsx("div",{className:"shrink-0 flex flex-col sm:flex-row gap-2",children:t.jsx("button",{disabled:f,onClick:()=>!f&&L({...e,status:d?"upcoming":s?"active":e.status}),className:`px-3 py-2 rounded-lg text-sm font-semibold border transition ${f?"bg-slate-700 text-slate-400 border-slate-700":s?"bg-emerald-600 hover:bg-emerald-700 text-white border-emerald-600 shadow-emerald-500/20 shadow-lg":"bg-indigo-600 hover:bg-indigo-700 text-white border-indigo-600 shadow-indigo-500/20 shadow-lg"}`,children:u})})]})})]},e.id)})})]})};export{ce as default};
