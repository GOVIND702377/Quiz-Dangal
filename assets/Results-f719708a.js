import{_ as xt}from"./supabase-07ebd5d8.js";import{u as gt,a as bt,h as Ne,s as k,b as wt,c as vt,g as oe,j as t,B as Ve,m as yt,n as jt,e as _t}from"./index-dc690ff1.js";import{r as R}from"./react-63c462fe.js";import{g as Nt}from"./avatar-8b1b1844.js";import{S as ce}from"./SEO-db5765ff.js";import{c as St,a as zt}from"./router-10fed1f4.js";import{d as Tt,T as Ye,S as Ct,a0 as kt,h as Rt}from"./icons-218c8792.js";const Bt=()=>{const{id:v}=St(),Se=zt(),{toast:F}=gt(),{user:b,userProfile:_}=bt(),[i,Ge]=R.useState(null),[S,de]=R.useState([]),[u,Xe]=R.useState(null),[me,fe]=R.useState(!0),[ue,ee]=R.useState(""),[V,W]=R.useState(null),[te,ze]=R.useState(!1),[Te,he]=R.useState(null),[Ze,Je]=R.useState(0),Ce=(_==null?void 0:_.role)==="admin",Ke={hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.2}}},U=R.useCallback(async()=>{var s,n;if(!Ne||!k){ee("Results are unavailable right now."),fe(!1);return}try{ee("");const{data:a,error:e}=await k.from("quizzes").select("*").eq("id",v).single();if(e)throw e;Ge(a||null);let l=!1;if(b!=null&&b.id)try{const{data:d}=await k.from("quiz_participants").select("status").eq("quiz_id",v).eq("user_id",b==null?void 0:b.id).maybeSingle();l=!!d}catch(d){l=!1}const o=Ce||l||wt({defaultValue:!0}),{data:h,error:N}=await k.from("quiz_results").select("leaderboard").eq("quiz_id",v).maybeSingle();if(N)throw N;let p=Array.isArray(h==null?void 0:h.leaderboard)?h.leaderboard:[];if(!h||p.length===0)if(de([]),a!=null&&a.end_time){const f=new Date(a.end_time).getTime()-Date.now();if(W(f>0?f:0),f<=0&&o)try{await vt(k,v,{throttleMs:150}),await new Promise(T=>setTimeout(T,400));const{data:j}=await k.from("quiz_results").select("leaderboard").eq("quiz_id",v).maybeSingle(),z=Array.isArray(j==null?void 0:j.leaderboard)?j.leaderboard:[];z.length>0&&(p=z)}catch(j){}else if(f>0)return}else{W(null);return}else W(null);const y=(Array.isArray(p)?p:[]).map((d,f)=>{var j;return{id:`${v}-${d.user_id}`,user_id:d.user_id,score:Number(d.score)||0,rank:Number(d.rank)||f+1,profiles:{username:(j=d.display_name)!=null&&j.startsWith("@")?d.display_name.slice(1):void 0,full_name:d.display_name,avatar_url:void 0}}}).sort((d,f)=>f.score-d.score);de(y),y.length>0&&te&&ze(!1);try{const{data:d}=await k.rpc("get_engagement_counts",{p_quiz_id:v}),f=Array.isArray(d)?d[0]:d,j=Number((s=f==null?void 0:f.joined)!=null?s:0),z=Number((n=f==null?void 0:f.pre_joined)!=null?n:0);Je(j+z)}catch(d){}try{const d=y.slice(0,10).map(f=>f.user_id);if(d.length){const{data:f,error:j}=await k.rpc("profiles_public_by_ids",{p_ids:d});if(j&&console.warn("Public profile fetch failed:",j),Array.isArray(f)&&f.length){const z=new Map(f.map(w=>[w.id,w])),T=await Nt(f.map(w=>w.avatar_url).filter(Boolean));de(w=>w.map(C=>{const M=z.get(C.user_id);if(!M)return C;const Y=M.avatar_url&&T.get(M.avatar_url)||"";return{...C,profiles:{username:M.username,full_name:M.full_name,avatar_url:Y}}}))}}}catch(d){}const A=y.find(d=>d.user_id===(b==null?void 0:b.id));A&&Xe(A)}catch(a){console.error("Error fetching results:",a),ee((a==null?void 0:a.message)||"Failed to load results.")}finally{fe(!1)}},[v,b==null?void 0:b.id,Ce,te]);R.useEffect(()=>{U()},[U]);const et=()=>{fe(!0),ee(""),U()};R.useEffect(()=>{let s=!1;return(async()=>{try{if(S.length===0){he(null);return}const a=await pe();s||he(a)}catch(a){s||he(null)}})(),()=>{s=!0}},[S.length,v,u==null?void 0:u.rank,u==null?void 0:u.score]);const se=(i==null?void 0:i.prize_type)||"coins",ke=u!=null&&u.rank&&Array.isArray(i==null?void 0:i.prizes)&&i.prizes[u.rank-1]?i.prizes[u.rank-1]:0,tt=oe(se,ke,{fallback:0}),pe=async()=>{try{const a=document.createElement("canvas");a.width=1080,a.height=1920;const e=a.getContext("2d");e.textBaseline="top";const l="Inter, system-ui, -apple-system, Segoe UI, Roboto",o=(r,c)=>{e.font=`${r} ${c}px ${l}`},h=r=>e.measureText(r).width,N=(r,c,m,x,g)=>{let E=x;for(o(m,E);E>g&&h(r)>c;)E-=2,o(m,E);return E},p=(r,c,m,x)=>{o(m,x);const g=String(r).split(/\s+/),E=[];let P="";for(const O of g){const ie=P?P+" "+O:O;h(ie)<=c?P=ie:(P&&E.push(P),P=O)}return P&&E.push(P),E},y=(r,c,m,x,g,E,P,O,ie)=>{let I=E,K=p(r,x,g,I);for(;(K.length>O||K.some(Q=>h(Q)>x))&&I>P;)I-=1,K=p(r,x,g,I);o(g,I),e.fillStyle=ie;const Oe=Math.round(I*1.25),Qe=Math.min(O,K.length);for(let Q=0;Q<Qe;Q++){const Fe=K[Q],pt=h(Fe);e.fillText(Fe,c-pt/2,m+Q*Oe)}return{height:Qe*Oe,size:I}},A=(r,c)=>{let m=String(r);for(;m&&h(m)>c;)m=m.slice(0,-1);return m.length<String(r).length?m.slice(0,Math.max(0,m.length-1))+"…":m},d=r=>new Promise((c,m)=>{const x=new Image;x.crossOrigin="anonymous",x.onload=()=>c(x),x.onerror=m,x.src=r}),f=(r,c,m,x,g)=>{e.beginPath(),e.moveTo(r+g,c),e.lineTo(r+m-g,c),e.quadraticCurveTo(r+m,c,r+m,c+g),e.lineTo(r+m,c+x-g),e.quadraticCurveTo(r+m,c+x,r+m-g,c+x),e.lineTo(r+g,c+x),e.quadraticCurveTo(r,c+x,r,c+x-g),e.lineTo(r,c+g),e.quadraticCurveTo(r,c,r+g,c),e.closePath()},j=e.createLinearGradient(0,0,1080,1920);j.addColorStop(0,"#150a36"),j.addColorStop(1,"#0f0926"),e.fillStyle=j,e.fillRect(0,0,1080,1920);const z=64,T=1080/2;let w=z+12;const C=140,M=w+C;e.save(),e.beginPath(),e.arc(T,M,C,0,Math.PI*2),e.closePath();const Y=e.createLinearGradient(T-C,M-C,T+C,M+C);Y.addColorStop(0,"#1cc5ff"),Y.addColorStop(1,"#ef47ff"),e.fillStyle=Y,e.fill();try{const c=({}.VITE_POSTER_LOGO_URL||"").trim()||"/android-chrome-192x192.png";let m;try{m=await d(c)}catch(E){m=await d("/android-chrome-192x192.png")}const x=16,g=C*2-x;e.save(),e.beginPath(),e.arc(T,M,C-x/2,0,Math.PI*2),e.clip(),e.drawImage(m,Math.round(T-g/2),Math.round(M-g/2),Math.round(g),Math.round(g)),e.restore(),e.lineWidth=2,e.strokeStyle="rgba(255,255,255,0.7)",e.beginPath(),e.arc(T,M,C-x/2,0,Math.PI*2),e.stroke()}catch(r){}e.restore(),w=M+C+18;const rt=`🏅 ${((_==null?void 0:_.full_name)||(_==null?void 0:_.username)||"Your").toString().toUpperCase()}’S LEGENDARY RUN 🏅`,lt=y(rt,T,w,1080-z*2,"900",56,34,2,"#ffd54a");w+=lt.height+16;const it=y("✨ Brains = Fame ✨",T,w,1080-z*2,"700",36,22,1,"rgba(255,255,255,0.9)");w+=it.height+28;const D=z,L=1080-z*2,xe=D+56,Re=48,ot=40,Me=u!=null&&u.rank?`#${u.rank} Rank!`:"Results Live!",Ae=`👑 Prize: ${oe(se,ke,{fallback:0}).formatted}`,G=typeof(u==null?void 0:u.score)=="number"?`☑️ Score: ${u.score}`:"",ge=N(Me,L-100,"900",112,80),be=N(Ae,L-100,"900",48,32),we=G?N(G,L-100,"900",44,28):0,ct=Math.round(ge*1)+24+Math.round(be*1.15)+12+(G?Math.round(we*1.15)+12:0),Ee=Re+ct+ot,X=w,ve=e.createLinearGradient(D,X,D+L,X);ve.addColorStop(0,"rgba(34,211,238,0.9)"),ve.addColorStop(1,"rgba(236,72,153,0.9)"),e.save(),f(D,X,L,Ee,36),e.fillStyle="rgba(15,23,42,0.72)",e.fill(),e.lineWidth=4,e.strokeStyle=ve,e.stroke(),e.restore();let B=X+Re;o("900",ge),e.fillStyle="#ffffff",e.fillText(Me,xe,B),B+=Math.round(ge*1)+24,o("900",be),e.fillStyle="#ffd54a",e.fillText(Ae,xe,B),B+=Math.round(be*1.15)+12,G&&(o("900",we),e.fillStyle="rgba(168,255,230,0.95)",e.fillText(G,xe,B),B+=Math.round(we*1.15)+12),w=X+Ee+28;const Le=230,Pe=Math.max(120,1920-z-Le-w),ye="⚡ My Result is Live!",je=N(ye,L-120,"900",48,26),dt="“Think you can beat me? Join Quiz Dangal & prove it 👀”",ae=26,qe=Math.round(ae*1.25);o("700",ae);const De=p(dt,L-120,"700",ae).slice(0,2),mt=De.length*qe;let ne=28+Math.round(je)+12+mt+28;ne>Pe&&(ne=Pe);const re=w;f(D,re,L,ne,28),e.fillStyle="rgba(8,11,30,0.9)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(56,189,248,0.5)",e.stroke(),o("900",je),e.fillStyle="#facc15";const ft=h(ye);e.fillText(ye,T-ft/2,re+28),o("700",ae),e.fillStyle="rgba(226,232,240,0.92)";let Ue=re+28+Math.round(je)+12;for(const r of De){const c=h(r);e.fillText(r,T-c/2,Ue),Ue+=qe}w=re+ne+24;const q=w,Z=Math.max(Le,Math.min(280,1920-z-q));f(D,q,L,Z,24),e.fillStyle="rgba(12,10,36,0.9)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(79,70,229,0.45)",e.stroke();const ut=_!=null&&_.referral_code?_.referral_code:b!=null&&b.id?b.id.replace(/-/g,"").slice(0,8).toUpperCase():"",le=jt(ut),ht=`${({}.VITE_PUBLIC_SITE_URL||"https://www.quizdangal.com").replace(/\/$/,"")}/?ref=${encodeURIComponent(le)}`;le&&_t(le);const J=Math.min(220,Z-72),$e=J+32,Ie=J+40,_e=D+L-$e-36,We=q+Math.max(24,Math.round((Z-Ie)/2));f(_e,We,$e,Ie,18),e.fillStyle="#ffffff",e.fill();try{const{default:r}=await xt(()=>import("./browser-864b0b18.js").then(m=>m.b),[]),c=document.createElement("canvas");await r.toCanvas(c,ht,{width:J,margin:1,color:{dark:"#000000",light:"#ffffff"}}),e.drawImage(c,_e+16,We+16,J,J)}catch(r){}const $=D+36,H=_e-24-$;e.fillStyle="rgba(255,255,255,0.96)",o("900",48),e.fillText(A("🧠 Play & Win",H),$,q+36),e.fillStyle="rgba(203,213,225,0.98)",o("800",36),e.fillText(A("🌐 www.quizdangal.com",H),$,q+36+54),o("900",44),e.fillStyle="rgba(255,255,255,0.96)";const Be="🔗 Referral: ",He=h(Be);return e.fillText(A(Be,H),$,q+36+54+62),e.fillStyle="rgba(0,255,198,1)",e.fillText(A(le,Math.max(0,H-He-8)),$+He,q+36+54+62),o("700",26),e.fillStyle="rgba(226,232,240,0.92)",e.fillText(A("Your turn to flex your brain 💯",H),$,q+Z-80),o("700",24),e.fillStyle="rgba(203,213,225,0.92)",e.fillText(A("#QuizDangal  #ChallengeAccepted  #PlayToWin",H),$,q+Z-44),await new Promise(r=>a.toBlob(r,"image/jpeg",.92))}catch(s){try{const n=document.createElement("canvas");n.width=8,n.height=8;const a=n.getContext("2d"),e=a.createLinearGradient(0,0,8,8);return e.addColorStop(0,"#130531"),e.addColorStop(1,"#1e0b4b"),a.fillStyle=e,a.fillRect(0,0,8,8),await new Promise(o=>n.toBlob(o,"image/jpeg",.9))}catch(n){return null}}};R.useEffect(()=>{if(!(i!=null&&i.end_time)||S.length>0){W(null);return}const s=new Date(i.end_time).getTime(),n=()=>{const e=s-Date.now();e>0?W(e):(W(0),te||(ze(!0),U()))};n();const a=setInterval(n,1e3);return()=>clearInterval(a)},[i==null?void 0:i.end_time,S.length,te,U]),R.useEffect(()=>{if(S.length>0||!Ne||!k||!v||typeof window=="undefined")return;const s=(()=>{var l,o;try{const h=typeof window!="undefined"&&window.__QUIZ_DANGAL_ENV__?window.__QUIZ_DANGAL_ENV__:{},N=(o=(l={}.VITE_ENABLE_REALTIME)!=null?l:h.VITE_ENABLE_REALTIME)!=null?o:"0",p=String(N).toLowerCase();return p==="1"||p==="true"||p==="yes"}catch(h){return!1}})();if(!(()=>{try{if(!s||!Ne||!k||!v||typeof window=="undefined"||!("WebSocket"in window)||navigator&&navigator.onLine===!1||typeof document!="undefined"&&document.visibilityState==="hidden"||typeof window!="undefined"&&window.isSecureContext===!1)return!1;const l=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||null;return!(l&&(l.saveData||typeof l.effectiveType=="string"&&/(^|\b)2g(\b|$)/i.test(l.effectiveType)))}catch(l){return!0}})())return;let a=null,e=null;try{a=k.channel(`quiz-results-${v}`,{config:{broadcast:{ack:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"quiz_results",filter:`quiz_id=eq.${v}`},()=>{U()}).subscribe(l=>{if(l==="CHANNEL_ERROR"||l==="TIMED_OUT"||l==="CLOSED")try{a&&k.removeChannel(a)}catch(o){}}),e=setTimeout(()=>{try{a&&a.state!=="joined"&&(k.removeChannel(a),a=null)}catch(l){}},5e3)}catch(l){}return()=>{try{e&&clearTimeout(e),a&&k.removeChannel(a)}catch(l){}}},[v,S.length,U]);const st=s=>{const n=Math.max(0,Math.floor((s!=null?s:0)/1e3)),a=Math.floor(n/86400),e=Math.floor(n%86400/3600),l=Math.floor(n%3600/60),o=n%60;return{days:a,hours:e,minutes:l,seconds:o}},at=async()=>{try{let s=Te;if(s||(s=await pe()),s&&navigator.canShare&&window.File){const n=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[n]})){await navigator.share({files:[n],title:"Quiz Dangal Result"}),F({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const n=URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download="quiz-dangal-result.jpg",a.rel="noopener",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(n),1500),F({title:"Poster saved",description:"Share the image from your gallery."});return}F({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){F({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},nt=async()=>{try{let s=Te;if(s||(s=await pe()),s&&navigator.canShare&&window.File){const p=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[p]})){await navigator.share({files:[p],title:"Quiz Dangal Result"});return}}if(s)try{const p=URL.createObjectURL(s),y=document.createElement("a");y.href=p,y.download="quiz-dangal-result.jpg",y.rel="noopener",document.body.appendChild(y),y.click(),document.body.removeChild(y),setTimeout(()=>URL.revokeObjectURL(p),1500)}catch(p){}const n=navigator.userAgent||"",a=/Android/i.test(n),e=/iPhone|iPad|iPod/i.test(n),l="whatsapp://send",o="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",h="https://wa.me/",N=p=>!!window.open(p,"_blank");if(a){if(N(l))return;window.location.href=o,setTimeout(()=>{document.hidden||(window.location.href=h)},700);return}if(e){window.location.href=l,setTimeout(()=>{document.hidden||(window.location.href=h)},700);return}N(h)}catch(s){F({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};return me?t.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[t.jsx(ce,{title:"Results – Loading | Quiz Dangal",description:"Loading quiz results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-accent-b"})]}):!me&&ue?t.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[t.jsx(ce,{title:"Results – Error | Quiz Dangal",description:ue||"Could not load results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),t.jsx("p",{className:"text-slate-300 mb-4",children:ue}),t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(Ve,{variant:"brand",onClick:et,children:"Retry"}),t.jsx(Ve,{variant:"white",onClick:()=>Se("/my-quizzes"),children:"Back"})]})]})]}):!me&&(V!=null?V:0)>0&&S.length===0?t.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[t.jsx(ce,{title:"Results – Not Published | Quiz Dangal",description:"Results will be available after the quiz ends.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Results not published yet"}),i!=null&&i.end_time?t.jsx("div",{className:"mb-4",children:V>0?t.jsxs("div",{children:[t.jsx("p",{className:"text-slate-300 mb-3",children:"Quiz ends in"}),(()=>{const{days:s,hours:n,minutes:a,seconds:e}=st(V),l=(o,h)=>t.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[t.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:o.toString().padStart(2,"0")}),t.jsx("div",{className:"text-xs text-slate-400",children:h})]});return t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s>0&&l(s,"Days"),l(n,"Hours"),l(a,"Minutes"),l(e,"Seconds")]})})(),t.jsxs("p",{className:"text-xs text-slate-400 mt-3",children:["End time: ",new Date(i.end_time).toLocaleString()]})]}):t.jsx("p",{className:"text-slate-300 mb-4",children:"Finalizing results… please stay on this page."})}):t.jsx("p",{className:"text-slate-300 mb-4",children:"Please check back after the quiz end time."})]})]}):t.jsxs("div",{className:"min-h-screen p-4 pb-24 relative overflow-hidden",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[t.jsx(ce,{title:`${i!=null&&i.title?`${i.title} – Results`:"Quiz Results"} | Quiz Dangal`,description:S.length>0?"Leaderboard and winners for this quiz.":"Results are finalized.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${v}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),t.jsx("style",{children:".results-prize-row::-webkit-scrollbar{display:none;}"}),t.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[t.jsx("div",{className:"absolute -top-32 -right-16 w-80 h-80 rounded-full blur-3xl opacity-30 bg-gradient-to-br from-fuchsia-600 to-indigo-600"}),t.jsx("div",{className:"absolute -bottom-24 -left-16 w-96 h-96 rounded-full blur-3xl opacity-20 bg-gradient-to-br from-emerald-500 to-cyan-500"})]}),t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsx("div",{className:"px-1 sm:px-1.5 pt-1 pb-2 sm:pt-1.5 sm:pb-3",children:t.jsxs("div",{className:"relative rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur p-3 sm:p-4 overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none","aria-hidden":!0,children:t.jsx("div",{className:"absolute -inset-1 bg-[conic-gradient(var(--tw-gradient-stops))] from-indigo-500/12 via-fuchsia-500/10 to-cyan-500/12 blur-2xl"})}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-start justify-between gap-3 flex-nowrap",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 text-slate-300 text-xs",children:[t.jsx(Tt,{className:"w-3.5 h-3.5"}),t.jsxs("span",{children:[Ze||(S==null?void 0:S.length)||0," participants"]})]}),t.jsxs("h1",{className:"text-[22px] sm:text-[26px] font-extrabold text-white tracking-tight flex items-center gap-2",children:[t.jsx(Ye,{className:"w-6 h-6 text-amber-300"})," Results"]}),t.jsx("p",{className:"text-[12px] sm:text-sm text-slate-400 truncate max-w-[65vw] sm:max-w-sm",children:i==null?void 0:i.title})]}),(u==null?void 0:u.rank)&&t.jsxs("div",{className:"shrink-0 text-right pl-1 self-start relative z-10",children:[t.jsxs("div",{className:"inline-flex items-center gap-1.5 text-xs sm:text-sm font-semibold text-indigo-200 drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:[t.jsx(Ct,{className:"w-4 h-4"}),"You ranked"]}),t.jsxs("div",{className:"mt-1 text-2xl sm:text-3xl font-extrabold text-white drop-shadow-[0_2px_6px_rgba(0,0,0,0.9)]",children:["#",u.rank]})]})]}),Array.isArray(i==null?void 0:i.prizes)&&i.prizes.length>0&&t.jsx("div",{className:"results-prize-row mt-2 flex items-center gap-1.5 flex-nowrap overflow-x-auto sm:overflow-visible [-ms-overflow-style:none] [scrollbar-width:none] relative z-0",children:i.prizes.map((s,n)=>{const a=oe(se,s,{fallback:0}),e="inline-flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-[11px] font-semibold border shadow-sm backdrop-blur-sm whitespace-nowrap",l=n===0?"bg-amber-500/15 text-amber-100 border-amber-500/35":n===1?"bg-sky-500/15 text-sky-100 border-sky-500/35":n===2?"bg-violet-500/15 text-violet-100 border-violet-500/35":"bg-slate-800/70 text-slate-200 border-slate-700/60";return t.jsxs("span",{className:`${e} ${l}`,children:[t.jsx("span",{children:n===0?"🥇":n===1?"🥈":n===2?"🥉":`#${n+1}`}),t.jsx("span",{children:n===0?"1st":n===1?"2nd":n===2?"3rd":"Prize"}),t.jsx("span",{children:a.formatted})]},n)})})]})]})}),u&&(_==null?void 0:_.role)!=="admin"&&t.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-900/60 px-3 py-3 mt-4 mb-5",children:t.jsxs("div",{className:"flex items-center justify-between gap-3 flex-nowrap text-[10px] sm:text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[t.jsxs("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 via-violet-500 to-fuchsia-600 text-white font-bold flex items-center justify-center ring-1 ring-indigo-300/40",children:["#",u.rank]}),t.jsxs("div",{className:"leading-tight min-w-0",children:[t.jsx("div",{className:"text-[12px] sm:text-sm font-semibold text-white",children:"Your Result"}),t.jsxs("div",{className:"text-[11px] sm:text-xs text-slate-300 truncate",children:["Out of ",S.length," participants"]})]})]}),t.jsxs("div",{className:"flex items-center gap-3 sm:gap-5 shrink-0",children:[t.jsxs("div",{className:"flex flex-col items-end min-w-[60px]",children:[t.jsx("span",{className:"uppercase text-[9px] sm:text-[10px] tracking-wide text-slate-400",children:"Score"}),t.jsx("span",{className:"text-[15px] sm:text-base font-bold text-emerald-300 leading-tight",children:u.score})]}),t.jsxs("div",{className:"flex flex-col items-end min-w-[78px]",children:[t.jsx("span",{className:"uppercase text-[9px] sm:text-[10px] tracking-wide text-slate-400",children:"Prize"}),t.jsx("span",{className:"text-[15px] sm:text-base font-bold text-purple-300 leading-tight",children:tt.formatted})]})]})]})}),t.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/60 p-3",children:[t.jsxs("div",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[t.jsx(Ye,{className:"w-4 h-4 text-amber-300"}),"Leaderboard"]}),t.jsxs("div",{className:"space-y-2",children:[S.length===0&&t.jsx("div",{className:"p-3 rounded-lg bg-slate-900/70 border border-slate-700/60 text-slate-300 text-sm",children:"No participants or no valid answers. Results are finalized."}),S.map((s,n)=>{var o,h,N,p,y,A,d;const a=s.rank&&Array.isArray(i==null?void 0:i.prizes)&&i.prizes[s.rank-1]?i.prizes[s.rank-1]:0,e=oe(se,a,{fallback:0}),l=s.user_id===(b==null?void 0:b.id);return t.jsxs(yt.div,{variants:Ke,initial:"hidden",animate:"show",className:`flex items-center justify-between gap-3 p-2.5 rounded-lg border transition-colors ${l?"bg-indigo-950/40 border-indigo-700/40 ring-1 ring-indigo-500/20":n<3?"bg-slate-900/70 border-slate-700/60":"bg-slate-950/30 border-slate-800 hover:bg-slate-900/60"}`,children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx("div",{className:"w-8 h-8 rounded-md grid place-items-center text-xs font-bold bg-slate-800 text-slate-100 ring-1 ring-white/10",children:t.jsx("span",{children:s.rank||n+1})}),t.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center text-gray-600 text-xs font-bold",children:(o=s.profiles)!=null&&o.avatar_url?t.jsx("img",{src:s.profiles.avatar_url,alt:s.profiles.full_name?`${s.profiles.full_name} avatar`:"User avatar",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):t.jsx("span",{children:(((h=s.profiles)==null?void 0:h.full_name)||((N=s.profiles)==null?void 0:N.username)||"U").charAt(0).toUpperCase()})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-white truncate",children:((p=s.profiles)==null?void 0:p.username)||((y=s.profiles)==null?void 0:y.full_name)||"Anonymous"}),((A=s.profiles)==null?void 0:A.full_name)&&((d=s.profiles)==null?void 0:d.username)&&t.jsx("p",{className:"text-[10px] text-slate-400 truncate",children:s.profiles.full_name})]})]}),t.jsxs("div",{className:"flex items-center gap-3 sm:gap-5 shrink-0 whitespace-nowrap",children:[t.jsxs("div",{className:"text-right min-w-[52px]",children:[t.jsx("p",{className:"text-[10px] text-slate-400 leading-none mb-0.5",children:"Score"}),t.jsx("p",{className:"text-sm sm:text-base font-bold text-emerald-300 leading-none",children:s.score})]}),t.jsxs("div",{className:"text-right min-w-[70px]",children:[t.jsx("p",{className:"text-[10px] text-slate-400 leading-none mb-0.5",children:"Prize"}),t.jsx("p",{className:"text-sm sm:text-base font-bold text-purple-300 leading-none flex items-center justify-end gap-1",children:t.jsx("span",{children:e.formatted})})]})]})]},s.id)})]})]})]}),t.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/90 backdrop-blur supports-[backdrop-filter]:bg-slate-900/70 shadow-[0_-6px_24px_rgba(0,0,0,0.35)]",children:t.jsx("div",{className:"max-w-4xl mx-auto px-3 sm:px-4",style:{paddingTop:10,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 10px)"},children:t.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[t.jsxs("button",{onClick:()=>Se("/my-quizzes"),className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-3 rounded-lg text-sm font-semibold bg-slate-800/85 text-white border border-slate-700 hover:bg-slate-800 active:translate-y-px transition w-full min-w-0",children:[t.jsx(kt,{className:"w-5 h-5","aria-hidden":"true"}),t.jsx("span",{className:"truncate",children:"Back"})]}),t.jsxs("button",{onClick:nt,className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-2.5 rounded-lg text-[13px] sm:text-sm font-extrabold border text-white shadow-[0_8px_18px_rgba(34,197,94,0.35)] hover:shadow-[0_12px_24px_rgba(34,197,94,0.5)] border-emerald-500/50 bg-[linear-gradient(90deg,#16a34a,#22c55e,#10b981)] w-full min-w-0",children:[t.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fill:"currentColor",d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),t.jsx("span",{className:"whitespace-nowrap",children:"WhatsApp"})]}),t.jsxs("button",{onClick:at,className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-3 rounded-lg text-sm font-extrabold border text-white shadow-[0_8px_18px_rgba(139,92,246,0.4)] hover:shadow-[0_12px_24px_rgba(139,92,246,0.55)] border-violet-500/40 bg-[linear-gradient(90deg,#4f46e5,#7c3aed,#9333ea,#c026d3)] w-full min-w-0",children:[t.jsx(Rt,{className:"w-5 h-5","aria-hidden":"true"}),t.jsx("span",{className:"truncate",children:"Share"})]})]})})})]})};export{Bt as default};
