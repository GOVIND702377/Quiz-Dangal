import{a as O,s as f,h as B,j as e,B as R,f as Y,b as A,g as L}from"./index-d8c98b97.js";import{r as g}from"./react-8a702e3e.js";import{S as U}from"./SEO-4581ed8b.js";import{a as W}from"./router-f2cf3f51.js";import{L as F,P,d as G,e as H}from"./icons-52d1b41a.js";import{m as _}from"./motion-f69b6c08.js";import"./supabase-4c1332f7.js";function J(l){const c="px-2 py-0.5 rounded-full text-xs font-semibold";return l==="active"?c+" bg-green-600/15 text-green-400 border border-green-700/40":l==="upcoming"?c+" bg-blue-600/15 text-blue-300 border border-blue-700/40":c+" bg-slate-600/20 text-slate-300 border border-slate-700/40"}const K=({size:l=72,centered:c=!1,fitParent:m=!1})=>{const u=typeof l=="number"?`${l}px`:l,[j,v]=g.useState(0),y=["/Trophy.png","/trophy.png","/trophy-question.png","/trophy-question.webp"],w=y[j]||y[0];return e.jsx("div",{className:`relative trophy-float pointer-events-none${c?"":" mx-auto mb-4"}`,style:{width:m?"100%":u,height:m?"100%":u},children:e.jsx("div",{className:"trophy-sway w-full h-full",children:e.jsx("div",{className:"trophy-pulse w-full h-full",children:j>=0?e.jsx("img",{src:w,alt:"Trophy",className:"w-full h-full object-contain select-none",style:{backgroundColor:"transparent",display:"block"},loading:"eager",decoding:"async",onError:()=>{const h=j+1;h<y.length?v(h):v(-1)}}):e.jsxs("svg",{viewBox:"0 0 128 128",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid meet","aria-hidden":!0,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"qdTg",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffe795"}),e.jsx("stop",{offset:"45%",stopColor:"#ffd34d"}),e.jsx("stop",{offset:"75%",stopColor:"#f0a700"}),e.jsx("stop",{offset:"100%",stopColor:"#b86a00"})]}),e.jsxs("linearGradient",{id:"qdQM",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#6d28d9"}),e.jsx("stop",{offset:"100%",stopColor:"#7c3aed"})]})]}),e.jsx("path",{d:"M28 30c-10 0-18 10-16 20 2 10 14 14 24 11",fill:"none",stroke:"#f0b000",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M100 30c10 0 18 10 16 20-2 10-14 14-24 11",fill:"none",stroke:"#f0b000",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M28 22h72c0 24-10 36-26 41v9c0 7-6 13-14 13s-14-6-14-13v-9C38 58 28 46 28 22Z",fill:"url(#qdTg)"}),e.jsx("rect",{x:"56",y:"72",width:"16",height:"10",rx:"3",fill:"url(#qdTg)"}),e.jsx("rect",{x:"44",y:"82",width:"40",height:"12",rx:"4",fill:"url(#qdTg)"}),e.jsx("rect",{x:"36",y:"94",width:"56",height:"10",rx:"5",fill:"url(#qdTg)"}),e.jsx("text",{x:"64",y:"46",textAnchor:"middle",dominantBaseline:"middle",fontSize:"32",fontWeight:"900",fill:"url(#qdQM)",stroke:"#2b1a59",strokeWidth:"3",paintOrder:"stroke fill",children:"?"})]})})})})},re=()=>{const l=W(),{user:c}=O(),[m,u]=g.useState([]),[j,v]=g.useState(!0),[y,w]=g.useState({}),h=g.useCallback(async()=>{if(c)try{const{data:t,error:o}=await f.from("my_quizzes_view").select("*");if(o){console.error("Error fetching my quizzes view:",o),u([]);return}const i=(t||[]).map(s=>({...s})),r=Date.now(),a=(i||[]).filter(s=>s.end_time&&new Date(s.end_time).getTime()<=r&&(!Array.isArray(s.leaderboard)||s.leaderboard.length===0)).map(s=>s.id);if(a.length)try{await Promise.allSettled(a.map(d=>f.rpc("compute_results_if_due",{p_quiz_id:d})));const{data:s}=await f.from("my_quizzes_view").select("*"),n=(s||[]).map(d=>({...d}));u(n);return}catch(s){}u(i)}catch(t){console.error(t)}},[c]);if(g.useEffect(()=>{typeof window!="undefined"&&"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().catch(()=>{});let t=null;if(B&&f&&c)try{t=f.channel("quiz-results-channel",{config:{broadcast:{ack:!0}}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"quiz_results"},()=>{if(h(),typeof window!="undefined"&&"Notification"in window&&Notification.permission==="granted")try{new Notification("Quiz Result Ready",{body:"Your quiz results are available. Tap to view."})}catch(r){}}).subscribe(r=>{})}catch(r){}(async()=>{v(!0),await h(),v(!1)})();const i=setInterval(h,12e4);return()=>{try{t&&f.removeChannel(t)}catch(r){}clearInterval(i)}},[c,h]),g.useEffect(()=>{const t=async()=>{try{const o=Date.now(),i=(m||[]).filter(n=>n.end_time&&o<new Date(n.end_time).getTime()).map(n=>n.id);if(!i.length){w({});return}const{data:r,error:a}=await f.rpc("get_engagement_counts_many",{p_quiz_ids:i});if(a)throw a;const s={};for(const n of r||[]){const d=n.pre_joined||0,x=n.joined||0;s[n.quiz_id]=d+x}w(s)}catch(o){w({})}};m&&m.length&&t()},[m]),j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(F,{className:"h-12 w-12 animate-spin text-indigo-300"})});if(m.length===0)return e.jsx("div",{className:"min-h-screen overflow-x-hidden",children:e.jsx("div",{className:"fixed inset-0 overflow-hidden",children:e.jsx("div",{className:"container mx-auto h-full px-4",children:e.jsx("div",{className:"h-full flex items-start justify-center pt-20",children:e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:"relative text-center text-slate-100 p-2",children:[e.jsx("div",{className:"pointer-events-none absolute -top-16 -left-16 w-44 h-44 rounded-full bg-indigo-600/10 blur-3xl"}),e.jsx("div",{className:"pointer-events-none absolute -bottom-16 -right-16 w-44 h-44 rounded-full bg-fuchsia-600/10 blur-3xl"}),e.jsx("h1",{className:"text-2xl font-bold heading-gradient text-shadow mb-4",children:"My Quizzes"}),e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.06},className:"relative max-w-md mx-auto rounded-3xl p-[2px] bg-gradient-to-r from-indigo-600 via-fuchsia-600 to-rose-500 shadow-[0_30px_80px_-20px_rgba(99,102,241,0.25)]",children:e.jsxs("div",{className:"rounded-3xl bg-slate-950/80 backdrop-blur border border-white/10 px-6 py-9",children:[e.jsx("div",{className:"mx-auto mb-4 w-24 h-24 rounded-full p-[2px] bg-gradient-to-b from-amber-400 to-amber-600",children:e.jsx("div",{className:"w-full h-full rounded-full grid place-items-center bg-slate-950/90 p-2",children:e.jsx(K,{centered:!0,fitParent:!0})})}),e.jsx("h3",{className:"text-xl font-extrabold bg-gradient-to-r from-white to-slate-200 bg-clip-text text-transparent",children:"No Quizzes Yet"}),e.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"Kickstart your journeyâ€”join your first quiz and build your streak!"}),e.jsxs("div",{className:"mt-5 flex flex-wrap items-center justify-center gap-2 text-[11px]",children:[e.jsx("span",{className:"px-2.5 py-1 rounded-full border border-indigo-500/40 bg-indigo-500/10 text-indigo-200",children:"Daily quizzes"}),e.jsx("span",{className:"px-2.5 py-1 rounded-full border border-fuchsia-500/40 bg-fuchsia-500/10 text-fuchsia-200",children:"Win coins"}),e.jsx("span",{className:"px-2.5 py-1 rounded-full border border-emerald-500/40 bg-emerald-500/10 text-emerald-200",children:"Leaderboards"})]}),e.jsx("div",{className:"mt-7",children:e.jsxs(R,{onClick:()=>l("/"),variant:"brand",className:"w-full rounded-xl py-3 text-sm font-extrabold shadow-[0_14px_30px_rgba(139,92,246,0.35)] hover:shadow-[0_18px_42px_rgba(139,92,246,0.5)] hover:scale-[1.01] active:scale-[0.99] transition",children:[e.jsx(P,{className:"w-5 h-5 mr-2"})," Explore Quizzes"]})})]})})]})})})})});const p=Date.now(),T=m.filter(t=>t.end_time&&p<new Date(t.end_time).getTime()),Q=m.filter(t=>t.end_time&&p>=new Date(t.end_time).getTime());return T.sort((t,o)=>{const i=t.start_time?new Date(t.start_time).getTime():0,r=t.end_time?new Date(t.end_time).getTime():0,a=o.start_time?new Date(o.start_time).getTime():0,s=o.end_time?new Date(o.end_time).getTime():0,n=i&&r&&p>=i&&p<r,d=a&&s&&p>=a&&p<s;return n!==d?n?-1:1:i-a}),e.jsxs("div",{className:"min-h-screen overflow-x-hidden",children:[e.jsx(U,{title:"My Quizzes â€“ Quiz Dangal",description:"Track the quizzes you have joined, monitor live rounds, and revisit completed contests on Quiz Dangal.",canonical:"https://quizdangal.com/my-quizzes",robots:"noindex, nofollow"}),e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs(_.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},className:"overflow-hidden",children:[e.jsx("h1",{className:"text-2xl font-bold heading-gradient text-shadow mb-4 text-center",children:"My Quizzes"}),T.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Live/Upcoming"}),e.jsx("div",{className:"space-y-3",children:T.map((t,o)=>{var M,$,E;const i=t.start_time?new Date(t.start_time):null,r=t.end_time?new Date(t.end_time):null,a=i&&r&&p>=i.getTime()&&p<r.getTime(),s=a?Math.max(0,Math.floor((r.getTime()-Date.now())/1e3)):i?Math.max(0,Math.floor((i.getTime()-Date.now())/1e3)):0,n=i&&r?Math.max(1,r.getTime()-i.getTime()):null,d=a&&n?Math.min(100,Math.max(0,Math.round((Date.now()-i.getTime())/n*100))):null,x=Array.isArray(t.prizes)?t.prizes:[],N=t.prize_type||"money",b=(M=x[0])!=null?M:0,C=($=x[1])!=null?$:0,z=(E=x[2])!=null?E:0,S=D=>{const k=L(N,D,{fallback:0});return`${k.showIconSeparately&&k.icon?`${k.icon} `:""}${k.formatted}`.trim()},I=y[t.id]||0;return e.jsxs(_.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:o*.05},onClick:()=>l(`/quiz/${t.id}`),className:`relative overflow-hidden rounded-2xl border ${a?"border-emerald-700/50":"border-slate-800"} bg-gradient-to-br from-slate-950/90 via-slate-900/85 to-slate-900/60 shadow-xl cursor-pointer group hover:-translate-y-0.5 transition-transform qd-card p-4 sm:p-5`,children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(1200px 300px at -10% -10%, rgba(99,102,241,0.06), transparent), radial-gradient(900px 200px at 110% 20%, rgba(16,185,129,0.05), transparent)"}}),e.jsxs("div",{className:"absolute top-3 right-3 z-10 flex gap-2",children:[a&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-extrabold tracking-widest bg-rose-600 text-white ring-1 ring-rose-300/50 shadow",children:"LIVE"}),!a&&i&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-extrabold tracking-widest bg-sky-600 text-white ring-1 ring-sky-300/50 shadow",children:"SOON"})]}),e.jsx("div",{className:"flex items-center justify-between gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"truncate font-semibold text-slate-100 text-base sm:text-lg",children:t.title}),e.jsx("span",{className:J(a?"active":"upcoming"),children:a?"active":"upcoming"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[10px] font-semibold border ${a?"bg-emerald-500/15 text-emerald-300 border-emerald-700/40":"bg-indigo-500/15 text-indigo-300 border-indigo-700/40"}`,children:"Joined"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"px-2.5 py-1.5 rounded-lg bg-gradient-to-r from-amber-500/20 to-amber-400/10 text-amber-200 border border-amber-500/30 shadow-sm",children:["ðŸ¥‡ ",S(b)]}),e.jsxs("span",{className:"px-2.5 py-1.5 rounded-lg bg-gradient-to-r from-sky-500/20 to-sky-400/10 text-sky-200 border border-sky-500/30 shadow-sm",children:["ðŸ¥ˆ ",S(C)]}),e.jsxs("span",{className:"px-2.5 py-1.5 rounded-lg bg-gradient-to-r from-violet-500/20 to-violet-400/10 text-violet-200 border border-violet-500/30 shadow-sm",children:["ðŸ¥‰ ",S(z)]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-[11px] text-slate-400",children:t.start_time?Y(t.start_time):"â€”"}),e.jsxs("div",{className:"mt-1 grid grid-cols-1 sm:grid-cols-2 gap-2 text-[11px] text-slate-300",children:[e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-md px-2 py-1",children:[e.jsx("span",{className:"uppercase text-[9px] text-slate-400",children:"Start"}),e.jsx("div",{children:t.start_time?A(t.start_time):"â€”"})]}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-md px-2 py-1",children:[e.jsx("span",{className:"uppercase text-[9px] text-slate-400",children:"End"}),e.jsx("div",{children:t.end_time?A(t.end_time):"â€”"})]})]})]}),s!==null&&e.jsxs("div",{className:"mt-2 text-sm font-semibold text-indigo-300",children:[a?"Ends in":"Starts in"," ",String(Math.floor(s/60)).padStart(2,"0"),":",String(s%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-1 flex items-center gap-4 text-xs text-slate-400",children:e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(G,{className:"w-3.5 h-3.5 mr-1"}),I," joined"]})}),d!==null&&e.jsx("div",{className:"mt-2 w-full bg-slate-800/50 border border-slate-700/70 rounded-full h-1 overflow-hidden",children:e.jsx("div",{className:"h-1 bg-emerald-500/80",style:{width:`${d}%`}})})]})}),e.jsx("div",{className:"mt-3 flex",children:e.jsx("button",{onClick:D=>{D.stopPropagation(),l(`/quiz/${t.id}`)},className:"relative w-full px-4 py-2.5 rounded-lg text-sm sm:text-base font-extrabold border border-violet-500/40 text-white shadow-[0_8px_18px_rgba(139,92,246,0.4)] hover:shadow-[0_12px_24px_rgba(139,92,246,0.55)] hover:scale-[1.015] active:scale-[0.99] transition focus:outline-none focus:ring-2 focus:ring-fuchsia-300 bg-[linear-gradient(90deg,#4f46e5,#7c3aed,#9333ea,#c026d3)] overflow-hidden",children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"})," PLAY"]})})})]},`lu-${t.id}`)})})]}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-3",children:"Finished"}),e.jsx("div",{className:"space-y-3",children:Q.map((t,o)=>{var n,d;const i=new Date,r=new Date(t.end_time),a=i>=r&&t.leaderboard,s=a?t.leaderboard.find(x=>x.user_id===c.id):null;return e.jsxs(_.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:o*.06},onClick:()=>l(`/results/${t.id}`),className:"qd-card relative overflow-hidden rounded-xl p-4 shadow-lg text-slate-100 cursor-pointer group border border-slate-800 hover:-translate-y-0.5 transition-transform",children:[e.jsx("span",{className:"pointer-events-none absolute left-0 top-0 bottom-0 w-[3px] bg-[linear-gradient(180deg,#9333ea,#4f46e5,#06b6d4)] opacity-70"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 -z-10 opacity-50 mix-blend-screen [background-image:radial-gradient(circle_at_18%_28%,rgba(99,102,241,0.22),rgba(0,0,0,0)60%),radial-gradient(circle_at_82%_72%,rgba(168,85,247,0.18),rgba(0,0,0,0)65%),radial-gradient(circle_at_50%_50%,rgba(236,72,153,0.12),rgba(0,0,0,0)55%)]"}),e.jsx("div",{className:"pointer-events-none absolute -top-1/2 left-1/4 w-2/3 h-full rotate-12 bg-gradient-to-b from-white/10 via-transparent to-transparent opacity-20"}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-md bg-[linear-gradient(135deg,rgba(99,102,241,0.25),rgba(236,72,153,0.2))] ring-1 ring-white/10 text-base",children:a?"ðŸ†":"â³"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-white truncate pr-3",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("div",{className:`px-2.5 py-1 rounded-full text-[11px] font-medium border ${a?"bg-emerald-900/25 text-emerald-200 border-emerald-500/30":"bg-amber-900/25 text-amber-200 border-amber-500/30"}`,children:a?"Completed":"Awaiting Results"}),e.jsx("button",{onClick:x=>{x.stopPropagation(),l(`/results/${t.id}`)},className:"px-3 py-1.5 rounded-lg text-[11px] sm:text-xs font-extrabold border text-white transition focus:outline-none focus:ring-2 focus:ring-fuchsia-300 overflow-hidden hover:scale-[1.015] active:scale-[0.99] shadow-[0_8px_18px_rgba(139,92,246,0.4)] hover:shadow-[0_12px_24px_rgba(139,92,246,0.55)] border-violet-500/40 bg-[linear-gradient(90deg,#4f46e5,#7c3aed,#9333ea,#c026d3)]",children:"RESULT"})]})]}),a?e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-slate-900/60 border border-slate-700/60 rounded-lg px-2 py-1.5 text-center",children:[e.jsx("div",{className:"uppercase text-[10px] text-slate-400",children:"Your Rank"}),e.jsxs("div",{className:"font-semibold text-indigo-200",children:["#",(n=s==null?void 0:s.rank)!=null?n:"-"]})]}),e.jsxs("div",{className:"bg-slate-900/60 border border-slate-700/60 rounded-lg px-2 py-1.5 text-center",children:[e.jsx("div",{className:"uppercase text-[10px] text-slate-400",children:"Your Score"}),e.jsx("div",{className:"font-semibold text-indigo-200",children:(d=s==null?void 0:s.score)!=null?d:"-"})]}),e.jsxs("div",{className:"bg-slate-900/60 border border-slate-700/60 rounded-lg px-2 py-1.5 text-center",children:[e.jsx("div",{className:"uppercase text-[10px] text-slate-400",children:"Your Prize"}),(()=>{const x=t.prize_type||"money",N=s!=null&&s.rank&&Array.isArray(t.prizes)?t.prizes[s.rank-1]:null;if(!(s!=null&&s.rank))return e.jsx("div",{className:"font-semibold text-purple-200",children:"â€”"});const b=L(x,N!=null?N:0,{fallback:0}),z=`${b.showIconSeparately&&b.icon?`${b.icon} `:""}${b.formatted}`.trim();return e.jsx("div",{className:"font-semibold text-purple-200",children:z})})()]})]}):e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-slate-300",children:[e.jsx(H,{className:"h-4 w-4 text-slate-400"}),e.jsxs("span",{children:["Results will be declared at ",r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]},t.id)})})]})})]})};export{re as default};
