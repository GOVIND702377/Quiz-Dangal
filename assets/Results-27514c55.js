import{_ as gt}from"./supabase-4c1332f7.js";import{u as bt,a as wt,h as Ve,s as P,b as vt,g as ue,j as t,B as Q,n as yt,d as jt}from"./index-d6fec639.js";import{r as k}from"./react-8a702e3e.js";import{g as _t}from"./avatar-14da71c6.js";import{c as Nt,a as St}from"./router-f2cf3f51.js";import{d as zt,T as Xe,S as kt,$ as Ct,f as Tt}from"./icons-52d1b41a.js";import{m as Mt}from"./motion-f69b6c08.js";const Bt=()=>{const{id:_}=Nt(),se=St(),{toast:$}=bt(),{user:g,userProfile:j}=wt(),[l,Je]=k.useState(null),[C,xe]=k.useState([]),[f,Ke]=k.useState(null),[pe,G]=k.useState(!0),[ke,ae]=k.useState(""),[V,B]=k.useState(null),[re,Ce]=k.useState(!1),[Te,ge]=k.useState(null),[Ze,et]=k.useState(0),ne=(j==null?void 0:j.role)==="admin",tt={hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.2}}},E=k.useCallback(async()=>{var s,r;if(!Ve||!P){ae("Results are unavailable right now."),G(!1);return}try{ae("");const{data:a,error:e}=await P.from("quizzes").select("*").eq("id",_).single();if(e)throw e;Je(a||null);let b=!1;if(g!=null&&g.id)try{const{data:o}=await P.from("quiz_participants").select("status").eq("quiz_id",_).eq("user_id",g==null?void 0:g.id).maybeSingle();b=!!o}catch(o){b=!1}const d=ne||b||vt({defaultValue:!0}),{data:u,error:T}=await P.from("quiz_results").select("leaderboard").eq("quiz_id",_).maybeSingle();if(T)throw T;let p=Array.isArray(u==null?void 0:u.leaderboard)?u.leaderboard:[];if(!u||p.length===0)if(xe([]),a!=null&&a.end_time){const m=new Date(a.end_time).getTime()-Date.now();if(B(m>0?m:0),m<=0&&d)try{await P.rpc("compute_results_if_due",{p_quiz_id:_}),await new Promise(S=>setTimeout(S,400));const{data:y}=await P.from("quiz_results").select("leaderboard").eq("quiz_id",_).maybeSingle(),N=Array.isArray(y==null?void 0:y.leaderboard)?y.leaderboard:[];N.length>0&&(p=N)}catch(y){}else if(m>0)return}else{B(null);return}else B(null);const v=(Array.isArray(p)?p:[]).map((o,m)=>{var y;return{id:`${_}-${o.user_id}`,user_id:o.user_id,score:Number(o.score)||0,rank:Number(o.rank)||m+1,profiles:{username:(y=o.display_name)!=null&&y.startsWith("@")?o.display_name.slice(1):void 0,full_name:o.display_name,avatar_url:void 0}}}).sort((o,m)=>m.score-o.score);xe(v),v.length>0&&re&&Ce(!1);try{const{data:o}=await P.rpc("get_engagement_counts",{p_quiz_id:_}),m=Array.isArray(o)?o[0]:o,y=Number((s=m==null?void 0:m.joined)!=null?s:0),N=Number((r=m==null?void 0:m.pre_joined)!=null?r:0);et(y+N)}catch(o){}try{const o=v.slice(0,10).map(m=>m.user_id);if(o.length){const{data:m,error:y}=await P.rpc("profiles_public_by_ids",{p_ids:o});if(y&&console.warn("Public profile fetch failed:",y),Array.isArray(m)&&m.length){const N=new Map(m.map(w=>[w.id,w])),S=await _t(m.map(w=>w.avatar_url).filter(Boolean));xe(w=>w.map(z=>{const M=N.get(z.user_id);if(!M)return z;const X=M.avatar_url&&S.get(M.avatar_url)||"";return{...z,profiles:{username:M.username,full_name:M.full_name,avatar_url:X}}}))}}}catch(o){}const R=v.find(o=>o.user_id===(g==null?void 0:g.id));R&&Ke(R)}catch(a){console.error("Error fetching results:",a),ae((a==null?void 0:a.message)||"Failed to load results.")}finally{G(!1)}},[_,g==null?void 0:g.id,ne,re]);k.useEffect(()=>{E()},[E]);const Me=()=>{G(!0),ae(""),E()},st=async()=>{if(ne)try{G(!0),await P.rpc("admin_recompute_quiz_results",{p_quiz_id:_}),await new Promise(s=>setTimeout(s,600)),await E(),$({title:"Recompute triggered",description:"Results recomputed."})}catch(s){$({title:"Recompute failed",description:(s==null?void 0:s.message)||"Could not recompute.",variant:"destructive"})}finally{G(!1)}};k.useEffect(()=>{let s=!1;return(async()=>{try{if(C.length===0){ge(null);return}const a=await be();s||ge(a)}catch(a){s||ge(null)}})(),()=>{s=!0}},[C.length,_,f==null?void 0:f.rank,f==null?void 0:f.score]);const le=(l==null?void 0:l.prize_type)||"money",Re=f!=null&&f.rank&&Array.isArray(l==null?void 0:l.prizes)&&l.prizes[f.rank-1]?l.prizes[f.rank-1]:0,ie=ue(le,Re,{fallback:0}),be=async()=>{try{const a=document.createElement("canvas");a.width=1080,a.height=1920;const e=a.getContext("2d");e.textBaseline="top";const b="Inter, system-ui, -apple-system, Segoe UI, Roboto",d=(n,i)=>{e.font=`${n} ${i}px ${b}`},u=n=>e.measureText(n).width,T=(n,i,c,h,x)=>{let A=h;for(d(c,A);A>x&&u(n)>i;)A-=2,d(c,A);return A},p=(n,i,c,h)=>{d(c,h);const x=String(n).split(/\s+/),A=[];let q="";for(const O of x){const he=q?q+" "+O:O;u(he)<=i?q=he:(q&&A.push(q),q=O)}return q&&A.push(q),A},v=(n,i,c,h,x,A,q,O,he)=>{let D=A,te=p(n,h,x,D);for(;(te.length>O||te.some(Y=>u(Y)>h))&&D>q;)D-=1,te=p(n,h,x,D);d(x,D),e.fillStyle=he;const Ye=Math.round(D*1.25),Qe=Math.min(O,te.length);for(let Y=0;Y<Qe;Y++){const Ge=te[Y],pt=u(Ge);e.fillText(Ge,i-pt/2,c+Y*Ye)}return{height:Qe*Ye,size:D}},R=(n,i)=>{let c=String(n);for(;c&&u(c)>i;)c=c.slice(0,-1);return c.length<String(n).length?c.slice(0,Math.max(0,c.length-1))+"…":c},o=n=>new Promise((i,c)=>{const h=new Image;h.crossOrigin="anonymous",h.onload=()=>i(h),h.onerror=c,h.src=n}),m=(n,i,c,h,x)=>{e.beginPath(),e.moveTo(n+x,i),e.lineTo(n+c-x,i),e.quadraticCurveTo(n+c,i,n+c,i+x),e.lineTo(n+c,i+h-x),e.quadraticCurveTo(n+c,i+h,n+c-x,i+h),e.lineTo(n+x,i+h),e.quadraticCurveTo(n,i+h,n,i+h-x),e.lineTo(n,i+x),e.quadraticCurveTo(n,i,n+x,i),e.closePath()},y=e.createLinearGradient(0,0,1080,1920);y.addColorStop(0,"#150a36"),y.addColorStop(1,"#0f0926"),e.fillStyle=y,e.fillRect(0,0,1080,1920);const N=64,S=1080/2;let w=N+12;const z=140,M=w+z;e.save(),e.beginPath(),e.arc(S,M,z,0,Math.PI*2),e.closePath();const X=e.createLinearGradient(S-z,M-z,S+z,M+z);X.addColorStop(0,"#1cc5ff"),X.addColorStop(1,"#ef47ff"),e.fillStyle=X,e.fill();try{const i=({}.VITE_POSTER_LOGO_URL||"").trim()||"/android-chrome-192x192.png";let c;try{c=await o(i)}catch(A){c=await o("/android-chrome-192x192.png")}const h=16,x=z*2-h;e.save(),e.beginPath(),e.arc(S,M,z-h/2,0,Math.PI*2),e.clip(),e.drawImage(c,Math.round(S-x/2),Math.round(M-x/2),Math.round(x),Math.round(x)),e.restore(),e.lineWidth=2,e.strokeStyle="rgba(255,255,255,0.7)",e.beginPath(),e.arc(S,M,z-h/2,0,Math.PI*2),e.stroke()}catch(n){}e.restore(),w=M+z+18;const lt=`🏅 ${((j==null?void 0:j.full_name)||(j==null?void 0:j.username)||"Your").toString().toUpperCase()}’S LEGENDARY RUN 🏅`,it=v(lt,S,w,1080-N*2,"900",56,34,2,"#ffd54a");w+=it.height+16;const ot=v("✨ Brains = Fame ✨",S,w,1080-N*2,"700",36,22,1,"rgba(255,255,255,0.9)");w+=ot.height+28;const U=N,L=1080-N*2,we=U+56,Ae=48,ct=40,Pe=f!=null&&f.rank?`#${f.rank} Rank!`:"Results Live!",oe=ue(le,Re,{fallback:0}),Le=`👑 Prize: ${oe.showIconSeparately&&oe.icon?`${oe.icon} `:""}${oe.formatted}`,J=typeof(f==null?void 0:f.score)=="number"?`☑️ Score: ${f.score}`:"",ve=T(Pe,L-100,"900",112,80),ye=T(Le,L-100,"900",48,32),je=J?T(J,L-100,"900",44,28):0,dt=Math.round(ve*1)+24+Math.round(ye*1.15)+12+(J?Math.round(je*1.15)+12:0),qe=Ae+dt+ct,K=w,_e=e.createLinearGradient(U,K,U+L,K);_e.addColorStop(0,"rgba(34,211,238,0.9)"),_e.addColorStop(1,"rgba(236,72,153,0.9)"),e.save(),m(U,K,L,qe,36),e.fillStyle="rgba(15,23,42,0.72)",e.fill(),e.lineWidth=4,e.strokeStyle=_e,e.stroke(),e.restore();let H=K+Ae;d("900",ve),e.fillStyle="#ffffff",e.fillText(Pe,we,H),H+=Math.round(ve*1)+24,d("900",ye),e.fillStyle="#ffd54a",e.fillText(Le,we,H),H+=Math.round(ye*1.15)+12,J&&(d("900",je),e.fillStyle="rgba(168,255,230,0.95)",e.fillText(J,we,H),H+=Math.round(je*1.15)+12),w=K+qe+28;const Ie=230,Ee=Math.max(120,1920-N-Ie-w),Ne="⚡ My Result is Live!",Se=T(Ne,L-120,"900",48,26),mt="“Think you can beat me? Join Quiz Dangal & prove it 👀”",ce=26,Ue=Math.round(ce*1.25);d("700",ce);const $e=p(mt,L-120,"700",ce).slice(0,2),ft=$e.length*Ue;let de=28+Math.round(Se)+12+ft+28;de>Ee&&(de=Ee);const me=w;m(U,me,L,de,28),e.fillStyle="rgba(8,11,30,0.9)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(56,189,248,0.5)",e.stroke(),d("900",Se),e.fillStyle="#facc15";const ht=u(Ne);e.fillText(Ne,S-ht/2,me+28),d("700",ce),e.fillStyle="rgba(226,232,240,0.92)";let We=me+28+Math.round(Se)+12;for(const n of $e){const i=u(n);e.fillText(n,S-i/2,We),We+=Ue}w=me+de+24;const I=w,Z=Math.max(Ie,Math.min(280,1920-N-I));m(U,I,L,Z,24),e.fillStyle="rgba(12,10,36,0.9)",e.fill(),e.lineWidth=2,e.strokeStyle="rgba(79,70,229,0.45)",e.stroke();const ut=(()=>j!=null&&j.referral_code?j.referral_code:g!=null&&g.id?g.id.replace(/-/g,"").slice(0,8).toUpperCase():"")(),fe=yt(ut),xt=`${({}.VITE_PUBLIC_SITE_URL||"https://www.quizdangal.com").replace(/\/$/,"")}/?ref=${encodeURIComponent(fe)}`;fe&&jt(fe);const ee=Math.min(220,Z-72),De=ee+32,Be=ee+40,ze=U+L-De-36,He=I+Math.max(24,Math.round((Z-Be)/2));m(ze,He,De,Be,18),e.fillStyle="#ffffff",e.fill();try{const{default:n}=await gt(()=>import("./browser-864b0b18.js").then(c=>c.b),[]),i=document.createElement("canvas");await n.toCanvas(i,xt,{width:ee,margin:1,color:{dark:"#000000",light:"#ffffff"}}),e.drawImage(i,ze+16,He+16,ee,ee)}catch(n){}const W=U+36,F=ze-24-W;e.fillStyle="rgba(255,255,255,0.96)",d("900",48),e.fillText(R("🧠 Play & Win",F),W,I+36),e.fillStyle="rgba(203,213,225,0.98)",d("800",36),e.fillText(R("🌐 www.quizdangal.com",F),W,I+36+54),d("900",44),e.fillStyle="rgba(255,255,255,0.96)";const Fe="🔗 Referral: ",Oe=u(Fe);return e.fillText(R(Fe,F),W,I+36+54+62),e.fillStyle="rgba(0,255,198,1)",e.fillText(R(fe,Math.max(0,F-Oe-8)),W+Oe,I+36+54+62),d("700",26),e.fillStyle="rgba(226,232,240,0.92)",e.fillText(R("Your turn to flex your brain 💯",F),W,I+Z-80),d("700",24),e.fillStyle="rgba(203,213,225,0.92)",e.fillText(R("#QuizDangal  #ChallengeAccepted  #PlayToWin",F),W,I+Z-44),await new Promise(n=>a.toBlob(n,"image/jpeg",.92))}catch(s){try{const r=document.createElement("canvas");r.width=8,r.height=8;const a=r.getContext("2d"),e=a.createLinearGradient(0,0,8,8);return e.addColorStop(0,"#130531"),e.addColorStop(1,"#1e0b4b"),a.fillStyle=e,a.fillRect(0,0,8,8),await new Promise(d=>r.toBlob(d,"image/jpeg",.9))}catch(r){return null}}};k.useEffect(()=>{if(!(l!=null&&l.end_time)||C.length>0){B(null);return}const s=new Date(l.end_time).getTime(),r=()=>{const e=s-Date.now();e>0?B(e):(B(0),re||(Ce(!0),E()))};r();const a=setInterval(r,1e3);return()=>clearInterval(a)},[l==null?void 0:l.end_time,C.length,re,E]),k.useEffect(()=>{if(C.length>0||!Ve||!P||!_||typeof window=="undefined")return;const s=P.channel(`quiz-results-${_}`,{config:{broadcast:{ack:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"quiz_results",filter:`quiz_id=eq.${_}`},()=>{E()}).subscribe();return()=>{try{P.removeChannel(s)}catch(r){}}},[_,C.length,E]);const at=s=>{const r=Math.max(0,Math.floor((s!=null?s:0)/1e3)),a=Math.floor(r/86400),e=Math.floor(r%86400/3600),b=Math.floor(r%3600/60),d=r%60;return{days:a,hours:e,minutes:b,seconds:d}},rt=async()=>{try{let s=Te;if(s||(s=await be()),s&&navigator.canShare&&window.File){const r=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[r]})){await navigator.share({files:[r],title:"Quiz Dangal Result"}),$({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download="quiz-dangal-result.jpg",a.rel="noopener",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(r),1500),$({title:"Poster saved",description:"Share the image from your gallery."});return}$({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){$({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},nt=async()=>{try{let s=Te;if(s||(s=await be()),s&&navigator.canShare&&window.File){const p=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[p]})){await navigator.share({files:[p],title:"Quiz Dangal Result"});return}}if(s)try{const p=URL.createObjectURL(s),v=document.createElement("a");v.href=p,v.download="quiz-dangal-result.jpg",v.rel="noopener",document.body.appendChild(v),v.click(),document.body.removeChild(v),setTimeout(()=>URL.revokeObjectURL(p),1500)}catch(p){}const r=navigator.userAgent||"",a=/Android/i.test(r),e=/iPhone|iPad|iPod/i.test(r),b="whatsapp://send",d="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",u="https://wa.me/",T=p=>!!window.open(p,"_blank");if(a){if(T(b))return;window.location.href=d,setTimeout(()=>{document.hidden||(window.location.href=u)},700);return}if(e){window.location.href=b,setTimeout(()=>{document.hidden||(window.location.href=u)},700);return}T(u)}catch(s){$({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};return pe?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-accent-b"})}):!pe&&ke?t.jsx("div",{className:"min-h-screen p-4 flex items-center justify-center",children:t.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),t.jsx("p",{className:"text-slate-300 mb-4",children:ke}),t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(Q,{variant:"brand",onClick:Me,children:"Retry"}),t.jsx(Q,{variant:"white",onClick:()=>se("/my-quizzes"),children:"Back"})]})]})}):!pe&&(V!=null?V:0)>0&&C.length===0?t.jsx("div",{className:"min-h-screen p-4 flex items-center justify-center",children:t.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[t.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Results not published yet"}),l!=null&&l.end_time?t.jsx("div",{className:"mb-4",children:V>0?t.jsxs("div",{children:[t.jsx("p",{className:"text-slate-300 mb-3",children:"Quiz ends in"}),(()=>{const{days:s,hours:r,minutes:a,seconds:e}=at(V),b=(d,u)=>t.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[t.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:d.toString().padStart(2,"0")}),t.jsx("div",{className:"text-xs text-slate-400",children:u})]});return t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s>0&&b(s,"Days"),b(r,"Hours"),b(a,"Minutes"),b(e,"Seconds")]})})(),t.jsxs("p",{className:"text-xs text-slate-400 mt-3",children:["End time: ",new Date(l.end_time).toLocaleString()]})]}):t.jsx("p",{className:"text-slate-300 mb-4",children:"Finalizing results… please stay on this page."})}):t.jsx("p",{className:"text-slate-300 mb-4",children:"Please check back after the quiz end time."}),t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(Q,{variant:"brand",onClick:Me,children:"Refresh"}),t.jsx(Q,{variant:"white",onClick:()=>se("/my-quizzes"),children:"Back to My Quizzes"}),t.jsx(Q,{variant:"white",onClick:()=>se("/"),children:"Go Home"}),ne&&t.jsx(Q,{variant:"destructive",onClick:st,title:"Admin only",children:"Force Recompute"})]})]})}):t.jsxs("div",{className:"min-h-screen p-4 pb-24 relative overflow-hidden",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[t.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[t.jsx("div",{className:"absolute -top-32 -right-16 w-80 h-80 rounded-full blur-3xl opacity-30 bg-gradient-to-br from-fuchsia-600 to-indigo-600"}),t.jsx("div",{className:"absolute -bottom-24 -left-16 w-96 h-96 rounded-full blur-3xl opacity-20 bg-gradient-to-br from-emerald-500 to-cyan-500"})]}),t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"mb-4 rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur p-4 sm:p-5 relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 pointer-events-none","aria-hidden":!0,children:t.jsx("div",{className:"absolute -inset-1 bg-[conic-gradient(var(--tw-gradient-stops))] from-fuchsia-500/10 via-indigo-500/5 to-cyan-500/10 blur-2xl"})}),t.jsxs("div",{className:"flex items-center justify-between gap-3 relative",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2 text-slate-300 text-xs",children:[t.jsx(zt,{className:"w-3.5 h-3.5"}),t.jsxs("span",{children:[Ze||(C==null?void 0:C.length)||0," participants"]})]}),t.jsxs("h1",{className:"text-xl sm:text-2xl font-extrabold text-white tracking-tight flex items-center gap-2",children:[t.jsx(Xe,{className:"w-5 h-5 text-amber-300"})," Results"]}),t.jsx("p",{className:"text-xs text-slate-400 truncate max-w-[90vw]",children:l==null?void 0:l.title})]}),(f==null?void 0:f.rank)&&t.jsxs("div",{className:"shrink-0 text-center",children:[t.jsxs("div",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-lg bg-indigo-500/15 text-indigo-200 border border-indigo-600/30 text-xs font-semibold",children:[t.jsx(kt,{className:"w-3.5 h-3.5"})," You ranked"]}),t.jsxs("div",{className:"mt-1 text-2xl font-extrabold text-white",children:["#",f.rank]})]})]})]}),f&&(j==null?void 0:j.role)!=="admin"&&t.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/60 p-3 mb-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-indigo-500 via-violet-500 to-fuchsia-600 text-white font-bold flex items-center justify-center ring-1 ring-indigo-300/40",children:["#",f.rank]}),t.jsxs("div",{className:"text-xs text-slate-300",children:[t.jsx("div",{className:"text-white font-semibold",children:"Your Result"}),t.jsxs("div",{children:["Out of ",C.length," participants"]})]})]}),t.jsxs("div",{className:"flex items-center gap-3 text-center",children:[t.jsx("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-semibold bg-indigo-500/15 text-indigo-200 border border-indigo-600/30",children:"YOU"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[11px] text-slate-400",children:"Score"}),t.jsx("div",{className:"text-sm font-bold text-emerald-300",children:f.score})]}),t.jsxs("div",{className:"min-w-[68px]",children:[t.jsx("div",{className:"text-[11px] text-slate-400",children:"Prize"}),t.jsxs("div",{className:"text-sm font-bold text-purple-300 flex items-center justify-end gap-1",children:[ie.showIconSeparately&&ie.icon&&t.jsx("span",{"aria-hidden":"true",children:ie.icon}),t.jsx("span",{children:ie.formatted})]})]})]})]}),Array.isArray(l==null?void 0:l.prizes)&&l.prizes.length>0&&t.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-900/60 p-3 mb-4 overflow-x-auto whitespace-nowrap",children:l.prizes.map((s,r)=>{const a=ue(le,s,{fallback:0}),e=a.showIconSeparately&&a.icon?`${a.icon} `:"";return t.jsxs("span",{className:`inline-block mr-2 mb-2 px-2.5 py-1 rounded-lg text-xs font-semibold border ${r===0?"bg-amber-500/10 text-amber-200 border-amber-500/30":r===1?"bg-sky-500/10 text-sky-200 border-sky-500/30":r===2?"bg-violet-500/10 text-violet-200 border-violet-500/30":"bg-slate-800/60 text-slate-200 border-slate-700"}`,children:[r===0?"🥇 1st":r===1?"🥈 2nd":r===2?"🥉 3rd":`#${r+1}`," • ",`${e}${a.formatted}`.trim()]},r)})}),t.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/60 p-3",children:[t.jsxs("div",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[t.jsx(Xe,{className:"w-4 h-4 text-amber-300"}),"Leaderboard"]}),t.jsxs("div",{className:"space-y-2",children:[C.length===0&&t.jsx("div",{className:"p-3 rounded-lg bg-slate-900/70 border border-slate-700/60 text-slate-300 text-sm",children:"No participants or no valid answers. Results are finalized."}),C.map((s,r)=>{var d,u,T,p,v,R,o;const a=s.rank&&Array.isArray(l==null?void 0:l.prizes)&&l.prizes[s.rank-1]?l.prizes[s.rank-1]:0,e=ue(le,a,{fallback:0}),b=s.user_id===(g==null?void 0:g.id);return t.jsxs(Mt.div,{variants:tt,initial:"hidden",animate:"show",className:`flex items-center justify-between p-2.5 rounded-lg border transition-colors ${b?"bg-indigo-950/40 border-indigo-700/40 ring-1 ring-indigo-500/20":r<3?"bg-slate-900/70 border-slate-700/60":"bg-slate-950/30 border-slate-800 hover:bg-slate-900/60"}`,children:[t.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[t.jsx("div",{className:"w-8 h-8 rounded-md grid place-items-center text-xs font-bold bg-slate-800 text-slate-100 ring-1 ring-white/10",children:t.jsx("span",{children:s.rank||r+1})}),t.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center text-gray-600 text-xs font-bold",children:(d=s.profiles)!=null&&d.avatar_url?t.jsx("img",{src:s.profiles.avatar_url,alt:s.profiles.full_name?`${s.profiles.full_name} avatar`:"User avatar",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):t.jsx("span",{children:(((u=s.profiles)==null?void 0:u.full_name)||((T=s.profiles)==null?void 0:T.username)||"U").charAt(0).toUpperCase()})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-white truncate",children:((p=s.profiles)==null?void 0:p.username)||((v=s.profiles)==null?void 0:v.full_name)||"Anonymous"}),((R=s.profiles)==null?void 0:R.full_name)&&((o=s.profiles)==null?void 0:o.username)&&t.jsx("p",{className:"text-[10px] text-slate-400 truncate",children:s.profiles.full_name})]})]}),t.jsxs("div",{className:"flex items-center gap-5 shrink-0",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm font-bold text-emerald-300 leading-none",children:s.score}),t.jsx("p",{className:"text-[10px] text-slate-400 leading-none",children:"Score"})]}),t.jsxs("div",{className:"text-right min-w-[64px]",children:[t.jsxs("p",{className:"text-sm font-bold text-purple-300 leading-none flex items-center justify-end gap-1",children:[e.showIconSeparately&&e.icon&&t.jsx("span",{"aria-hidden":"true",children:e.icon}),t.jsx("span",{children:e.formatted})]}),t.jsx("p",{className:"text-[10px] text-slate-400 leading-none",children:"Prize"})]})]})]},s.id)})]})]})]}),t.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/90 backdrop-blur supports-[backdrop-filter]:bg-slate-900/70 shadow-[0_-6px_24px_rgba(0,0,0,0.35)]",children:t.jsx("div",{className:"max-w-4xl mx-auto px-3 sm:px-4",style:{paddingTop:10,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 10px)"},children:t.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[t.jsxs("button",{onClick:()=>se("/my-quizzes"),className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-3 rounded-lg text-sm font-semibold bg-slate-800/85 text-white border border-slate-700 hover:bg-slate-800 active:translate-y-px transition w-full min-w-0",children:[t.jsx(Ct,{className:"w-5 h-5","aria-hidden":"true"}),t.jsx("span",{className:"truncate",children:"Back"})]}),t.jsxs("button",{onClick:nt,className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-2.5 rounded-lg text-[13px] sm:text-sm font-extrabold border text-white shadow-[0_8px_18px_rgba(34,197,94,0.35)] hover:shadow-[0_12px_24px_rgba(34,197,94,0.5)] border-emerald-500/50 bg-[linear-gradient(90deg,#16a34a,#22c55e,#10b981)] w-full min-w-0",children:[t.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{fill:"currentColor",d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),t.jsx("span",{className:"whitespace-nowrap",children:"WhatsApp"})]}),t.jsxs("button",{onClick:rt,className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-3 rounded-lg text-sm font-extrabold border text-white shadow-[0_8px_18px_rgba(139,92,246,0.4)] hover:shadow-[0_12px_24px_rgba(139,92,246,0.55)] border-violet-500/40 bg-[linear-gradient(90deg,#4f46e5,#7c3aed,#9333ea,#c026d3)] w-full min-w-0",children:[t.jsx(Tt,{className:"w-5 h-5","aria-hidden":"true"}),t.jsx("span",{className:"truncate",children:"Share"})]})]})})})]})};export{Bt as default};
