import{a as C,r as n,s as l,j as e}from"./index-74c9f0b4.js";function U(){const g=C(),[y,i]=n.useState(!1),[d,v]=n.useState(""),[m,j]=n.useState(""),[x,p]=n.useState(!1),[f,o]=n.useState("");n.useEffect(()=>{const a=new URL(window.location.href),t=a.hash||"",u=a.search||"",b=()=>{const r=new URLSearchParams(u).get("code");if(r)return r;const c=t.indexOf("?");return c!==-1?new URLSearchParams(t.substring(c+1)).get("code"):null},R=new URLSearchParams(u),S=t.includes("type=recovery"),k=R.get("type")==="recovery",P=t.includes("access_token=")||!!b();(S||k||P)&&i(!0),(async()=>{const s=b();if(s)try{const{data:r,error:c}=await l.auth.exchangeCodeForSession({code:s});if(c)throw c;try{const w=window.location.origin+window.location.pathname+(window.location.hash.split("?")[0]||"");window.history.replaceState({},document.title,w)}catch(w){}i(!0)}catch(r){o((r==null?void 0:r.message)||"Could not validate reset link. Try requesting a new one.")}})(),(async()=>{try{const{data:s}=await l.auth.getSession();s!=null&&s.session&&window.location.pathname.includes("/reset-password")&&i(!0)}catch(s){}})();const{data:{subscription:h}}=l.auth.onAuthStateChange(s=>{s==="PASSWORD_RECOVERY"&&i(!0),s==="SIGNED_IN"&&i(!0)});return()=>h==null?void 0:h.unsubscribe()},[]);const N=async a=>{if(a.preventDefault(),d.length<6)return o("Password must be at least 6 characters.");if(d!==m)return o("Passwords do not match.");p(!0),o("");try{const{error:t}=await l.auth.updateUser({password:d});if(t)throw t;o("Password updated! Redirecting to sign in…");try{await l.auth.signOut()}catch(u){}g("/login?reset=1",{replace:!0})}catch(t){o((t==null?void 0:t.message)||"Failed to update password.")}finally{p(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-indigo-900/50 via-violet-900/40 to-fuchsia-900/40 backdrop-blur-xl border border-indigo-700/60 rounded-2xl p-8 max-w-md w-full shadow-xl text-slate-100",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-violet-400 via-indigo-300 to-fuchsia-400 bg-clip-text text-transparent mb-2 text-center",children:"Reset Password"}),y?e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200 mb-1",children:"New Password"}),e.jsx("input",{type:"password",className:"w-full border border-slate-300 bg-white text-black rounded-lg px-3 py-2",value:d,onChange:a=>v(a.target.value),placeholder:"Enter new password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-200 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",className:"w-full border border-slate-300 bg-white text-black rounded-lg px-3 py-2",value:m,onChange:a=>j(a.target.value),placeholder:"Re-enter new password",required:!0})]}),f&&e.jsx("div",{className:"text-sm text-center text-slate-300",children:f}),e.jsx("button",{type:"submit",disabled:x,className:"w-full bg-gradient-to-r from-indigo-600 via-violet-600 to-fuchsia-600 hover:from-indigo-500 hover:to-fuchsia-700 text-white rounded-lg py-2.5 font-semibold",children:x?"Updating…":"Update Password"}),e.jsx("button",{type:"button",onClick:()=>g("/login"),className:"w-full bg-white text-black border border-slate-300 hover:bg-slate-50 rounded-lg shadow-md focus:ring-2 focus:ring-indigo-500/40 py-2.5 font-medium",children:"Back to Login"})]}):e.jsx("div",{className:"text-center text-slate-300",children:"The reset link is invalid or has expired, or you are already signed in. If you see this by mistake, open the link again or request a new reset from the Sign In screen."})]})})}export{U as default};
