import{k as q,a as C,u as T,b as U,r as c,s as b,j as e,m as n,B as v,T as y,M as E}from"./index-74c9f0b4.js";import{A as P}from"./award-18f0550a.js";import{U as B}from"./users-26bd74aa.js";const D=()=>{var h;const{id:o}=q(),g=C(),{toast:m}=T(),{user:x}=U(),[a,w]=c.useState(null),[k,z]=c.useState([]),[l,_]=c.useState(null),[R,A]=c.useState(!0);c.useEffect(()=>{S()},[o]);const S=async()=>{try{const{data:t}=await b.from("quizzes").select("*").eq("id",o).single();w(t);const{data:s}=await b.from("quiz_participants").select(`
          *,
          profiles (
            full_name,
            username,
            avatar_url
          )
        `).eq("quiz_id",o).eq("status","completed").order("score",{ascending:!1});z(s||[]);const i=s==null?void 0:s.find(r=>r.user_id===x.id);if(i){const r=s.findIndex(d=>d.user_id===x.id)+1;_({...i,rank:r})}}catch(t){console.error("Error fetching results:",t)}finally{A(!1)}};return R?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-accent-b"})}):e.jsx("div",{className:"min-h-screen p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white text-shadow mb-2",children:"Quiz Results"}),e.jsx("p",{className:"text-slate-300",children:a==null?void 0:a.title})]}),e.jsxs("div",{className:"flex justify-center gap-3 mb-8",children:[e.jsx(v,{variant:"white",onClick:()=>g("/my-quizzes"),children:"Back to My Quizzes"}),e.jsx(v,{variant:"brand",onClick:async()=>{var t;try{const s=window.location.href;(t=navigator.clipboard)!=null&&t.writeText?(await navigator.clipboard.writeText(s),m({title:"Link copied",description:"Result link copied to clipboard"})):window.prompt("Copy result link:",s)}catch(s){m({title:"Copy failed",description:s.message,variant:"destructive"})}},children:"Share Result"})]}),l&&e.jsx(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"qd-card rounded-2xl p-6 shadow-lg mb-8 text-slate-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:l.rank===1?e.jsx(y,{className:"h-16 w-16 text-yellow-500"}):l.rank===2?e.jsx(E,{className:"h-16 w-16 text-gray-400"}):l.rank===3?e.jsx(P,{className:"h-16 w-16 text-orange-500"}):e.jsx(B,{className:"h-16 w-16 text-blue-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-white text-shadow-sm mb-2",children:"Your Result"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-3xl font-bold text-accent-b",children:["#",l.rank]}),e.jsx("p",{className:"text-sm text-slate-300",children:"Rank"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-green-400",children:l.score}),e.jsx("p",{className:"text-sm text-slate-300",children:"Score"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-3xl font-bold text-purple-300",children:["â‚¹",l.rank<=3&&((h=a==null?void 0:a.prizes)==null?void 0:h[l.rank-1])||0]}),e.jsx("p",{className:"text-sm text-slate-300",children:"Prize"})]})]})]})}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"qd-card rounded-2xl p-6 shadow-lg mb-6 text-slate-100",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Prize Distribution"}),Array.isArray(a==null?void 0:a.prizes)&&a.prizes.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:a.prizes.map((t,s)=>e.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/70 flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-slate-100",children:s===0?"1st":s===1?"2nd":s===2?"3rd":`#${s+1}`}),e.jsxs("div",{className:"text-accent-b font-bold",children:["â‚¹",t]})]},s))}):e.jsx("div",{className:"text-sm text-slate-300",children:"No prize data available"})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"qd-card rounded-2xl p-6 shadow-lg text-slate-100",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-6 flex items-center",children:[e.jsx(y,{className:"mr-2 text-accent-a"}),e.jsx("span",{className:"text-white",children:"Leaderboard"})]}),e.jsx("div",{className:"space-y-4",children:k.map((t,s)=>{var i,r,d,u,f,j,p,N;return e.jsxs(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.1},className:`flex items-center justify-between p-4 rounded-lg ${t.user_id===x.id?"bg-slate-800/70 border border-accent-b/50":"bg-slate-800/60 border border-slate-700"}`,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-accent-b text-white font-bold",children:s+1}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center text-gray-600 font-bold",children:(i=t.profiles)!=null&&i.avatar_url?e.jsx("img",{src:t.profiles.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):e.jsx("span",{children:(((r=t.profiles)==null?void 0:r.full_name)||((d=t.profiles)==null?void 0:d.username)||"U").charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:((u=t.profiles)==null?void 0:u.username)||((f=t.profiles)==null?void 0:f.full_name)||"Anonymous"}),((j=t.profiles)==null?void 0:j.full_name)&&((p=t.profiles)==null?void 0:p.username)&&e.jsx("p",{className:"text-xs text-slate-300",children:t.profiles.full_name})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-bold text-green-400",children:t.score}),e.jsx("p",{className:"text-xs text-slate-300",children:"Score"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-purple-300",children:["â‚¹",s<3&&((N=a==null?void 0:a.prizes)==null?void 0:N[s])||0]}),e.jsx("p",{className:"text-xs text-slate-300",children:"Prize"})]}),s<3&&e.jsx("div",{className:"text-2xl",children:s===0?"ðŸ¥‡":s===1?"ðŸ¥ˆ":"ðŸ¥‰"})]})]},t.id)})})]})]})})};export{D as default};
