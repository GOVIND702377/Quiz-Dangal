import{R as J,j as e,at as X,r as d,au as L,s as D,av as Y,aw as I,ax as Z}from"./react-vendor-c284acb6.js";import{d as ee,a as te,u as M,s as o,B as x,c as u,I as l}from"./index-e74e2d11.js";import{m as O}from"./motion-b88ded6b.js";import"./vendor-3e030596.js";import"./supabase-97550265.js";const R=J.forwardRef(({className:g,...r},y)=>e.jsx("textarea",{ref:y,className:ee("flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",g),...r}));R.displayName="Textarea";function se(){const{toast:g}=M(),[r,y]=d.useState(""),[w,f]=d.useState(""),[k,Q]=d.useState("announcement"),[z,q]=d.useState(""),[_,F]=d.useState(""),[N,m]=d.useState(!1),[P,E]=d.useState([]),[T,S]=d.useState(!0),C=async()=>{S(!0);const{data:i,error:c}=await o.from("notifications").select("*").order("created_at",{ascending:!1}).limit(20);c?g({title:"Load failed",description:c.message,variant:"destructive"}):E(i||[]),S(!1)};d.useEffect(()=>{C()},[]);const a=async i=>{if(i.preventDefault(),!r.trim()||!w.trim()){g({title:"Title/Message required",variant:"destructive"});return}m(!0);try{const c={p_title:r.trim(),p_message:w.trim(),p_type:k,p_quiz_id:z||null,p_scheduled_at:_?new Date(_).toISOString():null},{error:v}=await o.rpc("create_notification",c);if(v)throw v;g({title:"Notification queued",description:"It will be delivered per schedule."}),y(""),f(""),q(""),F(""),Q("announcement"),await C()}catch(c){g({title:"Send failed",description:c.message,variant:"destructive"})}finally{m(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent flex items-center",children:[e.jsx(Z,{className:"mr-2"})," Admin: Notifications"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Announcements aur quiz notifications yahan se bhejein"})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Send Push Notification"}),e.jsxs("form",{onSubmit:handleSendPushNotification,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"pushTitle",children:"Push Notification Title *"}),e.jsx(l,{id:"pushTitle",value:pushTitle,onChange:i=>setPushTitle(i.target.value),placeholder:"e.g., New Quiz Alert!",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"pushMessage",children:"Push Notification Message *"}),e.jsx(R,{id:"pushMessage",value:pushMessage,onChange:i=>setPushMessage(i.target.value),placeholder:"Don't miss out on today's quiz!",required:!0})]}),e.jsx(x,{type:"submit",disabled:sendingPush,className:"bg-purple-600 hover:bg-purple-700",children:sendingPush?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Push..."]}):"Send Push Notification"})]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:a,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"ntitle",children:"Title *"}),e.jsx(l,{id:"ntitle",value:r,onChange:i=>y(i.target.value),placeholder:"e.g., Quiz Starting Soon",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"ntype",children:"Type *"}),e.jsxs("select",{id:"ntype",value:k,onChange:i=>Q(i.target.value),className:"w-full border rounded-md px-3 py-2",children:[e.jsx("option",{value:"announcement",children:"Announcement"}),e.jsx("option",{value:"quiz_start",children:"Quiz Start"}),e.jsx("option",{value:"quiz_end",children:"Quiz End"}),e.jsx("option",{value:"quiz_result",children:"Quiz Result"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"nmsg",children:"Message *"}),e.jsx(R,{id:"nmsg",value:w,onChange:i=>f(i.target.value),placeholder:"Write your message...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"nquiz",children:"Quiz ID (optional)"}),e.jsx(l,{id:"nquiz",value:z,onChange:i=>q(i.target.value),placeholder:"UUID of quiz"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"nsched",children:"Schedule (optional)"}),e.jsx(l,{id:"nsched",type:"datetime-local",value:_,onChange:i=>F(i.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"submit",disabled:N,className:"bg-indigo-600 hover:bg-indigo-700",children:N?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):"Send Notification"}),e.jsx(x,{type:"button",variant:"outline",onClick:C,children:"Refresh"})]})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-4 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Recent"}),T?e.jsxs("div",{className:"py-8 text-center text-gray-600",children:[e.jsx(D,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):P.length===0?e.jsx("div",{className:"py-8 text-center text-gray-600",children:"No notifications"}):e.jsx("div",{className:"space-y-2",children:P.map(i=>e.jsx("div",{className:"p-3 rounded-xl bg-white/70 border border-gray-200/50 flex items-center justify-between text-sm",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800",children:[i.title," ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.type,")"]})]}),e.jsx("div",{className:"text-gray-600",children:i.message}),e.jsxs("div",{className:"text-gray-500 text-xs",children:["Quiz: ",i.quiz_id||"—"," • Scheduled: ",i.scheduled_at?new Date(i.scheduled_at).toLocaleString():"now"," • Created: ",new Date(i.created_at).toLocaleString()]})]})},i.id))})]})]})}function de(){const{userProfile:g}=te(),{toast:r}=M(),[y,w]=X(),f=y.get("tab")||"overview",k=t=>{const s=new URLSearchParams(y);s.set("tab",t),w(s,{replace:!1})};if((g==null?void 0:g.role)!=="admin")return e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Aapke paas admin adhikaar nahi hain."})]});const[Q,z]=d.useState([]),[q,_]=d.useState(!0),[F,N]=d.useState(!1),[m,P]=d.useState(null),[E,T]=d.useState(!1),[S,C]=d.useState([]),[a,i]=d.useState({title:"",entry_fee:"",prizes:["","",""],start_time:"",end_time:"",result_time:"",category:""});d.useEffect(()=>{f==="overview"&&c()},[f]);const c=async()=>{try{const{data:t,error:s}=await o.from("quizzes").select("*").order("start_time",{ascending:!1});if(s)throw s;z(t||[])}catch(t){r({title:"Error",description:"Failed to fetch quizzes.",variant:"destructive"})}finally{_(!1)}},v=async t=>{try{const{data:s,error:n}=await o.from("questions").select("id, question_text, options ( id, option_text )").eq("quiz_id",t);if(n)throw n;C(s||[])}catch(s){r({title:"Error",description:"Failed to fetch questions.",variant:"destructive"})}},U=async()=>{if(!m)return;const t=window.prompt("Question text daalein");if(!t||!t.trim())return;const{error:s}=await o.from("questions").insert({quiz_id:m.id,question_text:t.trim()});if(s)return r({title:"Add failed",description:s.message,variant:"destructive"});await v(m.id)},B=async(t,s)=>{const n=(s||"").trim();if(!n)return r({title:"Question khaali nahi ho sakta",variant:"destructive"});const{error:h}=await o.from("questions").update({question_text:n}).eq("id",t);if(h)return r({title:"Update failed",description:h.message,variant:"destructive"});await v(m.id)},K=async t=>{if(!confirm("Is question aur iske options ko delete karein?"))return;const{error:s}=await o.from("questions").delete().eq("id",t);if(s)return r({title:"Delete failed",description:s.message,variant:"destructive"});await v(m.id)},V=async t=>{const s=window.prompt("Option text daalein");if(!s||!s.trim())return;const{error:n}=await o.from("options").insert({question_id:t,option_text:s.trim()});if(n)return r({title:"Add failed",description:n.message,variant:"destructive"});await v(m.id)},$=async(t,s)=>{const n=(s||"").trim();if(!n)return r({title:"Option khaali nahi ho sakta",variant:"destructive"});const{error:h}=await o.from("options").update({option_text:n}).eq("id",t);if(h)return r({title:"Update failed",description:h.message,variant:"destructive"});await v(m.id)},G=async t=>{if(!confirm("Is option ko delete karein?"))return;const{error:s}=await o.from("options").delete().eq("id",t);if(s)return r({title:"Delete failed",description:s.message,variant:"destructive"});await v(m.id)},W=async t=>{t.preventDefault();try{const s=a.prizes.filter(j=>j).map(j=>parseInt(j)),n=s.reduce((j,A)=>j+A,0),{error:h}=await o.from("quizzes").insert([{title:a.title,entry_fee:parseFloat(a.entry_fee),prize_pool:n,prizes:s,start_time:a.start_time,end_time:a.end_time,result_time:a.result_time,status:"upcoming",category:a.category||null}]);if(h)throw h;r({title:"Success",description:"Quiz create ho gaya."}),N(!1),i({title:"",entry_fee:"",prizes:["","",""],start_time:"",end_time:"",result_time:"",category:""}),c()}catch(s){r({title:"Error",description:s.message,variant:"destructive"})}},H=async t=>{if(confirm("Kya aap is quiz ko delete karna chahte hain?"))try{const{error:s}=await o.from("quizzes").delete().eq("id",t);if(s)throw s;r({title:"Success",description:"Quiz delete ho gaya."}),c()}catch(s){r({title:"Error",description:s.message,variant:"destructive"})}};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Quiz Dangal Admin"}),e.jsx("p",{className:"text-gray-600",children:"Admin dashboard"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-6",children:[{key:"overview",title:"Overview"},{key:"notifications",title:"Notifications"}].map(t=>e.jsx("button",{onClick:()=>k(t.key),className:`px-3 py-2 rounded-lg border text-sm transition-colors ${t.key===f?"bg-indigo-600 text-white border-indigo-600":"bg-white border-gray-200 hover:bg-gray-50"}`,children:t.title},t.key))}),f==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs(x,{onClick:()=>N(!0),className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Create New Quiz"]})}),F&&e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Create New Quiz"}),e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"title",children:"Quiz Title"}),e.jsx(l,{id:"title",value:a.title,onChange:t=>i({...a,title:t.target.value}),placeholder:"Daily Opinion Quiz - Evening",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"entry_fee",children:"Entry Fee (₹)"}),e.jsx(l,{id:"entry_fee",type:"number",step:"0.01",value:a.entry_fee,onChange:t=>i({...a,entry_fee:t.target.value}),placeholder:"11.00",required:!0})]})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Prize Distribution (₹)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(l,{placeholder:"1st Prize (251)",value:a.prizes[0],onChange:t=>{const s=[...a.prizes];s[0]=t.target.value,i({...a,prizes:s})}}),e.jsx(l,{placeholder:"2nd Prize (151)",value:a.prizes[1],onChange:t=>{const s=[...a.prizes];s[1]=t.target.value,i({...a,prizes:s})}}),e.jsx(l,{placeholder:"3rd Prize (51)",value:a.prizes[2],onChange:t=>{const s=[...a.prizes];s[2]=t.target.value,i({...a,prizes:s})}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"start_time",children:"Start Time"}),e.jsx(l,{id:"start_time",type:"datetime-local",value:a.start_time,onChange:t=>i({...a,start_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"end_time",children:"End Time"}),e.jsx(l,{id:"end_time",type:"datetime-local",value:a.end_time,onChange:t=>i({...a,end_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"result_time",children:"Result Time"}),e.jsx(l,{id:"result_time",type:"datetime-local",value:a.result_time,onChange:t=>i({...a,result_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"category",children:"Category"}),e.jsx(l,{id:"category",value:a.category,onChange:t=>i({...a,category:t.target.value}),placeholder:"e.g., GK, Sports, Movies, Opinion"})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(x,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create Quiz"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"All Quizzes"}),q?e.jsxs("div",{className:"py-8 text-center text-gray-600",children:[e.jsx(D,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading quizzes..."]}):Q.map((t,s)=>{var n,h,j,A;return e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["Entry: ₹",t.entry_fee]}),e.jsxs("span",{children:["Prize Pool: ₹",t.prize_pool]}),e.jsxs("span",{children:["Prizes: ₹",(n=t.prizes)==null?void 0:n.join(", ₹")]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.status==="upcoming"?"bg-blue-100 text-blue-800":t.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.status})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[e.jsxs("span",{children:["Start: ",new Date(t.start_time).toLocaleString()]}),e.jsxs("span",{className:"ml-4",children:["End: ",new Date(t.end_time).toLocaleString()]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-4 gap-2",children:[e.jsx(l,{type:"datetime-local",value:((h=t.start_time)==null?void 0:h.slice(0,16))||"",onChange:async b=>{const{error:p}=await o.from("quizzes").update({start_time:b.target.value}).eq("id",t.id);p?r({title:"Update failed",description:p.message,variant:"destructive"}):c()}}),e.jsx(l,{type:"datetime-local",value:((j=t.end_time)==null?void 0:j.slice(0,16))||"",onChange:async b=>{const{error:p}=await o.from("quizzes").update({end_time:b.target.value}).eq("id",t.id);p?r({title:"Update failed",description:p.message,variant:"destructive"}):c()}}),e.jsx(l,{type:"datetime-local",value:((A=t.result_time)==null?void 0:A.slice(0,16))||"",onChange:async b=>{const{error:p}=await o.from("quizzes").update({result_time:b.target.value}).eq("id",t.id);p?r({title:"Update failed",description:p.message,variant:"destructive"}):c()}}),e.jsxs("select",{className:"border rounded-md px-2 py-2",value:t.status,onChange:async b=>{const{error:p}=await o.from("quizzes").update({status:b.target.value}).eq("id",t.id);p?r({title:"Update failed",description:p.message,variant:"destructive"}):c()},children:[e.jsx("option",{value:"upcoming",children:"upcoming"}),e.jsx("option",{value:"active",children:"active"}),e.jsx("option",{value:"completed",children:"completed"})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>{P(t),v(t.id),T(!0)},className:"text-blue-600 hover:text-blue-700",children:[e.jsx(Y,{className:"h-4 w-4"}),"Questions"]}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>H(t.id),className:"text-red-600 hover:text-red-700",children:e.jsx(I,{className:"h-4 w-4"})})]})]})},t.id)})]}),E&&m&&e.jsxs("div",{className:"mt-6 bg-white/80 backdrop-blur-md border border-gray-200/50 rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Questions for: ",m.title]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{onClick:U,className:"bg-indigo-600 hover:bg-indigo-700",size:"sm",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Add Question"]}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>T(!1),children:"Close"})]})]}),S.length===0?e.jsx("div",{className:"py-6 text-center text-gray-600",children:"No questions yet"}):e.jsx("div",{className:"space-y-4",children:S.map(t=>e.jsxs("div",{className:"p-3 rounded-xl bg-white/70 border border-gray-200/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{defaultValue:t.question_text,onBlur:s=>B(t.id,s.target.value),className:"flex-1"}),e.jsx(x,{variant:"outline",size:"sm",className:"text-red-600 border-red-300",onClick:()=>K(t.id),children:e.jsx(I,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 pl-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Options"}),e.jsxs("div",{className:"space-y-2",children:[(t.options||[]).map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{defaultValue:s.option_text,onBlur:n=>$(s.id,n.target.value),className:"flex-1"}),e.jsx(x,{variant:"outline",size:"sm",className:"text-red-600 border-red-300",onClick:()=>G(s.id),children:e.jsx(I,{className:"w-4 h-4"})})]},s.id)),e.jsxs(x,{onClick:()=>V(t.id),size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Add Option"]})]})]})]},t.id))})]})]}),f==="notifications"&&e.jsx(se,{})]})}export{de as default};
