import{_ as yt}from"./supabase-07ebd5d8.js";import{u as jt,a as _t,h as Ce,s as T,b as Nt,c as St,g as ce,j as e,B as Je,m as zt,n as Ct,e as kt}from"./index-ccf5b30f.js";import{r as C}from"./react-63c462fe.js";import{g as Tt}from"./avatar-2547b377.js";import{S as de}from"./SEO-72b98264.js";import{c as At,a as Mt}from"./router-10fed1f4.js";import{d as Rt,T as Ke,S as Et,a0 as Lt,Z as Pt,a1 as $t,h as qt}from"./icons-590232b1.js";const Gt=()=>{const{id:_}=At(),ke=Mt(),{toast:Y}=jt(),{user:u,userProfile:k,refreshUserProfile:Te}=_t(),[n,et]=C.useState(null),[M,me]=C.useState([]),[c,tt]=C.useState(null),[fe,ue]=C.useState(!0),[xe,te]=C.useState(""),[G,Q]=C.useState(null),[se,Ae]=C.useState(!1),[Me,pe]=C.useState(null),[st,at]=C.useState(0),[D,he]=C.useState([]),[ge,Re]=C.useState(!1),Ee=(k==null?void 0:k.role)==="admin",rt={hidden:{opacity:0,y:10},show:{opacity:1,y:0,transition:{duration:.2}}},I=C.useCallback(async()=>{var s,r;if(!Ce||!T){te("Results are unavailable right now."),ue(!1);return}try{te("");const{data:a,error:t}=await T.from("quizzes").select("*").eq("id",_).single();if(t)throw t;et(a||null);let i=!1;if(u!=null&&u.id)try{const{data:d}=await T.from("quiz_participants").select("status").eq("quiz_id",_).eq("user_id",u==null?void 0:u.id).maybeSingle();i=!!d}catch(d){i=!1}const o=Ee||i||Nt({defaultValue:!0}),{data:x,error:A}=await T.from("quiz_results").select("leaderboard").eq("quiz_id",_).maybeSingle();if(A)throw A;let h=Array.isArray(x==null?void 0:x.leaderboard)?x.leaderboard:[];if(!x||h.length===0)if(me([]),a!=null&&a.end_time){const p=new Date(a.end_time).getTime()-Date.now();if(Q(p>0?p:0),p<=0&&o)try{await St(T,_,{throttleMs:150}),await new Promise(z=>setTimeout(z,400));const{data:b}=await T.from("quiz_results").select("leaderboard").eq("quiz_id",_).maybeSingle(),S=Array.isArray(b==null?void 0:b.leaderboard)?b.leaderboard:[];S.length>0&&(h=S)}catch(b){}else if(p>0)return}else{Q(null);return}else Q(null);const N=(Array.isArray(h)?h:[]).map((d,p)=>{var b;return{id:`${_}-${d.user_id}`,user_id:d.user_id,score:Number(d.score)||0,rank:Number(d.rank)||p+1,profiles:{username:(b=d.display_name)!=null&&b.startsWith("@")?d.display_name.slice(1):void 0,full_name:d.display_name,avatar_url:void 0}}}).sort((d,p)=>p.score-d.score);me(N),N.length>0&&se&&Ae(!1);try{const{data:d}=await T.rpc("get_engagement_counts",{p_quiz_id:_}),p=Array.isArray(d)?d[0]:d,b=Number((s=p==null?void 0:p.joined)!=null?s:0),S=Number((r=p==null?void 0:p.pre_joined)!=null?r:0);at(b+S)}catch(d){}try{if(!(((a==null?void 0:a.category)||"").toLowerCase()==="opinion")&&_){const{data:b,error:S}=await T.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",_).order("id");if(S)throw S;let z=new Map;if(u!=null&&u.id&&Array.isArray(b)&&b.length>0){const y=b.map(L=>L.id),{data:j}=await T.from("user_answers").select("question_id, selected_option_id").in("question_id",y).eq("user_id",u.id);Array.isArray(j)&&(z=new Map(j.map(L=>[L.question_id,L.selected_option_id])))}const v=(b||[]).map(y=>({id:y.id,question_text:y.question_text,options:(y.options||[]).map(j=>({id:j.id,option_text:j.option_text,is_correct:!!j.is_correct,isSelected:z.get(y.id)===j.id}))}));he(v)}else he([])}catch(d){he([])}try{const d=N.slice(0,10).map(p=>p.user_id);if(d.length){const{data:p,error:b}=await T.rpc("profiles_public_by_ids",{p_ids:d});if(b&&console.warn("Public profile fetch failed:",b),Array.isArray(p)&&p.length){const S=new Map(p.map(v=>[v.id,v])),z=await Tt(p.map(v=>v.avatar_url).filter(Boolean));me(v=>v.map(y=>{const j=S.get(y.user_id);if(!j)return y;const L=j.avatar_url&&z.get(j.avatar_url)||"";return{...y,profiles:{username:j.username,full_name:j.full_name,avatar_url:L}}}))}}}catch(d){}const R=N.find(d=>d.user_id===(u==null?void 0:u.id));R&&tt(R)}catch(a){console.error("Error fetching results:",a),te((a==null?void 0:a.message)||"Failed to load results.")}finally{ue(!1)}},[_,u==null?void 0:u.id,Ee,se]);C.useEffect(()=>{I()},[I]);const nt=()=>{ue(!0),te(""),I()};C.useEffect(()=>{let s=!1;return(async()=>{try{if(M.length===0){pe(null);return}const a=await be();s||pe(a)}catch(a){s||pe(null)}})(),()=>{s=!0}},[M.length,_,c==null?void 0:c.rank,c==null?void 0:c.score]);const ae=(n==null?void 0:n.prize_type)||"coins",Le=c!=null&&c.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[c.rank-1]?n.prizes[c.rank-1]:0,it=ce(ae,Le,{fallback:0});C.useEffect(()=>{try{if(!(u!=null&&u.id)||!Array.isArray(n==null?void 0:n.prizes)||!(c!=null&&c.rank))return;(n.prizes[c.rank-1]||0)>0&&Te(u)}catch(s){}},[u,c==null?void 0:c.rank,n==null?void 0:n.prizes,Te]);const be=async()=>{try{const a=document.createElement("canvas");a.width=1080,a.height=1920;const t=a.getContext("2d");t.textBaseline="top";const i="Inter, system-ui, -apple-system, Segoe UI, Roboto",o=(l,m)=>{t.font=`${l} ${m}px ${i}`},x=l=>t.measureText(l).width,A=(l,m,f,g,w)=>{let E=g;for(o(f,E);E>w&&x(l)>m;)E-=2,o(f,E);return E},h=(l,m,f,g)=>{o(f,g);const w=String(l).split(/\s+/),E=[];let $="";for(const V of w){const oe=$?$+" "+V:V;x(oe)<=m?$=oe:($&&E.push($),$=V)}return $&&E.push($),E},N=(l,m,f,g,w,E,$,V,oe)=>{let B=E,ee=h(l,g,w,B);for(;(ee.length>V||ee.some(F=>x(F)>g))&&B>$;)B-=1,ee=h(l,g,w,B);o(w,B),t.fillStyle=oe;const Ge=Math.round(B*1.25),Xe=Math.min(V,ee.length);for(let F=0;F<Xe;F++){const Ze=ee[F],vt=x(Ze);t.fillText(Ze,m-vt/2,f+F*Ge)}return{height:Xe*Ge,size:B}},R=(l,m)=>{let f=String(l);for(;f&&x(f)>m;)f=f.slice(0,-1);return f.length<String(l).length?f.slice(0,Math.max(0,f.length-1))+"â€¦":f},d=l=>new Promise((m,f)=>{const g=new Image;g.crossOrigin="anonymous",g.onload=()=>m(g),g.onerror=f,g.src=l}),p=(l,m,f,g,w)=>{t.beginPath(),t.moveTo(l+w,m),t.lineTo(l+f-w,m),t.quadraticCurveTo(l+f,m,l+f,m+w),t.lineTo(l+f,m+g-w),t.quadraticCurveTo(l+f,m+g,l+f-w,m+g),t.lineTo(l+w,m+g),t.quadraticCurveTo(l,m+g,l,m+g-w),t.lineTo(l,m+w),t.quadraticCurveTo(l,m,l+w,m),t.closePath()},b=t.createLinearGradient(0,0,1080,1920);b.addColorStop(0,"#150a36"),b.addColorStop(1,"#0f0926"),t.fillStyle=b,t.fillRect(0,0,1080,1920);const S=64,z=1080/2;let v=S+12;const y=140,j=v+y;t.save(),t.beginPath(),t.arc(z,j,y,0,Math.PI*2),t.closePath();const L=t.createLinearGradient(z-y,j-y,z+y,j+y);L.addColorStop(0,"#1cc5ff"),L.addColorStop(1,"#ef47ff"),t.fillStyle=L,t.fill();try{const m=({}.VITE_POSTER_LOGO_URL||"").trim()||"/android-chrome-192x192.png";let f;try{f=await d(m)}catch(E){f=await d("/android-chrome-192x192.png")}const g=16,w=y*2-g;t.save(),t.beginPath(),t.arc(z,j,y-g/2,0,Math.PI*2),t.clip(),t.drawImage(f,Math.round(z-w/2),Math.round(j-w/2),Math.round(w),Math.round(w)),t.restore(),t.lineWidth=2,t.strokeStyle="rgba(255,255,255,0.7)",t.beginPath(),t.arc(z,j,y-g/2,0,Math.PI*2),t.stroke()}catch(l){}t.restore(),v=j+y+18;const dt=`ðŸ… ${((k==null?void 0:k.full_name)||(k==null?void 0:k.username)||"Your").toString().toUpperCase()}â€™S LEGENDARY RUN ðŸ…`,mt=N(dt,z,v,1080-S*2,"900",56,34,2,"#ffd54a");v+=mt.height+16;const ft=N("âœ¨ Brains = Fame âœ¨",z,v,1080-S*2,"700",36,22,1,"rgba(255,255,255,0.9)");v+=ft.height+28;const U=S,P=1080-S*2,we=U+56,Pe=48,ut=40,$e=c!=null&&c.rank?`#${c.rank} Rank!`:"Results Live!",qe=`ðŸ‘‘ Prize: ${ce(ae,Le,{fallback:0}).formatted}`,X=typeof(c==null?void 0:c.score)=="number"?`â˜‘ï¸ Score: ${c.score}`:"",ve=A($e,P-100,"900",112,80),ye=A(qe,P-100,"900",48,32),je=X?A(X,P-100,"900",44,28):0,xt=Math.round(ve*1)+24+Math.round(ye*1.15)+12+(X?Math.round(je*1.15)+12:0),Ue=Pe+xt+ut,Z=v,_e=t.createLinearGradient(U,Z,U+P,Z);_e.addColorStop(0,"rgba(34,211,238,0.9)"),_e.addColorStop(1,"rgba(236,72,153,0.9)"),t.save(),p(U,Z,P,Ue,36),t.fillStyle="rgba(15,23,42,0.72)",t.fill(),t.lineWidth=4,t.strokeStyle=_e,t.stroke(),t.restore();let O=Z+Pe;o("900",ve),t.fillStyle="#ffffff",t.fillText($e,we,O),O+=Math.round(ve*1)+24,o("900",ye),t.fillStyle="#ffd54a",t.fillText(qe,we,O),O+=Math.round(ye*1.15)+12,X&&(o("900",je),t.fillStyle="rgba(168,255,230,0.95)",t.fillText(X,we,O),O+=Math.round(je*1.15)+12),v=Z+Ue+28;const De=230,Ie=Math.max(120,1920-S-De-v),Ne="âš¡ My Result is Live!",Se=A(Ne,P-120,"900",48,26),pt="â€œThink you can beat me? Join Quiz Dangal & prove it ðŸ‘€â€",re=26,We=Math.round(re*1.25);o("700",re);const Be=h(pt,P-120,"700",re).slice(0,2),ht=Be.length*We;let ne=28+Math.round(Se)+12+ht+28;ne>Ie&&(ne=Ie);const ie=v;p(U,ie,P,ne,28),t.fillStyle="rgba(8,11,30,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(56,189,248,0.5)",t.stroke(),o("900",Se),t.fillStyle="#facc15";const gt=x(Ne);t.fillText(Ne,z-gt/2,ie+28),o("700",re),t.fillStyle="rgba(226,232,240,0.92)";let Qe=ie+28+Math.round(Se)+12;for(const l of Be){const m=x(l);t.fillText(l,z-m/2,Qe),Qe+=We}v=ie+ne+24;const q=v,J=Math.max(De,Math.min(280,1920-S-q));p(U,q,P,J,24),t.fillStyle="rgba(12,10,36,0.9)",t.fill(),t.lineWidth=2,t.strokeStyle="rgba(79,70,229,0.45)",t.stroke();const bt=k!=null&&k.referral_code?k.referral_code:u!=null&&u.id?u.id.replace(/-/g,"").slice(0,8).toUpperCase():"",le=Ct(bt),wt=`${({}.VITE_PUBLIC_SITE_URL||"https://www.quizdangal.com").replace(/\/$/,"")}/?ref=${encodeURIComponent(le)}`;le&&kt(le);const K=Math.min(220,J-72),Oe=K+32,He=K+40,ze=U+P-Oe-36,Ve=q+Math.max(24,Math.round((J-He)/2));p(ze,Ve,Oe,He,18),t.fillStyle="#ffffff",t.fill();try{const{default:l}=await yt(()=>import("./browser-864b0b18.js").then(f=>f.b),[]),m=document.createElement("canvas");await l.toCanvas(m,wt,{width:K,margin:1,color:{dark:"#000000",light:"#ffffff"}}),t.drawImage(m,ze+16,Ve+16,K,K)}catch(l){}const W=U+36,H=ze-24-W;t.fillStyle="rgba(255,255,255,0.96)",o("900",48),t.fillText(R("ðŸ§  Play & Win",H),W,q+36),t.fillStyle="rgba(203,213,225,0.98)",o("800",36),t.fillText(R("ðŸŒ www.quizdangal.com",H),W,q+36+54),o("900",44),t.fillStyle="rgba(255,255,255,0.96)";const Fe="ðŸ”— Referral: ",Ye=x(Fe);return t.fillText(R(Fe,H),W,q+36+54+62),t.fillStyle="rgba(0,255,198,1)",t.fillText(R(le,Math.max(0,H-Ye-8)),W+Ye,q+36+54+62),o("700",26),t.fillStyle="rgba(226,232,240,0.92)",t.fillText(R("Your turn to flex your brain ðŸ’¯",H),W,q+J-80),o("700",24),t.fillStyle="rgba(203,213,225,0.92)",t.fillText(R("#QuizDangal  #ChallengeAccepted  #PlayToWin",H),W,q+J-44),await new Promise(l=>a.toBlob(l,"image/jpeg",.92))}catch(s){try{const r=document.createElement("canvas");r.width=8,r.height=8;const a=r.getContext("2d"),t=a.createLinearGradient(0,0,8,8);return t.addColorStop(0,"#130531"),t.addColorStop(1,"#1e0b4b"),a.fillStyle=t,a.fillRect(0,0,8,8),await new Promise(o=>r.toBlob(o,"image/jpeg",.9))}catch(r){return null}}};C.useEffect(()=>{if(!(n!=null&&n.end_time)||M.length>0){Q(null);return}const s=new Date(n.end_time).getTime(),r=()=>{const t=s-Date.now();t>0?Q(t):(Q(0),se||(Ae(!0),I()))};r();const a=setInterval(r,1e3);return()=>clearInterval(a)},[n==null?void 0:n.end_time,M.length,se,I]),C.useEffect(()=>{if(M.length>0||!Ce||!T||!_||typeof window=="undefined")return;const s=(()=>{var i,o;try{const x=typeof window!="undefined"&&window.__QUIZ_DANGAL_ENV__?window.__QUIZ_DANGAL_ENV__:{},A=(o=(i={}.VITE_ENABLE_REALTIME)!=null?i:x.VITE_ENABLE_REALTIME)!=null?o:"1",h=String(A).toLowerCase();return h==="1"||h==="true"||h==="yes"}catch(x){return!1}})();if(!(()=>{try{if(!s||!Ce||!T||!_||typeof window=="undefined"||!("WebSocket"in window)||navigator&&navigator.onLine===!1||typeof document!="undefined"&&document.visibilityState==="hidden"||typeof window!="undefined"&&window.isSecureContext===!1)return!1;const i=navigator&&(navigator.connection||navigator.mozConnection||navigator.webkitConnection)||null;return!(i&&(i.saveData||typeof i.effectiveType=="string"&&/(^|\b)2g(\b|$)/i.test(i.effectiveType)))}catch(i){return!0}})())return;let a=null,t=null;try{a=T.channel(`quiz-results-${_}`,{config:{broadcast:{ack:!1}}}).on("postgres_changes",{event:"*",schema:"public",table:"quiz_results",filter:`quiz_id=eq.${_}`},()=>{I()}).subscribe(i=>{if(i==="CHANNEL_ERROR"||i==="TIMED_OUT"||i==="CLOSED")try{a&&T.removeChannel(a)}catch(o){}}),t=setTimeout(()=>{try{a&&a.state!=="joined"&&(T.removeChannel(a),a=null)}catch(i){}},5e3)}catch(i){}return()=>{try{t&&clearTimeout(t),a&&T.removeChannel(a)}catch(i){}}},[_,M.length,I]);const lt=s=>{const r=Math.max(0,Math.floor((s!=null?s:0)/1e3)),a=Math.floor(r/86400),t=Math.floor(r%86400/3600),i=Math.floor(r%3600/60),o=r%60;return{days:a,hours:t,minutes:i,seconds:o}},ot=async()=>{try{let s=Me;if(s||(s=await be()),s&&navigator.canShare&&window.File){const r=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[r]})){await navigator.share({files:[r],title:"Quiz Dangal Result"}),Y({title:"Shared!",description:"Poster shared from your device."});return}}if(s){const r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download="quiz-dangal-result.jpg",a.rel="noopener",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(r),1500),Y({title:"Poster saved",description:"Share the image from your gallery."});return}Y({title:"Share unavailable",description:"Try again after poster is ready."})}catch(s){Y({title:"Share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}},ct=async()=>{try{let s=Me;if(s||(s=await be()),s&&navigator.canShare&&window.File){const h=new File([s],"quiz-dangal-result.jpg",{type:"image/jpeg"});if(navigator.canShare({files:[h]})){await navigator.share({files:[h],title:"Quiz Dangal Result"});return}}if(s)try{const h=URL.createObjectURL(s),N=document.createElement("a");N.href=h,N.download="quiz-dangal-result.jpg",N.rel="noopener",document.body.appendChild(N),N.click(),document.body.removeChild(N),setTimeout(()=>URL.revokeObjectURL(h),1500)}catch(h){}const r=navigator.userAgent||"",a=/Android/i.test(r),t=/iPhone|iPad|iPod/i.test(r),i="whatsapp://send",o="intent://send#Intent;scheme=whatsapp;package=com.whatsapp;end",x="https://wa.me/",A=h=>!!window.open(h,"_blank");if(a){if(A(i))return;window.location.href=o,setTimeout(()=>{document.hidden||(window.location.href=x)},700);return}if(t){window.location.href=i,setTimeout(()=>{document.hidden||(window.location.href=x)},700);return}A(x)}catch(s){Y({title:"WhatsApp share failed",description:(s==null?void 0:s.message)||"Try again",variant:"destructive"})}};return fe?e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[e.jsx(de,{title:"Results â€“ Loading | Quiz Dangal",description:"Loading quiz results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${_}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-accent-b"})]}):!fe&&xe?e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(de,{title:"Results â€“ Error | Quiz Dangal",description:xe||"Could not load results.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${_}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Couldn't load results"}),e.jsx("p",{className:"text-slate-300 mb-4",children:xe}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx(Je,{variant:"brand",onClick:nt,children:"Retry"}),e.jsx(Je,{variant:"white",onClick:()=>ke("/my-quizzes/"),children:"Back"})]})]})]}):!fe&&(G!=null?G:0)>0&&M.length===0?e.jsxs("div",{className:"min-h-screen p-4 flex items-center justify-center",children:[e.jsx(de,{title:"Results â€“ Not Published | Quiz Dangal",description:"Results will be available after the quiz ends.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${_}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsxs("div",{className:"qd-card rounded-2xl p-6 shadow-lg text-center max-w-md w-full text-slate-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-white",children:"Results not published yet"}),n!=null&&n.end_time?e.jsx("div",{className:"mb-4",children:G>0?e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300 mb-3",children:"Quiz ends in"}),(()=>{const{days:s,hours:r,minutes:a,seconds:t}=lt(G),i=(o,x)=>e.jsxs("div",{className:"px-3 py-2 rounded-md bg-slate-800/70 border border-slate-700 min-w-[64px]",children:[e.jsx("div",{className:"text-xl font-bold text-white tabular-nums",children:o.toString().padStart(2,"0")}),e.jsx("div",{className:"text-xs text-slate-400",children:x})]});return e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s>0&&i(s,"Days"),i(r,"Hours"),i(a,"Minutes"),i(t,"Seconds")]})})(),e.jsxs("p",{className:"text-xs text-slate-400 mt-3",children:["End time: ",new Date(n.end_time).toLocaleString()]})]}):e.jsx("p",{className:"text-slate-300 mb-4",children:"Finalizing resultsâ€¦ please stay on this page."})}):e.jsx("p",{className:"text-slate-300 mb-4",children:"Please check back after the quiz end time."})]})]}):e.jsxs("div",{className:"min-h-screen p-4 pb-24 relative overflow-hidden",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[e.jsx(de,{title:`${n!=null&&n.title?`${n.title} â€“ Results`:"Quiz Results"} | Quiz Dangal`,description:M.length>0?"Leaderboard and winners for this quiz.":"Results are finalized.",canonical:typeof window!="undefined"?`${window.location.origin}/results/${_}`:"https://quizdangal.com/results",robots:"noindex, nofollow"}),e.jsx("style",{children:".results-prize-row::-webkit-scrollbar{display:none;}"}),e.jsxs("div",{className:"pointer-events-none absolute inset-0 -z-10",children:[e.jsx("div",{className:"absolute -top-32 -right-16 w-80 h-80 rounded-full blur-3xl opacity-30 bg-gradient-to-br from-fuchsia-600 to-indigo-600"}),e.jsx("div",{className:"absolute -bottom-24 -left-16 w-96 h-96 rounded-full blur-3xl opacity-20 bg-gradient-to-br from-emerald-500 to-cyan-500"})]}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"px-1 sm:px-1.5 pt-1 pb-2 sm:pt-1.5 sm:pb-3",children:e.jsxs("div",{className:"relative rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur p-3 sm:p-4 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none","aria-hidden":!0,children:e.jsx("div",{className:"absolute -inset-1 bg-[conic-gradient(var(--tw-gradient-stops))] from-indigo-500/12 via-fuchsia-500/10 to-cyan-500/12 blur-2xl"})}),e.jsxs("div",{className:"relative pt-20",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 flex-nowrap",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-300 text-xs",children:[e.jsx(Rt,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[st||(M==null?void 0:M.length)||0," participants"]})]}),e.jsxs("h1",{className:"text-[22px] sm:text-[26px] font-extrabold text-white tracking-tight flex items-center gap-2",children:[e.jsx(Ke,{className:"w-6 h-6 text-amber-300"})," Results"]}),e.jsx("p",{className:"text-[12px] sm:text-sm text-slate-400 truncate max-w-[65vw] sm:max-w-sm",children:n==null?void 0:n.title})]}),(c==null?void 0:c.rank)&&e.jsxs("div",{className:"shrink-0 text-right pl-1 self-start relative z-10",children:[e.jsxs("div",{className:"inline-flex items-center gap-1.5 text-xs sm:text-sm font-semibold text-indigo-200 drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:[e.jsx(Et,{className:"w-4 h-4"}),"You ranked"]}),e.jsxs("div",{className:"mt-1 text-2xl sm:text-3xl font-extrabold text-white drop-shadow-[0_2px_6px_rgba(0,0,0,0.9)]",children:["#",c.rank]})]})]}),Array.isArray(n==null?void 0:n.prizes)&&n.prizes.length>0&&e.jsx("div",{className:"results-prize-row mt-2 flex items-center gap-1.5 flex-nowrap overflow-x-auto sm:overflow-visible [-ms-overflow-style:none] [scrollbar-width:none] relative z-0",children:n.prizes.map((s,r)=>{const a=ce(ae,s,{fallback:0}),t="inline-flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-[11px] font-semibold border shadow-sm backdrop-blur-sm whitespace-nowrap",i=r===0?"bg-amber-500/15 text-amber-100 border-amber-500/35":r===1?"bg-sky-500/15 text-sky-100 border-sky-500/35":r===2?"bg-violet-500/15 text-violet-100 border-violet-500/35":"bg-slate-800/70 text-slate-200 border-slate-700/60";return e.jsxs("span",{className:`${t} ${i}`,children:[e.jsx("span",{children:r===0?"ðŸ¥‡":r===1?"ðŸ¥ˆ":r===2?"ðŸ¥‰":`#${r+1}`}),e.jsx("span",{children:r===0?"1st":r===1?"2nd":r===2?"3rd":"Prize"}),e.jsx("span",{children:a.formatted})]},r)})})]})]})}),c&&(k==null?void 0:k.role)!=="admin"&&e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/60 px-3 py-3 mt-4 mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-nowrap text-[10px] sm:text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsxs("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 via-violet-500 to-fuchsia-600 text-white font-bold flex items-center justify-center ring-1 ring-indigo-300/40",children:["#",c.rank]}),e.jsxs("div",{className:"leading-tight min-w-0",children:[e.jsx("div",{className:"text-[12px] sm:text-sm font-semibold text-white",children:"Your Result"}),e.jsxs("div",{className:"text-[11px] sm:text-xs text-slate-300 truncate",children:["Out of ",M.length," participants"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 shrink-0",children:[e.jsxs("div",{className:"flex flex-col items-end min-w-[60px]",children:[e.jsx("span",{className:"uppercase text-[9px] sm:text-[10px] tracking-wide text-slate-400",children:"Score"}),e.jsx("span",{className:"text-[15px] sm:text-base font-bold text-emerald-300 leading-tight",children:c.score})]}),e.jsxs("div",{className:"flex flex-col items-end min-w-[78px]",children:[e.jsx("span",{className:"uppercase text-[9px] sm:text-[10px] tracking-wide text-slate-400",children:"Prize"}),e.jsx("span",{className:"text-[15px] sm:text-base font-bold text-purple-300 leading-tight",children:it.formatted})]})]})]}),((D==null?void 0:D.length)||0)>0&&e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>Re(s=>!s),className:`group relative inline-flex items-center gap-2 h-10 px-3.5 rounded-full border text-white text-[12px] font-semibold transition
                    focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/60
                    ${ge?"bg-emerald-600/15 border-emerald-400/40 shadow-[0_0_0_1px_rgba(16,185,129,0.25)]":"bg-slate-900/60 border-slate-700/60 hover:bg-slate-900/75 hover:shadow-[0_8px_22px_rgba(16,185,129,0.2)]"}`,title:"View Questions & Answers","aria-expanded":ge,children:[e.jsx("span",{className:"absolute -inset-px rounded-full opacity-0 group-hover:opacity-100 transition","aria-hidden":"true",style:{background:"conic-gradient(from 180deg at 50% 50%, rgba(16,185,129,0.18), rgba(6,182,212,0.14), rgba(16,185,129,0.18))"}}),e.jsx("span",{className:"relative inline-flex items-center justify-center rounded-full p-1.5 bg-gradient-to-br from-emerald-500 to-cyan-500 text-white shadow-[0_4px_14px_rgba(6,182,212,0.35)]",children:e.jsx(Lt,{className:"w-3.5 h-3.5"})}),e.jsx("span",{className:"relative",children:"Questions & Answers"})]})})]}),ge&&((D==null?void 0:D.length)||0)>0&&e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/60 p-3 mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(Pt,{className:"w-4 h-4 text-emerald-300"}),"Questions & Answers"]}),e.jsx("button",{type:"button",onClick:()=>Re(!1),className:"text-[11px] sm:text-xs text-slate-300 hover:text-white",children:"Close"})]}),e.jsx("div",{className:"space-y-3",children:D.map((s,r)=>e.jsxs("div",{className:"rounded-lg border border-slate-800 bg-slate-950/40 p-3",children:[e.jsxs("div",{className:"text-[13px] sm:text-sm font-semibold text-white mb-2",children:[e.jsxs("span",{className:"text-slate-400 mr-1",children:["Q",r+1,"."]}),s.question_text]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:s.options.map(a=>{const t=!!a.is_correct,i=!!a.isSelected,o="px-2.5 py-2 rounded-md border text-[12px] sm:text-[13px]",x=t?"bg-emerald-600/20 border-emerald-500/30 text-emerald-200":i?"bg-rose-600/20 border-rose-500/35 text-rose-200":"bg-slate-900/60 border-slate-800 text-slate-300";return e.jsx("div",{className:`${o} ${x}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("span",{className:"text-emerald-300",children:"âœ“"}),i&&!t&&e.jsx("span",{className:"text-rose-300",children:"â€¢"}),e.jsx("span",{children:a.option_text})]})},a.id)})})]},s.id))})]}),e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/60 p-3",children:[e.jsxs("div",{className:"text-sm font-semibold text-white mb-2 flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-amber-300"}),"Leaderboard"]}),e.jsxs("div",{className:"space-y-2",children:[M.length===0&&e.jsx("div",{className:"p-3 rounded-lg bg-slate-900/70 border border-slate-700/60 text-slate-300 text-sm",children:"No participants or no valid answers. Results are finalized."}),M.map((s,r)=>{var o,x,A,h,N,R,d;const a=s.rank&&Array.isArray(n==null?void 0:n.prizes)&&n.prizes[s.rank-1]?n.prizes[s.rank-1]:0,t=ce(ae,a,{fallback:0}),i=s.user_id===(u==null?void 0:u.id);return e.jsxs(zt.div,{variants:rt,initial:"hidden",animate:"show",className:`flex items-center justify-between gap-3 p-2.5 rounded-lg border transition-colors ${i?"bg-indigo-950/40 border-indigo-700/40 ring-1 ring-indigo-500/20":r<3?"bg-slate-900/70 border-slate-700/60":"bg-slate-950/30 border-slate-800 hover:bg-slate-900/60"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-md grid place-items-center text-xs font-bold bg-slate-800 text-slate-100 ring-1 ring-white/10",children:e.jsx("span",{children:s.rank||r+1})}),e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center text-gray-600 text-xs font-bold",children:(o=s.profiles)!=null&&o.avatar_url?e.jsx("img",{src:s.profiles.avatar_url,alt:s.profiles.full_name?`${s.profiles.full_name} avatar`:"User avatar",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("span",{children:(((x=s.profiles)==null?void 0:x.full_name)||((A=s.profiles)==null?void 0:A.username)||"U").charAt(0).toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:((h=s.profiles)==null?void 0:h.username)||((N=s.profiles)==null?void 0:N.full_name)||"Anonymous"}),((R=s.profiles)==null?void 0:R.full_name)&&((d=s.profiles)==null?void 0:d.username)&&e.jsx("p",{className:"text-[10px] text-slate-400 truncate",children:s.profiles.full_name})]})]}),e.jsxs("div",{className:"flex items-center gap-3 sm:gap-5 shrink-0 whitespace-nowrap",children:[e.jsxs("div",{className:"text-right min-w-[52px]",children:[e.jsx("p",{className:"text-[10px] text-slate-400 leading-none mb-0.5",children:"Score"}),e.jsx("p",{className:"text-sm sm:text-base font-bold text-emerald-300 leading-none",children:s.score})]}),e.jsxs("div",{className:"text-right min-w-[70px]",children:[e.jsx("p",{className:"text-[10px] text-slate-400 leading-none mb-0.5",children:"Prize"}),e.jsx("p",{className:"text-sm sm:text-base font-bold text-purple-300 leading-none flex items-center justify-end gap-1",children:e.jsx("span",{children:t.formatted})})]})]})]},s.id)})]})]})]}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-slate-800 bg-slate-900/90 backdrop-blur supports-[backdrop-filter]:bg-slate-900/70 shadow-[0_-6px_24px_rgba(0,0,0,0.35)]",children:e.jsx("div",{className:"max-w-4xl mx-auto px-3 sm:px-4",style:{paddingTop:10,paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 10px)"},children:e.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[e.jsxs("button",{onClick:()=>ke("/my-quizzes/"),className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-3 rounded-lg text-sm font-semibold bg-slate-800/85 text-white border border-slate-700 hover:bg-slate-800 active:translate-y-px transition w-full min-w-0",children:[e.jsx($t,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:"Back"})]}),e.jsxs("button",{onClick:ct,className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-2.5 rounded-lg text-[13px] sm:text-sm font-extrabold border text-white shadow-[0_8px_18px_rgba(34,197,94,0.35)] hover:shadow-[0_12px_24px_rgba(34,197,94,0.5)] border-emerald-500/50 bg-[linear-gradient(90deg,#16a34a,#22c55e,#10b981)] w-full min-w-0",children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",viewBox:"0 0 24 24","aria-hidden":"true",focusable:"false",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fill:"currentColor",d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.272-.099-.471-.148-.67.149-.198.297-.768.966-.941 1.164-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.173.198-.297.297-.495.099-.198.05-.372-.025-.521-.074-.149-.669-1.611-.916-2.205-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.521.074-.793.372s-1.042 1.016-1.042 2.479 1.067 2.876 1.219 3.074c.149.198 2.1 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.718 2.007-1.41.248-.694.248-1.289.173-1.41-.074-.123-.272-.198-.57-.347m-5.49 7.485h-.004a9.867 9.867 0 01-5.031-1.378l-.361-.214-3.741.982.999-3.648-.235-.374a9.861 9.861 0 01-1.51-5.241c.001-5.45 4.434-9.884 9.885-9.884 2.641 0 5.122 1.03 6.988 2.897a9.825 9.825 0 012.897 6.994c-.003 5.45-4.436 9.884-9.887 9.884m8.413-18.297A11.815 11.815 0 0012.004 0C5.375 0 .16 5.215.157 11.844a11.82 11.82 0 001.624 5.99L0 24l6.305-1.654a11.86 11.86 0 005.68 1.448h.005c6.628 0 11.843-5.215 11.846-11.844a11.787 11.787 0 00-3.473-8.372z"})}),e.jsx("span",{className:"whitespace-nowrap",children:"WhatsApp"})]}),e.jsxs("button",{onClick:ot,className:"col-span-1 inline-flex items-center justify-center gap-2 h-12 px-3 rounded-lg text-sm font-extrabold border text-white shadow-[0_8px_18px_rgba(139,92,246,0.4)] hover:shadow-[0_12px_24px_rgba(139,92,246,0.55)] border-violet-500/40 bg-[linear-gradient(90deg,#4f46e5,#7c3aed,#9333ea,#c026d3)] w-full min-w-0",children:[e.jsx(qt,{className:"w-5 h-5","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:"Share"})]})]})})})]})};export{Gt as default};
