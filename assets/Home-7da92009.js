import{c as w,u as q,a as N,b as S,r,s as v,j as s,S as _,T as C,m as M}from"./index-5684ffb2.js";const L=w("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),E=w("Clapperboard",[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]]),I=w("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),A=[{title:"Opinion",slug:"opinion",icon:I},{title:"G.K Knowledge",slug:"gk",icon:L},{title:"Sports",slug:"sports",icon:C},{title:"Movies",slug:"movies",icon:E}],T=({tile:a,quizzes:f,onJoin:l,index:g,joiningId:u})=>{const i=f.find(d=>(d.category||"").toLowerCase()===a.slug.toLowerCase()),o=u&&i&&u===i.id,m=a.icon,h=["neon-orange","neon-purple","neon-teal","neon-pink"];return s.jsx(M.button,{type:"button",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},transition:{duration:.25,delay:g*.06},onClick:()=>i&&!o&&l(i),disabled:!i||o,className:`neon-card ${h[g%h.length]} group aspect-square w-full rounded-xl focus:outline-none will-change-transform transform-gpu ${!i||o?"opacity-70 cursor-not-allowed":""}`,style:{borderRadius:"0.75rem"},"aria-label":`${a.title} - ${i?o?"Joining…":"Play":"Coming soon"}`,children:s.jsx("div",{className:"neon-card-content select-none flex items-center justify-center",children:s.jsxs("div",{className:"w-full flex flex-col items-center justify-center gap-2",children:[s.jsx(m,{className:"w-8 h-8 text-white drop-shadow"}),s.jsx("h3",{className:"text-base font-extrabold leading-tight text-white text-shadow-sm text-center",children:a.title}),s.jsx("span",{className:"play-pill",children:o?"JOINING…":i?"PLAY":"SOON"})]})})})},P=()=>{const{toast:a}=q(),f=N(),{user:l,userProfile:g,refreshUserProfile:u}=S(),[i,o]=r.useState([]),[m,h]=r.useState(!0),[d,z]=r.useState({open:!1,day:0,coins:0}),y=r.useRef(!1),[j,b]=r.useState(null),x=r.useCallback(async()=>{try{const{data:t,error:e}=await v.from("quizzes").select("*").order("start_time",{ascending:!0});if(e)throw e;o(t||[])}catch(t){console.error(t),a({title:"Error",description:"Could not fetch quizzes.",variant:"destructive"}),o([])}finally{h(!1)}},[a]);r.useEffect(()=>{x();const t=setInterval(x,3e4);return()=>clearInterval(t)},[x]),r.useEffect(()=>{if(!l||y.current)return;const e=setTimeout(async()=>{y.current=!0;try{const{data:n,error:c}=await v.rpc("handle_daily_login",{user_uuid:l.id});if(c)return console.error(c);n&&n.is_new_login&&(await u(l),z({open:!0,day:n.streak_day,coins:n.coins_earned}))}finally{y.current=!1}},1200);return()=>clearTimeout(e)},[l,u]);const k=async t=>{if(!(!t||j===t.id)){if(!l){a({title:"Login required",description:"Please sign in to join the quiz.",variant:"destructive"}),f("/login");return}b(t.id);try{const{data:e,error:n}=await v.rpc("join_quiz",{p_quiz_id:t.id});if(n)throw n;if(e&&e!=="Joined Successfully")throw new Error(e);a({title:"Joined!",description:"Redirecting you to the quiz."}),f(`/quiz/${t.id}`)}catch(e){const n=String((e==null?void 0:e.message)||"").toLowerCase();let c=(e==null?void 0:e.message)||"Could not join quiz.",p="Error";n.includes("not authenticated")?(p="Login required",c="Please sign in to join the quiz."):n.includes("insufficient balance")?(p="Insufficient balance",c="You do not have enough coins to join this quiz."):n.includes("quiz not active")&&(p="Quiz not active",c="This quiz is not active right now."),a({title:p,description:c,variant:"destructive"})}finally{b(null)}}};return s.jsxs("div",{className:"h-full relative overflow-hidden",children:[s.jsx("div",{className:"relative z-10 h-full flex items-center justify-center px-4 mt-1 sm:mt-2",children:s.jsx("div",{className:"w-full max-w-[420px]",children:s.jsx("div",{className:"grid grid-cols-2 gap-3",children:m?Array.from({length:4}).map((t,e)=>s.jsx("div",{className:"aspect-square w-full rounded-xl bg-slate-800/60 border border-slate-700/60 animate-pulse"},e)):A.map((t,e)=>s.jsx(T,{tile:t,quizzes:i,onJoin:k,index:e,joiningId:j},t.slug))})})}),s.jsx(_,{open:d.open,day:d.day,coins:d.coins,onClose:()=>z(t=>({...t,open:!1}))})]})};export{P as default};
