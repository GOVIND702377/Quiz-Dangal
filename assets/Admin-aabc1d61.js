import{j as e,k as Ee,u as G,a as Pe,s as m,H as ue,h as qe,B as f,A as he,m as J,L as S,I as P,o as X}from"./index-dc690ff1.js";import{a as w,r as R}from"./react-63c462fe.js";import{d as Le,L as De}from"./router-10fed1f4.js";import{L as $,Y as te,Z as Ie,m as Qe,u as Te,_ as $e,$ as Me}from"./icons-218c8792.js";import"./supabase-07ebd5d8.js";const ae=w.forwardRef(({className:c,...h},z)=>e.jsx("textarea",{ref:z,className:Ee("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",c),...h}));ae.displayName="Textarea";const fe=[{value:"opinion",label:"Opinion"},{value:"gk",label:"General Knowledge"},{value:"sports",label:"Sports"},{value:"movies",label:"Movies"}],ge=c=>{var h;return((h=fe.find(z=>z.value===c))==null?void 0:h.label)||c},H=()=>({text:"",options:["","",""],correctIndex:0});function W(c,h,{fallback:z=0}={}){return h==null&&(h=z),c==="coins"?`${h} coins`:c==="others"?`${h}`:`â‚¹${h}`}function Fe(c,{allowZeroCorrect:h=!1}={}){var k,L;const z=String(c||"").trim().split(/\n\s*\n+/),N=[],q=[],v=[];let y=0;for(const b of z){const E=b.split(/\r?\n/).map(o=>o.trim()).filter(Boolean);if(!E.length)continue;y+=1;const _=E[0].replace(/^Q\d*\.?\s*/i,"").replace(/^Question\s*[:-]\s*/i,""),C=[];let A="";for(let o=1;o<E.length;o++){const a=E[o];if(/^ans(wer)?\s*[:-]/i.test(a)){A=a;continue}const n=a.match(/^[-*â€¢]?\s*\[(x|X| )\]\s*(.+)$/);if(n){C.push({option_text:n[2].trim(),is_correct:/x/i.test(n[1])});continue}const i=a.match(/^(?:[-*â€¢]|[A-Da-d]\)|\d+\)|[A-Da-d][.:])\s*(.+)$/),r=i?i[1].trim():a.replace(/^[*]\s*/,"").trim();r&&C.push({option_text:r,is_correct:/^\*/.test(a)})}if(A){const o=A.split(/[:-]/).slice(1).join(":").trim(),a=(L=(k=o.match(/^[A-D]/i))==null?void 0:k[0])==null?void 0:L.toUpperCase(),n=a?{A:0,B:1,C:2,D:3}[a]:NaN,i=parseInt(o,10);if(!Number.isNaN(n)&&C[n])C.forEach((r,p)=>r.is_correct=p===n);else if(!Number.isNaN(i)&&C[i-1])C.forEach((r,p)=>r.is_correct=p===i-1);else{const r=o.toLowerCase(),p=C.findIndex(D=>D.option_text.toLowerCase()===r||D.option_text.toLowerCase().includes(r));p>=0&&C.forEach((D,M)=>D.is_correct=M===p)}}let d=C.filter(o=>o.option_text);if(d.length>4){const o=d.findIndex(a=>a.is_correct);if(o>=0){const a=d[o],n=d.filter((i,r)=>r!==o);d=[a,...n.slice(0,3)]}else d=d.slice(0,4);v.push(`Q${y}: Trimmed to 4 options.`)}if(!_){q.push(`Q${y}: Missing question text.`);continue}if(d.length<2){q.push(`Q${y}: Need at least 2 options.`);continue}if(h)d=d.map(o=>({...o,is_correct:!1}));else{const o=d.filter(a=>a.is_correct).length;if(o===0)d[0].is_correct=!0;else if(o>1){let a=!1;d=d.map(n=>n.is_correct&&!a?(a=!0,n):{...n,is_correct:!1})}}N.push({question_text:_,options:d})}return{items:N,errors:q,warnings:v}}function Je(){var de;const{toast:c}=G(),{userProfile:h,loading:z,user:N}=Pe(),[q,v]=Le(),y=q.get("tab")||"overview",k=s=>{q.set("tab",s),v(q,{replace:!0})},[L,b]=R.useState([]),[E,_]=R.useState(!1),[C,A]=R.useState(!1),[d,o]=R.useState({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),[a,n]=R.useState("form"),[i,r]=R.useState([H()]),[p,D]=R.useState(null),[M,F]=R.useState([]),[ie,re]=R.useState(null),[ve,ye]=R.useState(!1),B=d.category==="opinion",je=R.useMemo(()=>{try{const s=String({}.VITE_ADMIN_EMAILS||"").trim();return s?new Set(s.split(/[\s,]+/).map(t=>t.trim().toLowerCase()).filter(Boolean)):new Set}catch(s){return new Set}},[]),be=String((h==null?void 0:h.role)||"").trim().toLowerCase(),ne=String((N==null?void 0:N.email)||"").trim().toLowerCase(),_e=String(((de=N==null?void 0:N.app_metadata)==null?void 0:de.role)||"").trim().toLowerCase(),I=be==="admin"||_e==="admin"||ne&&je.has(ne),K=R.useCallback(async()=>{if(!I){_(!1),b([]);return}if(_(!0),!m){b([]),_(!1);return}const{data:s,error:t}=await m.from("quizzes").select("id,title,category,prizes,prize_pool,prize_type,start_time,end_time").order("start_time",{ascending:!1});t?c({title:"Fetch failed",description:t.message,variant:"destructive"}):b(s||[]),_(!1)},[c,I]),we=R.useCallback(async s=>{if(!I){F([]);return}if(!m){F([]);return}const{data:t,error:x}=await m.from("questions").select("id,question_text,options(id,option_text,is_correct)").eq("quiz_id",s);x?c({title:"Questions failed",description:x.message,variant:"destructive"}):F(t||[])},[c,I]);R.useEffect(()=>{z||K()},[K,z]);const Ne=async s=>{s.preventDefault();try{if(!I){c({title:"Access denied",description:"Only admins can create quizzes.",variant:"destructive"});return}const t=[];d.category||t.push("Select category"),d.title.trim()||t.push("Title required"),(!d.start_time||!d.end_time)&&t.push("Start & End time required");const x=new Date(d.start_time);new Date(d.end_time)<=x&&t.push("End after start");const l=parseInt(d.prizes[0]||"",10);if((Number.isNaN(l)||l<=0)&&t.push("1st prize invalid"),t.length){c({title:"Fix form",description:t[0],variant:"destructive"});return}const g=i.map(T=>{const V=(T.options||[]).map(se=>se.trim()).filter(Boolean).slice(0,4);if(!T.text.trim()||V.length<2)return null;const Ae=Math.min(Math.max(T.correctIndex||0,0),V.length-1);return{question_text:T.text.trim(),options:V.map((se,Re)=>({option_text:se,is_correct:B?!1:Re===Ae}))}}).filter(Boolean);if(!g.length){c({title:"Add questions",variant:"destructive"});return}const j=d.prizes.filter(T=>T).map(T=>parseInt(T,10)),Q=j.reduce((T,V)=>T+V,0),Y=d.prize_type==="money"&&Q>0?"coins":d.prize_type,Z={title:d.title.trim(),category:d.category,start_time:new Date(d.start_time).toISOString(),end_time:new Date(d.end_time).toISOString(),prizes:j,prize_pool:Q,prize_type:Y};if(!m)throw new Error("Supabase config missing");const{data:me,error:xe}=await m.from("quizzes").insert([Z]).select().single();if(xe)throw xe;c({title:"Quiz created",description:me.title});const pe=await ke(me.id,g,"replace");pe.ok?c({title:"Questions added",description:`${g.length} questions`}):c({title:"Question insert fallback",description:pe.message||"Failed",variant:"destructive"}),A(!1),o({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),r([H()]),K()}catch(t){c({title:"Create failed",description:t.message,variant:"destructive"})}},ke=async(s,t,x="append")=>{var u;if(!I)return{ok:!1,message:"Admin access required"};if(!m)return{ok:!1,message:"No Supabase client"};try{const{data:l}=await m.auth.getSession(),g=(u=l==null?void 0:l.session)==null?void 0:u.access_token,j=await fetch("/functions/v1/admin-upsert-questions",{method:"POST",headers:{"Content-Type":"application/json",...g?{Authorization:`Bearer ${g}`}:{}},body:JSON.stringify({quizId:s,items:t,mode:x})});if(j.ok)return{ok:!0};if(j.status!==404){const Q=await j.json().catch(()=>({}));throw new Error((Q==null?void 0:Q.error)||`HTTP ${j.status}`)}}catch(l){console.warn("Edge bulk insert failed, falling back to direct RPC path",l)}try{const{error:l}=await m.rpc("admin_bulk_upsert_questions",{p_quiz_id:s,p_payload:t,p_mode:x});if(!l)return{ok:!0};console.warn("admin_bulk_upsert_questions RPC returned error, using manual inserts",l==null?void 0:l.message)}catch(l){console.warn("admin_bulk_upsert_questions RPC threw, using manual inserts",l)}x==="replace"&&await m.from("questions").delete().eq("quiz_id",s);for(const l of t){const{data:g,error:j}=await m.from("questions").insert({quiz_id:s,question_text:l.question_text}).select("id").single();if(j)return{ok:!1,message:j.message};const Q=l.options.map(Z=>({question_id:g.id,option_text:Z.option_text,is_correct:!!Z.is_correct})),{error:Y}=await m.from("options").insert(Q);if(Y)return{ok:!1,message:Y.message}}return{ok:!0}},Se=async s=>{if(!window.confirm("Delete this quiz?"))return;if(!I){c({title:"Access denied",description:"Only admins can delete quizzes.",variant:"destructive"});return}if(!m)return;const{error:t}=await m.from("quizzes").delete().eq("id",s);t?c({title:"Delete failed",description:t.message,variant:"destructive"}):(c({title:"Deleted"}),K())},Ce=async s=>{if(!I){c({title:"Access denied",description:"Only admins can recompute results.",variant:"destructive"});return}if(m)try{re(s);const{error:t}=await m.rpc("admin_recompute_quiz_results",{p_quiz_id:s});if(t)throw t;try{await m.rpc("compute_results_if_due",{p_quiz_id:s})}catch(x){}c({title:"Recomputed"})}catch(t){c({title:"Recompute failed",description:t.message,variant:"destructive"})}finally{re(null)}},le=R.useMemo(()=>{const s=Date.now(),t=[],x=[];for(const u of L){const l=u.end_time?new Date(u.end_time).getTime():null;l!==null&&s>l?x.push(u):t.push(u)}return{active:t,finished:x}},[L]),[ee,O]=R.useState([]),[ce,oe]=R.useState(!1),U=R.useCallback(async()=>{if(!I){O([]);return}if(!m){O([]);return}oe(!0);try{const{data:s,error:t}=await m.from("redemptions").select("id,user_id,reward_value,reward_type,coins_required,payout_identifier,payout_channel,requested_at, profiles(username,full_name)").eq("status","pending").order("requested_at",{ascending:!1});if(t)throw t;O(s||[])}catch(s){O([])}finally{oe(!1)}},[I]),ze=R.useCallback(async s=>{if(I&&m){O(t=>t.filter(x=>x.id!==s));try{const{error:t}=await m.rpc("admin_approve_redemption",{p_redemption_id:s});if(t)throw t;c({title:"Approved",description:"Redemption approved."})}catch(t){c({title:"Approve failed",description:t.message,variant:"destructive"}),U()}}},[I,U,c]);return R.useEffect(()=>{U();const s=setInterval(U,3e4);return()=>clearInterval(s)},[U]),z?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx($,{className:"w-8 h-8 text-indigo-600 animate-spin"})}):I?e.jsxs("div",{className:"container mx-auto p-6 max-w-5xl bg-white text-gray-900 rounded-2xl shadow-sm",children:[e.jsxs(ue,{children:[e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{rel:"canonical",href:"https://quizdangal.com/admin"})]}),e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Admin Dashboard"}),!qe&&e.jsx("div",{className:"mb-6 text-sm text-amber-600",children:"Supabase env keys missing. Read-only UI only."}),e.jsx("div",{className:"flex gap-2 mb-6 flex-wrap",children:["overview","automation","rewards","approvals","notifications"].map(s=>e.jsx("button",{onClick:()=>k(s),className:`px-3 py-1.5 rounded border text-sm transition-colors ${s===y?"bg-indigo-600 text-white border-indigo-600":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"}`,children:s},s))}),y==="overview"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{children:e.jsxs(f,{onClick:()=>A(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"New Quiz"]})}),e.jsx(he,{children:C&&e.jsxs(J.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},className:"bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Create Quiz"}),e.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{className:"mb-1 block",children:"Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map(({value:s,label:t})=>e.jsx("button",{type:"button",onClick:()=>o(x=>({...x,category:s})),className:`px-3 py-1 rounded-full text-xs border ${d.category===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:t},s))})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Title"}),e.jsx(P,{value:d.title,onChange:s=>o(t=>({...t,title:s.target.value})),placeholder:"Daily Quiz",required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Prize Type"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["money","coins","others"].map(s=>e.jsx("button",{type:"button",onClick:()=>o(t=>({...t,prize_type:s})),className:`px-2 py-1 rounded text-xs border ${d.prize_type===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},s))})]})]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-2",children:d.prizes.map((s,t)=>e.jsx(P,{value:s,placeholder:`${t+1}${["st","nd","rd"][t]||"th"} Prize`,onChange:x=>o(u=>{const l=[...u.prizes];return l[t]=x.target.value,{...u,prizes:l}})},t))}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Start Time"}),e.jsx(P,{type:"datetime-local",value:d.start_time,onChange:s=>o(t=>({...t,start_time:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{children:"End Time"}),e.jsx(P,{type:"datetime-local",value:d.end_time,onChange:s=>o(t=>({...t,end_time:s.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Questions Mode"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["form","paste"].map(s=>e.jsx("button",{type:"button",onClick:()=>n(s),className:`px-3 py-1 rounded text-xs border ${a===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},s))})]}),a==="form"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-600",children:B?"Opinion: no correct option stored.":"Mark one correct option with radio."}),i.map((s,t)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 space-y-2 bg-white",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-6",children:["Q",t+1]}),e.jsx(P,{value:s.text,onChange:x=>r(u=>{const l=[...u];return l[t]={...l[t],text:x.target.value},l}),placeholder:"Question text",className:"flex-1"}),e.jsx(f,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-500",onClick:()=>r(x=>x.length===1?[H()]:x.filter((u,l)=>l!==t)),children:"Del"})]}),(s.options||[]).slice(0,4).map((x,u)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!B&&e.jsx("input",{type:"radio",name:`q-${t}`,checked:(s.correctIndex||0)===u,onChange:()=>r(l=>{const g=[...l];return g[t]={...g[t],correctIndex:u},g})}),e.jsx(P,{value:x,onChange:l=>r(g=>{const j=[...g],Q=[...j[t].options];return Q[u]=l.target.value,j[t]={...j[t],options:Q},j}),placeholder:`Option ${u+1}`,className:"flex-1"}),(s.options||[]).length>2&&e.jsx(f,{type:"button",size:"sm",variant:"outline",className:"border-red-300 text-red-500",onClick:()=>r(l=>{const g=[...l],j=[...g[t].options];return j.splice(u,1),g[t]={...g[t],options:j},g}),children:"X"})]},u)),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(f,{type:"button",size:"sm",disabled:(s.options||[]).length>=4,onClick:()=>r(x=>{const u=[...x],l=[...u[t].options];return l.length<4&&l.push(""),u[t]={...u[t],options:l},u}),children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Option"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Max 4 options"})]})]},t)),e.jsxs(f,{type:"button",onClick:()=>r(s=>[...s,H()]),children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Question"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{children:"Paste Questions"}),e.jsx(ae,{className:"h-40",value:d.bulk,onChange:s=>o(t=>({...t,bulk:s.target.value})),placeholder:`Q1. Capital of India?
- [ ] Mumbai
- [x] Delhi
- [ ] Kolkata
- [ ] Jaipur

Q2. ...`}),(()=>{const{items:s,errors:t,warnings:x}=Fe(d.bulk,{allowZeroCorrect:B});return e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[s.length," parsed"]}),x[0]&&e.jsx("div",{className:"text-amber-500",children:x[0]}),t[0]&&e.jsx("div",{className:"text-red-500",children:t[0]}),e.jsx(f,{type:"button",size:"sm",disabled:!!t.length||!s.length,onClick:()=>{if(t.length||!s.length)return;const u=s.map(l=>({text:l.question_text,options:l.options.map(g=>g.option_text),correctIndex:B?0:l.options.findIndex(g=>g.is_correct)>=0?l.options.findIndex(g=>g.is_correct):0}));r(u.length?u:[H()]),n("form"),c({title:"Loaded",description:`${u.length} questions moved to form.`})},children:"Load into form"})]})})()]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancel"})]})]})]})}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2 mb-3",children:[e.jsx(Ie,{className:"w-5 h-5"}),"All Quizzes"]}),E?e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading..."]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Active / Upcoming"}),e.jsx("div",{className:"space-y-4",children:le.active.map(s=>{const t=s.prize_type||"money",x=W(t,s.prize_pool,{fallback:0}),u=Array.isArray(s.prizes)?s.prizes.map(l=>W(t,l,{fallback:0})).join(", "):"";return e.jsxs(J.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[240px]",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",ge(s.category)||"â€”"]}),e.jsxs("span",{children:["Type: ",t]}),e.jsxs("span",{children:["Pool: ",x]}),e.jsxs("span",{children:["Prizes: ",u]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:["Start: ",s.start_time?X(s.start_time):"â€”"]}),e.jsxs("span",{className:"ml-4",children:["End: ",s.end_time?X(s.end_time):"â€”"]})]})]}),e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>Ce(s.id),disabled:ie===s.id,children:ie===s.id?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"w-4 h-4 mr-1"}),"Recompute"]})}),e.jsxs(De,{to:`/results/${s.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-gray-300 hover:bg-gray-100 text-indigo-600",children:[e.jsx(Te,{className:"w-4 h-4"}),"Results"]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{D(s),we(s.id),ye(!0)},className:"text-blue-400",children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Questions"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>Se(s.id),className:"text-red-500",children:e.jsx(Me,{className:"w-4 h-4"})})]})]}),e.jsx(he,{children:ve&&(p==null?void 0:p.id)===s.id&&e.jsxs(J.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 space-y-2",children:[e.jsxs("h5",{className:"font-medium flex items-center gap-2",children:["Questions for ",s.title]}),M.length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No questions."}),M.map((l,g)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 bg-white",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Q",g+1,": ",l.question_text]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:(l.options||[]).map(j=>e.jsxs("div",{className:`px-2 py-0.5 text-xs rounded-full ${j.is_correct?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:[j.option_text,j.is_correct&&e.jsx("span",{className:"ml-1",children:"âœ“"})]},j.id))})]},l.id))]})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Finished"}),e.jsx("div",{className:"space-y-4",children:le.finished.map(s=>{const t=s.prize_type||"money",x=W(t,s.prize_pool,{fallback:0}),u=Array.isArray(s.prizes)?s.prizes.map(l=>W(t,l,{fallback:0})).join(", "):"";return e.jsxs(J.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",ge(s.category)||"â€”"]}),e.jsxs("span",{children:["Type: ",t]}),e.jsxs("span",{children:["Pool: ",x]}),e.jsxs("span",{children:["Prizes: ",u]})]})]},s.id)})})]})]})]})]}),y==="approvals"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pending Redemptions"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Approve user reward payouts after verifying their UPI ID / phone number."}),ce&&e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading pending requests..."]}),!ce&&ee.length===0&&e.jsx("div",{className:"py-6 text-center text-gray-500 border border-gray-200 rounded-xl bg-gray-50",children:"No pending redemptions."}),ee.length>0&&e.jsx("div",{className:"space-y-4",children:ee.map(s=>{var t;return e.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 bg-white shadow-sm flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-yellow-500 flex items-center justify-center text-white font-semibold shadow",children:e.jsx("span",{className:"text-sm",children:"â‚¹"})}),(()=>{var g,j;const x=s.reward_value,u=x&&String(x).trim().length?x:`${s.reward_type||""}`.trim()||"Reward",l=((g=s.profiles)==null?void 0:g.username)||((j=s.profiles)==null?void 0:j.full_name)||"Anonymous";return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:u}),e.jsxs("div",{className:"text-[11px] text-gray-600",children:["@",l]})]})})()]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex flex-wrap gap-3",children:[e.jsxs("span",{children:["Type: ",s.reward_type||"â€”"]}),e.jsxs("span",{children:["Coins: ",(t=s.coins_required)!=null?t:0]}),e.jsxs("span",{children:["Requested: ",s.requested_at?X(s.requested_at):"â€”"]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Payout: ",s.payout_identifier?`${s.payout_identifier} (${s.payout_channel||"upi"})`:"â€”"]})]}),e.jsx("div",{className:"flex items-center gap-2 self-start md:self-center",children:e.jsx(f,{size:"sm",onClick:()=>ze(s.id),className:"bg-green-600 hover:bg-green-700 text-white",children:"Approve"})})]},s.id)})})]}),y==="notifications"&&e.jsx(Oe,{}),y==="automation"&&e.jsx(Ue,{}),y==="rewards"&&e.jsx(Be,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{children:[e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{rel:"canonical",href:"https://quizdangal.com/admin"})]}),e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 max-w-md w-full text-center shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-500 mb-2",children:"Admin access required"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Supabase "}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:" table mein aapke record ka "}),e.jsx("strong",{children:"role"}),e.jsx("span",{children:" field admin hona chahiye."})]}),e.jsxs("ul",{className:"text-left text-sm text-gray-600 mt-4 space-y-2 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("span",{children:"Supabase dashboard"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"â†’"}),e.jsx("span",{children:"Table editor"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"â†’"}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:"Â me role update karein."})]}),e.jsx("li",{children:"Update ke baad login session refresh karein."}),e.jsxs("li",{children:["Dev bypass (",e.jsx("code",{children:"VITE_BYPASS_AUTH=1"}),") mein mock admin auto-enable hota hai."]})]})]})})]})}function Be(){const{toast:c}=G(),[h,z]=w.useState([]),[N,q]=w.useState(!1),[v,y]=w.useState(!1),[k,L]=w.useState({reward_type:"coins",reward_value:"",coins_required:"",is_active:!0}),[b,E]=w.useState(!1),[_,C]=w.useState(null),A=w.useCallback(async()=>{if(!m)return;q(!0);const{data:i,error:r}=await m.from("reward_catalog").select("id,reward_type,reward_value,coins_required,is_active").order("id",{ascending:!1}).limit(200);r?c({title:"Rewards load failed",description:r.message,variant:"destructive"}):z(i||[]),q(!1)},[c]);w.useEffect(()=>{A()},[A]);const d=()=>L({reward_type:"cash",reward_value:"",coins_required:"",is_active:!0}),o=async i=>{if(i.preventDefault(),!!m){E(!0);try{const r={reward_type:String(k.reward_type||"").trim()||"cash",reward_value:String(k.reward_value||"").trim(),coins_required:k.coins_required!==""&&k.coins_required!==null?parseInt(k.coins_required,10):null,is_active:!!k.is_active};if(!r.reward_value)throw new Error("Value required");if(r.coins_required===null||Number.isNaN(r.coins_required))throw new Error("Coins required");let p;if(_?p=await m.from("reward_catalog").update(r).eq("id",_).select().single():p=await m.from("reward_catalog").insert([r]).select().single(),p.error)throw p.error;c({title:_?"Reward updated":"Reward created"}),d(),y(!1),C(null),A()}catch(r){c({title:"Save failed",description:r.message,variant:"destructive"})}finally{E(!1)}}},a=async i=>{if(!m)return;const{error:r}=await m.from("reward_catalog").update({is_active:!i.is_active}).eq("id",i.id);r?c({title:"Toggle failed",description:r.message,variant:"destructive"}):(c({title:i.is_active?"Deactivated":"Activated"}),A())},n=i=>{var r;C(i.id),y(!0),L({reward_type:i.reward_type||"cash",reward_value:i.reward_value||"",coins_required:((r=i.coins_required)!=null?r:"").toString(),is_active:!!i.is_active})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Redemptions auto-approved hain. Neeche sirf Rewards Catalog manage karna hai."}),e.jsxs("div",{className:"pt-10 border-t border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Rewards Catalog"}),e.jsx(f,{size:"sm",onClick:()=>{y(i=>!i),v||(d(),C(null))},children:v?"Close":"New Reward"}),e.jsx(f,{size:"sm",variant:"outline",onClick:A,disabled:N,children:N?e.jsx($,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),v&&e.jsxs("form",{onSubmit:o,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Type"}),e.jsx("div",{className:"flex gap-2 flex-wrap mt-1",children:["cash","voucher"].map(i=>e.jsx("button",{type:"button",onClick:()=>L(r=>({...r,reward_type:i})),className:`px-2 py-1 rounded text-xs border ${k.reward_type===i?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:i==="cash"?"ðŸ’µ Cash (UPI/Phone)":"ðŸŽŸï¸ Voucher (WhatsApp)"},i))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:k.reward_type==="cash"?"User will provide UPI ID or Phone number":"User will provide WhatsApp number"})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Value"}),e.jsx(P,{value:k.reward_value,onChange:i=>L(r=>({...r,reward_value:i.target.value})),placeholder:"e.g. 100 / AMAZON100 / â‚¹100"})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Coins Required"}),e.jsx(P,{type:"number",value:k.coins_required,onChange:i=>L(r=>({...r,coins_required:i.target.value})),placeholder:"coins needed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_active",type:"checkbox",checked:!!k.is_active,onChange:i=>L(r=>({...r,is_active:i.target.checked}))}),e.jsx("label",{htmlFor:"is_active",className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"Saving"]}):_?"Update":"Create"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>{d(),C(null)},children:_?"Cancel Edit":"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Value"}),e.jsx("th",{className:"p-2 text-left",children:"Coins Required"}),e.jsx("th",{className:"p-2 text-left",children:"Active"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[h.map(i=>{var r;return e.jsxs("tr",{className:"border-t border-gray-200 hover:bg-gray-100",children:[e.jsx("td",{className:"p-2 capitalize",children:i.reward_type}),e.jsx("td",{className:"p-2 max-w-[260px] truncate",title:i.reward_value,children:i.reward_value}),e.jsx("td",{className:"p-2",children:(r=i.coins_required)!=null?r:"â€”"}),e.jsx("td",{className:"p-2",children:i.is_active?e.jsx("span",{className:"text-green-500",children:"Yes"}):e.jsx("span",{className:"text-gray-500",children:"No"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>n(i),children:"Edit"}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>a(i),children:i.is_active?"Deactivate":"Activate"})]})})]},i.id)}),!h.length&&!N&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 text-center text-gray-500",children:"No rewards."})}),N&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:[e.jsx($,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading rewards..."]})})]})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Catalog: inactive rewards are hidden from users."})]})]})}function Oe(){const{toast:c}=G(),[h,z]=w.useState(""),[N,q]=w.useState(""),[v,y]=w.useState("all"),[k,L]=w.useState(!1),[b,E]=w.useState([]),[_,C]=w.useState(!1),A=w.useCallback(async()=>{if(!m)return;C(!0);const{data:o,error:a}=await m.from("notifications").select("id,title,message,type,segment,created_at").order("created_at",{ascending:!1}).limit(100);a?c({title:"Fetch failed",description:a.message,variant:"destructive"}):E(o||[]),C(!1)},[c]);w.useEffect(()=>{A()},[A]);const d=async o=>{var a;if(o.preventDefault(),!h.trim()||!N.trim()){c({title:"Missing fields",variant:"destructive"});return}if(!m){c({title:"No backend client",variant:"destructive"});return}L(!0);try{const n={title:h.trim(),message:N.trim(),segment:v},{data:i}=await m.auth.getSession(),r=(a=i==null?void 0:i.session)==null?void 0:a.access_token,{data:p,error:D}=await m.functions.invoke("send-notifications",{body:n,headers:r?{Authorization:`Bearer ${r}`}:void 0});if(D)throw new Error(D.message||D.error||"Failed to send notification");const M=typeof p=="object"&&(p!=null&&p.message)?p.message:h.trim();c({title:"Sent",description:M}),z(""),q(""),A()}catch(n){c({title:"Send failed",description:n.message,variant:"destructive"})}finally{L(!1)}};return e.jsxs("div",{className:"space-y-8 max-w-3xl",children:[e.jsxs("form",{onSubmit:d,className:"space-y-4 bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Send Notification"}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"notification-title",children:"Title"}),e.jsx(P,{id:"notification-title",name:"notificationTitle",value:h,onChange:o=>z(o.target.value),maxLength:80,placeholder:"Short title"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 80 chars â€¢ ",h.length,"/80"]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"notification-message",children:"Message"}),e.jsx(ae,{id:"notification-message",name:"notificationMessage",value:N,onChange:o=>q(o.target.value),className:"h-28",maxLength:280,placeholder:"Body shown in push notification"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 280 chars â€¢ ",N.length,"/280"]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Segment"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["all"].map(o=>e.jsx("button",{type:"button",onClick:()=>y(o),className:`px-3 py-1 rounded text-xs border ${v===o?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:o},o))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-1 animate-spin"}),"Sending"]}):"Send"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>{z(""),q("")},children:"Reset"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Recent Notifications"}),e.jsx(f,{size:"sm",variant:"outline",onClick:A,disabled:_,children:_?e.jsx($,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),e.jsxs("div",{className:"space-y-3",children:[b.map(o=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:o.title}),e.jsx("div",{className:"text-xs text-gray-600 whitespace-pre-wrap max-w-xl break-words",children:o.message})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:X(o.created_at)})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Segment: ",o.segment||"â€”",o.type?` â€¢ ${o.type}`:""]})]},o.id)),!b.length&&!_&&e.jsx("div",{className:"text-xs text-gray-500",children:"No notifications yet."})]})]})]})}function Ue(){const{toast:c}=G(),[h,z]=w.useState(!1),[N,q]=w.useState(!1),[v,y]=w.useState({is_enabled:!0,cadence_min:10,live_window_min:7,start_offset_sec:15,cleanup_days:3,categories:["opinion","gk","sports","movies"],alert_emails:["quizdangalofficial@gmail.com"]}),[k,L]=w.useState([]),[b,E]=w.useState({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),_=w.useCallback(async()=>{var a,n,i,r;if(m){z(!0);try{const[{data:p,error:D},{data:M,error:F}]=await Promise.all([m.from("ai_settings").select("*").eq("id",1).maybeSingle(),m.from("ai_providers").select("*").order("enabled",{ascending:!1}).order("priority",{ascending:!0}).order("id",{ascending:!0})]);if(D)throw D;if(F)throw F;p&&y({is_enabled:!!p.is_enabled,cadence_min:(a=p.cadence_min)!=null?a:10,live_window_min:(n=p.live_window_min)!=null?n:7,start_offset_sec:(i=p.start_offset_sec)!=null?i:15,cleanup_days:(r=p.cleanup_days)!=null?r:3,categories:Array.isArray(p.categories)?p.categories:["opinion","gk","sports","movies"],alert_emails:Array.isArray(p.alert_emails)?p.alert_emails:["quizdangalofficial@gmail.com"]}),L(M||[])}catch(p){c({title:"Load failed",description:p.message,variant:"destructive"})}finally{z(!1)}}},[c]);w.useEffect(()=>{_()},[_]);const C=async a=>{var n,i;if((n=a==null?void 0:a.preventDefault)==null||n.call(a),!!m){q(!0);try{const r={id:1,is_enabled:!!v.is_enabled,cadence_min:Number(v.cadence_min||10),live_window_min:Number(v.live_window_min||7),start_offset_sec:Number((i=v.start_offset_sec)!=null?i:15),categories:v.categories,cleanup_days:Number(v.cleanup_days||3),alert_emails:v.alert_emails},{error:p}=await m.from("ai_settings").upsert(r,{onConflict:"id"});if(p)throw p;c({title:"Settings saved"})}catch(r){c({title:"Save failed",description:r.message,variant:"destructive"})}finally{q(!1)}}},A=async a=>{if(!m)return;const{error:n}=await m.from("ai_providers").update({enabled:!a.enabled}).eq("id",a.id);n?c({title:"Toggle failed",description:n.message,variant:"destructive"}):(c({title:a.enabled?"Disabled":"Enabled"}),_())},d=async a=>{var n;if((n=a==null?void 0:a.preventDefault)==null||n.call(a),!!m)try{const i={name:String(b.name||"").trim(),api_key_enc:String(b.api_key_enc||"").trim()||null,priority:Number(b.priority||1),enabled:!!b.enabled};if(!i.name)throw new Error("Provider name required");let r;if(b.id?r=await m.from("ai_providers").update(i).eq("id",b.id).select().single():r=await m.from("ai_providers").insert([i]).select().single(),r.error)throw r.error;c({title:b.id?"Provider updated":"Provider added"}),E({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),_()}catch(i){c({title:"Save failed",description:i.message,variant:"destructive"})}},o=a=>E({id:a.id,name:a.name||"",api_key_enc:a.api_key_enc||"",priority:a.priority||1,enabled:!!a.enabled});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"AI Automation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Auto-generate quizzes backend-only. Configure cadence, categories, alert emails, and API providers with failover."}),e.jsxs("form",{onSubmit:C,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_enabled",type:"checkbox",checked:!!v.is_enabled,onChange:a=>y(n=>({...n,is_enabled:a.target.checked}))}),e.jsx("label",{htmlFor:"is_enabled",className:"text-sm",children:"Enabled"})]}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Cadence (min)"}),e.jsx(P,{type:"number",min:1,max:60,value:v.cadence_min,onChange:a=>y(n=>({...n,cadence_min:a.target.valueAsNumber||10}))})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Live window (min)"}),e.jsx(P,{type:"number",min:5,max:180,value:v.live_window_min,onChange:a=>y(n=>({...n,live_window_min:a.target.valueAsNumber||7}))})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Start offset (sec)"}),e.jsx(P,{type:"number",min:0,max:120,value:v.start_offset_sec,onChange:a=>y(n=>{var i;return{...n,start_offset_sec:Math.max(0,(i=a.target.valueAsNumber)!=null?i:15)}})})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Cleanup days"}),e.jsx(P,{type:"number",min:1,max:30,value:v.cleanup_days,onChange:a=>y(n=>({...n,cleanup_days:a.target.valueAsNumber||3}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(S,{children:"Categories (comma)"}),e.jsx(P,{value:(v.categories||[]).join(", "),onChange:a=>y(n=>({...n,categories:a.target.value.split(",").map(i=>i.trim()).filter(Boolean)}))})]})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Alert emails (comma)"}),e.jsx(P,{value:(v.alert_emails||[]).join(", "),onChange:a=>y(n=>({...n,alert_emails:a.target.value.split(",").map(i=>i.trim()).filter(Boolean)}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:N,children:N?"Savingâ€¦":"Save Settings"}),e.jsx(f,{type:"button",variant:"outline",onClick:_,disabled:h,children:h?"Loadingâ€¦":"Refresh"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h3",{className:"font-semibold",children:"Providers"}),e.jsx(f,{size:"sm",variant:"outline",onClick:_,disabled:h,children:h?"Loadingâ€¦":"Refresh"})]}),e.jsxs("form",{onSubmit:d,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsx("h4",{className:"font-medium",children:b.id?"Edit Provider":"Add Provider"}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(S,{children:"Name"}),e.jsx(P,{value:b.name,onChange:a=>E(n=>({...n,name:a.target.value})),placeholder:"e.g. openai"})]}),e.jsxs("div",{children:[e.jsx(S,{children:"Priority"}),e.jsx(P,{type:"number",value:b.priority,onChange:a=>E(n=>({...n,priority:a.target.valueAsNumber||1}))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"prov_enabled",type:"checkbox",checked:!!b.enabled,onChange:a=>E(n=>({...n,enabled:a.target.checked}))}),e.jsx("label",{htmlFor:"prov_enabled",className:"text-sm",children:"Enabled"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(S,{children:"API Key (stored server-side)"}),e.jsx(P,{value:b.api_key_enc,onChange:a=>E(n=>({...n,api_key_enc:a.target.value})),placeholder:"sk-..."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",children:b.id?"Update":"Add"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>E({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),children:"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Name"}),e.jsx("th",{className:"p-2 text-left",children:"Priority"}),e.jsx("th",{className:"p-2 text-left",children:"Enabled"}),e.jsx("th",{className:"p-2 text-left",children:"Quota"}),e.jsx("th",{className:"p-2 text-left",children:"Last Error"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[k.map(a=>e.jsxs("tr",{className:"border-t border-gray-200",children:[e.jsx("td",{className:"p-2",children:a.name}),e.jsx("td",{className:"p-2",children:a.priority}),e.jsx("td",{className:"p-2",children:a.enabled?"Yes":"No"}),e.jsx("td",{className:"p-2",children:a.quota_exhausted?"Exhausted":"OK"}),e.jsx("td",{className:"p-2 max-w-[300px] truncate",title:a.last_error||"",children:a.last_error||"â€”"}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>o(a),children:"Edit"}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>A(a),children:a.enabled?"Disable":"Enable"})]})})]},a.id)),!k.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-center text-gray-500",children:"No providers"})})]})]})})]})]})}export{Je as default};
