import{a as se,s as g,j as e,B as _,P as te}from"./index-b1c17e29.js";import{r as n}from"./react-8a702e3e.js";import{L as C}from"./router-f2cf3f51.js";import{S as ae}from"./SEO-307f93bb.js";import{g as re}from"./avatar-c5201127.js";import{L as le,n as ne,a as ie,S as oe,C as ce,d as de,f as D,o as xe,p as me,q as P,m as ue,I as he,r as fe,s as ge,t as ve}from"./icons-29deee62.js";import"./supabase-4c1332f7.js";function Ce(){var $;const{signOut:F}=se(),[O,S]=n.useState(!0),[m,Y]=n.useState(null),[s,w]=n.useState(null),[k,u]=n.useState(""),[L,R]=n.useState(!1),[B,E]=n.useState(!1),[U,Q]=n.useState(!1),[v,H]=n.useState(0),[q,V]=n.useState({nextLevel:1,nextReq:50,have:0,remaining:50,currReq:0}),[o,p]=n.useState(null),[A,b]=n.useState(""),[W,y]=n.useState(!1),h=n.useMemo(()=>[0,50,200,450,800,1250,1800,2450,3200,4050,5e3,6050,7200,8450,9800,11250,12800,14450,16200,18050,2e4,22050,24200,26450,28800,31250,33800,36450,39200,42050,45e3,48050,51200,54450,57800,61250,64800,68450,72200,76050,8e4,84050,88200,92450,96800,101250,105800,110450,115200,120050,125e3,130050,135200,140450,145800,151250,156800,162450,168200,174050,18e4,186050,192200,198450,204800,211250,217800,224450,231200,238050,245e3,252050,259200,266450,273800,281250,288800,296450,304200,312050,32e4,328050,336200,344450,352800,361250,369800,378450,387200,396050,405e3,414050,423200,432450,441800,451250,460800,470450,480200,490050,5e5],[]),z=n.useCallback(a=>{const l=Number(a||0);let t=0;for(let r=1;r<h.length&&l>=h[r];r++)t=r;return t},[h]),I=n.useCallback((a,l)=>{const t=Number(a||0),r=Math.max(0,Number(l||0)),c=100,d=Math.min(c,r+1),i=h[r]||0,x=h[d]||h[c],f=Math.max(0,(x||0)-t);return{nextLevel:d,nextReq:x,have:t,remaining:f,currReq:i}},[h]),j=n.useRef(null),N=n.useCallback(async()=>{S(!0);try{const{data:{session:a}}=await g.auth.getSession(),l=(a==null?void 0:a.user)||null;if(Y(l),l){const{data:t,error:r}=await g.from("profiles").select("id, email, username, full_name, avatar_url, total_coins, wallet_balance, referral_code, referred_by, referral_count, mobile_number, is_profile_complete, level").eq("id",l.id).single();if(r)throw r;w(t),p(null),b("");const c=Number((t==null?void 0:t.total_coins)||0),d=z(c);if(H(d),V(I(c,d)),t!=null&&t.referred_by)try{const{data:i,error:x}=await g.rpc("profiles_public_by_ids",{p_ids:[t.referred_by]});if(!x&&Array.isArray(i)&&i.length>0){const f=i[0];if(p(f),f!=null&&f.avatar_url){const T=await re(f.avatar_url);T&&b(T)}}}catch(i){console.warn("Referrer lookup failed:",i)}if(t!=null&&t.avatar_url)if(t.avatar_url.includes("://"))u(t.avatar_url);else{const{data:i,error:x}=await g.storage.from("avatars").createSignedUrl(t.avatar_url,3600);x?(console.warn("Avatar signed URL creation failed:",x),u("")):u((i==null?void 0:i.signedUrl)||"")}else u("")}else w(null),u(""),p(null),b("")}catch(a){w(null),u(""),p(null),b("")}finally{S(!1)}},[z,I]);n.useEffect(()=>{N()},[N]);const G=async()=>{await F()},J=()=>{var a;return(a=j.current)==null?void 0:a.click()},K=async a=>{var t;const l=(t=a.target.files)==null?void 0:t[0];if(!(!l||!m)){R(!0);try{const r=`${m.id}/${Date.now()}-${l.name}`,{error:c}=await g.storage.from("avatars").upload(r,l,{upsert:!0});if(c)throw c;const{error:d}=await g.from("profiles").update({avatar_url:r}).eq("id",m.id);if(d)throw d;const{data:i,error:x}=await g.storage.from("avatars").createSignedUrl(r,60*60);x||u((i==null?void 0:i.signedUrl)||""),await N(),alert("Avatar updated")}catch(r){alert(`Avatar change failed: ${(r==null?void 0:r.message)||"Try again later"}`)}finally{R(!1),j.current&&(j.current.value="")}}},X=a=>{const l=Number(a||0);return l>=80?"ring-[#8b5cf6]":l>=50?"ring-[#f59e0b]":l>=20?"ring-[#9ca3af]":"ring-[#cd7f32]"},M=(a,l)=>{const t=Number(a||0);if(Math.max(0,Number(l||0))>=100)return 100;const{nextReq:c,currReq:d}=q;if(!c||c<=d)return 0;const i=c-d,x=Math.max(0,Math.min(i,t-d));return Math.round(x/i*100)},Z=n.useCallback(async()=>{var t;const a=String((s==null?void 0:s.referral_code)||"").trim();if(!a)return;const l=()=>{if(typeof document=="undefined")return;const r=document.createElement("textarea");r.value=a,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)};try{typeof navigator!="undefined"&&((t=navigator==null?void 0:navigator.clipboard)!=null&&t.writeText)?await navigator.clipboard.writeText(a):l(),y(!0)}catch(r){try{l(),y(!0)}catch(c){console.warn("Referral code copy failed:",c)}}setTimeout(()=>y(!1),1800)},[s==null?void 0:s.referral_code]);if(O)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-indigo-300"})});if(!m)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-800/40 text-indigo-300 flex items-center justify-center mb-3 border border-indigo-700/60",children:e.jsx(ne,{className:"w-6 h-6"})}),e.jsxs("p",{className:"text-lg text-slate-200",children:["You are not logged in or session expired.",e.jsx("br",{}),"Please ",e.jsx(C,{to:"/login",className:"text-indigo-300 underline",children:"login"})," to view your profile."]})]});const ee=[{label:"About Us",href:"/about-us",icon:he},{label:"Contact Us",href:"/contact-us",icon:fe},{label:"Terms & Conditions",href:"/terms-conditions",icon:ge},{label:"Privacy Policy",href:"/privacy-policy",icon:ve},{label:"Refer & Earn",href:"/refer",icon:D}];return e.jsxs("div",{className:"relative overflow-x-hidden",children:[e.jsx(ae,{title:"Your Quiz Dangal Profile",description:"View and manage your Quiz Dangal profile details, quiz preferences, and account settings.",canonical:"https://quizdangal.com/profile",robots:"noindex, nofollow"}),e.jsxs("div",{className:"mx-auto w-full px-3 sm:px-4 pt-3 pb-24 max-w-3xl space-y-3 overflow-x-hidden",children:[e.jsxs("div",{className:"qd-card relative overflow-hidden rounded-3xl p-4 shadow-2xl",children:[e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute -top-20 -right-20 h-56 w-56 rounded-full bg-gradient-to-tr from-indigo-500/20 via-fuchsia-400/15 to-transparent blur-3xl"}),e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute -bottom-24 -left-24 h-56 w-56 rounded-full bg-gradient-to-tr from-purple-500/15 via-pink-500/10 to-transparent blur-3xl"}),e.jsxs("div",{className:"flex flex-col gap-3 relative",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center -ml-2",children:[e.jsxs("div",{className:"relative w-[5.5rem] h-[5.5rem]",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-indigo-400/20 via-fuchsia-400/20 to-transparent blur-[3px] animate-spin",style:{animationDuration:"9s"}}),e.jsx("div",{className:`relative w-[5.5rem] h-[5.5rem] rounded-full overflow-hidden flex items-center justify-center text-slate-100 font-bold ring-2 ring-offset-2 ring-offset-slate-900 ${X(v)} bg-gradient-to-br from-slate-800 to-slate-700 shadow-md`,children:k?e.jsx("img",{src:k,alt:s!=null&&s.full_name||s!=null&&s.username?`${s.full_name||s.username} avatar`:"User avatar",className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:((s==null?void 0:s.full_name)||(m==null?void 0:m.email)||"U").charAt(0).toUpperCase()})})}),e.jsx("button",{onClick:J,disabled:L,className:"absolute -bottom-2 -right-2 p-2 rounded-xl bg-slate-900/80 border border-slate-700/60 shadow-sm text-slate-200 hover:bg-slate-800 transition disabled:opacity-60",title:L?"Uploading…":"Change avatar",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("input",{ref:j,type:"file",accept:"image/*",className:"hidden",onChange:K})]}),e.jsxs("div",{className:"mt-1.5 text-center max-w-[12rem] sm:max-w-none mx-auto",children:[e.jsx("div",{className:"text-[11px] text-slate-400",children:"Email"}),e.jsx("div",{className:"text-sm font-medium text-slate-100 truncate",children:(s==null?void 0:s.email)||m.email})]})]}),e.jsxs("div",{className:"min-w-0 -mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400",children:[e.jsx(oe,{className:"w-4 h-4 text-indigo-300"}),e.jsx("span",{children:"Welcome back"})]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate",children:s!=null&&s.username?`@${s.username}`:"Username not set"}),e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-2 text-xs",children:e.jsxs("div",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-amber-900/20 text-amber-200 border border-amber-500/20",children:[e.jsx(ce,{className:"w-3.5 h-3.5"}),e.jsxs("span",{className:"font-medium",children:[Number(($=s==null?void 0:s.wallet_balance)!=null?$:0).toLocaleString()," Coins"]})]})})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mt-1.5 inline-flex items-center gap-2 relative",children:[e.jsxs("button",{type:"button",onClick:()=>Q(a=>!a),className:"px-2 py-0.5 rounded-full text-[11px] chip-accent-b focus:outline-none focus:ring-2 focus:ring-indigo-500/40",title:"Show next level info","aria-expanded":U,children:["Level ",v]}),U&&e.jsxs("div",{className:"absolute z-20 top-full left-0 mt-2 w-56 rounded-xl border border-slate-700/60 bg-slate-900/95 text-slate-100 shadow-xl p-3",children:[e.jsx("div",{className:"text-xs font-semibold mb-1",children:"Next Level Info"}),e.jsxs("div",{className:"text-[11px] text-slate-300 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Required"}),e.jsxs("span",{children:[Number(q.nextReq).toLocaleString()," coins"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"You have"}),e.jsxs("span",{children:[Number((s==null?void 0:s.total_coins)||0).toLocaleString()," coins"]})]})]})]})]}),e.jsxs("div",{className:"mt-1.5 relative h-2.5 bg-slate-800/70 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10"}),e.jsx("div",{className:"relative h-full bg-gradient-to-r from-indigo-500 via-purple-500 to-fuchsia-500 shadow-[0_0_12px_rgba(99,102,241,0.35)]",style:{width:`${M(s==null?void 0:s.total_coins,v)}%`}}),e.jsxs("span",{className:"absolute right-1 top-1/2 -translate-y-1/2 text-[10px] text-slate-300",children:[M(s==null?void 0:s.total_coins,v),"%"]})]}),e.jsx("div",{className:"mt-1 text-[11px] text-slate-400",children:"to next level"})]}),e.jsx("div",{className:"pt-2 mt-1 w-full border-t border-gray-100",children:e.jsx(_,{onClick:()=>E(!0),size:"sm",variant:"brand",className:"rounded-xl",children:"Edit Profile"})})]})]}),s&&e.jsxs("div",{className:"qd-card rounded-3xl p-4 shadow-xl space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-slate-100",children:[e.jsx(de,{className:"w-4 h-4 text-cyan-300"}),e.jsx("span",{children:"Referral Summary"})]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Invite friends and earn bonus coins when they join Quiz Dangal."})]}),e.jsx(_,{asChild:!0,variant:"outline",size:"sm",className:"rounded-xl border-cyan-500/40 text-cyan-200 hover:bg-cyan-900/30",children:e.jsxs(C,{to:"/refer",className:"inline-flex items-center gap-1",children:[e.jsx(D,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Refer & Earn"})]})})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/50 p-3",children:[e.jsx("div",{className:"text-[11px] uppercase text-slate-400 tracking-wide",children:"Your Code"}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-semibold text-emerald-200",children:(s==null?void 0:s.referral_code)||"—"}),e.jsx(_,{onClick:Z,variant:"outline",size:"icon",className:"h-8 w-8 border-emerald-500/40 text-emerald-200 hover:bg-emerald-900/30",children:W?e.jsx(xe,{className:"w-4 h-4"}):e.jsx(me,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/50 p-3",children:[e.jsx("div",{className:"text-[11px] uppercase text-slate-400 tracking-wide",children:"Friends Referred"}),e.jsx("div",{className:"mt-1 text-2xl font-extrabold text-cyan-200",children:Number((s==null?void 0:s.referral_count)||0)}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Track how many friends joined using your link."})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/50 p-3",children:[e.jsx("div",{className:"text-[11px] uppercase text-slate-400 tracking-wide",children:"Referred By"}),s!=null&&s.referred_by?e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[A?e.jsx("img",{src:A,alt:"Referrer avatar",className:"w-10 h-10 rounded-full object-cover border border-slate-700/60",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-800/70 border border-slate-700/60 flex items-center justify-center text-sm font-semibold text-slate-200",children:((o==null?void 0:o.username)||(o==null?void 0:o.id)||"?").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-100",children:o!=null&&o.username?`@${o.username}`:"Friend"}),(o==null?void 0:o.referral_code)&&e.jsxs("div",{className:"text-xs text-slate-400",children:["Code: ",o.referral_code]})]})]}):e.jsx("p",{className:"mt-2 text-sm text-slate-300",children:"You joined directly. Share your code above to earn referral coins."})]})]}),e.jsx("div",{className:"qd-card rounded-3xl p-3 shadow-xl",children:e.jsx("div",{className:"flex flex-col gap-3",children:ee.map((a,l)=>{const t=["chip-accent-d","chip-accent-a","chip-accent-b","chip-accent-c"][l%4],r=e.jsxs("div",{className:"group w-full flex items-center justify-between px-3.5 py-2.5 rounded-2xl border border-indigo-700/60 bg-indigo-900/40 hover:bg-indigo-900/60 transition shadow-sm hover:shadow-lg text-sm text-slate-100 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`w-9 h-9 rounded-xl ${t} group-hover:scale-[1.03] transition`,children:e.jsx(a.icon,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-semibold tracking-wide",children:a.label})]}),e.jsx(P,{className:"w-4 h-4 text-slate-500 group-hover:text-slate-300 transition"})]});return a.href?e.jsx(C,{to:a.href,tabIndex:0,className:"focus:outline-none focus:ring-2 focus:ring-indigo-500/40 rounded-2xl",children:r},l):e.jsx("button",{onClick:a.onClick,className:"text-left w-full focus:outline-none focus:ring-2 focus:ring-indigo-500/40 rounded-2xl",children:r},l)})})}),e.jsx("div",{className:"qd-card rounded-3xl p-3 shadow-xl",children:e.jsx("button",{onClick:G,className:"w-full text-left focus:outline-none focus:ring-2 focus:ring-red-500/30 rounded-2xl",children:e.jsxs("div",{className:"group w-full flex items-center justify-between px-3.5 py-2.5 rounded-2xl border border-rose-700/40 bg-rose-900/10 hover:bg-rose-900/20 transition shadow-sm hover:shadow-md text-sm text-rose-300 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-9 h-9 rounded-xl bg-rose-900/30 text-rose-300 flex items-center justify-center shadow-sm border border-rose-700/40 group-hover:scale-[1.03] transition",children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-semibold tracking-wide",children:"Logout"})]}),e.jsx(P,{className:"w-4 h-4 text-rose-400/70 group-hover:text-rose-300 transition"})]})})}),e.jsx(te,{isOpen:B,onClose:()=>{E(!1),N()},isFirstTime:!1})]})]})}export{Ce as default};
