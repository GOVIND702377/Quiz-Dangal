import{a as D,j as e,I as $,B as g,s as I}from"./index-ec0de953.js";import{r as c}from"./react-8a702e3e.js";import{g as O}from"./avatar-f7ea9f2a.js";import{G as q,C as v,q as U,$ as y,a0 as w,e as G}from"./icons-b32a7949.js";import"./supabase-4c1332f7.js";import"./router-bcacfb8d.js";import"./motion-511bde03.js";const K=()=>{const{user:u,userProfile:b}=D(),[k,C]=c.useState({total:0,earnings:0}),[d,_]=c.useState([]),[m,x]=c.useState(""),[T,S]=c.useState(!0),j=(b==null?void 0:b.referral_code)||"",l=`${window.location.origin}?ref=${j}`;c.useEffect(()=>{let a=!0;return(async()=>{if(u){S(!0);try{const{data:f,error:t}=await I.from("referrals").select("*").eq("referrer_id",u.id).order("created_at",{ascending:!1});if(t&&t.code!=="PGRST116")throw t;if(!a)return;let r=f||[];if(r.length){const i=Array.from(new Set(r.map(o=>o.referred_id).filter(Boolean)));if(i.length){const{data:o,error:E}=await I.rpc("profiles_public_by_ids",{p_ids:i});E&&console.warn("Referral profile lookup failed:",E);const A=o||[],z=new Map(A.map(n=>[n.id,n])),P=await O(A.map(n=>n.avatar_url).filter(Boolean));r=r.map(n=>{const p=z.get(n.referred_id);if(!p)return{...n,referred:null};const B=p.avatar_url&&P.get(p.avatar_url)||"";return{...n,referred:{...p,avatar_url:B}}})}}const R=r.length,N=r.reduce((i,o)=>i+(o.coins_awarded||0),0)||0;C({total:R,earnings:N}),_(r)}catch(f){if(!a)return;C({total:0,earnings:0}),_([])}finally{a&&S(!1)}}})(),()=>{a=!1}},[u]);const h=async(a,s)=>{try{await navigator.clipboard.writeText(a),x(s),setTimeout(()=>x(""),1600)}catch(f){const t=document.createElement("textarea");t.value=a,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),x(s),setTimeout(()=>x(""),1600)}},L=async()=>{const a={title:"Join Quiz Dangal",text:"Earn coins by playing quizzes! Use my referral to get started.",url:l};if(navigator.share&&(!navigator.canShare||navigator.canShare(a)))try{await navigator.share(a);return}catch(s){if(s&&(s.name==="AbortError"||s.name==="NotAllowedError"))return}try{const s=encodeURIComponent(`${a.text}
${a.url}`),f=/Android/i.test(navigator.userAgent),r=/iPhone|iPad|iPod/i.test(navigator.userAgent)?`https://wa.me/?text=${s}`:`whatsapp://send?text=${s}`;if(window.open(r,"_blank"))return;const N=`https://t.me/share/url?url=${encodeURIComponent(a.url)}&text=${encodeURIComponent(a.text)}`;if(window.open(N,"_blank"))return}catch(s){}h(l,"link")};return e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-2xl text-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(q,{className:"w-6 h-6 text-emerald-300"}),e.jsx("h1",{className:"text-2xl font-extrabold bg-gradient-to-r from-sky-400 via-cyan-400 to-emerald-400 bg-clip-text text-transparent tracking-tight",children:"Refer & Earn"})]}),e.jsx("div",{className:"rounded-2xl p-4 mb-6 bg-emerald-900/25 border border-emerald-600/30 backdrop-blur-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden hd-badge-coin relative shrink-0","aria-hidden":!0,children:e.jsxs("div",{className:"hd-badge-coin-front",children:[e.jsx(v,{className:"hd-badge-coin-icon"}),e.jsx("span",{className:"hd-badge-coin-shine"})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-extrabold tracking-wide",children:[e.jsx("span",{className:"text-amber-200",children:"Earn +50 coins"})," per referral"]}),e.jsx("div",{className:"text-sm text-emerald-100/90",children:"Coins are added after your friend signs up and completes their profile."})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"rounded-xl p-4 text-center bg-gradient-to-br from-sky-900/40 via-cyan-900/30 to-emerald-900/20 border border-cyan-600/40",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(U,{className:"w-4 h-4 text-cyan-300"}),e.jsx("span",{className:"text-2xl font-extrabold bg-gradient-to-r from-sky-300 via-cyan-300 to-emerald-300 bg-clip-text text-transparent",children:k.total})]}),e.jsx("p",{className:"text-xs sm:text-sm text-cyan-200/90 tracking-wide",children:"Friends Referred"})]}),e.jsxs("div",{className:"rounded-xl p-4 text-center bg-gradient-to-br from-amber-900/30 via-yellow-900/20 to-transparent border border-amber-600/40",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("span",{className:"relative inline-flex w-6 h-6 align-middle rounded-full overflow-hidden hd-badge-coin shrink-0",children:e.jsxs("span",{className:"hd-badge-coin-front",children:[e.jsx(v,{className:"hd-badge-coin-icon"}),e.jsx("span",{className:"hd-badge-coin-shine"})]})}),e.jsx("span",{className:"text-2xl font-extrabold bg-gradient-to-r from-amber-200 via-yellow-200 to-orange-200 bg-clip-text text-transparent",children:k.earnings})]}),e.jsx("p",{className:"text-xs sm:text-sm text-amber-200/90 tracking-wide",children:"Coins Earned"})]})]}),e.jsxs("div",{className:"space-y-2 mb-5",children:[e.jsx("h3",{className:"font-semibold text-slate-200",children:"Your Referral Code"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{value:j,readOnly:!0,className:"font-mono text-center text-lg font-bold bg-slate-900/60 border-slate-700/60 text-slate-100"}),e.jsx(g,{onClick:()=>h(j,"code"),variant:"outline",size:"sm",className:"px-3 border-cyan-500/50 text-cyan-200 hover:bg-cyan-900/30",children:m==="code"?e.jsx(y,{className:"w-4 h-4 text-emerald-300"}):e.jsx(w,{className:"w-4 h-4 text-cyan-300"})})]})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx("h3",{className:"font-semibold text-slate-200",children:"Your Referral Link"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{value:l,readOnly:!0,className:"text-sm bg-slate-900/60 border-slate-700/60 text-slate-100"}),e.jsx(g,{onClick:()=>h(l,"link"),variant:"outline",size:"sm",className:"px-3 border-cyan-500/50 text-cyan-200 hover:bg-cyan-900/30",children:m==="link"?e.jsx(y,{className:"w-4 h-4 text-emerald-300"}):e.jsx(w,{className:"w-4 h-4 text-cyan-300"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{onClick:L,className:"flex-1 bg-gradient-to-r from-indigo-500 via-violet-500 to-fuchsia-500 hover:opacity-90 border border-indigo-400/40",children:[e.jsx(G,{className:"w-4 h-4 mr-2"})," Share"]}),e.jsxs(g,{onClick:()=>h(l,"link"),variant:"outline",className:"flex-1 border-cyan-500/50 text-cyan-200 hover:bg-cyan-900/30",children:[m==="link"?e.jsx(y,{className:"w-4 h-4 mr-2 text-emerald-300"}):e.jsx(w,{className:"w-4 h-4 mr-2 text-cyan-300"})," ",m==="link"?"Copied!":"Copy Link"]})]}),!T&&(d.length>0?e.jsxs("div",{className:"space-y-3 mt-6",children:[e.jsx("h3",{className:"font-semibold text-slate-200",children:"Recent Referrals"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:d.slice(0,8).map(a=>{var s;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-900/60 rounded-lg border border-slate-700/60",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:((s=a.referred)==null?void 0:s.username)||"New User"}),e.jsx("div",{className:"text-xs text-slate-400",children:new Date(a.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-1 text-emerald-300",children:[e.jsx("span",{className:"relative inline-flex w-5 h-5 align-middle rounded-full overflow-hidden hd-badge-coin shrink-0",children:e.jsxs("span",{className:"hd-badge-coin-front",children:[e.jsx(v,{className:"hd-badge-coin-icon"}),e.jsx("span",{className:"hd-badge-coin-shine"})]})}),e.jsxs("span",{className:"font-bold",children:["+",a.coins_awarded]})]})]},a.id)})}),d.length>8&&e.jsxs("p",{className:"text-xs text-slate-400",children:["And ",d.length-8," more referralsâ€¦"]})]}):e.jsxs("div",{className:"text-center py-8 text-slate-400 mt-6",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-2 text-slate-500"}),e.jsx("p",{className:"text-slate-200",children:"No referrals yet"}),e.jsx("p",{className:"text-sm",children:"Start sharing your link to earn coins!"})]}))]})})};export{K as default};
