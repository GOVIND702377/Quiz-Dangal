import{u as _,a as N,s as y,j as s,S as q}from"./index-e762386f.js";import{r as a}from"./react-8a702e3e.js";import{a as S}from"./router-bcacfb8d.js";import{b as k,B as C,T as L,c as T}from"./icons-3e0b0f01.js";import{m as E}from"./motion-511bde03.js";import"./supabase-4c1332f7.js";const $=[{title:"Opinion",slug:"opinion",icon:k},{title:"G.K Knowledge",slug:"gk",icon:C},{title:"Sports",slug:"sports",icon:L},{title:"Movies",slug:"movies",icon:T}],P=({tile:o,quizzes:u,onJoin:b,index:f,joiningId:w,onOpenList:j,navigateTo:g})=>{const m=Date.now(),h=u.filter(e=>(e.category||"").toLowerCase()===o.slug.toLowerCase()).filter(e=>{const i=e.start_time?new Date(e.start_time).getTime():0,n=e.end_time?new Date(e.end_time).getTime():0,d=i&&n&&m>=i&&m<n,z=i&&m<i;return d||z}).sort((e,i)=>new Date(e.start_time||e.end_time||0)-new Date(i.start_time||i.end_time||0)),r=h[0],x=h.length;w&&r&&r.id;const v=o.icon,p=["neon-orange","neon-purple","neon-teal","neon-pink"],l=[{from:"from-rose-500",to:"to-amber-400"},{from:"from-violet-500",to:"to-indigo-400"},{from:"from-emerald-500",to:"to-teal-400"},{from:"from-sky-500",to:"to-cyan-400"}],c=l[f%l.length],t="PLAY";return s.jsxs(E.button,{type:"button",initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},transition:{duration:.25,delay:f*.06},onClick:()=>g(o.slug),className:`neon-card ${p[f%p.length]} group aspect-square w-full rounded-xl focus:outline-none will-change-transform transform-gpu transition-transform hover:scale-[1.02] hover:shadow-xl relative`,style:{borderRadius:"0.75rem"},"aria-label":`${o.title} - Play`,children:[s.jsx("div",{className:"absolute top-1.5 right-1.5 z-10",children:s.jsx("div",{className:`relative rounded-lg p-[1px] bg-gradient-to-r ${c.from} ${c.to} shadow-[0_4px_10px_rgba(0,0,0,0.35)]`,children:s.jsxs("div",{className:"rounded-[9px] bg-slate-950/70 backdrop-blur-md px-2 py-1 flex items-center gap-1 border border-white/10",children:[s.jsxs("div",{className:"relative w-5 h-5",children:[s.jsx("div",{className:`absolute -inset-0.5 rounded-full blur-[6px] opacity-80 bg-gradient-to-r ${c.from} ${c.to}`,"aria-hidden":!0}),s.jsx("div",{className:"relative w-5 h-5 rounded-full grid place-items-center bg-black/40 border border-white/20 text-white text-[10px] font-extrabold",children:x})]}),s.jsx("span",{className:"text-[9px] font-semibold uppercase tracking-wider text-white/90",children:x===1?"Quiz":"Quizzes"})]})})}),s.jsx("div",{className:"neon-card-content select-none flex items-center justify-center",children:s.jsxs("div",{className:"w-full flex flex-col items-center justify-center gap-2",children:[s.jsx(v,{className:"w-8 h-8 text-white drop-shadow"}),s.jsx("h3",{className:"text-base font-extrabold leading-tight text-white text-shadow-sm text-center",children:o.title}),s.jsx("span",{className:"play-pill group-hover:shadow-lg group-hover:brightness-110",children:t})]})})]})},R=()=>{const{toast:o}=_(),u=S(),{user:b,userProfile:f,refreshUserProfile:w}=N(),[j,g]=a.useState([]),[m,h]=a.useState(!0),[r,x]=a.useState({open:!1,day:0,coins:0});a.useRef(!1);const[v,p]=a.useState(null),l=a.useCallback(async()=>{try{const{data:t,error:e}=await y.from("quizzes").select("id,title,category,start_time,end_time,status,prize_pool,prizes").order("start_time",{ascending:!0});if(e)throw e;g(t||[])}catch(t){console.error(t),o({title:"Error",description:"Could not fetch quizzes.",variant:"destructive"}),g([])}finally{h(!1)}},[o]);a.useEffect(()=>{l();const t=setInterval(l,6e4);return()=>clearInterval(t)},[l]);const c=async t=>{if(!(!t||v===t.id)){if(!b){o({title:"Login required",description:"Please sign in to join the quiz.",variant:"destructive"}),u("/login");return}p(t.id);try{const e=t.status==="upcoming"?"pre_join_quiz":"join_quiz",{data:i,error:n}=await y.rpc(e,{p_quiz_id:t.id});if(n)throw n;if(t.status==="upcoming")o({title:"Pre-joined!",description:"We will remind you 1 minute before start."});else{if(i&&i!=="Joined Successfully")throw new Error(i);o({title:"Joined!",description:"Redirecting you to the quiz."}),u(`/quiz/${t.id}`)}}catch(e){const i=String((e==null?void 0:e.message)||"").toLowerCase();let n=(e==null?void 0:e.message)||"Could not join quiz.",d="Error";i.includes("not authenticated")?(d="Login required",n="Please sign in to join the quiz."):i.includes("insufficient balance")?(d="Insufficient balance",n="You do not have enough coins to join this quiz."):i.includes("quiz not active")&&(d="Quiz not active",n="This quiz is not active right now."),o({title:d,description:n,variant:"destructive"})}finally{p(null)}}};return s.jsxs("div",{className:"h-full relative overflow-hidden",children:[s.jsx("div",{className:"relative z-10 h-full flex items-center justify-center px-4 mt-1 sm:mt-2 mb-6",children:s.jsx("div",{className:"w-full max-w-[420px]",children:s.jsx("div",{className:"grid grid-cols-2 gap-3",children:m?Array.from({length:4}).map((t,e)=>s.jsx("div",{className:"aspect-square w-full rounded-xl bg-slate-800/60 border border-slate-700/60 animate-pulse"},e)):$.map((t,e)=>s.jsx(P,{tile:t,quizzes:j,onJoin:c,index:e,joiningId:v,navigateTo:i=>u(`/category/${i}`)},t.slug))})})}),s.jsx(q,{open:r.open,day:r.day,coins:r.coins,onClose:()=>x(t=>({...t,open:!1}))})]})};export{R as default};
