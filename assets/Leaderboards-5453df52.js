import{a as M,s as c,j as e}from"./index-9ff65d13.js";import{r as d}from"./react-8a702e3e.js";import{a as q,u as z}from"./router-bcacfb8d.js";import{m,A as O}from"./motion-511bde03.js";import{Y as P,L as Y,Z,i as D}from"./icons-c5cbdee3.js";import"./supabase-4c1332f7.js";const H=[{key:"all_time",label:"All-time"},{key:"monthly",label:"Monthly"},{key:"weekly",label:"Weekly"}];function Q(){const{search:b}=z();return d.useMemo(()=>new URLSearchParams(b),[b])}function X(){var C;const b=q(),{userProfile:x}=M(),g=Q().get("period")||"all_time",[o,A]=d.useState([]),[j,N]=d.useState(!0),[p,k]=d.useState(""),[w,F]=d.useState(""),_=d.useCallback(async t=>{N(!0),k("");try{if(!c)throw new Error("Supabase not configured");let a=[];if(t==="all_time"){let{data:r,error:l}=await c.rpc("get_all_time_leaderboard_v2",{limit_rows:100,offset_rows:0,max_streak_limit:30});if(l&&({data:r,error:l}=await c.rpc("get_all_time_leaderboard",{limit_rows:100,offset_rows:0,max_streak_limit:30})),l)try{const i=await c.rpc("get_all_time_leaderboard",{limit_rows:100,offset_rows:0});if(i.error)throw i.error;const s=i.data||[];s.length&&Object.prototype.hasOwnProperty.call(s[0]||{},"coins_earned")?a=s.map(n=>{var u,h,L,S,E,R,T;return{user_id:n.user_id,username:(u=n.username)!=null?u:null,full_name:(h=n.full_name)!=null?h:null,avatar_url:(L=n.avatar_url)!=null?L:null,leaderboard_score:Number((S=n.coins_earned)!=null?S:0),win_rate:null,streak:(R=(E=n.current_streak)!=null?E:n.streak)!=null?R:0,rank:Number((T=n.rank)!=null?T:0)}}):a=s}catch(i){const s=await c.rpc("get_leaderboard",{p_period:"all_time",limit_rows:100,offset_rows:0});if(s.error)throw s.error;a=s.data||[]}else a=r||[]}else{const r=t==="weekly"?7:30;let{data:l,error:i}=await c.rpc("get_leaderboard_v2",{p_period:t,limit_rows:100,offset_rows:0,max_streak_limit:r});if(i&&({data:l,error:i}=await c.rpc("get_leaderboard",{p_period:t,limit_rows:100,offset_rows:0,max_streak_limit:r})),i){const s=await c.rpc("get_leaderboard",{p_period:t,limit_rows:100,offset_rows:0});if(s.error)throw s.error;a=s.data||[]}else a=l||[]}A(a)}catch(a){const r=a.message||"Failed to load leaderboard.";console.error("Leaderboard fetch error:",a),k(r)}finally{N(!1)}},[]);d.useEffect(()=>{_(g)},[g,_]);const I=t=>{b(`?period=${t}`)},y=d.useMemo(()=>{const t=w.trim().toLowerCase();return t?o.filter(a=>(a.username||a.full_name||"").toLowerCase().includes(t)):o},[o,w]),v=d.useMemo(()=>x!=null&&x.id?o.findIndex(t=>t.user_id===x.id):-1,[o,x]),f=v>=0?o[v]:null,$=v>=0?v+1:null;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 -z-10 opacity-60 mix-blend-screen [background-image:radial-gradient(circle_at_18%_28%,rgba(99,102,241,0.35),rgba(0,0,0,0)60%),radial-gradient(circle_at_82%_72%,rgba(168,85,247,0.30),rgba(0,0,0,0)65%),radial-gradient(circle_at_50%_50%,rgba(236,72,153,0.18),rgba(0,0,0,0)55%)]"}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8 space-y-7",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m.div,{className:"relative w-8 h-8 shrink-0",initial:{rotate:-3,y:0},animate:{rotate:[-3,3,-3],y:[0,-2,0]},transition:{duration:2.4,ease:"easeInOut",repeat:1/0},children:[e.jsx("span",{"aria-hidden":!0,className:"pointer-events-none absolute -inset-1 rounded-full bg-[radial-gradient(circle,rgba(255,215,0,0.35),rgba(0,0,0,0))] blur-[2px]",style:{zIndex:0}}),e.jsx(m.img,{src:"/Trophy.png",alt:"Trophy",className:"absolute inset-0 w-full h-full object-contain drop-shadow-md select-none",onError:t=>{t.currentTarget.getAttribute("data-tried-lower")?t.currentTarget.src="/android-chrome-512x512.png":(t.currentTarget.setAttribute("data-tried-lower","1"),t.currentTarget.src="/trophy.png")},decoding:"async",loading:"eager",style:{zIndex:1},whileHover:{scale:1.05},transition:{type:"spring",stiffness:250,damping:18}})]}),e.jsx("h1",{className:"text-3xl font-extrabold text-white text-shadow tracking-tight",children:"Leaderboards"})]}),e.jsx("p",{className:"text-slate-200/85 text-sm",children:"Top players by performance & consistency"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mt-3",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:H.map(t=>e.jsx("button",{onClick:()=>I(t.key),className:`px-4 py-2 rounded-full text-xs font-semibold tracking-wide border transition shadow-sm ${g===t.key?"bg-accent-b text-white border-accent-b shadow":"bg-slate-800/80 text-slate-200 border-slate-700 hover:bg-slate-800"} `,children:t.label},t.key))}),e.jsxs("div",{className:"relative w-full sm:w-72",children:[e.jsx(P,{className:"w-4 h-4 text-slate-100 absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none"}),e.jsx("input",{value:w,onChange:t=>F(t.target.value),placeholder:"Search players...",className:"pl-9 pr-3 h-11 w-full rounded-xl bg-slate-800/80 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 text-base sm:text-[13px] font-medium text-slate-100 placeholder:text-slate-400 shadow"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-xl ring-1 ring-inset ring-white/5"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-xl ring-1 ring-inset ring-white/5"})]})]}),e.jsx(O,{children:!j&&!p&&o.length>=1&&e.jsx(m.div,{layout:!0,className:"grid grid-cols-3 gap-4",children:[2,1,3].map((t,a)=>{var s;const r=o[t-1];if(!r)return e.jsx("div",{},`podium-empty-${a}`);const l=t===1?"h-48":t===2?"h-40":"h-36",i=t===1?{circle:"bg-[linear-gradient(140deg,#fff9db_0%,#f9e27a_25%,#f6c84f_55%,#f9e27a_75%,#fff9db_100%)] text-amber-800",card:"from-[#72542140] via-[#ffd36b14] to-[#5b3b7a40]",border:"border-amber-300/60"}:t===2?{circle:"bg-[linear-gradient(145deg,#f5f7fa_0%,#d9e2ec_30%,#c2ccd6_55%,#e4ebf2_85%,#ffffff_100%)] text-slate-700",card:"from-[#42506a40] via-[#bcc7d214] to-[#4a3a7a40]",border:"border-slate-300/50"}:{circle:"bg-[linear-gradient(140deg,#ffe7d0_0%,#ffc891_25%,#f7a350_55%,#ffc891_78%,#ffe7d0_100%)] text-orange-800",card:"from-[#6b3f2640] via-[#ffb77414] to-[#5b367a40]",border:"border-orange-300/50"};return e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`relative flex items-end justify-center rounded-2xl ${l} overflow-hidden border ${i.border} bg-slate-800/80 shadow-xl`,children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute -top-1/3 left-1/4 w-2/3 h-full rotate-12 bg-gradient-to-b from-white/25 via-transparent to-transparent opacity-40"}),e.jsx("div",{className:"absolute inset-0 opacity-40 mix-blend-overlay bg-[radial-gradient(circle_at_65%_25%,rgba(124,58,237,0.55),rgba(255,255,255,0)_60%)]"})]}),e.jsxs("div",{className:"relative w-full p-3 flex flex-col items-center gap-2",children:[t===1?e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-black shadow-[0_4px_14px_-4px_rgba(0,0,0,0.6)] ring-2 ring-indigo-300/50 backdrop-blur ${i.circle}`,children:"ðŸ¥‡"}):e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-black shadow-[0_4px_14px_-4px_rgba(0,0,0,0.6)] ring-2 ring-indigo-300/50 backdrop-blur ${i.circle}`,children:t===2?"ðŸ¥ˆ":"ðŸ¥‰"}),e.jsx("div",{className:"text-[11px] font-semibold tracking-wide text-white max-w-full truncate",children:r.username?`@${r.username}`:r.full_name||"Anonymous"}),e.jsxs("div",{className:"text-[11px] font-semibold tracking-wider text-slate-100 flex items-center gap-1",children:[e.jsx("span",{className:"font-mono text-[12px] bg-gradient-to-r from-indigo-200 via-fuchsia-200 to-violet-200 bg-clip-text text-transparent drop-shadow-sm",children:((s=r.leaderboard_score)!=null?s:0).toFixed(2)}),e.jsx("span",{className:"text-slate-200/80",children:"SCORE"})]})]})]},t)})})}),!j&&!p&&f&&e.jsx("div",{className:"p-4 rounded-2xl qd-card shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 via-violet-500 to-fuchsia-600 text-white font-bold flex items-center justify-center shadow-lg ring-2 ring-indigo-400/40",children:$}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-white text-sm",children:f.username?`@${f.username}`:f.full_name||"You"}),e.jsx("div",{className:"text-[11px] text-slate-300/85 uppercase tracking-wide",children:"Your Position"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-base font-bold font-mono bg-gradient-to-r from-indigo-100 via-fuchsia-200 to-violet-200 bg-clip-text text-transparent drop-shadow-sm tracking-tight",children:Number((C=f.leaderboard_score)!=null?C:0).toFixed(2)}),e.jsx("div",{className:"text-[11px] font-semibold text-slate-200/95 uppercase tracking-wider drop-shadow",children:"Score"})]})]})}),e.jsxs("div",{className:"p-4 rounded-2xl qd-card shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute -top-20 -right-24 w-72 h-72 bg-gradient-to-br from-indigo-500/25 via-violet-500/25 to-fuchsia-500/25 opacity-40 rounded-full blur-3xl"}),j?e.jsxs("div",{className:"py-12 flex flex-col items-center text-indigo-300/80",children:[e.jsx(Y,{className:"h-8 w-8 animate-spin text-indigo-300 mb-3"}),"Loading leaderboard..."]}):p?e.jsxs("div",{className:"py-10 text-center",children:[e.jsx("div",{className:"text-red-400 font-medium mb-3",children:p}),e.jsx("button",{onClick:()=>_(g),className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-indigo-600 text-white hover:bg-indigo-700",children:"Retry"})]}):y.length===0?e.jsx("div",{className:"py-10 text-center text-indigo-200/80",children:w.trim()?e.jsx(e.Fragment,{children:"No players match your search."}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:"No leaderboard data yet for this period."}),e.jsx("div",{className:"text-indigo-100/80 text-sm",children:"Tips: Choose All-time, ensure quizzes are finished and results computed, or tap refresh."}),e.jsx("div",{children:e.jsx("button",{onClick:()=>_(g),className:"px-3 py-1.5 rounded-lg text-sm font-medium bg-indigo-600 text-white hover:bg-indigo-700",children:"Refresh"})})]})}):e.jsxs(m.div,{layout:!0,className:"flex flex-col gap-3",children:[y.map((t,a)=>{var u,h;const r=t.rank||a+1,l=$===r,i=r<=3,s=Math.min(100,t.win_rate||0),n=t.username?`@${t.username}`:t.full_name||"Anonymous";return e.jsxs(m.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},layout:!0,className:`group relative rounded-xl overflow-hidden border pr-4 transition shadow-sm hover:shadow-lg ${l?"ring-2 ring-indigo-400/60 border-indigo-400":"border-slate-700"} bg-slate-800/70`,children:[e.jsx("span",{className:`absolute inset-y-0 left-0 w-1 ${i?"bg-amber-400":"bg-indigo-500"} opacity-90`}),e.jsx("span",{className:"absolute inset-0 pointer-events-none opacity-0 group-hover:opacity-60 transition mix-blend-overlay",style:{background:i?"radial-gradient(circle_at_70%_35%,rgba(252,211,77,0.4),rgba(0,0,0,0)60%)":"linear-gradient(95deg, rgba(99,102,241,0.18), rgba(139,92,246,0.16), rgba(236,72,153,0.14))"}}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 p-3 pl-4",children:[e.jsx("div",{className:`w-11 h-11 rounded-xl flex items-center justify-center font-semibold text-[13px] shadow-lg ${i?"bg-amber-400 text-amber-900":"bg-indigo-600 text-white"} ${l?"ring-2 ring-indigo-300/60":""}`,children:r}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`font-semibold truncate transition tracking-wide ${l?"text-white":"text-slate-100 group-hover:text-white"}`,children:n}),e.jsxs("div",{className:"mt-1 flex items-center gap-5 text-[11px] text-slate-300/85 font-medium",children:[e.jsx("span",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"tabular-nums font-mono",children:[Number((u=t.win_rate)!=null?u:0).toFixed(1),"%"]})}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3 text-fuchsia-200"})," ",e.jsx("span",{className:"tabular-nums font-mono",children:t.streak||0})]})]}),e.jsx("div",{className:"mt-2 h-1.5 w-full rounded-full bg-indigo-100/40 overflow-hidden ring-1 ring-indigo-100/60",children:e.jsx("span",{style:{width:s+"%"},className:"block h-full rounded-full bg-[linear-gradient(90deg,#4338ca,#6366f1,#8b5cf6,#d946ef)] shadow-[0_0_10px_-1px_rgba(139,92,246,0.65)]"})})]})]}),e.jsxs("div",{className:"absolute top-3 right-3 text-right text-sm font-bold",children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-50 via-fuchsia-100 to-violet-100 bg-clip-text text-transparent drop-shadow-sm font-mono tabular-nums tracking-tight",children:Number((h=t.leaderboard_score)!=null?h:0).toFixed(2)}),e.jsx("div",{className:"text-[11px] font-semibold text-slate-200/95 tracking-wider drop-shadow",children:"Score"})]})]},t.user_id||`row-${r}-${a}`)}),e.jsxs("div",{className:"flex justify-end text-[11px] uppercase tracking-wide text-indigo-400/70 mt-2 items-center",children:["Showing ",y.length," of ",o.length,e.jsx(D,{className:"w-3 h-3 ml-1"})]})]})]})]})]})}export{X as default};
