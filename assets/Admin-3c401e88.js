import{j as e,k as Ee,u as ee,a as qe,s as d,H as ue,h as Pe,B as f,A as he,m as W,L as C,I as P,o as G}from"./index-ca690398.js";import{a as N,r as R}from"./react-63c462fe.js";import{d as Le,L as Qe}from"./router-10fed1f4.js";import{L as F,Y as ae,Z as De,m as Ie,u as Te,_ as $e,$ as Fe}from"./icons-590232b1.js";import"./supabase-07ebd5d8.js";const ie=N.forwardRef(({className:n,...h},z)=>e.jsx("textarea",{ref:z,className:Ee("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",n),...h}));ie.displayName="Textarea";const fe=[{value:"opinion",label:"Opinion"},{value:"gk",label:"General Knowledge"},{value:"sports",label:"Sports"},{value:"movies",label:"Movies"}],ge=n=>{var h;return((h=fe.find(z=>z.value===n))==null?void 0:h.label)||n},K=()=>({text:"",options:["","",""],correctIndex:0});function X(n,h,{fallback:z=0}={}){return h==null&&(h=z),n==="coins"?`${h} coins`:n==="others"?`${h}`:`â‚¹${h}`}function Me(n,{allowZeroCorrect:h=!1}={}){var S,Q;const z=String(n||"").trim().split(/\n\s*\n+/),k=[],L=[],y=[];let j=0;for(const w of z){const E=w.split(/\r?\n/).map(c=>c.trim()).filter(Boolean);if(!E.length)continue;j+=1;const q=E[0].replace(/^Q\d*\.?\s*/i,"").replace(/^Question\s*[:-]\s*/i,""),v=[];let A="";for(let c=1;c<E.length;c++){const u=E[c];if(/^ans(wer)?\s*[:-]/i.test(u)){A=u;continue}const a=u.match(/^[-*â€¢]?\s*\[(x|X| )\]\s*(.+)$/);if(a){v.push({option_text:a[2].trim(),is_correct:/x/i.test(a[1])});continue}const i=u.match(/^(?:[-*â€¢]|[A-Da-d]\)|\d+\)|[A-Da-d][.:])\s*(.+)$/),r=i?i[1].trim():u.replace(/^[*]\s*/,"").trim();r&&v.push({option_text:r,is_correct:/^\*/.test(u)})}if(A){const c=A.split(/[:-]/).slice(1).join(":").trim(),u=(Q=(S=c.match(/^[A-D]/i))==null?void 0:S[0])==null?void 0:Q.toUpperCase(),a=u?{A:0,B:1,C:2,D:3}[u]:NaN,i=parseInt(c,10);if(!Number.isNaN(a)&&v[a])v.forEach((r,p)=>r.is_correct=p===a);else if(!Number.isNaN(i)&&v[i-1])v.forEach((r,p)=>r.is_correct=p===i-1);else{const r=c.toLowerCase(),p=v.findIndex(b=>b.option_text.toLowerCase()===r||b.option_text.toLowerCase().includes(r));p>=0&&v.forEach((b,$)=>b.is_correct=$===p)}}let o=v.filter(c=>c.option_text);if(o.length>4){const c=o.findIndex(u=>u.is_correct);if(c>=0){const u=o[c],a=o.filter((i,r)=>r!==c);o=[u,...a.slice(0,3)]}else o=o.slice(0,4);y.push(`Q${j}: Trimmed to 4 options.`)}if(!q){L.push(`Q${j}: Missing question text.`);continue}if(o.length<2){L.push(`Q${j}: Need at least 2 options.`);continue}if(h)o=o.map(c=>({...c,is_correct:!1}));else{const c=o.filter(u=>u.is_correct).length;if(c===0)o[0].is_correct=!0;else if(c>1){let u=!1;o=o.map(a=>a.is_correct&&!u?(u=!0,a):{...a,is_correct:!1})}}k.push({question_text:q,options:o})}return{items:k,errors:L,warnings:y}}function Je(){var de;const{toast:n}=ee(),{userProfile:h,loading:z,user:k}=qe(),[L,y]=Le(),j=L.get("tab")||"overview",S=s=>{L.set("tab",s),y(L,{replace:!0})},[Q,w]=R.useState([]),[E,q]=R.useState(!1),[v,A]=R.useState(!1),[o,c]=R.useState({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),[u,a]=R.useState("form"),[i,r]=R.useState([K()]),[p,b]=R.useState(null),[$,M]=R.useState([]),[B,re]=R.useState(null),[ve,ye]=R.useState(!1),O=o.category==="opinion",je=R.useMemo(()=>{try{const s=String({}.VITE_ADMIN_EMAILS||"").trim();return s?new Set(s.split(/[\s,]+/).map(t=>t.trim().toLowerCase()).filter(Boolean)):new Set}catch(s){return new Set}},[]),be=String((h==null?void 0:h.role)||"").trim().toLowerCase(),ne=String((k==null?void 0:k.email)||"").trim().toLowerCase(),_e=String(((de=k==null?void 0:k.app_metadata)==null?void 0:de.role)||"").trim().toLowerCase(),D=be==="admin"||_e==="admin"||ne&&je.has(ne),Y=R.useCallback(async()=>{if(!D){q(!1),w([]);return}if(q(!0),!d){w([]),q(!1);return}const{data:s,error:t}=await d.from("quizzes").select("id,title,category,prizes,prize_pool,prize_type,start_time,end_time").order("start_time",{ascending:!1});t?n({title:"Fetch failed",description:t.message,variant:"destructive"}):w(s||[]),q(!1)},[n,D]),we=R.useCallback(async s=>{if(!D){M([]);return}if(!d){M([]);return}const{data:t,error:m}=await d.from("questions").select("id,question_text,options(id,option_text,is_correct)").eq("quiz_id",s);m?n({title:"Questions failed",description:m.message,variant:"destructive"}):M(t||[])},[n,D]);R.useEffect(()=>{z||Y()},[Y,z]);const Ne=async s=>{s.preventDefault();try{if(!D){n({title:"Access denied",description:"Only admins can create quizzes.",variant:"destructive"});return}const t=[];o.category||t.push("Select category"),o.title.trim()||t.push("Title required"),(!o.start_time||!o.end_time)&&t.push("Start & End time required");const m=new Date(o.start_time);new Date(o.end_time)<=m&&t.push("End after start");const l=parseInt(o.prizes[0]||"",10);if((Number.isNaN(l)||l<=0)&&t.push("1st prize invalid"),t.length){n({title:"Fix form",description:t[0],variant:"destructive"});return}const g=i.map(T=>{const H=(T.options||[]).map(te=>te.trim()).filter(Boolean).slice(0,4);if(!T.text.trim()||H.length<2)return null;const Ae=Math.min(Math.max(T.correctIndex||0,0),H.length-1);return{question_text:T.text.trim(),options:H.map((te,Re)=>({option_text:te,is_correct:O?!1:Re===Ae}))}}).filter(Boolean);if(!g.length){n({title:"Add questions",variant:"destructive"});return}const _=o.prizes.filter(T=>T).map(T=>parseInt(T,10)),I=_.reduce((T,H)=>T+H,0),Z=o.prize_type==="money"&&I>0?"coins":o.prize_type,J={title:o.title.trim(),category:o.category,start_time:new Date(o.start_time).toISOString(),end_time:new Date(o.end_time).toISOString(),prizes:_,prize_pool:I,prize_type:Z};if(!d)throw new Error("Supabase config missing");const{data:me,error:xe}=await d.from("quizzes").insert([J]).select().single();if(xe)throw xe;n({title:"Quiz created",description:me.title});const pe=await ke(me.id,g,"replace");pe.ok?n({title:"Questions added",description:`${g.length} questions`}):n({title:"Question insert fallback",description:pe.message||"Failed",variant:"destructive"}),A(!1),c({title:"",category:"",start_time:"",end_time:"",prizes:["","",""],prize_type:"coins",bulk:""}),r([K()]),Y()}catch(t){n({title:"Create failed",description:t.message,variant:"destructive"})}},ke=async(s,t,m="append")=>{var x;if(!D)return{ok:!1,message:"Admin access required"};if(!d)return{ok:!1,message:"No Supabase client"};try{const{data:l}=await d.auth.getSession(),g=(x=l==null?void 0:l.session)==null?void 0:x.access_token,_=await fetch("/functions/v1/admin-upsert-questions",{method:"POST",headers:{"Content-Type":"application/json",...g?{Authorization:`Bearer ${g}`}:{}},body:JSON.stringify({quizId:s,items:t,mode:m})});if(_.ok)return{ok:!0};if(_.status!==404){const I=await _.json().catch(()=>({}));throw new Error((I==null?void 0:I.error)||`HTTP ${_.status}`)}}catch(l){console.warn("Edge bulk insert failed, falling back to direct RPC path",l)}try{const{error:l}=await d.rpc("admin_bulk_upsert_questions",{p_quiz_id:s,p_payload:t,p_mode:m});if(!l)return{ok:!0};console.warn("admin_bulk_upsert_questions RPC returned error, using manual inserts",l==null?void 0:l.message)}catch(l){console.warn("admin_bulk_upsert_questions RPC threw, using manual inserts",l)}m==="replace"&&await d.from("questions").delete().eq("quiz_id",s);for(const l of t){const{data:g,error:_}=await d.from("questions").insert({quiz_id:s,question_text:l.question_text}).select("id").single();if(_)return{ok:!1,message:_.message};const I=l.options.map(J=>({question_id:g.id,option_text:J.option_text,is_correct:!!J.is_correct})),{error:Z}=await d.from("options").insert(I);if(Z)return{ok:!1,message:Z.message}}return{ok:!0}},Se=async s=>{if(!window.confirm("Delete this quiz?"))return;if(!D){n({title:"Access denied",description:"Only admins can delete quizzes.",variant:"destructive"});return}if(!d)return;const{error:t}=await d.from("quizzes").delete().eq("id",s);t?n({title:"Delete failed",description:t.message,variant:"destructive"}):(n({title:"Deleted"}),Y())},Ce=async s=>{if(!D){n({title:"Access denied",description:"Only admins can recompute results.",variant:"destructive"});return}if(d)try{re(s);const{error:t}=await d.rpc("admin_recompute_quiz_results",{p_quiz_id:s});if(t)throw t;try{await d.rpc("compute_results_if_due",{p_quiz_id:s})}catch(m){}n({title:"Recomputed"})}catch(t){n({title:"Recompute failed",description:t.message,variant:"destructive"})}finally{re(null)}},le=R.useMemo(()=>{const s=Date.now(),t=[],m=[];for(const x of Q){const l=x.end_time?new Date(x.end_time).getTime():null;l!==null&&s>l?m.push(x):t.push(x)}return{active:t,finished:m}},[Q]),[se,U]=R.useState([]),[ce,oe]=R.useState(!1),V=R.useCallback(async()=>{if(!D){U([]);return}if(!d){U([]);return}oe(!0);try{const{data:s,error:t}=await d.from("redemptions").select("id,user_id,reward_value,reward_type,coins_required,payout_identifier,payout_channel,requested_at, profiles(username,full_name)").eq("status","pending").order("requested_at",{ascending:!1});if(t)throw t;U(s||[])}catch(s){U([])}finally{oe(!1)}},[D]),ze=R.useCallback(async s=>{if(D&&d){U(t=>t.filter(m=>m.id!==s));try{const{error:t}=await d.rpc("admin_approve_redemption",{p_redemption_id:s});if(t)throw t;n({title:"Approved",description:"Redemption approved."})}catch(t){n({title:"Approve failed",description:t.message,variant:"destructive"}),V()}}},[D,V,n]);return R.useEffect(()=>{V();const s=setInterval(V,3e4);return()=>clearInterval(s)},[V]),z?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(F,{className:"w-8 h-8 text-indigo-600 animate-spin"})}):D?e.jsxs("div",{className:"container mx-auto p-6 max-w-5xl bg-white text-gray-900 rounded-2xl shadow-sm",children:[e.jsxs(ue,{children:[e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{rel:"canonical",href:"https://quizdangal.com/admin"})]}),e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Admin Dashboard"}),!Pe&&e.jsx("div",{className:"mb-6 text-sm text-amber-600",children:"Supabase env keys missing. Read-only UI only."}),e.jsx("div",{className:"flex gap-2 mb-6 flex-wrap",children:["overview","automation","rewards","approvals","notifications"].map(s=>e.jsx("button",{onClick:()=>S(s),className:`px-3 py-1.5 rounded border text-sm transition-colors ${s===j?"bg-indigo-600 text-white border-indigo-600":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"}`,children:s},s))}),j==="overview"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{children:e.jsxs(f,{onClick:()=>A(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"New Quiz"]})}),e.jsx(he,{children:v&&e.jsxs(W.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},className:"bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Create Quiz"}),e.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{className:"mb-1 block",children:"Category"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:fe.map(({value:s,label:t})=>e.jsx("button",{type:"button",onClick:()=>c(m=>({...m,category:s})),className:`px-3 py-1 rounded-full text-xs border ${o.category===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:t},s))})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Title"}),e.jsx(P,{value:o.title,onChange:s=>c(t=>({...t,title:s.target.value})),placeholder:"Daily Quiz",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Prize Type"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["money","coins","others"].map(s=>e.jsx("button",{type:"button",onClick:()=>c(t=>({...t,prize_type:s})),className:`px-2 py-1 rounded text-xs border ${o.prize_type===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},s))})]})]}),e.jsx("div",{className:"grid md:grid-cols-3 gap-2",children:o.prizes.map((s,t)=>e.jsx(P,{value:s,placeholder:`${t+1}${["st","nd","rd"][t]||"th"} Prize`,onChange:m=>c(x=>{const l=[...x.prizes];return l[t]=m.target.value,{...x,prizes:l}})},t))}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Start Time"}),e.jsx(P,{type:"datetime-local",value:o.start_time,onChange:s=>c(t=>({...t,start_time:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{children:"End Time"}),e.jsx(P,{type:"datetime-local",value:o.end_time,onChange:s=>c(t=>({...t,end_time:s.target.value})),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Questions Mode"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["form","paste"].map(s=>e.jsx("button",{type:"button",onClick:()=>a(s),className:`px-3 py-1 rounded text-xs border ${u===s?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:s},s))})]}),u==="form"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-600",children:O?"Opinion: no correct option stored.":"Mark one correct option with radio."}),i.map((s,t)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 space-y-2 bg-white",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-6",children:["Q",t+1]}),e.jsx(P,{value:s.text,onChange:m=>r(x=>{const l=[...x];return l[t]={...l[t],text:m.target.value},l}),placeholder:"Question text",className:"flex-1"}),e.jsx(f,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-500",onClick:()=>r(m=>m.length===1?[K()]:m.filter((x,l)=>l!==t)),children:"Del"})]}),(s.options||[]).slice(0,4).map((m,x)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!O&&e.jsx("input",{type:"radio",name:`q-${t}`,checked:(s.correctIndex||0)===x,onChange:()=>r(l=>{const g=[...l];return g[t]={...g[t],correctIndex:x},g})}),e.jsx(P,{value:m,onChange:l=>r(g=>{const _=[...g],I=[..._[t].options];return I[x]=l.target.value,_[t]={..._[t],options:I},_}),placeholder:`Option ${x+1}`,className:"flex-1"}),(s.options||[]).length>2&&e.jsx(f,{type:"button",size:"sm",variant:"outline",className:"border-red-300 text-red-500",onClick:()=>r(l=>{const g=[...l],_=[...g[t].options];return _.splice(x,1),g[t]={...g[t],options:_},g}),children:"X"})]},x)),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs(f,{type:"button",size:"sm",disabled:(s.options||[]).length>=4,onClick:()=>r(m=>{const x=[...m],l=[...x[t].options];return l.length<4&&l.push(""),x[t]={...x[t],options:l},x}),children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Option"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Max 4 options"})]})]},t)),e.jsxs(f,{type:"button",onClick:()=>r(s=>[...s,K()]),children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"Question"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Paste Questions"}),e.jsx(ie,{className:"h-40",value:o.bulk,onChange:s=>c(t=>({...t,bulk:s.target.value})),placeholder:`Q1. Capital of India?
- [ ] Mumbai
- [x] Delhi
- [ ] Kolkata
- [ ] Jaipur

Q2. ...`}),(()=>{const{items:s,errors:t,warnings:m}=Me(o.bulk,{allowZeroCorrect:O});return e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[s.length," parsed"]}),m[0]&&e.jsx("div",{className:"text-amber-500",children:m[0]}),t[0]&&e.jsx("div",{className:"text-red-500",children:t[0]}),e.jsx(f,{type:"button",size:"sm",disabled:!!t.length||!s.length,onClick:()=>{if(t.length||!s.length)return;const x=s.map(l=>({text:l.question_text,options:l.options.map(g=>g.option_text),correctIndex:O?0:l.options.findIndex(g=>g.is_correct)>=0?l.options.findIndex(g=>g.is_correct):0}));r(x.length?x:[K()]),a("form"),n({title:"Loaded",description:`${x.length} questions moved to form.`})},children:"Load into form"})]})})()]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Create"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancel"})]})]})]})}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2 mb-3",children:[e.jsx(De,{className:"w-5 h-5"}),"All Quizzes"]}),E?e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(F,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading..."]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Active / Upcoming"}),e.jsx("div",{className:"space-y-4",children:le.active.map(s=>{const t=s.prize_type||"money",m=X(t,s.prize_pool,{fallback:0}),x=Array.isArray(s.prizes)?s.prizes.map(l=>X(t,l,{fallback:0})).join(", "):"";return e.jsxs(W.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[240px]",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",ge(s.category)||"â€”"]}),e.jsxs("span",{children:["Type: ",t]}),e.jsxs("span",{children:["Pool: ",m]}),e.jsxs("span",{children:["Prizes: ",x]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:["Start: ",s.start_time?G(s.start_time):"â€”"]}),e.jsxs("span",{className:"ml-4",children:["End: ",s.end_time?G(s.end_time):"â€”"]})]})]}),e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>Ce(s.id),disabled:B===s.id,children:B===s.id?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-1 animate-spin"}),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-1"}),"Recompute"]})}),e.jsxs(Qe,{to:`/results/${s.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-gray-300 hover:bg-gray-100 text-indigo-600",children:[e.jsx(Te,{className:"w-4 h-4"}),"Results"]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{b(s),we(s.id),ye(!0)},className:"text-blue-400",children:[e.jsx($e,{className:"w-4 h-4 mr-1"}),"Questions"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>Se(s.id),className:"text-red-500",children:e.jsx(Fe,{className:"w-4 h-4"})})]})]}),e.jsx(he,{children:ve&&(p==null?void 0:p.id)===s.id&&e.jsxs(W.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 space-y-2",children:[e.jsxs("h5",{className:"font-medium flex items-center gap-2",children:["Questions for ",s.title]}),$.length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No questions."}),$.map((l,g)=>e.jsxs("div",{className:"border border-gray-200 rounded p-3 bg-white",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Q",g+1,": ",l.question_text]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:(l.options||[]).map(_=>e.jsxs("div",{className:`px-2 py-0.5 text-xs rounded-full ${_.is_correct?"bg-green-600 text-white":"bg-gray-200 text-gray-700"}`,children:[_.option_text,_.is_correct&&e.jsx("span",{className:"ml-1",children:"âœ“"})]},_.id))})]},l.id))]})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Finished"}),e.jsx("div",{className:"space-y-4",children:le.finished.map(s=>{const t=s.prize_type||"money",m=X(t,s.prize_pool,{fallback:0}),x=Array.isArray(s.prizes)?s.prizes.map(l=>X(t,l,{fallback:0})).join(", "):"";return e.jsxs(W.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"border border-gray-200 rounded-xl p-4 bg-gray-50",children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-3 mt-1",children:[e.jsxs("span",{children:["Category: ",ge(s.category)||"â€”"]}),e.jsxs("span",{children:["Type: ",t]}),e.jsxs("span",{children:["Pool: ",m]}),e.jsxs("span",{children:["Prizes: ",x]})]})]},s.id)})})]})]})]})]}),j==="approvals"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Pending Redemptions"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Approve user reward payouts after verifying their UPI ID / phone number."}),ce&&e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx(F,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading pending requests..."]}),!ce&&se.length===0&&e.jsx("div",{className:"py-6 text-center text-gray-500 border border-gray-200 rounded-xl bg-gray-50",children:"No pending redemptions."}),se.length>0&&e.jsx("div",{className:"space-y-4",children:se.map(s=>{var t;return e.jsxs("div",{className:"border border-gray-200 rounded-xl p-4 bg-white shadow-sm flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-amber-400 to-yellow-500 flex items-center justify-center text-white font-semibold shadow",children:e.jsx("span",{className:"text-sm",children:"â‚¹"})}),(()=>{var g,_;const m=s.reward_value,x=m&&String(m).trim().length?m:`${s.reward_type||""}`.trim()||"Reward",l=((g=s.profiles)==null?void 0:g.username)||((_=s.profiles)==null?void 0:_.full_name)||"Anonymous";return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 truncate",children:x}),e.jsxs("div",{className:"text-[11px] text-gray-600",children:["@",l]})]})})()]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex flex-wrap gap-3",children:[e.jsxs("span",{children:["Type: ",s.reward_type||"â€”"]}),e.jsxs("span",{children:["Coins: ",(t=s.coins_required)!=null?t:0]}),e.jsxs("span",{children:["Requested: ",s.requested_at?G(s.requested_at):"â€”"]})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Payout: ",s.payout_identifier?`${s.payout_identifier} (${s.payout_channel||"upi"})`:"â€”"]})]}),e.jsx("div",{className:"flex items-center gap-2 self-start md:self-center",children:e.jsx(f,{size:"sm",onClick:()=>ze(s.id),className:"bg-green-600 hover:bg-green-700 text-white",children:"Approve"})})]},s.id)})})]}),j==="notifications"&&e.jsx(Oe,{}),j==="automation"&&e.jsx(Ue,{}),j==="rewards"&&e.jsx(Be,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{children:[e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{rel:"canonical",href:"https://quizdangal.com/admin"})]}),e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 max-w-md w-full text-center shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-500 mb-2",children:"Admin access required"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Supabase "}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:" table mein aapke record ka "}),e.jsx("strong",{children:"role"}),e.jsx("span",{children:" field admin hona chahiye."})]}),e.jsxs("ul",{className:"text-left text-sm text-gray-600 mt-4 space-y-2 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("span",{children:"Supabase dashboard"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"â†’"}),e.jsx("span",{children:"Table editor"}),e.jsx("span",{"aria-hidden":"true",role:"presentation",className:"mx-1",children:"â†’"}),e.jsx("code",{children:"profiles"}),e.jsx("span",{children:"Â me role update karein."})]}),e.jsx("li",{children:"Update ke baad login session refresh karein."}),e.jsxs("li",{children:["Dev bypass (",e.jsx("code",{children:"VITE_BYPASS_AUTH=1"}),") mein mock admin auto-enable hota hai."]})]})]})})]})}function Be(){const{toast:n}=ee(),[h,z]=N.useState([]),[k,L]=N.useState(!1),[y,j]=N.useState(!1),[S,Q]=N.useState({reward_type:"coins",reward_value:"",coins_required:"",is_active:!0}),[w,E]=N.useState(!1),[q,v]=N.useState(null),A=N.useCallback(async()=>{if(!d)return;L(!0);const{data:i,error:r}=await d.from("reward_catalog").select("id,reward_type,reward_value,coins_required,is_active").order("id",{ascending:!1}).limit(200);r?n({title:"Rewards load failed",description:r.message,variant:"destructive"}):z(i||[]),L(!1)},[n]);N.useEffect(()=>{A()},[A]);const o=()=>Q({reward_type:"cash",reward_value:"",coins_required:"",is_active:!0}),c=async i=>{if(i.preventDefault(),!!d){E(!0);try{const r={reward_type:String(S.reward_type||"").trim()||"cash",reward_value:String(S.reward_value||"").trim(),coins_required:S.coins_required!==""&&S.coins_required!==null?parseInt(S.coins_required,10):null,is_active:!!S.is_active};if(!r.reward_value)throw new Error("Value required");if(r.coins_required===null||Number.isNaN(r.coins_required))throw new Error("Coins required");let p;if(q?p=await d.from("reward_catalog").update(r).eq("id",q).select().single():p=await d.from("reward_catalog").insert([r]).select().single(),p.error)throw p.error;n({title:q?"Reward updated":"Reward created"}),o(),j(!1),v(null),A()}catch(r){n({title:"Save failed",description:r.message,variant:"destructive"})}finally{E(!1)}}},u=async i=>{if(!d)return;const{error:r}=await d.from("reward_catalog").update({is_active:!i.is_active}).eq("id",i.id);r?n({title:"Toggle failed",description:r.message,variant:"destructive"}):(n({title:i.is_active?"Deactivated":"Activated"}),A())},a=i=>{var r;v(i.id),j(!0),Q({reward_type:i.reward_type||"cash",reward_value:i.reward_value||"",coins_required:((r=i.coins_required)!=null?r:"").toString(),is_active:!!i.is_active})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Redemptions auto-approved hain. Neeche sirf Rewards Catalog manage karna hai."}),e.jsxs("div",{className:"pt-10 border-t border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Rewards Catalog"}),e.jsx(f,{size:"sm",onClick:()=>{j(i=>!i),y||(o(),v(null))},children:y?"Close":"New Reward"}),e.jsx(f,{size:"sm",variant:"outline",onClick:A,disabled:k,children:k?e.jsx(F,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),y&&e.jsxs("form",{onSubmit:c,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Type"}),e.jsx("div",{className:"flex gap-2 flex-wrap mt-1",children:["cash","voucher"].map(i=>e.jsx("button",{type:"button",onClick:()=>Q(r=>({...r,reward_type:i})),className:`px-2 py-1 rounded text-xs border ${S.reward_type===i?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:i==="cash"?"ðŸ’µ Cash (UPI/Phone)":"ðŸŽŸï¸ Voucher (WhatsApp)"},i))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:S.reward_type==="cash"?"User will provide UPI ID or Phone number":"User will provide WhatsApp number"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Value"}),e.jsx(P,{value:S.reward_value,onChange:i=>Q(r=>({...r,reward_value:i.target.value})),placeholder:"e.g. 100 / AMAZON100 / â‚¹100"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Coins Required"}),e.jsx(P,{type:"number",value:S.coins_required,onChange:i=>Q(r=>({...r,coins_required:i.target.value})),placeholder:"coins needed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_active",type:"checkbox",checked:!!S.is_active,onChange:i=>Q(r=>({...r,is_active:i.target.checked}))}),e.jsx("label",{htmlFor:"is_active",className:"text-sm",children:"Active"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-1 animate-spin"}),"Saving"]}):q?"Update":"Create"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>{o(),v(null)},children:q?"Cancel Edit":"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Type"}),e.jsx("th",{className:"p-2 text-left",children:"Value"}),e.jsx("th",{className:"p-2 text-left",children:"Coins Required"}),e.jsx("th",{className:"p-2 text-left",children:"Active"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[h.map(i=>{var r;return e.jsxs("tr",{className:"border-t border-gray-200 hover:bg-gray-100",children:[e.jsx("td",{className:"p-2 capitalize",children:i.reward_type}),e.jsx("td",{className:"p-2 max-w-[260px] truncate",title:i.reward_value,children:i.reward_value}),e.jsx("td",{className:"p-2",children:(r=i.coins_required)!=null?r:"â€”"}),e.jsx("td",{className:"p-2",children:i.is_active?e.jsx("span",{className:"text-green-500",children:"Yes"}):e.jsx("span",{className:"text-gray-500",children:"No"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>a(i),children:"Edit"}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>u(i),children:i.is_active?"Deactivate":"Activate"})]})})]},i.id)}),!h.length&&!k&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 text-center text-gray-500",children:"No rewards."})}),k&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"p-6 text-center text-gray-500",children:[e.jsx(F,{className:"w-5 h-5 animate-spin inline mr-2"}),"Loading rewards..."]})})]})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Catalog: inactive rewards are hidden from users."})]})]})}function Oe(){const{toast:n}=ee(),[h,z]=N.useState(""),[k,L]=N.useState(""),[y,j]=N.useState("all"),[S,Q]=N.useState(!1),[w,E]=N.useState([]),[q,v]=N.useState(!1),A=N.useCallback(async()=>{if(!d)return;v(!0);const{data:c,error:u}=await d.from("notifications").select("id,title,message,type,segment,created_at").order("created_at",{ascending:!1}).limit(100);u?n({title:"Fetch failed",description:u.message,variant:"destructive"}):E(c||[]),v(!1)},[n]);N.useEffect(()=>{A()},[A]);const o=async c=>{var u;if(c.preventDefault(),!h.trim()||!k.trim()){n({title:"Missing fields",variant:"destructive"});return}if(!d){n({title:"No backend client",variant:"destructive"});return}Q(!0);try{const a={title:h.trim(),message:k.trim(),segment:y},{data:i}=await d.auth.getSession(),r=(u=i==null?void 0:i.session)==null?void 0:u.access_token,{data:p,error:b}=await d.functions.invoke("send-notifications",{body:a,headers:r?{Authorization:`Bearer ${r}`}:void 0});if(b)throw new Error(b.message||b.error||"Failed to send notification");const $=typeof p=="object"&&(p!=null&&p.message)?p.message:h.trim();n({title:"Sent",description:$}),z(""),L(""),A()}catch(a){n({title:"Send failed",description:a.message,variant:"destructive"})}finally{Q(!1)}};return e.jsxs("div",{className:"space-y-8 max-w-3xl",children:[e.jsxs("form",{onSubmit:o,className:"space-y-4 bg-gray-50 border border-gray-200 rounded-xl p-5",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Send Notification"}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"notification-title",children:"Title"}),e.jsx(P,{id:"notification-title",name:"notificationTitle",value:h,onChange:c=>z(c.target.value),maxLength:80,placeholder:"Short title"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 80 chars â€¢ ",h.length,"/80"]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"notification-message",children:"Message"}),e.jsx(ie,{id:"notification-message",name:"notificationMessage",value:k,onChange:c=>L(c.target.value),className:"h-28",maxLength:280,placeholder:"Body shown in push notification"}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Max 280 chars â€¢ ",k.length,"/280"]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Segment"}),e.jsx("div",{className:"flex gap-2 mt-1",children:["all"].map(c=>e.jsx("button",{type:"button",onClick:()=>j(c),className:`px-3 py-1 rounded text-xs border ${y===c?"bg-indigo-600 text-white border-indigo-600":"border-gray-300 text-gray-600 hover:bg-gray-100"}`,children:c},c))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-1 animate-spin"}),"Sending"]}):"Send"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>{z(""),L("")},children:"Reset"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Recent Notifications"}),e.jsx(f,{size:"sm",variant:"outline",onClick:A,disabled:q,children:q?e.jsx(F,{className:"w-4 h-4 animate-spin"}):"Refresh"})]}),e.jsxs("div",{className:"space-y-3",children:[w.map(c=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:c.title}),e.jsx("div",{className:"text-xs text-gray-600 whitespace-pre-wrap max-w-xl break-words",children:c.message})]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:G(c.created_at)})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 mt-1",children:["Segment: ",c.segment||"â€”",c.type?` â€¢ ${c.type}`:""]})]},c.id)),!w.length&&!q&&e.jsx("div",{className:"text-xs text-gray-500",children:"No notifications yet."})]})]})]})}function Ue(){const{toast:n}=ee(),[h,z]=N.useState(!1),[k,L]=N.useState(!1),[y,j]=N.useState({is_enabled:!0,cadence_min:10,live_window_min:7,start_offset_sec:15,cleanup_days:3,categories:["opinion","gk","sports","movies"],alert_emails:["quizdangalofficial@gmail.com"]}),[S,Q]=N.useState([]),[w,E]=N.useState({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),q=async()=>{if(d)try{const{error:a}=await d.from("ai_providers").update({quota_exhausted:!1,last_error:null}).eq("enabled",!0);if(a)throw a;n({title:"Quota flags reset",description:"Enabled providers can be retried now."}),v()}catch(a){n({title:"Reset failed",description:a.message,variant:"destructive"})}},v=N.useCallback(async()=>{var a,i,r,p;if(d){z(!0);try{const[{data:b,error:$},{data:M,error:B}]=await Promise.all([d.from("ai_settings").select("*").eq("id",1).maybeSingle(),d.from("ai_providers").select("*").order("enabled",{ascending:!1}).order("priority",{ascending:!0}).order("id",{ascending:!0})]);if($)throw $;if(B)throw B;b&&j({is_enabled:!!b.is_enabled,cadence_min:(a=b.cadence_min)!=null?a:10,live_window_min:(i=b.live_window_min)!=null?i:7,start_offset_sec:(r=b.start_offset_sec)!=null?r:15,cleanup_days:(p=b.cleanup_days)!=null?p:3,categories:Array.isArray(b.categories)?b.categories:["opinion","gk","sports","movies"],alert_emails:Array.isArray(b.alert_emails)?b.alert_emails:["quizdangalofficial@gmail.com"]}),Q(M||[])}catch(b){n({title:"Load failed",description:b.message,variant:"destructive"})}finally{z(!1)}}},[n]);N.useEffect(()=>{v()},[v]);const A=async a=>{var i,r;if((i=a==null?void 0:a.preventDefault)==null||i.call(a),!!d){L(!0);try{const p={id:1,is_enabled:!!y.is_enabled,cadence_min:Number(y.cadence_min||10),live_window_min:Number(y.live_window_min||7),start_offset_sec:Number((r=y.start_offset_sec)!=null?r:15),categories:y.categories,cleanup_days:Number(y.cleanup_days||3),alert_emails:y.alert_emails},{error:b}=await d.from("ai_settings").upsert(p,{onConflict:"id"});if(b)throw b;n({title:"Settings saved"})}catch(p){n({title:"Save failed",description:p.message,variant:"destructive"})}finally{L(!1)}}},o=async a=>{if(!d)return;const{error:i}=await d.from("ai_providers").update({enabled:!a.enabled}).eq("id",a.id);i?n({title:"Toggle failed",description:i.message,variant:"destructive"}):(n({title:a.enabled?"Disabled":"Enabled"}),v())},c=async a=>{var i;if((i=a==null?void 0:a.preventDefault)==null||i.call(a),!!d)try{const r={name:String(w.name||"").trim(),api_key_enc:String(w.api_key_enc||"").trim()||null,priority:Number(w.priority||1),enabled:!!w.enabled};if(!r.name)throw new Error("Provider name required");let p;if(w.id?p=await d.from("ai_providers").update(r).eq("id",w.id).select().single():p=await d.from("ai_providers").insert([r]).select().single(),p.error)throw p.error;n({title:w.id?"Provider updated":"Provider added"}),E({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),v()}catch(r){n({title:"Save failed",description:r.message,variant:"destructive"})}},u=a=>E({id:a.id,name:a.name||"",api_key_enc:a.api_key_enc||"",priority:a.priority||1,enabled:!!a.enabled});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"AI Automation"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Auto-generate quizzes backend-only. Configure cadence (minutes) and live window (minutes). For 5-minute quizzes with 5-minute gaps, set cadence=10 and live window=5. Each quiz has 4 options per question."}),e.jsxs("form",{onSubmit:A,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_enabled",type:"checkbox",checked:!!y.is_enabled,onChange:a=>j(i=>({...i,is_enabled:a.target.checked}))}),e.jsx("label",{htmlFor:"is_enabled",className:"text-sm",children:"Enabled"})]}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Cadence (min)"}),e.jsx(P,{type:"number",min:1,max:60,value:y.cadence_min,onChange:a=>j(i=>({...i,cadence_min:a.target.valueAsNumber||10}))})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Live window (min)"}),e.jsx(P,{type:"number",min:5,max:180,value:y.live_window_min,onChange:a=>j(i=>({...i,live_window_min:a.target.valueAsNumber||7}))})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Start offset (sec)"}),e.jsx(P,{type:"number",min:0,max:120,value:y.start_offset_sec,onChange:a=>j(i=>{var r;return{...i,start_offset_sec:Math.max(0,(r=a.target.valueAsNumber)!=null?r:15)}})})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Cleanup days"}),e.jsx(P,{type:"number",min:1,max:30,value:y.cleanup_days,onChange:a=>j(i=>({...i,cleanup_days:a.target.valueAsNumber||3}))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(C,{children:"Categories (comma)"}),e.jsx(P,{value:(y.categories||[]).join(", "),onChange:a=>j(i=>({...i,categories:a.target.value.split(",").map(r=>r.trim()).filter(Boolean)}))})]})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Alert emails (comma)"}),e.jsx(P,{value:(y.alert_emails||[]).join(", "),onChange:a=>j(i=>({...i,alert_emails:a.target.value.split(",").map(r=>r.trim()).filter(Boolean)}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",disabled:k,children:k?"Savingâ€¦":"Save Settings"}),e.jsx(f,{type:"button",variant:"outline",onClick:v,disabled:h,children:h?"Loadingâ€¦":"Refresh"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("h3",{className:"font-semibold",children:"Providers"}),e.jsx(f,{size:"sm",variant:"outline",onClick:v,disabled:h,children:h?"Loadingâ€¦":"Refresh"}),e.jsx(f,{size:"sm",variant:"outline",onClick:q,children:"Reset quota flags"})]}),e.jsxs("form",{onSubmit:c,className:"space-y-3 bg-gray-50 border border-gray-200 rounded-lg p-4 max-w-3xl",children:[e.jsx("h4",{className:"font-medium",children:w.id?"Edit Provider":"Add Provider"}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(C,{children:"Name"}),e.jsx(P,{value:w.name,onChange:a=>E(i=>({...i,name:a.target.value})),placeholder:"e.g. openai"})]}),e.jsxs("div",{children:[e.jsx(C,{children:"Priority"}),e.jsx(P,{type:"number",value:w.priority,onChange:a=>E(i=>({...i,priority:a.target.valueAsNumber||1}))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"prov_enabled",type:"checkbox",checked:!!w.enabled,onChange:a=>E(i=>({...i,enabled:a.target.checked}))}),e.jsx("label",{htmlFor:"prov_enabled",className:"text-sm",children:"Enabled"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(C,{children:"API Key (stored server-side)"}),e.jsx(P,{value:w.api_key_enc,onChange:a=>E(i=>({...i,api_key_enc:a.target.value})),placeholder:"sk-..."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"submit",children:w.id?"Update":"Add"}),e.jsx(f,{type:"button",variant:"outline",onClick:()=>E({id:null,name:"",api_key_enc:"",priority:1,enabled:!0}),children:"Reset"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded border border-gray-200",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Name"}),e.jsx("th",{className:"p-2 text-left",children:"Priority"}),e.jsx("th",{className:"p-2 text-left",children:"Enabled"}),e.jsx("th",{className:"p-2 text-left",children:"Quota"}),e.jsx("th",{className:"p-2 text-left",children:"Last Error"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[S.map(a=>e.jsxs("tr",{className:"border-t border-gray-200",children:[e.jsx("td",{className:"p-2",children:a.name}),e.jsx("td",{className:"p-2",children:a.priority}),e.jsx("td",{className:"p-2",children:a.enabled?"Yes":"No"}),e.jsx("td",{className:"p-2",children:a.quota_exhausted?"Exhausted":"OK"}),e.jsx("td",{className:"p-2 max-w-[300px] truncate",title:a.last_error||"",children:a.last_error||"â€”"}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(f,{size:"sm",variant:"outline",onClick:()=>u(a),children:"Edit"}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>o(a),children:a.enabled?"Disable":"Enable"})]})})]},a.id)),!S.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-center text-gray-500",children:"No providers"})})]})]})})]})]})}export{Je as default};
