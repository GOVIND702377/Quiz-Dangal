import{j as e,d as Ee,a as Ue,u as we,s as g,B as h,L as C,I as j,e as ye,t as Se,D as We,g as Ve,h as Ze,i as Ge,k as Ke,l as Je,m as Xe,n as He}from"./index-e762386f.js";import{a as Ye,r as u}from"./react-8a702e3e.js";import{d as et,L as De}from"./router-bcacfb8d.js";import{m as Ne}from"./motion-511bde03.js";import{J as tt,h as Ie,G as st,K as de,N as qe,L as X,O as rt,n as Ae,Q as it,V as he,Y as at}from"./icons-3e0b0f01.js";import"./supabase-4c1332f7.js";const le=Ye.forwardRef(({className:y,...a},$)=>e.jsx("textarea",{ref:$,className:Ee("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",y),...a}));le.displayName="Textarea";function nt(){const{toast:y}=we(),[a,$]=u.useState(""),[H,T]=u.useState(""),[Y,L]=u.useState("announcement"),[N,F]=u.useState(""),[M,se]=u.useState(""),[R,n]=u.useState(!1),[p,w]=u.useState([]),[_,Z]=u.useState(!0),[G,K]=u.useState(""),[ee,A]=u.useState(""),[B,ge]=u.useState(!1),re=async()=>{Z(!0);const{data:x,error:I}=await g.from("notifications").select("*").order("created_at",{ascending:!1}).limit(20);I?y({title:"Load failed",description:I.message,variant:"destructive"}):w(x||[]),Z(!1)};u.useEffect(()=>{re()},[]);const ie=async x=>{if(x.preventDefault(),!G.trim()||!ee.trim()){y({title:"Title/Message required",variant:"destructive"});return}ge(!0);try{const{error:I}=await g.functions.invoke("send-notifications",{body:{title:G.trim(),message:ee.trim()}});if(I)throw I;y({title:"Push sent",description:"Notifications queued to subscribers."}),K(""),A("")}catch(I){y({title:"Push failed",description:I.message||"Try again later",variant:"destructive"})}finally{ge(!1)}},fe=async x=>{if(x.preventDefault(),!a.trim()||!H.trim()){y({title:"Title/Message required",variant:"destructive"});return}n(!0);try{const I={p_title:a.trim(),p_message:H.trim(),p_type:Y,p_quiz_id:N||null,p_scheduled_at:M?new Date(M).toISOString():null},{error:ce}=await g.rpc("create_notification",I);if(ce)throw ce;y({title:"Notification queued",description:"It will be delivered per schedule."}),$(""),T(""),F(""),se(""),L("announcement"),await re()}catch(I){y({title:"Send failed",description:I.message,variant:"destructive"})}finally{n(!1)}};return e.jsxs("div",{className:"space-y-4 text-foreground",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent flex items-center",children:[e.jsx(at,{className:"mr-2"})," Admin: Notifications"]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Announcements aur quiz notifications yahan se bhejein"})]})}),e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-4 flex items-center",children:[e.jsx(Ie,{className:"w-5 h-5 mr-2"}),"Send Push Notification"]}),e.jsxs("form",{onSubmit:ie,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"pushTitle",children:"Push Notification Title *"}),e.jsx(j,{id:"pushTitle",value:G,onChange:x=>K(x.target.value),placeholder:"e.g., New Quiz Alert!",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"pushMessage",children:"Push Notification Message *"}),e.jsx(le,{id:"pushMessage",value:ee,onChange:x=>A(x.target.value),placeholder:"Don't miss out on today's quiz!",required:!0})]}),e.jsx(h,{type:"submit",disabled:B,className:"bg-purple-600 hover:bg-purple-700",children:B?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Push..."]}):"Send Push Notification"})]})]}),e.jsx("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:fe,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"ntitle",children:"Title *"}),e.jsx(j,{id:"ntitle",value:a,onChange:x=>$(x.target.value),placeholder:"e.g., Quiz Starting Soon",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"ntype",children:"Type *"}),e.jsxs("select",{id:"ntype",value:Y,onChange:x=>L(x.target.value),className:"w-full border border-border bg-background text-foreground rounded-md px-3 py-2",children:[e.jsx("option",{value:"announcement",children:"Announcement"}),e.jsx("option",{value:"quiz_start",children:"Quiz Start"}),e.jsx("option",{value:"quiz_end",children:"Quiz End"}),e.jsx("option",{value:"quiz_result",children:"Quiz Result"})]})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"nmsg",children:"Message *"}),e.jsx(le,{id:"nmsg",value:H,onChange:x=>T(x.target.value),placeholder:"Write your message...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"nquiz",children:"Quiz ID (optional)"}),e.jsx(j,{id:"nquiz",value:N,onChange:x=>F(x.target.value),placeholder:"UUID of quiz"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"nsched",children:"Schedule (optional)"}),e.jsx(j,{id:"nsched",type:"datetime-local",value:M,onChange:x=>se(x.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{type:"submit",disabled:R,className:"bg-indigo-600 hover:bg-indigo-700",children:R?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):"Send Notification"}),e.jsx(h,{type:"button",variant:"outline",onClick:re,children:"Refresh"})]})]})}),e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg",children:[e.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center",children:[e.jsx(qe,{className:"w-5 h-5 mr-2"}),"Recent"]}),_?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(X,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):p.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No notifications"}):e.jsx("div",{className:"space-y-2",children:p.map(x=>e.jsx("div",{className:"p-3 rounded-xl bg-card/80 border border-border flex items-center justify-between text-sm",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-foreground",children:[x.title," ",e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",x.type,")"]})]}),e.jsx("div",{className:"text-foreground/80",children:x.message}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["Quiz: ",x.quiz_id||"—"," • Scheduled: ",x.scheduled_at?new Date(x.scheduled_at).toLocaleString():"now"," • Created: ",new Date(x.created_at).toLocaleString()]})]})},x.id))})]})]})}function xt(){const{userProfile:y}=Ue(),{toast:a}=we(),[$,H]=et(),T=$.get("tab")||"overview",Y=t=>{const s=new URLSearchParams($);s.set("tab",t),H(s,{replace:!1})};if((y==null?void 0:y.role)!=="admin")return e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Aapke paas admin adhikaar nahi hain."})]});const[L,N]=u.useState([]),[F,M]=u.useState(!0),[se,R]=u.useState(!1),[n,p]=u.useState(null),[w,_]=u.useState(!1),[Z,G]=u.useState([]),[K,ee]=u.useState(!1),[A,B]=u.useState({text:"",options:["","","",""],correctIndex:0}),[ge,re]=u.useState(!1),[ie,fe]=u.useState(""),[x,I]=u.useState("append"),[ce,ve]=u.useState(!1),[_e,ke]=u.useState(null),Ce=["opinion","gk","movies","sports"],[me,je]=u.useState("form"),ue=()=>({text:"",options:["",""],correctIndex:0}),[E,V]=u.useState([ue()]),[o,U]=u.useState({title:"",prizes:["","",""],start_time:"",end_time:"",category:"",bulk_text:"",prize_type:"money"});u.useEffect(()=>{T==="overview"&&ae()},[T]);const ae=async()=>{try{const{data:t,error:s}=await g.from("quizzes").select("*").order("start_time",{ascending:!1});if(s)throw s;N(t||[])}catch(t){a({title:"Error",description:"Failed to fetch quizzes.",variant:"destructive"})}finally{M(!1)}},W=async t=>{try{const{data:s,error:i}=await g.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",t);if(i)throw i;G(s||[])}catch(s){a({title:"Error",description:"Failed to fetch questions.",variant:"destructive"})}},pe=(t,{strict:s=!1,allowZeroCorrect:i=!1}={})=>{var z,P;const r=String(t||"").trim().split(/\n\s*\n+/),l=[],d=[],c=[];let f=0;for(const ne of r){const J=ne.split(/\r?\n/).map(m=>m.trim()),be=J.filter(Boolean);if(!be.length)continue;f+=1;const xe=be[0].replace(/^Q\d*\.?\s*/i,"").replace(/^Question\s*[:\-]\s*/i,""),q=[];let oe="";for(let m=1;m<J.length;m++){const b=J[m];if(!b)continue;if(/^ans(wer)?\s*[:\-]/i.test(b)){oe=b;continue}const S=b.match(/^[-*•]?\s*\[(x|X| )\]\s*(.+)$/);if(S){const te=/x/i.test(S[1]);q.push({option_text:S[2].trim(),is_correct:te});continue}const D=b.match(/^(?:[-*•]|[A-Da-d]\)|\d+\)|[A-Da-d][.:])\s*(.+)$/);let Q=D?D[1].trim():b.replace(/^[*]\s*/,"").trim();const O=/^\*/.test(b);Q&&q.push({option_text:Q,is_correct:O})}if(oe){const m=oe.split(/[:\-]/).slice(1).join(":").trim(),b=(P=(z=m.match(/^[A-Da-d]/))==null?void 0:z[0])==null?void 0:P.toUpperCase(),S=parseInt(m,10);if(b){const D={A:0,B:1,C:2,D:3}[b];Number.isInteger(D)&&q[D]&&q.forEach((Q,O)=>Q.is_correct=O===D)}else if(!isNaN(S)&&S>=1&&q[S-1])q.forEach((D,Q)=>D.is_correct=Q===S-1);else{const D=m.toLowerCase(),Q=q.findIndex(O=>O.option_text.toLowerCase()===D||O.option_text.toLowerCase().includes(D));Q>=0&&q.forEach((O,te)=>O.is_correct=te===Q)}}let k=q.filter(m=>m.option_text);if(k.length>4){const m=k.findIndex(b=>b.is_correct);if(m>=0){const b=k[m],S=k.filter((D,Q)=>Q!==m);k=[b,...S.slice(0,3)]}else k=k.slice(0,4);c.push(`Q${f}: More than 4 options found; trimmed to 4 (kept the marked correct).`)}if(!xe){d.push(`Q${f}: Question text missing.`);continue}if(k.length<2){d.push(`Q${f}: At least 2 options required.`);continue}let v=k.filter(m=>m.is_correct).length;if(i)v>0&&c.push(`Q${f}: Correct marks ignored for opinion category.`),k=k.map(m=>({...m,is_correct:!1}));else if(s)v===0?d.push(`Q${f}: Mark exactly one correct option with [x] or provide an Answer: line.`):v>1&&d.push(`Q${f}: Multiple correct marks detected; keep only one [x] or use a single Answer: line.`);else if(v===0)k[0].is_correct=!0;else if(v>1){let m=!1;k=k.map(b=>b.is_correct&&!m?(m=!0,b):{...b,is_correct:!1})}l.push({question_text:xe,options:k})}return{items:l,errors:d,warnings:c}},ze=async(t,s,i="append")=>{try{const{error:r}=await g.rpc("admin_bulk_upsert_questions",{p_quiz_id:t,p_payload:s,p_mode:i});if(!r)return{ok:!0}}catch(r){}i==="replace"&&await g.from("questions").delete().eq("quiz_id",t);for(const r of s){const{data:l,error:d}=await g.from("questions").insert({quiz_id:t,question_text:r.question_text}).select("id").single();if(d)return{ok:!1,message:d.message};const c=l.id,f=r.options.map(P=>({question_id:c,option_text:P.option_text,is_correct:!!P.is_correct})),{error:z}=await g.from("options").insert(f);if(z)return{ok:!1,message:z.message}}return{ok:!0}},Qe=async()=>{if(!n)return;if(n!=null&&n.start_time?new Date(n.start_time).getTime()<=Date.now():!1){a({title:"Locked",description:"Cannot add after quiz start",variant:"destructive"});return}const s=(A.text||"").trim(),i=(A.options||[]).map(d=>(d||"").trim()).filter(Boolean).slice(0,4);if(!s){a({title:"Question required",variant:"destructive"});return}if(i.length<2){a({title:"At least 2 options required",variant:"destructive"});return}const r=(n==null?void 0:n.category)==="opinion",l=Math.min(Math.max(A.correctIndex||0,0),i.length-1);try{const{data:d,error:c}=await g.from("questions").insert({quiz_id:n.id,question_text:s}).select("id").single();if(c)throw c;const f=d.id,z=i.map((ne,J)=>({question_id:f,option_text:ne,is_correct:r?!1:J===l})),{error:P}=await g.from("options").insert(z);if(P)throw P;a({title:"Added",description:"Question created"}),ee(!1),B({text:"",options:["","","",""],correctIndex:0}),await W(n.id)}catch(d){a({title:"Add failed",description:d.message,variant:"destructive"})}},Te=async(t,s)=>{const i=(s||"").trim();if(!i)return a({title:"Question khaali nahi ho sakta",variant:"destructive"});const{error:r}=await g.from("questions").update({question_text:i}).eq("id",t);if(r)return a({title:"Update failed",description:r.message,variant:"destructive"});await W(n.id)},Le=async t=>{if(!confirm("Is question aur iske options ko delete karein?"))return;const{error:s}=await g.from("questions").delete().eq("id",t);if(s)return a({title:"Delete failed",description:s.message,variant:"destructive"});await W(n.id)},Pe=async t=>{const s=window.prompt("Option text daalein");if(!s||!s.trim())return;const{error:i}=await g.from("options").insert({question_id:t,option_text:s.trim()});if(i)return a({title:"Add failed",description:i.message,variant:"destructive"});await W(n.id)},Oe=async(t,s)=>{const i=(s||"").trim();if(!i)return a({title:"Option khaali nahi ho sakta",variant:"destructive"});const{error:r}=await g.from("options").update({option_text:i}).eq("id",t);if(r)return a({title:"Update failed",description:r.message,variant:"destructive"});await W(n.id)},$e=async t=>{if(!confirm("Is option ko delete karein?"))return;const{error:s}=await g.from("options").delete().eq("id",t);if(s)return a({title:"Delete failed",description:s.message,variant:"destructive"});await W(n.id)},Fe=async t=>{t.preventDefault();try{const s=[],i=(o.title||"").trim();o.category||s.push("Please choose a category"),(!i||i.length<3)&&s.push("Title is too short"),o.start_time||s.push("Start time is required"),o.end_time||s.push("End time is required");let r={items:[],errors:[],warnings:[]};const l=[];E.length||s.push("Add at least one question"),E.forEach((v,m)=>{var O;const b=(v.text||"").trim(),S=(v.options||[]).map(te=>(te||"").trim()).filter(Boolean).slice(0,4);b||r.errors.push(`Q${m+1}: Question text is required`),S.length<2&&r.errors.push(`Q${m+1}: At least 2 options required`),S.length>4&&r.warnings.push(`Q${m+1}: Max 4 options; extra ignored`);const D=Math.max(0,Math.min((O=v.correctIndex)!=null?O:0,S.length-1)),Q=S.map((te,Be)=>({option_text:te,is_correct:Be===D}));b&&S.length>=2&&l.push({question_text:b,options:Q})}),r.items=l,r.errors.length&&s.push(r.errors[0]),r.items.length||s.push("No valid questions detected"),me==="paste"&&s.push("Load pasted questions into Form and review before creating");const d=v=>{try{const m=new Date(v);return isNaN(m.getTime())?null:m}catch(m){return null}},c=d(o.start_time),f=d(o.end_time);(!c||!f)&&s.push("Invalid start/end time"),c&&f&&f<=c&&s.push("End time must be after start time"),c&&c.getTime()<Date.now()-6e4&&s.push("Start time must be in the future");const z=parseInt(o.prizes[0]||"",10),P=o.prizes[1]?parseInt(o.prizes[1],10):0,ne=o.prizes[2]?parseInt(o.prizes[2],10):0;if((isNaN(z)||z<=0)&&s.push("1st prize must be a positive number"),o.prizes[1]&&(isNaN(P)||P<0)&&s.push("2nd prize must be 0 or more"),o.prizes[2]&&(isNaN(ne)||ne<0)&&s.push("3rd prize must be 0 or more"),s.length){a({title:"Please fix the form",description:s[0],variant:"destructive"});return}const J=o.prizes.filter(v=>v).map(v=>parseInt(v)),be=J.reduce((v,m)=>v+m,0),xe=v=>{if(!v)return null;const m=new Date(v);return isNaN(m.getTime())?null:m.toISOString()},{data:q,error:oe}=await g.from("quizzes").insert([{title:o.title,prize_pool:be,prizes:J,start_time:xe(o.start_time),end_time:xe(o.end_time),status:"upcoming",category:o.category||null,prize_type:o.prize_type||"money"}]).select("id, title, category, prizes, prize_pool, start_time, end_time").single();if(oe)throw oe;a({title:"Quiz created",description:"Questions will be saved now."});const k=r.items;if(R(!1),U({title:"",prizes:["","",""],start_time:"",end_time:"",category:"",bulk_text:"",prize_type:"money"}),je("form"),V([ue()]),p(q),k.length>0){ve(!0);const v=await ze(q.id,k,"replace");ve(!1),v.ok?a({title:"Questions added",description:`${k.length} questions created.`}):a({title:"Bulk add failed",description:v.message||"Please try again",variant:"destructive"})}await W(q.id),_(!0),ae()}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}},Me=async t=>{if(confirm("Kya aap is quiz ko delete karna chahte hain?"))try{const{error:s}=await g.from("quizzes").delete().eq("id",t);if(s)throw s;a({title:"Success",description:"Quiz delete ho gaya."}),ae()}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}},Re=async t=>{try{ke(t);const{error:s}=await g.rpc("admin_recompute_quiz_results",{p_quiz_id:t});if(s)throw s;a({title:"Results recomputed",description:"Leaderboard update ho gaya."})}catch(s){a({title:"Recompute failed",description:s.message,variant:"destructive"})}finally{ke(null)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl text-foreground",children:[e.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Quiz Dangal Admin"}),e.jsx("p",{className:"text-muted-foreground",children:"Admin dashboard"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-6",children:[{key:"overview",title:"Overview",icon:e.jsx(tt,{className:"w-4 h-4"})},{key:"notifications",title:"Notifications",icon:e.jsx(Ie,{className:"w-4 h-4"})},{key:"redemptions",title:"Redemptions",icon:e.jsx(st,{className:"w-4 h-4"})}].map(t=>e.jsxs("button",{onClick:()=>Y(t.key),className:`px-3 py-2 rounded-lg border text-sm transition-colors inline-flex items-center gap-2 ${t.key===T?"bg-primary text-primary-foreground border-transparent shadow":"bg-muted text-muted-foreground border-border hover:text-foreground"} `,children:[t.icon,t.title]},t.key))}),T==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs(h,{onClick:()=>R(!0),className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Create New Quiz"]})}),se&&e.jsxs(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-1",children:"Create New Quiz"}),e.jsxs("form",{onSubmit:Fe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Category (Section)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ce.map(t=>e.jsx("button",{type:"button",onClick:()=>U({...o,category:t}),className:`px-3 py-1 rounded-full border text-sm capitalize ${o.category===t?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border hover:text-foreground"}`,children:t},t))}),!o.category&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:"Please choose a category"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(C,{htmlFor:"title",children:"Quiz Title"}),e.jsx(j,{id:"title",value:o.title,onChange:t=>U({...o,title:t.target.value}),placeholder:"Daily Opinion Quiz - Evening",required:!0})]})}),e.jsxs("div",{children:[e.jsx(C,{children:"Prize Distribution"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"}),e.jsx("div",{className:"flex gap-2",children:["money","coins","others"].map(t=>e.jsx("button",{type:"button",onClick:()=>U({...o,prize_type:t}),className:`px-2 py-1 rounded border text-xs capitalize ${o.prize_type===t?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border"}`,children:t},t))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(j,{placeholder:o.prize_type==="coins"?"1st Prize (coins)":"1st Prize (amount)",value:o.prizes[0],onChange:t=>{const s=[...o.prizes];s[0]=t.target.value,U({...o,prizes:s})}}),e.jsx(j,{placeholder:o.prize_type==="coins"?"2nd Prize (coins)":"2nd Prize (amount)",value:o.prizes[1],onChange:t=>{const s=[...o.prizes];s[1]=t.target.value,U({...o,prizes:s})}}),e.jsx(j,{placeholder:o.prize_type==="coins"?"3rd Prize (coins)":"3rd Prize (amount)",value:o.prizes[2],onChange:t=>{const s=[...o.prizes];s[2]=t.target.value,U({...o,prizes:s})}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Start Time"}),e.jsx(j,{type:"datetime-local",value:o.start_time,onChange:t=>U({...o,start_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{children:"End Time"}),e.jsx(j,{type:"datetime-local",value:o.end_time,onChange:t=>U({...o,end_time:t.target.value}),required:!0})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{children:"Questions entry mode:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:`px-3 py-1 rounded-md text-sm border ${me==="form"?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border"}`,onClick:()=>je("form"),children:"Form"}),e.jsx("button",{type:"button",className:`px-3 py-1 rounded-md text-sm border ${me==="paste"?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border"}`,onClick:()=>je("paste"),children:"Paste"})]})]}),me==="form"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:o.category==="opinion"?"Add questions with 2–4 options. No correct option in Opinion category.":"Add questions with 2–4 options. Select exactly one correct."}),E.map((t,s)=>e.jsxs("div",{className:"p-3 rounded-xl border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground w-10",children:["Q",s+1,"."]}),e.jsx(j,{value:t.text,onChange:i=>{const r=[...E];r[s]={...r[s],text:i.target.value},V(r)},placeholder:"Question text",className:"flex-1"}),e.jsx(h,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-600",onClick:()=>{const i=[...E];i.splice(s,1),V(i.length?i:[ue()])},children:"Remove"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[(t.options||[]).slice(0,4).map((i,r)=>{var l;return e.jsxs("div",{className:"flex items-center gap-2",children:[o.category!=="opinion"&&e.jsx("input",{type:"radio",name:`qdraft-${s}`,checked:((l=t.correctIndex)!=null?l:0)===r,onChange:()=>{const d=[...E];d[s]={...d[s],correctIndex:r},V(d)}}),e.jsx(j,{value:i,onChange:d=>{const c=[...E],f=[...c[s].options||[]];f[r]=d.target.value,c[s]={...c[s],options:f},V(c)},placeholder:`Option ${r+1}`,className:"flex-1"}),(t.options||[]).length>2&&e.jsx(h,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-600",onClick:()=>{var z;const d=[...E],c=[...d[s].options||[]];c.splice(r,1);const f=Math.min((z=d[s].correctIndex)!=null?z:0,c.length-1);d[s]={...d[s],options:c,correctIndex:f},V(d)},children:"Delete"})]},r)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 disabled:opacity-60",disabled:(t.options||[]).length>=4,onClick:()=>{const i=[...E],r=[...i[s].options||[]].slice(0,4).concat("");i[s]={...i[s],options:r},V(i)},children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Add Option"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Max 4 options."})]})]})]},s)),e.jsx("div",{children:e.jsxs(h,{type:"button",onClick:()=>V(t=>[...t,ue()]),children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Add Question"]})})]}):e.jsxs("div",{children:[e.jsx(C,{children:"Paste Questions (RAW format) *"}),e.jsx(le,{placeholder:`Use RAW format with [x]/[ ] tick and max 4 options. Example:
Q1. Capital of India?
- [ ] Mumbai
- [x] Delhi
- [ ] Kolkata
- [ ] Jaipur

Q2. Best color?
- [x] Blue
- [ ] Red
- [ ] Green
(Alternatively, provide Answer: B or Answer: 2 line)`,value:o.bulk_text,onChange:t=>U({...o,bulk_text:t.target.value}),className:"mt-1 h-40"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[o.category==="opinion"?"No correct option required for Opinion category.":"Mark exactly one correct option per question with [x] or Answer: A/B/1."," Max 4 options per question."]}),(()=>{const{items:t,errors:s,warnings:i}=pe(o.bulk_text,{strict:!0,allowZeroCorrect:o.category==="opinion"});return e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("div",{className:"text-foreground/80",children:["Preview: ",t.length," questions"]}),i.length>0&&e.jsxs("div",{className:"text-xs text-amber-600",children:[i[0],i.length>1?` (+${i.length-1} more)`:""]}),s.length>0&&e.jsxs("div",{className:"text-xs text-destructive",children:[s[0],s.length>1?` (+${s.length-1} more)`:""]}),e.jsx("div",{className:"pt-2",children:e.jsx(h,{type:"button",onClick:()=>{const r=pe(o.bulk_text,{strict:!0,allowZeroCorrect:o.category==="opinion"});if(r.errors.length){a({title:"Fix pasted input",description:r.errors[0],variant:"destructive"});return}if(!r.items.length){a({title:"No valid questions",variant:"destructive"});return}const l=r.items.map(d=>{const c=(d.options||[]).slice(0,4),f=o.category==="opinion"?0:Math.max(0,c.findIndex(z=>z.is_correct));return{text:d.question_text,options:c.map(z=>z.option_text),correctIndex:f<0?0:f}});V(l.length?l:[ue()]),je("form"),a({title:"Loaded into form",description:`${l.length} questions ready to review & edit.`})},className:"bg-indigo-600 hover:bg-indigo-700",children:"Load into Form (Preview & Edit)"})})]})})()]}),e.jsxs("div",{className:"flex space-x-4",children:[(()=>{let t=!1;return me==="paste"?t=!0:t=!E.some(i=>(i.text||"").trim()&&(i.options||[]).filter(r=>(r||"").trim()).length>=2),e.jsx(h,{type:"submit",disabled:t,className:"bg-green-600 hover:bg-green-700 disabled:opacity-60",children:"Create Quiz"})})(),e.jsx(h,{type:"button",variant:"outline",onClick:()=>R(!1),children:"Cancel"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground flex items-center",children:[e.jsx(qe,{className:"w-5 h-5 mr-2"}),"All Quizzes"]}),F?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(X,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading quizzes..."]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Active / Upcoming"}),e.jsx("div",{className:"space-y-4 mt-2",children:L.filter(t=>{const s=Date.now();t.start_time&&new Date(t.start_time).getTime();const i=t.end_time?new Date(t.end_time).getTime():null;return i===null||s<=i}).map((t,s)=>e.jsx(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Category: ",t.category||"—"]}),e.jsxs("span",{children:["Prize Type: ",t.prize_type||"money"]}),e.jsxs("span",{children:["Prize Pool: ",t.prize_type==="coins"?"🪙":"","₹",t.prize_pool]}),e.jsxs("span",{children:["Prizes: ",t.prize_type==="coins"?"🪙 ":"",Array.isArray(t.prizes)?t.prizes.join(", "):""]})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Start: ",t.start_time?ye(t.start_time):"—"]}),e.jsxs("span",{className:"ml-4",children:["End: ",t.end_time?ye(t.end_time):"—"]})]}),(()=>{const i=t.start_time?new Date(t.start_time).getTime()<=Date.now():!1;return e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("select",{disabled:i,title:i?"Locked after start time":void 0,className:`border border-border bg-background text-foreground rounded-md px-2 py-2 capitalize ${i?"opacity-60 cursor-not-allowed":""}`,value:t.category||"",onChange:async r=>{if(i){a({title:"Locked",description:"Cannot change after start",variant:"destructive"});return}const{error:l}=await g.from("quizzes").update({category:r.target.value}).eq("id",t.id);l?a({title:"Update failed",description:l.message,variant:"destructive"}):ae()},children:[e.jsx("option",{value:"",children:"Select category"}),Ce.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsx(j,{type:"datetime-local",disabled:i,title:i?"Locked after start time":void 0,value:Se(t.start_time),onChange:async r=>{if(i){a({title:"Locked",description:"Cannot change after start",variant:"destructive"});return}const l=r.target.value,d=l?new Date(l).toISOString():null;L[s].start_time=d,N([...L]);const{error:c}=await g.from("quizzes").update({start_time:d}).eq("id",t.id);c&&(a({title:"Update failed",description:c.message,variant:"destructive"}),ae())}}),e.jsx(j,{type:"datetime-local",disabled:i,title:i?"Locked after start time":void 0,value:Se(t.end_time),onChange:async r=>{if(i){a({title:"Locked",description:"Cannot change after start",variant:"destructive"});return}const l=r.target.value,d=l?new Date(l).toISOString():null;L[s].end_time=d,N([...L]);const{error:c}=await g.from("quizzes").update({end_time:d}).eq("id",t.id);c&&(a({title:"Update failed",description:c.message,variant:"destructive"}),ae())}})]})})()]}),(()=>{const i=Date.now(),r=t.start_time?new Date(t.start_time).getTime():null,l=!r||i<r;return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{size:"sm",variant:"outline",onClick:()=>Re(t.id),disabled:_e===t.id,className:"text-indigo-600 hover:text-indigo-700",children:_e===t.id?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-1 animate-spin"}),"Recomputing"]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"h-4 w-4 mr-1"}),"Recompute"]})}),e.jsxs(De,{to:`/results/${t.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-border hover:bg-muted text-blue-600",children:[e.jsx(Ae,{className:"h-4 w-4"})," Results"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>{p(t),W(t.id),_(!0)},className:"text-blue-600 hover:text-blue-700",children:[e.jsx(it,{className:"h-4 w-4"}),"Questions"]}),e.jsxs("div",{className:"relative group",children:[e.jsx(h,{size:"sm",variant:"outline",onClick:()=>Me(t.id),disabled:!l,className:`${l?"text-red-600 hover:text-red-700":"text-muted-foreground opacity-60 cursor-not-allowed"}`,children:e.jsx(he,{className:"h-4 w-4"})}),!l&&e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap text-xs bg-popover text-popover-foreground border border-border px-2 py-1 rounded shadow hidden group-hover:block",children:"Cannot delete after start time"})]})]})})()]})},t.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Finished"}),e.jsx("div",{className:"space-y-4 mt-2",children:L.filter(t=>{const s=Date.now(),i=t.end_time?new Date(t.end_time).getTime():null;return i!==null&&s>i}).map((t,s)=>e.jsx(Ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Category: ",t.category||"—"]}),e.jsxs("span",{children:["Prize Type: ",t.prize_type||"money"]}),e.jsxs("span",{children:["Prize Pool: ",t.prize_type==="coins"?"🪙":"","₹",t.prize_pool]}),e.jsxs("span",{children:["Prizes: ",t.prize_type==="coins"?"🪙 ":"",Array.isArray(t.prizes)?t.prizes.join(", "):""]})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Start: ",t.start_time?ye(t.start_time):"—"]}),e.jsxs("span",{className:"ml-4",children:["End: ",t.end_time?ye(t.end_time):"—"]})]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(De,{to:`/results/${t.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-border hover:bg-muted text-blue-600",children:[e.jsx(Ae,{className:"h-4 w-4"})," Results"]})})]})},t.id))})]})]})]}),w&&n&&e.jsxs("div",{className:"mt-6 bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["Questions for: ",n.title]}),e.jsx("div",{className:"flex gap-2",children:(()=>{const t=n!=null&&n.start_time?new Date(n.start_time).getTime()<=Date.now():!1;return e.jsxs(e.Fragment,{children:[e.jsxs(h,{onClick:()=>{if(t){a({title:"Locked",description:"Cannot add after quiz start",variant:"destructive"});return}ee(!0)},disabled:t,className:"bg-indigo-600 hover:bg-indigo-700 disabled:opacity-60",size:"sm",children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),K?"Composer Open":"Add Question"]}),e.jsxs(We,{open:ge,onOpenChange:re,children:[e.jsx(Ve,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"sm",disabled:t,children:"Bulk Add/Replace"})}),e.jsxs(Ze,{className:"max-w-2xl",children:[e.jsxs(Ge,{children:[e.jsx(Ke,{children:"Bulk add questions"}),e.jsx(Je,{children:"Paste multiple questions with options. Supported formats shown below."})]}),e.jsxs("div",{children:[e.jsx(le,{value:ie,onChange:s=>fe(s.target.value),className:"h-56",disabled:t,placeholder:`RAW format with [x]/[ ] and max 4 options. Example:
Q. Sample?
- [x] Option 1
- [ ] Option 2
- [ ] Option 3
- [ ] Option 4

Alternatively: use Answer: B or Answer: 2`}),(()=>{const{items:s,errors:i,warnings:r}=pe(ie,{strict:!0,allowZeroCorrect:(n==null?void 0:n.category)==="opinion"});return e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-foreground/80",children:["Preview: ",s.length," questions"]}),e.jsxs("label",{className:"text-sm text-foreground/80 flex items-center gap-2",children:[e.jsx("span",{children:"Mode:"}),e.jsxs("select",{value:x,onChange:l=>I(l.target.value),className:"border border-border bg-background text-foreground rounded-md px-2 py-1 text-sm",disabled:t,children:[e.jsx("option",{value:"append",children:"Append"}),e.jsx("option",{value:"replace",children:"Replace existing"})]})]})]}),r.length>0&&e.jsxs("div",{className:"text-xs text-amber-600",children:[r[0],r.length>1?` (+${r.length-1} more)`:""]}),i.length>0&&e.jsxs("div",{className:"text-xs text-destructive",children:[i[0],i.length>1?` (+${i.length-1} more)`:""]})]})})()]}),e.jsxs(Xe,{children:[e.jsx(He,{asChild:!0,children:e.jsx(h,{variant:"outline",children:"Cancel"})}),e.jsx(h,{disabled:ce||t||pe(ie,{strict:!0,allowZeroCorrect:(n==null?void 0:n.category)==="opinion"}).errors.length>0,onClick:async()=>{const i=pe(ie,{strict:!0,allowZeroCorrect:(n==null?void 0:n.category)==="opinion"}).items;if(!i.length){a({title:"No valid questions detected",variant:"destructive"});return}ve(!0);const r=await ze(n.id,i,x);if(ve(!1),!r.ok){a({title:"Bulk add failed",description:r.message||"Try again",variant:"destructive"});return}a({title:"Questions added",description:`${i.length} questions processed.`}),re(!1),fe(""),await W(n.id)},children:ce?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-1 animate-spin"}),"Working…"]}):"Apply"})]})]})]}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>_(!1),children:"Close"})]})})()})]}),Z.length===0?e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:"No questions yet"}):e.jsxs("div",{className:"space-y-4",children:[(()=>{const t=n!=null&&n.start_time?new Date(n.start_time).getTime()<=Date.now():!1;if(!K)return null;const s=(n==null?void 0:n.category)==="opinion";return e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-foreground",children:"New Question"}),e.jsx(j,{placeholder:"Type your question",value:A.text,disabled:t,onChange:i=>B(r=>({...r,text:i.target.value})),className:"mb-3"}),e.jsxs("div",{className:"space-y-2",children:[(A.options||[]).slice(0,4).map((i,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!s&&e.jsx("input",{type:"radio",name:"newq-correct",checked:A.correctIndex===r,disabled:t,onChange:()=>B(l=>({...l,correctIndex:r}))}),e.jsx(j,{placeholder:`Option ${r+1}`,value:i,disabled:t,onChange:l=>{const d=[...A.options];d[r]=l.target.value,B(c=>({...c,options:d}))},className:"flex-1"}),A.options.length>2&&e.jsx(h,{type:"button",variant:"outline",size:"sm",className:`border-red-300 ${t?"text-muted-foreground opacity-60 cursor-not-allowed":"text-red-600"}`,disabled:t,onClick:()=>{const l=[...A.options];l.splice(r,1),B(d=>({...d,options:l,correctIndex:Math.min(d.correctIndex,l.length-1)}))},children:e.jsx(he,{className:"w-4 h-4"})})]},r)),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 disabled:opacity-60",disabled:t||(A.options||[]).length>=4,onClick:()=>B(i=>({...i,options:[...i.options].slice(0,4).concat("")})),children:[e.jsx(de,{className:"w-4 h-4 mr-1"})," Add Option"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s?"Opinion: no correct option needed.":"Select the correct option. Max 4 options."})]})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(h,{type:"button",onClick:Qe,className:"bg-indigo-600 hover:bg-indigo-700 disabled:opacity-60",disabled:t,children:"Save Question"}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>{ee(!1),B({text:"",options:["","","",""],correctIndex:0})},children:"Cancel"})]})]})})(),Z.map(t=>{const s=n!=null&&n.start_time?new Date(n.start_time).getTime()<=Date.now():!1,i=(n==null?void 0:n.category)==="opinion";return e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{defaultValue:t.question_text,onBlur:r=>{if(s){a({title:"Locked",description:"Cannot edit after quiz start",variant:"destructive"});return}Te(t.id,r.target.value)},className:"flex-1",disabled:s}),e.jsx(h,{variant:"outline",size:"sm",className:`border-red-300 ${s?"text-muted-foreground opacity-60 cursor-not-allowed":"text-red-600"}`,onClick:()=>{if(s){a({title:"Locked",description:"Cannot delete after quiz start",variant:"destructive"});return}Le(t.id)},disabled:s,children:e.jsx(he,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 pl-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Options"}),e.jsxs("div",{className:"space-y-2",children:[(t.options||[]).map(r=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{defaultValue:r.option_text,onBlur:l=>{if(s){a({title:"Locked",description:"Cannot edit after quiz start",variant:"destructive"});return}Oe(r.id,l.target.value)},className:"flex-1",disabled:s}),!i&&e.jsxs("label",{className:"flex items-center gap-1 text-xs text-foreground/80",children:[e.jsx("input",{type:"radio",name:`correct-${t.id}`,defaultChecked:!!r.is_correct,disabled:s,onChange:async l=>{if(s){l.preventDefault();return}if(!l.target.checked)return;const{error:d}=await g.from("options").update({is_correct:!1}).eq("question_id",t.id);if(d){a({title:"Update failed",description:d.message,variant:"destructive"});return}const{error:c}=await g.from("options").update({is_correct:!0}).eq("id",r.id);c&&a({title:"Update failed",description:c.message,variant:"destructive"}),await W(n.id)}}),"Correct"]}),e.jsx(h,{variant:"outline",size:"sm",className:`border-red-300 ${s?"text-muted-foreground opacity-60 cursor-not-allowed":"text-red-600"}`,onClick:()=>{if(s){a({title:"Locked",description:"Cannot delete after quiz start",variant:"destructive"});return}$e(r.id)},disabled:s,children:e.jsx(he,{className:"w-4 h-4"})})]},r.id)),e.jsxs(h,{onClick:()=>{if(s){a({title:"Locked",description:"Cannot add after quiz start",variant:"destructive"});return}if((t.options||[]).length>=4){a({title:"Limit reached",description:"Max 4 options per question",variant:"destructive"});return}Pe(t.id)},size:"sm",className:"bg-green-600 hover:bg-green-700 disabled:opacity-60",disabled:s,children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Add Option"]})]})]})]},t.id)})]})]})]}),T==="notifications"&&e.jsx(nt,{}),T==="redemptions"&&e.jsx(ot,{})]})}function ot(){const{toast:y}=we(),[a,$]=u.useState([]),[H,T]=u.useState(!0),[Y,L]=u.useState(!1),[N,F]=u.useState({title:"",coins_required:"",description:"",image_url:""}),M=async()=>{T(!0);const{data:p,error:w}=await g.from("reward_catalog").select("*").order("coins_required",{ascending:!1});w?(y({title:"Load failed",description:w.message,variant:"destructive"}),$([])):$(p||[]),T(!1)};u.useEffect(()=>{M()},[]);const se=async p=>{var G,K;p.preventDefault();const w=N.title.trim(),_=parseInt(N.coins_required,10);if(!w||isNaN(_)||_<0){y({title:"Invalid input",description:"Title required and coins must be a non-negative number",variant:"destructive"});return}L(!0);const{error:Z}=await g.from("reward_catalog").insert({title:w,coins_required:_,description:((G=N.description)==null?void 0:G.trim())||null,image_url:((K=N.image_url)==null?void 0:K.trim())||null,is_active:!0});Z?y({title:"Add failed",description:Z.message,variant:"destructive"}):(y({title:"Added",description:"Catalog item created"}),F({title:"",coins_required:"",description:"",image_url:""}),M()),L(!1)},R=async(p,w)=>{const{error:_}=await g.from("reward_catalog").update(w).eq("id",p);_?y({title:"Update failed",description:_.message,variant:"destructive"}):M()},n=async p=>{if(!confirm("Delete this item?"))return;const{error:w}=await g.from("reward_catalog").delete().eq("id",p);w?y({title:"Delete failed",description:w.message,variant:"destructive"}):(y({title:"Deleted"}),M())};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Admin: Redemptions Catalog"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Items jinko users coins se redeem kar sakte hain"})]}),e.jsx("div",{className:"bg-card text-card-foreground border border-border rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:se,className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"rc_title",children:"Title *"}),e.jsx(j,{id:"rc_title",value:N.title,onChange:p=>F({...N,title:p.target.value}),placeholder:"e.g., ₹100 Paytm",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"rc_coins",children:"Coins *"}),e.jsx(j,{id:"rc_coins",type:"number",min:"0",value:N.coins_required,onChange:p=>F({...N,coins_required:p.target.value}),placeholder:"e.g., 1000",required:!0})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"rc_img",children:"Image URL (optional)"}),e.jsx(j,{id:"rc_img",value:N.image_url,onChange:p=>F({...N,image_url:p.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(C,{htmlFor:"rc_desc",children:"Description (optional)"}),e.jsx(le,{id:"rc_desc",value:N.description,onChange:p=>F({...N,description:p.target.value}),placeholder:"Short details"})]}),e.jsx("div",{children:e.jsx(h,{type:"submit",disabled:Y,className:"bg-green-600 hover:bg-green-700",children:Y?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):"Add Item"})})]})}),e.jsxs("div",{className:"bg-card text-card-foreground border border-border rounded-2xl p-4 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Catalog Items"}),H?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(X,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):a.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No items"}):e.jsx("div",{className:"space-y-2",children:a.map(p=>e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{defaultValue:p.title,onBlur:w=>{const _=w.target.value.trim();_&&_!==p.title&&R(p.id,{title:_})},className:"flex-1"}),e.jsx(j,{type:"number",min:"0",defaultValue:p.coins_required,onBlur:w=>{const _=parseInt(w.target.value,10);!isNaN(_)&&_!==p.coins_required&&R(p.id,{coins_required:_})},className:"w-32"})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1 truncate",children:p.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs text-foreground/80 flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",defaultChecked:!!p.is_active,onChange:w=>R(p.id,{is_active:w.target.checked})})," Active"]}),e.jsx(h,{size:"sm",variant:"outline",className:"text-red-600 border-red-300",onClick:()=>n(p.id),children:e.jsx(he,{className:"w-4 h-4"})})]})]},p.id))})]})]})}export{xt as default};
