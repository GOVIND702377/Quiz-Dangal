import{j as e,d as Ue,a as Ve,u as ce,s as h,B as g,L as O,I as C,e as he,t as Ae,D as We,g as Ze,i as Ge,k as He,l as Ke,m as Xe,n as Je,o as Ye}from"./index-04703bac.js";import{a as be,r as p}from"./react-8a702e3e.js";import{d as et,L as ve}from"./router-f2cf3f51.js";import{m as ge}from"./motion-511bde03.js";import{V as tt,Y as je,G as st,Z as te,_ as qe,L as se,k as rt,s as De,$ as it,a0 as de,a1 as at}from"./icons-5fed0bfb.js";import"./supabase-4c1332f7.js";const le=be.forwardRef(({className:_,...a},T)=>e.jsx("textarea",{ref:T,className:Ue("flex w-full rounded-md border border-input bg-background px-3 py-2 text-base sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[80px] resize-vertical",_),...a}));le.displayName="Textarea";function nt(){const{toast:_}=ce(),[a,T]=p.useState(""),[B,q]=p.useState(""),[z,I]=p.useState(!1),N=async f=>{if(f.preventDefault(),!a.trim()||!B.trim()){_({title:"Title/Message required",variant:"destructive"});return}I(!0);try{const{error:v}=await h.functions.invoke("send-notifications",{body:{title:a.trim(),message:B.trim()}});if(v)throw v;_({title:"Push sent",description:"Notifications queued to subscribers."}),T(""),q("")}catch(v){_({title:"Push failed",description:v.message||"Try again later",variant:"destructive"})}finally{I(!1)}},[A,d]=p.useState("broadcast");return e.jsxs("div",{className:"space-y-4 text-foreground",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent flex items-center",children:[e.jsx(at,{className:"mr-2"})," Admin: Notifications"]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Announcements aur quiz notifications yahan se bhejein"})]})}),e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-4 flex items-center",children:[e.jsx(je,{className:"w-5 h-5 mr-2"}),"Send Push Notification"]}),e.jsxs("form",{onSubmit:N,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"pushTitle",children:"Push Notification Title *"}),e.jsx(C,{id:"pushTitle",value:a,onChange:f=>T(f.target.value),placeholder:"e.g., New Quiz Alert!",required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"pushMessage",children:"Push Notification Message *"}),e.jsx(le,{id:"pushMessage",value:B,onChange:f=>q(f.target.value),placeholder:"Don't miss out on today's quiz!",required:!0})]}),e.jsx(g,{type:"submit",disabled:z,className:"bg-purple-600 hover:bg-purple-700",children:z?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Push..."]}):"Send Push Notification"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:A==="broadcast"?"default":"outline",onClick:()=>d("broadcast"),children:"Admin ki bheji hui"}),e.jsx(g,{variant:A==="auto"?"default":"outline",onClick:()=>d("auto"),children:"Automatic wali"})]}),A==="broadcast"?e.jsx(dt,{}):e.jsx(ot,{})]})}function ot(){const{toast:_}=ce(),[a,T]=p.useState([]),[B,q]=p.useState(!0),[z,I]=p.useState("all"),N=async()=>{try{const{data:d,error:f}=await h.from("quiz_notification_log").select("id, quiz_id, type, sent_at").order("sent_at",{ascending:!1}).limit(50);if(f)throw f;const v=d||[],n=Array.from(new Set(v.map(b=>b.quiz_id).filter(Boolean)));let x={};if(n.length>0){const{data:b,error:Z}=await h.from("quizzes").select("id, title").in("id",n);if(Z)throw Z;x=Object.fromEntries((b||[]).map(H=>[H.id,H.title]))}const k=v.map(b=>({...b,quiz_title:x[b.quiz_id]||"Quiz"}));T(k)}catch(d){_({title:"Load failed",description:d.message,variant:"destructive"})}finally{q(!1)}};p.useEffect(()=>{N()},[]);const A=be.useMemo(()=>{if(!Array.isArray(a))return[];const d=Date.now();let f=0;if(z==="today"){const v=new Date;v.setHours(0,0,0,0),f=v.getTime()}else z==="7d"?f=d-7*24*60*60*1e3:z==="30d"&&(f=d-30*24*60*60*1e3);return f?a.filter(v=>new Date(v.sent_at).getTime()>=f):a},[a,z]);return e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(qe,{className:"w-5 h-5 mr-2"}),"Activity: Automatic Quiz Notifications"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Range:"}),["all","today","7d","30d"].map(d=>e.jsx("button",{onClick:()=>I(d),className:`px-2 py-1 rounded border ${z===d?"bg-primary text-primary-foreground":"border-border text-foreground"}`,children:d.toUpperCase()},d))]}),B?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading..."}):A.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No automatic notifications yet."}):e.jsx("div",{className:"space-y-2",children:A.map(d=>e.jsxs("div",{className:"flex items-center justify-between text-sm border border-border rounded-lg px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:d.quiz_title}),e.jsxs("div",{className:"text-muted-foreground",children:["Type: ",d.type," • ",new Date(d.sent_at).toLocaleString()]})]}),e.jsx(ve,{to:d.type==="result"?`/#/results/${d.quiz_id}`:`/#/quiz/${d.quiz_id}`,className:"text-primary hover:underline",children:"Open"})]},d.id))})]})}function dt(){const{toast:_}=ce(),[a,T]=p.useState([]),[B,q]=p.useState(!0),[z,I]=p.useState("all"),N=async()=>{try{const{data:d,error:f}=await h.from("notifications").select("id, title, message, created_at, created_by, type").order("created_at",{ascending:!1}).limit(50);if(f)throw f;T(d||[])}catch(d){_({title:"Load failed",description:d.message,variant:"destructive"})}finally{q(!1)}};p.useEffect(()=>{N()},[]);const A=be.useMemo(()=>{if(!Array.isArray(a))return[];const d=Date.now();let f=0;if(z==="today"){const v=new Date;v.setHours(0,0,0,0),f=v.getTime()}else z==="7d"?f=d-7*24*60*60*1e3:z==="30d"&&(f=d-30*24*60*60*1e3);return f?a.filter(v=>new Date(v.created_at).getTime()>=f):a},[a,z]);return e.jsxs("div",{className:"bg-card border border-border rounded-2xl p-4 shadow-lg mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(je,{className:"w-5 h-5 mr-2"}),"Activity: Admin Broadcast Pushes"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Range:"}),["all","today","7d","30d"].map(d=>e.jsx("button",{onClick:()=>I(d),className:`px-2 py-1 rounded border ${z===d?"bg-primary text-primary-foreground":"border-border text-foreground"}`,children:d.toUpperCase()},d))]}),B?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading..."}):A.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No broadcast pushes yet."}):e.jsx("div",{className:"space-y-2",children:A.map(d=>e.jsxs("div",{className:"text-sm border border-border rounded-lg px-3 py-2",children:[e.jsx("div",{className:"font-medium",children:d.title}),e.jsx("div",{className:"text-muted-foreground whitespace-pre-wrap",children:d.message}),e.jsxs("div",{className:"text-muted-foreground mt-1 flex items-center gap-2",children:[e.jsx("span",{children:new Date(d.created_at).toLocaleString()}),d.type?e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-muted border border-border",children:d.type}):null]})]},d.id))})]})}function gt(){const{userProfile:_}=Ve(),{toast:a}=ce(),[T,B]=et(),q=T.get("tab")||"overview",z=t=>{const s=new URLSearchParams(T);s.set("tab",t),B(s,{replace:!1})};if((_==null?void 0:_.role)!=="admin")return e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Aapke paas admin adhikaar nahi hain."})]});const[I,N]=p.useState([]),[A,d]=p.useState(!0),[f,v]=p.useState(!1),[n,x]=p.useState(null),[k,b]=p.useState(!1),[Z,H]=p.useState([]),[re,fe]=p.useState(!1),[M,K]=p.useState({text:"",options:["","","",""],correctIndex:0}),[Ie,ye]=p.useState(!1),[me,Ne]=p.useState(""),[we,Qe]=p.useState("append"),[_e,ue]=p.useState(!1),[ke,Ce]=p.useState(null),ze=["opinion","gk","movies","sports"],[ie,pe]=p.useState("form"),ae=()=>({text:"",options:["",""],correctIndex:0}),[F,W]=p.useState([ae()]),[o,U]=p.useState({title:"",prizes:["","",""],start_time:"",end_time:"",category:"",bulk_text:"",prize_type:"money"});p.useEffect(()=>{q==="overview"&&J()},[q]);const J=async()=>{try{const{data:t,error:s}=await h.from("quizzes").select("*").order("start_time",{ascending:!1});if(s)throw s;N(t||[])}catch(t){a({title:"Error",description:"Failed to fetch quizzes.",variant:"destructive"})}finally{d(!1)}},V=async t=>{try{const{data:s,error:i}=await h.from("questions").select("id, question_text, options ( id, option_text, is_correct )").eq("quiz_id",t);if(i)throw i;H(s||[])}catch(s){a({title:"Error",description:"Failed to fetch questions.",variant:"destructive"})}},ne=(t,{strict:s=!1,allowZeroCorrect:i=!1}={})=>{var D,R;const r=String(t||"").trim().split(/\n\s*\n+/),c=[],l=[],m=[];let j=0;for(const Y of r){const G=Y.split(/\r?\n/).map(u=>u.trim()),xe=G.filter(Boolean);if(!xe.length)continue;j+=1;const oe=xe[0].replace(/^Q\d*\.?\s*/i,"").replace(/^Question\s*[:\-]\s*/i,""),P=[];let ee="";for(let u=1;u<G.length;u++){const w=G[u];if(!w)continue;if(/^ans(wer)?\s*[:\-]/i.test(w)){ee=w;continue}const Q=w.match(/^[-*•]?\s*\[(x|X| )\]\s*(.+)$/);if(Q){const X=/x/i.test(Q[1]);P.push({option_text:Q[2].trim(),is_correct:X});continue}const L=w.match(/^(?:[-*•]|[A-Da-d]\)|\d+\)|[A-Da-d][.:])\s*(.+)$/);let $=L?L[1].trim():w.replace(/^[*]\s*/,"").trim();const E=/^\*/.test(w);$&&P.push({option_text:$,is_correct:E})}if(ee){const u=ee.split(/[:\-]/).slice(1).join(":").trim(),w=(R=(D=u.match(/^[A-Da-d]/))==null?void 0:D[0])==null?void 0:R.toUpperCase(),Q=parseInt(u,10);if(w){const L={A:0,B:1,C:2,D:3}[w];Number.isInteger(L)&&P[L]&&P.forEach(($,E)=>$.is_correct=E===L)}else if(!isNaN(Q)&&Q>=1&&P[Q-1])P.forEach((L,$)=>L.is_correct=$===Q-1);else{const L=u.toLowerCase(),$=P.findIndex(E=>E.option_text.toLowerCase()===L||E.option_text.toLowerCase().includes(L));$>=0&&P.forEach((E,X)=>E.is_correct=X===$)}}let S=P.filter(u=>u.option_text);if(S.length>4){const u=S.findIndex(w=>w.is_correct);if(u>=0){const w=S[u],Q=S.filter((L,$)=>$!==u);S=[w,...Q.slice(0,3)]}else S=S.slice(0,4);m.push(`Q${j}: More than 4 options found; trimmed to 4 (kept the marked correct).`)}if(!oe){l.push(`Q${j}: Question text missing.`);continue}if(S.length<2){l.push(`Q${j}: At least 2 options required.`);continue}let y=S.filter(u=>u.is_correct).length;if(i)y>0&&m.push(`Q${j}: Correct marks ignored for opinion category.`),S=S.map(u=>({...u,is_correct:!1}));else if(s)y===0?l.push(`Q${j}: Mark exactly one correct option with [x] or provide an Answer: line.`):y>1&&l.push(`Q${j}: Multiple correct marks detected; keep only one [x] or use a single Answer: line.`);else if(y===0)S[0].is_correct=!0;else if(y>1){let u=!1;S=S.map(w=>w.is_correct&&!u?(u=!0,w):{...w,is_correct:!1})}c.push({question_text:oe,options:S})}return{items:c,errors:l,warnings:m}},Se=async(t,s,i="append")=>{try{const{error:r}=await h.rpc("admin_bulk_upsert_questions",{p_quiz_id:t,p_payload:s,p_mode:i});if(!r)return{ok:!0}}catch(r){}i==="replace"&&await h.from("questions").delete().eq("quiz_id",t);for(const r of s){const{data:c,error:l}=await h.from("questions").insert({quiz_id:t,question_text:r.question_text}).select("id").single();if(l)return{ok:!1,message:l.message};const m=c.id,j=r.options.map(R=>({question_id:m,option_text:R.option_text,is_correct:!!R.is_correct})),{error:D}=await h.from("options").insert(j);if(D)return{ok:!1,message:D.message}}return{ok:!0}},Te=async()=>{if(!n)return;if(n!=null&&n.start_time?new Date(n.start_time).getTime()<=Date.now():!1){a({title:"Locked",description:"Cannot add after quiz start",variant:"destructive"});return}const s=(M.text||"").trim(),i=(M.options||[]).map(l=>(l||"").trim()).filter(Boolean).slice(0,4);if(!s){a({title:"Question required",variant:"destructive"});return}if(i.length<2){a({title:"At least 2 options required",variant:"destructive"});return}const r=(n==null?void 0:n.category)==="opinion",c=Math.min(Math.max(M.correctIndex||0,0),i.length-1);try{const{data:l,error:m}=await h.from("questions").insert({quiz_id:n.id,question_text:s}).select("id").single();if(m)throw m;const j=l.id,D=i.map((Y,G)=>({question_id:j,option_text:Y,is_correct:r?!1:G===c})),{error:R}=await h.from("options").insert(D);if(R)throw R;a({title:"Added",description:"Question created"}),fe(!1),K({text:"",options:["","","",""],correctIndex:0}),await V(n.id)}catch(l){a({title:"Add failed",description:l.message,variant:"destructive"})}},Le=async(t,s)=>{const i=(s||"").trim();if(!i)return a({title:"Question khaali nahi ho sakta",variant:"destructive"});const{error:r}=await h.from("questions").update({question_text:i}).eq("id",t);if(r)return a({title:"Update failed",description:r.message,variant:"destructive"});await V(n.id)},Pe=async t=>{if(!confirm("Is question aur iske options ko delete karein?"))return;const{error:s}=await h.from("questions").delete().eq("id",t);if(s)return a({title:"Delete failed",description:s.message,variant:"destructive"});await V(n.id)},$e=async t=>{const s=window.prompt("Option text daalein");if(!s||!s.trim())return;const{error:i}=await h.from("options").insert({question_id:t,option_text:s.trim()});if(i)return a({title:"Add failed",description:i.message,variant:"destructive"});await V(n.id)},Oe=async(t,s)=>{const i=(s||"").trim();if(!i)return a({title:"Option khaali nahi ho sakta",variant:"destructive"});const{error:r}=await h.from("options").update({option_text:i}).eq("id",t);if(r)return a({title:"Update failed",description:r.message,variant:"destructive"});await V(n.id)},Be=async t=>{if(!confirm("Is option ko delete karein?"))return;const{error:s}=await h.from("options").delete().eq("id",t);if(s)return a({title:"Delete failed",description:s.message,variant:"destructive"});await V(n.id)},Re=async t=>{t.preventDefault();try{const s=[],i=(o.title||"").trim();o.category||s.push("Please choose a category"),(!i||i.length<3)&&s.push("Title is too short"),o.start_time||s.push("Start time is required"),o.end_time||s.push("End time is required");let r={items:[],errors:[],warnings:[]};const c=[];F.length||s.push("Add at least one question"),F.forEach((y,u)=>{var E;const w=(y.text||"").trim(),Q=(y.options||[]).map(X=>(X||"").trim()).filter(Boolean).slice(0,4);w||r.errors.push(`Q${u+1}: Question text is required`),Q.length<2&&r.errors.push(`Q${u+1}: At least 2 options required`),Q.length>4&&r.warnings.push(`Q${u+1}: Max 4 options; extra ignored`);const L=Math.max(0,Math.min((E=y.correctIndex)!=null?E:0,Q.length-1)),$=Q.map((X,Fe)=>({option_text:X,is_correct:Fe===L}));w&&Q.length>=2&&c.push({question_text:w,options:$})}),r.items=c,r.errors.length&&s.push(r.errors[0]),r.items.length||s.push("No valid questions detected"),ie==="paste"&&s.push("Load pasted questions into Form and review before creating");const l=y=>{try{const u=new Date(y);return isNaN(u.getTime())?null:u}catch(u){return null}},m=l(o.start_time),j=l(o.end_time);(!m||!j)&&s.push("Invalid start/end time"),m&&j&&j<=m&&s.push("End time must be after start time"),m&&m.getTime()<Date.now()-6e4&&s.push("Start time must be in the future");const D=parseInt(o.prizes[0]||"",10),R=o.prizes[1]?parseInt(o.prizes[1],10):0,Y=o.prizes[2]?parseInt(o.prizes[2],10):0;if((isNaN(D)||D<=0)&&s.push("1st prize must be a positive number"),o.prizes[1]&&(isNaN(R)||R<0)&&s.push("2nd prize must be 0 or more"),o.prizes[2]&&(isNaN(Y)||Y<0)&&s.push("3rd prize must be 0 or more"),s.length){a({title:"Please fix the form",description:s[0],variant:"destructive"});return}const G=o.prizes.filter(y=>y).map(y=>parseInt(y)),xe=G.reduce((y,u)=>y+u,0),oe=y=>{if(!y)return null;const u=new Date(y);return isNaN(u.getTime())?null:u.toISOString()},{data:P,error:ee}=await h.from("quizzes").insert([{title:o.title,prize_pool:xe,prizes:G,start_time:oe(o.start_time),end_time:oe(o.end_time),status:"upcoming",category:o.category||null,prize_type:o.prize_type||"money"}]).select("id, title, category, prizes, prize_pool, start_time, end_time").single();if(ee)throw ee;a({title:"Quiz created",description:"Questions will be saved now."});const S=r.items;if(v(!1),U({title:"",prizes:["","",""],start_time:"",end_time:"",category:"",bulk_text:"",prize_type:"money"}),pe("form"),W([ae()]),x(P),S.length>0){ue(!0);const y=await Se(P.id,S,"replace");ue(!1),y.ok?a({title:"Questions added",description:`${S.length} questions created.`}):a({title:"Bulk add failed",description:y.message||"Please try again",variant:"destructive"})}await V(P.id),b(!0),J()}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}},Ee=async t=>{if(confirm("Kya aap is quiz ko delete karna chahte hain?"))try{const{error:s}=await h.from("quizzes").delete().eq("id",t);if(s)throw s;a({title:"Success",description:"Quiz delete ho gaya."}),J()}catch(s){a({title:"Error",description:s.message,variant:"destructive"})}},Me=async t=>{try{Ce(t);const{error:s}=await h.rpc("admin_recompute_quiz_results",{p_quiz_id:t});if(s)throw s;a({title:"Results recomputed",description:"Leaderboard update ho gaya."})}catch(s){a({title:"Recompute failed",description:s.message,variant:"destructive"})}finally{Ce(null)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl text-foreground",children:[e.jsxs(ge.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Quiz Dangal Admin"}),e.jsx("p",{className:"text-muted-foreground",children:"Admin dashboard"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-6",children:[{key:"overview",title:"Overview",icon:e.jsx(tt,{className:"w-4 h-4"})},{key:"notifications",title:"Notifications",icon:e.jsx(je,{className:"w-4 h-4"})},{key:"redemptions",title:"Redemptions",icon:e.jsx(st,{className:"w-4 h-4"})}].map(t=>e.jsxs("button",{onClick:()=>z(t.key),className:`px-3 py-2 rounded-lg border text-sm transition-colors inline-flex items-center gap-2 ${t.key===q?"bg-primary text-primary-foreground border-transparent shadow":"bg-muted text-muted-foreground border-border hover:text-foreground"} `,children:[t.icon,t.title]},t.key))}),q==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs(g,{onClick:()=>v(!0),className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Create New Quiz"]})}),f&&e.jsxs(ge.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-1",children:"Create New Quiz"}),e.jsxs("form",{onSubmit:Re,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Category (Section)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ze.map(t=>e.jsx("button",{type:"button",onClick:()=>U({...o,category:t}),className:`px-3 py-1 rounded-full border text-sm capitalize ${o.category===t?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border hover:text-foreground"}`,children:t},t))}),!o.category&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:"Please choose a category"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(O,{htmlFor:"title",children:"Quiz Title"}),e.jsx(C,{id:"title",value:o.title,onChange:t=>U({...o,title:t.target.value}),placeholder:"Daily Opinion Quiz - Evening",required:!0})]})}),e.jsxs("div",{children:[e.jsx(O,{children:"Prize Distribution"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"}),e.jsx("div",{className:"flex gap-2",children:["money","coins","others"].map(t=>e.jsx("button",{type:"button",onClick:()=>U({...o,prize_type:t}),className:`px-2 py-1 rounded border text-xs capitalize ${o.prize_type===t?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border"}`,children:t},t))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(C,{placeholder:o.prize_type==="coins"?"1st Prize (coins)":"1st Prize (amount)",value:o.prizes[0],onChange:t=>{const s=[...o.prizes];s[0]=t.target.value,U({...o,prizes:s})}}),e.jsx(C,{placeholder:o.prize_type==="coins"?"2nd Prize (coins)":"2nd Prize (amount)",value:o.prizes[1],onChange:t=>{const s=[...o.prizes];s[1]=t.target.value,U({...o,prizes:s})}}),e.jsx(C,{placeholder:o.prize_type==="coins"?"3rd Prize (coins)":"3rd Prize (amount)",value:o.prizes[2],onChange:t=>{const s=[...o.prizes];s[2]=t.target.value,U({...o,prizes:s})}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Start Time"}),e.jsx(C,{type:"datetime-local",value:o.start_time,onChange:t=>U({...o,start_time:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{children:"End Time"}),e.jsx(C,{type:"datetime-local",value:o.end_time,onChange:t=>U({...o,end_time:t.target.value}),required:!0})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{children:"Questions entry mode:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:`px-3 py-1 rounded-md text-sm border ${ie==="form"?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border"}`,onClick:()=>pe("form"),children:"Form"}),e.jsx("button",{type:"button",className:`px-3 py-1 rounded-md text-sm border ${ie==="paste"?"bg-primary text-primary-foreground border-transparent":"bg-muted text-muted-foreground border-border"}`,onClick:()=>pe("paste"),children:"Paste"})]})]}),ie==="form"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:o.category==="opinion"?"Add questions with 2–4 options. No correct option in Opinion category.":"Add questions with 2–4 options. Select exactly one correct."}),F.map((t,s)=>e.jsxs("div",{className:"p-3 rounded-xl border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground w-10",children:["Q",s+1,"."]}),e.jsx(C,{value:t.text,onChange:i=>{const r=[...F];r[s]={...r[s],text:i.target.value},W(r)},placeholder:"Question text",className:"flex-1"}),e.jsx(g,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-600",onClick:()=>{const i=[...F];i.splice(s,1),W(i.length?i:[ae()])},children:"Remove"})]}),e.jsxs("div",{className:"mt-2 space-y-2",children:[(t.options||[]).slice(0,4).map((i,r)=>{var c;return e.jsxs("div",{className:"flex items-center gap-2",children:[o.category!=="opinion"&&e.jsx("input",{type:"radio",name:`qdraft-${s}`,checked:((c=t.correctIndex)!=null?c:0)===r,onChange:()=>{const l=[...F];l[s]={...l[s],correctIndex:r},W(l)}}),e.jsx(C,{value:i,onChange:l=>{const m=[...F],j=[...m[s].options||[]];j[r]=l.target.value,m[s]={...m[s],options:j},W(m)},placeholder:`Option ${r+1}`,className:"flex-1"}),(t.options||[]).length>2&&e.jsx(g,{type:"button",variant:"outline",size:"sm",className:"border-red-300 text-red-600",onClick:()=>{var D;const l=[...F],m=[...l[s].options||[]];m.splice(r,1);const j=Math.min((D=l[s].correctIndex)!=null?D:0,m.length-1);l[s]={...l[s],options:m,correctIndex:j},W(l)},children:"Delete"})]},r)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 disabled:opacity-60",disabled:(t.options||[]).length>=4,onClick:()=>{const i=[...F],r=[...i[s].options||[]].slice(0,4).concat("");i[s]={...i[s],options:r},W(i)},children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Add Option"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Max 4 options."})]})]})]},s)),e.jsx("div",{children:e.jsxs(g,{type:"button",onClick:()=>W(t=>[...t,ae()]),children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Add Question"]})})]}):e.jsxs("div",{children:[e.jsx(O,{children:"Paste Questions (RAW format) *"}),e.jsx(le,{placeholder:`Use RAW format with [x]/[ ] tick and max 4 options. Example:
Q1. Capital of India?
- [ ] Mumbai
- [x] Delhi
- [ ] Kolkata
- [ ] Jaipur

Q2. Best color?
- [x] Blue
- [ ] Red
- [ ] Green
(Alternatively, provide Answer: B or Answer: 2 line)`,value:o.bulk_text,onChange:t=>U({...o,bulk_text:t.target.value}),className:"mt-1 h-40"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[o.category==="opinion"?"No correct option required for Opinion category.":"Mark exactly one correct option per question with [x] or Answer: A/B/1."," Max 4 options per question."]}),(()=>{const{items:t,errors:s,warnings:i}=ne(o.bulk_text,{strict:!0,allowZeroCorrect:o.category==="opinion"});return e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("div",{className:"text-foreground/80",children:["Preview: ",t.length," questions"]}),i.length>0&&e.jsxs("div",{className:"text-xs text-amber-600",children:[i[0],i.length>1?` (+${i.length-1} more)`:""]}),s.length>0&&e.jsxs("div",{className:"text-xs text-destructive",children:[s[0],s.length>1?` (+${s.length-1} more)`:""]}),e.jsx("div",{className:"pt-2",children:e.jsx(g,{type:"button",onClick:()=>{const r=ne(o.bulk_text,{strict:!0,allowZeroCorrect:o.category==="opinion"});if(r.errors.length){a({title:"Fix pasted input",description:r.errors[0],variant:"destructive"});return}if(!r.items.length){a({title:"No valid questions",variant:"destructive"});return}const c=r.items.map(l=>{const m=(l.options||[]).slice(0,4),j=o.category==="opinion"?0:Math.max(0,m.findIndex(D=>D.is_correct));return{text:l.question_text,options:m.map(D=>D.option_text),correctIndex:j<0?0:j}});W(c.length?c:[ae()]),pe("form"),a({title:"Loaded into form",description:`${c.length} questions ready to review & edit.`})},className:"bg-indigo-600 hover:bg-indigo-700",children:"Load into Form (Preview & Edit)"})})]})})()]}),e.jsxs("div",{className:"flex space-x-4",children:[(()=>{let t=!1;return ie==="paste"?t=!0:t=!F.some(i=>(i.text||"").trim()&&(i.options||[]).filter(r=>(r||"").trim()).length>=2),e.jsx(g,{type:"submit",disabled:t,className:"bg-green-600 hover:bg-green-700 disabled:opacity-60",children:"Create Quiz"})})(),e.jsx(g,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground flex items-center",children:[e.jsx(qe,{className:"w-5 h-5 mr-2"}),"All Quizzes"]}),A?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(se,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading quizzes..."]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Active / Upcoming"}),e.jsx("div",{className:"space-y-4 mt-2",children:I.filter(t=>{const s=Date.now();t.start_time&&new Date(t.start_time).getTime();const i=t.end_time?new Date(t.end_time).getTime():null;return i===null||s<=i}).map((t,s)=>e.jsx(ge.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Category: ",t.category||"—"]}),e.jsxs("span",{children:["Prize Type: ",t.prize_type||"money"]}),e.jsxs("span",{children:["Prize Pool: ",t.prize_type==="coins"?"🪙":"","₹",t.prize_pool]}),e.jsxs("span",{children:["Prizes: ",t.prize_type==="coins"?"🪙 ":"",Array.isArray(t.prizes)?t.prizes.join(", "):""]})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Start: ",t.start_time?he(t.start_time):"—"]}),e.jsxs("span",{className:"ml-4",children:["End: ",t.end_time?he(t.end_time):"—"]})]}),(()=>{const i=t.start_time?new Date(t.start_time).getTime()<=Date.now():!1;return e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsxs("select",{disabled:i,title:i?"Locked after start time":void 0,className:`border border-border bg-background text-foreground rounded-md px-2 py-2 capitalize ${i?"opacity-60 cursor-not-allowed":""}`,value:t.category||"",onChange:async r=>{if(i){a({title:"Locked",description:"Cannot change after start",variant:"destructive"});return}const{error:c}=await h.from("quizzes").update({category:r.target.value}).eq("id",t.id);c?a({title:"Update failed",description:c.message,variant:"destructive"}):J()},children:[e.jsx("option",{value:"",children:"Select category"}),ze.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsx(C,{type:"datetime-local",disabled:i,title:i?"Locked after start time":void 0,value:Ae(t.start_time),onChange:async r=>{if(i){a({title:"Locked",description:"Cannot change after start",variant:"destructive"});return}const c=r.target.value,l=c?new Date(c).toISOString():null;I[s].start_time=l,N([...I]);const{error:m}=await h.from("quizzes").update({start_time:l}).eq("id",t.id);m&&(a({title:"Update failed",description:m.message,variant:"destructive"}),J())}}),e.jsx(C,{type:"datetime-local",disabled:i,title:i?"Locked after start time":void 0,value:Ae(t.end_time),onChange:async r=>{if(i){a({title:"Locked",description:"Cannot change after start",variant:"destructive"});return}const c=r.target.value,l=c?new Date(c).toISOString():null;I[s].end_time=l,N([...I]);const{error:m}=await h.from("quizzes").update({end_time:l}).eq("id",t.id);m&&(a({title:"Update failed",description:m.message,variant:"destructive"}),J())}})]})})()]}),(()=>{const i=Date.now(),r=t.start_time?new Date(t.start_time).getTime():null,c=!r||i<r;return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Me(t.id),disabled:ke===t.id,className:"text-indigo-600 hover:text-indigo-700",children:ke===t.id?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-1 animate-spin"}),"Recomputing"]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"h-4 w-4 mr-1"}),"Recompute"]})}),e.jsxs(ve,{to:`/results/${t.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-border hover:bg-muted text-blue-600",children:[e.jsx(De,{className:"h-4 w-4"})," Results"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>{x(t),V(t.id),b(!0)},className:"text-blue-600 hover:text-blue-700",children:[e.jsx(it,{className:"h-4 w-4"}),"Questions"]}),e.jsxs("div",{className:"relative group",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Ee(t.id),disabled:!c,className:`${c?"text-red-600 hover:text-red-700":"text-muted-foreground opacity-60 cursor-not-allowed"}`,children:e.jsx(de,{className:"h-4 w-4"})}),!c&&e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap text-xs bg-popover text-popover-foreground border border-border px-2 py-1 rounded shadow hidden group-hover:block",children:"Cannot delete after start time"})]})]})})()]})},t.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Finished"}),e.jsx("div",{className:"space-y-4 mt-2",children:I.filter(t=>{const s=Date.now(),i=t.end_time?new Date(t.end_time).getTime():null;return i!==null&&s>i}).map((t,s)=>e.jsx(ge.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05},className:"bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Category: ",t.category||"—"]}),e.jsxs("span",{children:["Prize Type: ",t.prize_type||"money"]}),e.jsxs("span",{children:["Prize Pool: ",t.prize_type==="coins"?"🪙":"","₹",t.prize_pool]}),e.jsxs("span",{children:["Prizes: ",t.prize_type==="coins"?"🪙 ":"",Array.isArray(t.prizes)?t.prizes.join(", "):""]})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Start: ",t.start_time?he(t.start_time):"—"]}),e.jsxs("span",{className:"ml-4",children:["End: ",t.end_time?he(t.end_time):"—"]})]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(ve,{to:`/results/${t.id}`,className:"inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-md border border-border hover:bg-muted text-blue-600",children:[e.jsx(De,{className:"h-4 w-4"})," Results"]})})]})},t.id))})]})]})]}),k&&n&&e.jsxs("div",{className:"mt-6 bg-card text-card-foreground border border-border rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["Questions for: ",n.title]}),e.jsx("div",{className:"flex gap-2",children:(()=>{const t=n!=null&&n.start_time?new Date(n.start_time).getTime()<=Date.now():!1;return e.jsxs(e.Fragment,{children:[e.jsxs(g,{onClick:()=>{if(t){a({title:"Locked",description:"Cannot add after quiz start",variant:"destructive"});return}fe(!0)},disabled:t,className:"bg-indigo-600 hover:bg-indigo-700 disabled:opacity-60",size:"sm",children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),re?"Composer Open":"Add Question"]}),e.jsxs(We,{open:Ie,onOpenChange:ye,children:[e.jsx(Ze,{asChild:!0,children:e.jsx(g,{variant:"outline",size:"sm",disabled:t,children:"Bulk Add/Replace"})}),e.jsxs(Ge,{className:"max-w-2xl",children:[e.jsxs(He,{children:[e.jsx(Ke,{children:"Bulk add questions"}),e.jsx(Xe,{children:"Paste multiple questions with options. Supported formats shown below."})]}),e.jsxs("div",{children:[e.jsx(le,{value:me,onChange:s=>Ne(s.target.value),className:"h-56",disabled:t,placeholder:`RAW format with [x]/[ ] and max 4 options. Example:
Q. Sample?
- [x] Option 1
- [ ] Option 2
- [ ] Option 3
- [ ] Option 4

Alternatively: use Answer: B or Answer: 2`}),(()=>{const{items:s,errors:i,warnings:r}=ne(me,{strict:!0,allowZeroCorrect:(n==null?void 0:n.category)==="opinion"});return e.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-foreground/80",children:["Preview: ",s.length," questions"]}),e.jsxs("label",{className:"text-sm text-foreground/80 flex items-center gap-2",children:[e.jsx("span",{children:"Mode:"}),e.jsxs("select",{value:we,onChange:c=>Qe(c.target.value),className:"border border-border bg-background text-foreground rounded-md px-2 py-1 text-sm",disabled:t,children:[e.jsx("option",{value:"append",children:"Append"}),e.jsx("option",{value:"replace",children:"Replace existing"})]})]})]}),r.length>0&&e.jsxs("div",{className:"text-xs text-amber-600",children:[r[0],r.length>1?` (+${r.length-1} more)`:""]}),i.length>0&&e.jsxs("div",{className:"text-xs text-destructive",children:[i[0],i.length>1?` (+${i.length-1} more)`:""]})]})})()]}),e.jsxs(Je,{children:[e.jsx(Ye,{asChild:!0,children:e.jsx(g,{variant:"outline",children:"Cancel"})}),e.jsx(g,{disabled:_e||t||ne(me,{strict:!0,allowZeroCorrect:(n==null?void 0:n.category)==="opinion"}).errors.length>0,onClick:async()=>{const i=ne(me,{strict:!0,allowZeroCorrect:(n==null?void 0:n.category)==="opinion"}).items;if(!i.length){a({title:"No valid questions detected",variant:"destructive"});return}ue(!0);const r=await Se(n.id,i,we);if(ue(!1),!r.ok){a({title:"Bulk add failed",description:r.message||"Try again",variant:"destructive"});return}a({title:"Questions added",description:`${i.length} questions processed.`}),ye(!1),Ne(""),await V(n.id)},children:_e?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-1 animate-spin"}),"Working…"]}):"Apply"})]})]})]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>b(!1),children:"Close"})]})})()})]}),Z.length===0?e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:"No questions yet"}):e.jsxs("div",{className:"space-y-4",children:[(()=>{const t=n!=null&&n.start_time?new Date(n.start_time).getTime()<=Date.now():!1;if(!re)return null;const s=(n==null?void 0:n.category)==="opinion";return e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-foreground",children:"New Question"}),e.jsx(C,{placeholder:"Type your question",value:M.text,disabled:t,onChange:i=>K(r=>({...r,text:i.target.value})),className:"mb-3"}),e.jsxs("div",{className:"space-y-2",children:[(M.options||[]).slice(0,4).map((i,r)=>e.jsxs("div",{className:"flex items-center gap-2",children:[!s&&e.jsx("input",{type:"radio",name:"newq-correct",checked:M.correctIndex===r,disabled:t,onChange:()=>K(c=>({...c,correctIndex:r}))}),e.jsx(C,{placeholder:`Option ${r+1}`,value:i,disabled:t,onChange:c=>{const l=[...M.options];l[r]=c.target.value,K(m=>({...m,options:l}))},className:"flex-1"}),M.options.length>2&&e.jsx(g,{type:"button",variant:"outline",size:"sm",className:`border-red-300 ${t?"text-muted-foreground opacity-60 cursor-not-allowed":"text-red-600"}`,disabled:t,onClick:()=>{const c=[...M.options];c.splice(r,1),K(l=>({...l,options:c,correctIndex:Math.min(l.correctIndex,c.length-1)}))},children:e.jsx(de,{className:"w-4 h-4"})})]},r)),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{type:"button",size:"sm",className:"bg-green-600 hover:bg-green-700 disabled:opacity-60",disabled:t||(M.options||[]).length>=4,onClick:()=>K(i=>({...i,options:[...i.options].slice(0,4).concat("")})),children:[e.jsx(te,{className:"w-4 h-4 mr-1"})," Add Option"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s?"Opinion: no correct option needed.":"Select the correct option. Max 4 options."})]})]}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(g,{type:"button",onClick:Te,className:"bg-indigo-600 hover:bg-indigo-700 disabled:opacity-60",disabled:t,children:"Save Question"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>{fe(!1),K({text:"",options:["","","",""],correctIndex:0})},children:"Cancel"})]})]})})(),Z.map(t=>{const s=n!=null&&n.start_time?new Date(n.start_time).getTime()<=Date.now():!1,i=(n==null?void 0:n.category)==="opinion";return e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{defaultValue:t.question_text,onBlur:r=>{if(s){a({title:"Locked",description:"Cannot edit after quiz start",variant:"destructive"});return}Le(t.id,r.target.value)},className:"flex-1",disabled:s}),e.jsx(g,{variant:"outline",size:"sm",className:`border-red-300 ${s?"text-muted-foreground opacity-60 cursor-not-allowed":"text-red-600"}`,onClick:()=>{if(s){a({title:"Locked",description:"Cannot delete after quiz start",variant:"destructive"});return}Pe(t.id)},disabled:s,children:e.jsx(de,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 pl-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Options"}),e.jsxs("div",{className:"space-y-2",children:[(t.options||[]).map(r=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{defaultValue:r.option_text,onBlur:c=>{if(s){a({title:"Locked",description:"Cannot edit after quiz start",variant:"destructive"});return}Oe(r.id,c.target.value)},className:"flex-1",disabled:s}),!i&&e.jsxs("label",{className:"flex items-center gap-1 text-xs text-foreground/80",children:[e.jsx("input",{type:"radio",name:`correct-${t.id}`,defaultChecked:!!r.is_correct,disabled:s,onChange:async c=>{if(s){c.preventDefault();return}if(!c.target.checked)return;const{error:l}=await h.from("options").update({is_correct:!1}).eq("question_id",t.id);if(l){a({title:"Update failed",description:l.message,variant:"destructive"});return}const{error:m}=await h.from("options").update({is_correct:!0}).eq("id",r.id);m&&a({title:"Update failed",description:m.message,variant:"destructive"}),await V(n.id)}}),"Correct"]}),e.jsx(g,{variant:"outline",size:"sm",className:`border-red-300 ${s?"text-muted-foreground opacity-60 cursor-not-allowed":"text-red-600"}`,onClick:()=>{if(s){a({title:"Locked",description:"Cannot delete after quiz start",variant:"destructive"});return}Be(r.id)},disabled:s,children:e.jsx(de,{className:"w-4 h-4"})})]},r.id)),e.jsxs(g,{onClick:()=>{if(s){a({title:"Locked",description:"Cannot add after quiz start",variant:"destructive"});return}if((t.options||[]).length>=4){a({title:"Limit reached",description:"Max 4 options per question",variant:"destructive"});return}$e(t.id)},size:"sm",className:"bg-green-600 hover:bg-green-700 disabled:opacity-60",disabled:s,children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Add Option"]})]})]})]},t.id)})]})]})]}),q==="notifications"&&e.jsx(nt,{}),q==="redemptions"&&e.jsx(lt,{})]})}function lt(){const{toast:_}=ce(),[a,T]=p.useState([]),[B,q]=p.useState(!0),[z,I]=p.useState(!1),[N,A]=p.useState({title:"",coins_required:"",description:"",image_url:""}),d=async()=>{q(!0);const{data:x,error:k}=await h.from("reward_catalog").select("*").order("coins_required",{ascending:!1});k?(_({title:"Load failed",description:k.message,variant:"destructive"}),T([])):T(x||[]),q(!1)};p.useEffect(()=>{d()},[]);const f=async x=>{var H,re;x.preventDefault();const k=N.title.trim(),b=parseInt(N.coins_required,10);if(!k||isNaN(b)||b<0){_({title:"Invalid input",description:"Title required and coins must be a non-negative number",variant:"destructive"});return}I(!0);const{error:Z}=await h.from("reward_catalog").insert({title:k,coins_required:b,description:((H=N.description)==null?void 0:H.trim())||null,image_url:((re=N.image_url)==null?void 0:re.trim())||null,is_active:!0});Z?_({title:"Add failed",description:Z.message,variant:"destructive"}):(_({title:"Added",description:"Catalog item created"}),A({title:"",coins_required:"",description:"",image_url:""}),d()),I(!1)},v=async(x,k)=>{const{error:b}=await h.from("reward_catalog").update(k).eq("id",x);b?_({title:"Update failed",description:b.message,variant:"destructive"}):d()},n=async x=>{if(!confirm("Delete this item?"))return;const{error:k}=await h.from("reward_catalog").delete().eq("id",x);k?_({title:"Delete failed",description:k.message,variant:"destructive"}):(_({title:"Deleted"}),d())};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Admin: Redemptions Catalog"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Items jinko users coins se redeem kar sakte hain"})]}),e.jsx("div",{className:"bg-card text-card-foreground border border-border rounded-2xl p-4 shadow-lg",children:e.jsxs("form",{onSubmit:f,className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"rc_title",children:"Title *"}),e.jsx(C,{id:"rc_title",value:N.title,onChange:x=>A({...N,title:x.target.value}),placeholder:"e.g., ₹100 Paytm",required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"rc_coins",children:"Coins *"}),e.jsx(C,{id:"rc_coins",type:"number",min:"0",value:N.coins_required,onChange:x=>A({...N,coins_required:x.target.value}),placeholder:"e.g., 1000",required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"rc_img",children:"Image URL (optional)"}),e.jsx(C,{id:"rc_img",value:N.image_url,onChange:x=>A({...N,image_url:x.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(O,{htmlFor:"rc_desc",children:"Description (optional)"}),e.jsx(le,{id:"rc_desc",value:N.description,onChange:x=>A({...N,description:x.target.value}),placeholder:"Short details"})]}),e.jsx("div",{children:e.jsx(g,{type:"submit",disabled:z,className:"bg-green-600 hover:bg-green-700",children:z?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 mr-2 animate-spin"}),"Adding..."]}):"Add Item"})})]})}),e.jsxs("div",{className:"bg-card text-card-foreground border border-border rounded-2xl p-4 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Catalog Items"}),B?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(se,{className:"inline-block h-6 w-6 animate-spin text-indigo-500 mr-2"})," Loading..."]}):a.length===0?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No items"}):e.jsx("div",{className:"space-y-2",children:a.map(x=>e.jsxs("div",{className:"p-3 rounded-xl bg-card/80 border border-border flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{defaultValue:x.title,onBlur:k=>{const b=k.target.value.trim();b&&b!==x.title&&v(x.id,{title:b})},className:"flex-1"}),e.jsx(C,{type:"number",min:"0",defaultValue:x.coins_required,onBlur:k=>{const b=parseInt(k.target.value,10);!isNaN(b)&&b!==x.coins_required&&v(x.id,{coins_required:b})},className:"w-32"})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1 truncate",children:x.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs text-foreground/80 flex items-center gap-1",children:[e.jsx("input",{type:"checkbox",defaultChecked:!!x.is_active,onChange:k=>v(x.id,{is_active:k.target.checked})})," Active"]}),e.jsx(g,{size:"sm",variant:"outline",className:"text-red-600 border-red-300",onClick:()=>n(x.id),children:e.jsx(de,{className:"w-4 h-4"})})]})]},x.id))})]})]})}export{gt as default};
