import{a as y,s as f,j as e,B as N}from"./index-7ad73617.js";import{r as h}from"./react-8a702e3e.js";import{a as w}from"./router-bcacfb8d.js";import{L as v,P as k,d as j}from"./icons-246101da.js";import{m as u}from"./motion-511bde03.js";import"./supabase-4c1332f7.js";const z=({leaderboard:n,currentUser:a})=>{const l=n.slice(0,10),r=n.find(t=>t.user_id===a.id),o=t=>t===1?"text-amber-300":t===2?"text-slate-200":t===3?"text-orange-300":"text-slate-300";return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-lg text-center text-slate-100",children:"Leaderboard"}),e.jsx("div",{className:"space-y-2",children:l.map(t=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl border transition ${t.user_id===a.id?"bg-indigo-900/30 border-indigo-600/50 shadow-lg":"bg-slate-900/60 border-slate-700/60"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs("span",{className:`font-extrabold tabular-nums w-8 text-center ${o(t.rank)}`,children:[t.rank,"."]}),e.jsx("span",{className:"font-medium text-slate-100 truncate",children:t.display_name})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-bold text-indigo-300",children:[t.score," ",e.jsx("span",{className:"text-sm font-normal text-slate-300",children:"pts"})]})})]},t.user_id))}),r&&r.rank>10&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center text-slate-500",children:"..."}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-indigo-900/30 border border-indigo-600/50 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs("span",{className:"font-extrabold tabular-nums w-8 text-center text-indigo-200",children:[r.rank,"."]}),e.jsx("span",{className:"font-medium text-slate-100 truncate",children:r.display_name})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-bold text-indigo-300",children:[r.score," ",e.jsx("span",{className:"text-sm font-normal text-slate-300",children:"pts"})]})})]})]})]})},b=({size:n=72})=>{const a=typeof n=="number"?`${n}px`:n,[l,r]=h.useState(0),o=["/Trophy.png","/trophy.png","/trophy-question.png","/trophy-question.webp"],t=o[l]||o[0];return e.jsx("div",{className:"relative trophy-float mx-auto mb-4 pointer-events-none",style:{width:a,height:a},children:e.jsx("div",{className:"trophy-sway w-full h-full",children:e.jsx("div",{className:"trophy-pulse w-full h-full",children:l>=0?e.jsx("img",{src:t,alt:"Trophy",className:"w-full h-full object-contain select-none",style:{backgroundColor:"transparent",display:"block"},loading:"eager",decoding:"async",onError:()=>{const d=l+1;d<o.length?r(d):r(-1)}}):e.jsxs("svg",{viewBox:"0 0 128 128",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid meet","aria-hidden":!0,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"qdTg",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffe795"}),e.jsx("stop",{offset:"45%",stopColor:"#ffd34d"}),e.jsx("stop",{offset:"75%",stopColor:"#f0a700"}),e.jsx("stop",{offset:"100%",stopColor:"#b86a00"})]}),e.jsxs("linearGradient",{id:"qdQM",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#6d28d9"}),e.jsx("stop",{offset:"100%",stopColor:"#7c3aed"})]})]}),e.jsx("path",{d:"M28 30c-10 0-18 10-16 20 2 10 14 14 24 11",fill:"none",stroke:"#f0b000",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M100 30c10 0 18 10 16 20-2 10-14 14-24 11",fill:"none",stroke:"#f0b000",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M28 22h72c0 24-10 36-26 41v9c0 7-6 13-14 13s-14-6-14-13v-9C38 58 28 46 28 22Z",fill:"url(#qdTg)"}),e.jsx("rect",{x:"56",y:"72",width:"16",height:"10",rx:"3",fill:"url(#qdTg)"}),e.jsx("rect",{x:"44",y:"82",width:"40",height:"12",rx:"4",fill:"url(#qdTg)"}),e.jsx("rect",{x:"36",y:"94",width:"56",height:"10",rx:"5",fill:"url(#qdTg)"}),e.jsx("text",{x:"64",y:"46",textAnchor:"middle",dominantBaseline:"middle",fontSize:"32",fontWeight:"900",fill:"url(#qdQM)",stroke:"#2b1a59",strokeWidth:"3",paintOrder:"stroke fill",children:"?"})]})})})})},L=()=>{const n=w(),{user:a}=y(),[l,r]=h.useState([]),[o,t]=h.useState(!0),d=h.useCallback(async()=>{if(a)try{const{data:s,error:c}=await f.from("my_quizzes_view").select("*");if(c){console.error("Error fetching my quizzes view:",c),r([]);return}const x=new Date(Date.now()-60*60*1e3),m=(s||[]).map(i=>i.leaderboard&&new Date(i.result_shown_at)<x?{...i,leaderboard:null,resultExpired:!0}:{...i});r(m)}catch(s){console.error(s)}},[a]);return h.useEffect(()=>{typeof window!="undefined"&&"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission().catch(()=>{});const s=f.channel("quiz-results-channel").on("postgres_changes",{event:"INSERT",schema:"public",table:"quiz_results"},m=>{if(d(),typeof window!="undefined"&&"Notification"in window&&Notification.permission==="granted")try{new Notification("Quiz Result Ready",{body:"Your quiz results are available. Tap to view."})}catch(i){}}).subscribe();(async()=>{t(!0),await d(),t(!1)})();const x=setInterval(d,6e4);return()=>{f.removeChannel(s),clearInterval(x)}},[a,d]),o?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(v,{className:"h-12 w-12 animate-spin text-indigo-300"})}):l.length===0?e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center text-slate-100",children:[e.jsx("h1",{className:"text-3xl font-bold heading-gradient text-shadow mb-8",children:"My Quizzes"}),e.jsxs(u.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},transition:{delay:.15},className:"qd-card rounded-2xl p-8 max-w-md mx-auto shadow-2xl",children:[e.jsx(b,{size:104}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Quizzes Yet"}),e.jsx("p",{className:"text-slate-300 mb-6",children:"You haven't joined any quizzes. Play one to see your history!"}),e.jsxs(N,{onClick:()=>n("/"),variant:"brand",className:"w-full rounded-xl",children:[e.jsx(k,{className:"w-5 h-5 mr-2"})," Play Now"]})]})]})})}):e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(b,{size:112})}),e.jsx("h1",{className:"text-3xl font-bold heading-gradient text-shadow mb-8 text-center",children:"My Quizzes & Leaderboard"}),e.jsx("div",{className:"space-y-4",children:l.map((s,c)=>{const x=new Date,m=new Date(s.result_time),i=x>=m&&s.leaderboard,p=i?s.leaderboard.find(g=>g.user_id===a.id):null;return e.jsxs(u.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:c*.06},className:"qd-card rounded-2xl p-6 shadow-xl text-slate-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-white truncate pr-3",children:s.title}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs sm:text-sm font-medium border ${i?"bg-emerald-900/25 text-emerald-200 border-emerald-500/30":s.resultExpired?"bg-slate-800/60 text-slate-300 border-slate-700/60":"bg-amber-900/25 text-amber-200 border-amber-500/30"}`,children:i?"Completed":s.resultExpired?"Expired":"Awaiting Results"})]}),i?e.jsxs(e.Fragment,{children:[p&&e.jsxs("div",{className:"bg-slate-900/60 rounded-xl p-4 flex justify-around items-center text-center mb-4 border border-slate-700/60",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Your Rank"}),e.jsxs("p",{className:"text-2xl font-bold bg-gradient-to-r from-violet-300 via-indigo-200 to-fuchsia-300 bg-clip-text text-transparent",children:["#",p.rank]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Your Score"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-300",children:p.score})]})]}),e.jsx(z,{leaderboard:s.leaderboard,currentUser:a})]}):s.resultExpired?e.jsxs("div",{className:"text-center p-4 bg-slate-900/60 rounded-xl border border-slate-700/60",children:[e.jsx(j,{className:"mx-auto h-8 w-8 text-slate-400 mb-2"}),e.jsx("p",{className:"font-semibold text-slate-200",children:"Results for this quiz have expired."})]}):e.jsxs("div",{className:"text-center p-4 bg-slate-900/60 rounded-xl border border-slate-700/60",children:[e.jsx(j,{className:"mx-auto h-8 w-8 text-slate-400 mb-2"}),e.jsx("p",{className:"font-semibold text-slate-200",children:"Results will be declared at"}),e.jsx("p",{className:"text-slate-300",children:m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},s.id)})})]})})})};export{L as default};
